import{bf as hasOwn,x as reactive,cj as isObject,ck as isPropAbsent,al as _export_sfc,d as defineComponent,ah as useNamespace,ao as inject,bu as h,aj as renderSlot,ai as provide,l as ref,cl as removeClass,cm as addClass,cn as ElCollapseTransition,E as ElIcon,co as loading_default,Q as watch,a8 as nextTick,cp as caret_right_default,r as resolveComponent,a6 as withDirectives,a7 as vShow,o as openBlock,a as createElementBlock,m as createBaseVNode,g as createBlock,w as withCtx,h as resolveDynamicComponent,ak as normalizeClass,p as withModifiers,B as createCommentVNode,b as createVNode,ap as normalizeStyle,F as Fragment,D as renderList,am as getCurrentInstance,bt as isFunction,bd as isString,b8 as shallowRef,y as onMounted,cq as onUpdated,c1 as useEventListener,a_ as EVENT_CODE,an as iconPropType,aQ as useLocale,cr as selectKey,c as computed,cs as formItemContextKey,t as toDisplayString,as as withInstall,ct as pick,cu as toRefs,ax as ElSelect,bc as UPDATE_MODEL_EVENT,aw as ElOption,aU as isEqual,cv as escapeStringRegexp,be as isNil,aG as isEmpty,b7 as isClient,u as useCssVars,i as unref,e as useAppTheme,n as createTextVNode,q as ElTag,U as ElText,L as ElButton,N as ElButtonGroup,bC as __unplugin_components_6$1,cw as __unplugin_components_5,cx as __unplugin_components_7,V as ElSwitch,cy as __unplugin_components_10,W as ElInputNumber,M as ElInput,bB as _sfc_main$8,_ as _export_sfc$1,cz as mergeModels,cA as useModel,K as nanoid,A as isRef,j as useListStore,aa as ElMessage,cB as ElFormItem,cC as ElForm,cD as _sfc_main$9,cE as ElDivider,J as pathUtils,a9 as fsUtils,cF as exists,a4 as astWorker,a5 as watchEffect,a3 as onBeforeUnmount,cG as listen,bS as ElMessageBox,ad as ElAutocomplete,ab as useCore,bQ as getCurrent,z as invokeBaseApi,bw as onUnmounted,R as appWindow}from"./index-D_dbWzvW.js";import{E as ElEmpty}from"./el-empty-NomWsnoc.js";import{d as dataStructureUtils,E as ElTableColumn,a as ElTable,_ as __unplugin_components_14}from"./dataStructure-DMTO_vZU.js";/* empty css                        */import{l as lo}from"./vue-draggable-plus-D0MLr61c.js";import{E as ElCheckbox}from"./el-checkbox-Bt_DKWfY.js";import{E as ElSegmented}from"./el-segmented-Ba6ElbGp.js";import"./isArrayLikeObject-Dlm6siN9.js";const NODE_KEY="$treeNodeId",markNodeData=function(e,o){!o||o[NODE_KEY]||Object.defineProperty(o,NODE_KEY,{value:e.id,enumerable:!1,configurable:!1,writable:!1})},getNodeKey=function(e,o){return e?o[e]:o[NODE_KEY]},handleCurrentChange=(e,o,n)=>{const a=e.value.currentNode;n();const r=e.value.currentNode;a!==r&&o("current-change",r?r.data:null,r)},getChildState=e=>{let o=!0,n=!0,a=!0;for(let r=0,l=e.length;r<l;r++){const c=e[r];(c.checked!==!0||c.indeterminate)&&(o=!1,c.disabled||(a=!1)),(c.checked!==!1||c.indeterminate)&&(n=!1)}return{all:o,none:n,allWithoutDisable:a,half:!o&&!n}},reInitChecked=function(e){if(e.childNodes.length===0||e.loading)return;const{all:o,none:n,half:a}=getChildState(e.childNodes);o?(e.checked=!0,e.indeterminate=!1):a?(e.checked=!1,e.indeterminate=!0):n&&(e.checked=!1,e.indeterminate=!1);const r=e.parent;!r||r.level===0||e.store.checkStrictly||reInitChecked(r)},getPropertyFromData=function(e,o){const n=e.store.props,a=e.data||{},r=n[o];if(typeof r=="function")return r(a,e);if(typeof r=="string")return a[r];if(typeof r>"u"){const l=a[o];return l===void 0?"":l}};let nodeIdSeed=0;class Node{constructor(o){this.id=nodeIdSeed++,this.text=null,this.checked=!1,this.indeterminate=!1,this.data=null,this.expanded=!1,this.parent=null,this.visible=!0,this.isCurrent=!1,this.canFocus=!1;for(const n in o)hasOwn(o,n)&&(this[n]=o[n]);this.level=0,this.loaded=!1,this.childNodes=[],this.loading=!1,this.parent&&(this.level=this.parent.level+1)}initialize(){const o=this.store;if(!o)throw new Error("[Node]store is required!");o.registerNode(this);const n=o.props;if(n&&typeof n.isLeaf<"u"){const l=getPropertyFromData(this,"isLeaf");typeof l=="boolean"&&(this.isLeafByUser=l)}if(o.lazy!==!0&&this.data?(this.setData(this.data),o.defaultExpandAll&&(this.expanded=!0,this.canFocus=!0)):this.level>0&&o.lazy&&o.defaultExpandAll&&!this.isLeafByUser&&this.expand(),Array.isArray(this.data)||markNodeData(this,this.data),!this.data)return;const a=o.defaultExpandedKeys,r=o.key;r&&a&&a.includes(this.key)&&this.expand(null,o.autoExpandParent),r&&o.currentNodeKey!==void 0&&this.key===o.currentNodeKey&&(o.currentNode=this,o.currentNode.isCurrent=!0),o.lazy&&o._initDefaultCheckedNode(this),this.updateLeafState(),this.parent&&(this.level===1||this.parent.expanded===!0)&&(this.canFocus=!0)}setData(o){Array.isArray(o)||markNodeData(this,o),this.data=o,this.childNodes=[];let n;this.level===0&&Array.isArray(this.data)?n=this.data:n=getPropertyFromData(this,"children")||[];for(let a=0,r=n.length;a<r;a++)this.insertChild({data:n[a]})}get label(){return getPropertyFromData(this,"label")}get key(){const o=this.store.key;return this.data?this.data[o]:null}get disabled(){return getPropertyFromData(this,"disabled")}get nextSibling(){const o=this.parent;if(o){const n=o.childNodes.indexOf(this);if(n>-1)return o.childNodes[n+1]}return null}get previousSibling(){const o=this.parent;if(o){const n=o.childNodes.indexOf(this);if(n>-1)return n>0?o.childNodes[n-1]:null}return null}contains(o,n=!0){return(this.childNodes||[]).some(a=>a===o||n&&a.contains(o))}remove(){const o=this.parent;o&&o.removeChild(this)}insertChild(o,n,a){if(!o)throw new Error("InsertChild error: child is required.");if(!(o instanceof Node)){if(!a){const r=this.getChildren(!0);r.includes(o.data)||(typeof n>"u"||n<0?r.push(o.data):r.splice(n,0,o.data))}Object.assign(o,{parent:this,store:this.store}),o=reactive(new Node(o)),o instanceof Node&&o.initialize()}o.level=this.level+1,typeof n>"u"||n<0?this.childNodes.push(o):this.childNodes.splice(n,0,o),this.updateLeafState()}insertBefore(o,n){let a;n&&(a=this.childNodes.indexOf(n)),this.insertChild(o,a)}insertAfter(o,n){let a;n&&(a=this.childNodes.indexOf(n),a!==-1&&(a+=1)),this.insertChild(o,a)}removeChild(o){const n=this.getChildren()||[],a=n.indexOf(o.data);a>-1&&n.splice(a,1);const r=this.childNodes.indexOf(o);r>-1&&(this.store&&this.store.deregisterNode(o),o.parent=null,this.childNodes.splice(r,1)),this.updateLeafState()}removeChildByData(o){let n=null;for(let a=0;a<this.childNodes.length;a++)if(this.childNodes[a].data===o){n=this.childNodes[a];break}n&&this.removeChild(n)}expand(o,n){const a=()=>{if(n){let r=this.parent;for(;r.level>0;)r.expanded=!0,r=r.parent}this.expanded=!0,o&&o(),this.childNodes.forEach(r=>{r.canFocus=!0})};this.shouldLoadData()?this.loadData(r=>{Array.isArray(r)&&(this.checked?this.setChecked(!0,!0):this.store.checkStrictly||reInitChecked(this),a())}):a()}doCreateChildren(o,n={}){o.forEach(a=>{this.insertChild(Object.assign({data:a},n),void 0,!0)})}collapse(){this.expanded=!1,this.childNodes.forEach(o=>{o.canFocus=!1})}shouldLoadData(){return this.store.lazy===!0&&this.store.load&&!this.loaded}updateLeafState(){if(this.store.lazy===!0&&this.loaded!==!0&&typeof this.isLeafByUser<"u"){this.isLeaf=this.isLeafByUser;return}const o=this.childNodes;if(!this.store.lazy||this.store.lazy===!0&&this.loaded===!0){this.isLeaf=!o||o.length===0;return}this.isLeaf=!1}setChecked(o,n,a,r){if(this.indeterminate=o==="half",this.checked=o===!0,this.store.checkStrictly)return;if(!(this.shouldLoadData()&&!this.store.checkDescendants)){const{all:c,allWithoutDisable:C}=getChildState(this.childNodes);!this.isLeaf&&!c&&C&&(this.checked=!1,o=!1);const p=()=>{if(n){const b=this.childNodes;for(let f=0,y=b.length;f<y;f++){const k=b[f];r=r||o!==!1;const T=k.disabled?k.checked:r;k.setChecked(T,n,!0,r)}const{half:u,all:w}=getChildState(b);w||(this.checked=w,this.indeterminate=u)}};if(this.shouldLoadData()){this.loadData(()=>{p(),reInitChecked(this)},{checked:o!==!1});return}else p()}const l=this.parent;!l||l.level===0||a||reInitChecked(l)}getChildren(o=!1){if(this.level===0)return this.data;const n=this.data;if(!n)return null;const a=this.store.props;let r="children";return a&&(r=a.children||"children"),n[r]===void 0&&(n[r]=null),o&&!n[r]&&(n[r]=[]),n[r]}updateChildren(){const o=this.getChildren()||[],n=this.childNodes.map(l=>l.data),a={},r=[];o.forEach((l,c)=>{const C=l[NODE_KEY];!!C&&n.findIndex(b=>b[NODE_KEY]===C)>=0?a[C]={index:c,data:l}:r.push({index:c,data:l})}),this.store.lazy||n.forEach(l=>{a[l[NODE_KEY]]||this.removeChildByData(l)}),r.forEach(({index:l,data:c})=>{this.insertChild({data:c},l)}),this.updateLeafState()}loadData(o,n={}){if(this.store.lazy===!0&&this.store.load&&!this.loaded&&(!this.loading||Object.keys(n).length)){this.loading=!0;const a=l=>{this.childNodes=[],this.doCreateChildren(l,n),this.loaded=!0,this.loading=!1,this.updateLeafState(),o&&o.call(this,l)},r=()=>{this.loading=!1};this.store.load(this,a,r)}else o&&o.call(this)}eachNode(o){const n=[this];for(;n.length;){const a=n.shift();n.unshift(...a.childNodes),o(a)}}reInitChecked(){this.store.checkStrictly||reInitChecked(this)}}class TreeStore{constructor(o){this.currentNode=null,this.currentNodeKey=null;for(const n in o)hasOwn(o,n)&&(this[n]=o[n]);this.nodesMap={}}initialize(){if(this.root=new Node({data:this.data,store:this}),this.root.initialize(),this.lazy&&this.load){const o=this.load;o(this.root,n=>{this.root.doCreateChildren(n),this._initDefaultCheckedNodes()})}else this._initDefaultCheckedNodes()}filter(o){const n=this.filterNodeMethod,a=this.lazy,r=function(l){const c=l.root?l.root.childNodes:l.childNodes;if(c.forEach(C=>{C.visible=n.call(C,o,C.data,C),r(C)}),!l.visible&&c.length){let C=!0;C=!c.some(p=>p.visible),l.root?l.root.visible=C===!1:l.visible=C===!1}o&&l.visible&&!l.isLeaf&&(!a||l.loaded)&&l.expand()};r(this)}setData(o){o!==this.root.data?(this.nodesMap={},this.root.setData(o),this._initDefaultCheckedNodes()):this.root.updateChildren()}getNode(o){if(o instanceof Node)return o;const n=isObject(o)?getNodeKey(this.key,o):o;return this.nodesMap[n]||null}insertBefore(o,n){const a=this.getNode(n);a.parent.insertBefore({data:o},a)}insertAfter(o,n){const a=this.getNode(n);a.parent.insertAfter({data:o},a)}remove(o){const n=this.getNode(o);n&&n.parent&&(n===this.currentNode&&(this.currentNode=null),n.parent.removeChild(n))}append(o,n){const a=isPropAbsent(n)?this.root:this.getNode(n);a&&a.insertChild({data:o})}_initDefaultCheckedNodes(){const o=this.defaultCheckedKeys||[],n=this.nodesMap;o.forEach(a=>{const r=n[a];r&&r.setChecked(!0,!this.checkStrictly)})}_initDefaultCheckedNode(o){(this.defaultCheckedKeys||[]).includes(o.key)&&o.setChecked(!0,!this.checkStrictly)}setDefaultCheckedKey(o){o!==this.defaultCheckedKeys&&(this.defaultCheckedKeys=o,this._initDefaultCheckedNodes())}registerNode(o){const n=this.key;!o||!o.data||(n?o.key!==void 0&&(this.nodesMap[o.key]=o):this.nodesMap[o.id]=o)}deregisterNode(o){!this.key||!o||!o.data||(o.childNodes.forEach(a=>{this.deregisterNode(a)}),delete this.nodesMap[o.key])}getCheckedNodes(o=!1,n=!1){const a=[],r=function(l){(l.root?l.root.childNodes:l.childNodes).forEach(C=>{(C.checked||n&&C.indeterminate)&&(!o||o&&C.isLeaf)&&a.push(C.data),r(C)})};return r(this),a}getCheckedKeys(o=!1){return this.getCheckedNodes(o).map(n=>(n||{})[this.key])}getHalfCheckedNodes(){const o=[],n=function(a){(a.root?a.root.childNodes:a.childNodes).forEach(l=>{l.indeterminate&&o.push(l.data),n(l)})};return n(this),o}getHalfCheckedKeys(){return this.getHalfCheckedNodes().map(o=>(o||{})[this.key])}_getAllNodes(){const o=[],n=this.nodesMap;for(const a in n)hasOwn(n,a)&&o.push(n[a]);return o}updateChildren(o,n){const a=this.nodesMap[o];if(!a)return;const r=a.childNodes;for(let l=r.length-1;l>=0;l--){const c=r[l];this.remove(c.data)}for(let l=0,c=n.length;l<c;l++){const C=n[l];this.append(C,a.data)}}_setCheckedKeys(o,n=!1,a){const r=this._getAllNodes().sort((p,b)=>p.level-b.level),l=Object.create(null),c=Object.keys(a);r.forEach(p=>p.setChecked(!1,!1));const C=p=>{p.childNodes.forEach(b=>{var u;l[b.data[o]]=!0,(u=b.childNodes)!=null&&u.length&&C(b)})};for(let p=0,b=r.length;p<b;p++){const u=r[p],w=u.data[o].toString();if(!c.includes(w)){u.checked&&!l[w]&&u.setChecked(!1,!1);continue}if(u.childNodes.length&&C(u),u.isLeaf||this.checkStrictly){u.setChecked(!0,!1);continue}if(u.setChecked(!0,!0),n){u.setChecked(!1,!1);const y=function(k){k.childNodes.forEach(s=>{s.isLeaf||s.setChecked(!1,!1),y(s)})};y(u)}}}setCheckedNodes(o,n=!1){const a=this.key,r={};o.forEach(l=>{r[(l||{})[a]]=!0}),this._setCheckedKeys(a,n,r)}setCheckedKeys(o,n=!1){this.defaultCheckedKeys=o;const a=this.key,r={};o.forEach(l=>{r[l]=!0}),this._setCheckedKeys(a,n,r)}setDefaultExpandedKeys(o){o=o||[],this.defaultExpandedKeys=o,o.forEach(n=>{const a=this.getNode(n);a&&a.expand(null,this.autoExpandParent)})}setChecked(o,n,a){const r=this.getNode(o);r&&r.setChecked(!!n,a)}getCurrentNode(){return this.currentNode}setCurrentNode(o){const n=this.currentNode;n&&(n.isCurrent=!1),this.currentNode=o,this.currentNode.isCurrent=!0}setUserCurrentNode(o,n=!0){const a=o[this.key],r=this.nodesMap[a];this.setCurrentNode(r),n&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0)}setCurrentNodeKey(o,n=!0){if(o==null){this.currentNode&&(this.currentNode.isCurrent=!1),this.currentNode=null;return}const a=this.getNode(o);a&&(this.setCurrentNode(a),n&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0))}}const _sfc_main$7=defineComponent({name:"ElTreeNodeContent",props:{node:{type:Object,required:!0},renderContent:Function},setup(e){const o=useNamespace("tree"),n=inject("NodeInstance"),a=inject("RootTree");return()=>{const r=e.node,{data:l,store:c}=r;return e.renderContent?e.renderContent(h,{_self:n,node:r,data:l,store:c}):renderSlot(a.ctx.slots,"default",{node:r,data:l},()=>[h("span",{class:o.be("node","label")},[r.label])])}}});var NodeContent=_export_sfc(_sfc_main$7,[["__file","tree-node-content.vue"]]);function useNodeExpandEventBroadcast(e){const o=inject("TreeNodeMap",null),n={treeNodeExpand:a=>{e.node!==a&&e.node.collapse()},children:[]};return o&&o.children.push(n),provide("TreeNodeMap",n),{broadcastExpanded:a=>{if(e.accordion)for(const r of n.children)r.treeNodeExpand(a)}}}const dragEventsKey=Symbol("dragEvents");function useDragNodeHandler({props:e,ctx:o,el$:n,dropIndicator$:a,store:r}){const l=useNamespace("tree"),c=ref({showDropIndicator:!1,draggingNode:null,dropNode:null,allowDrop:!0,dropType:null});return provide(dragEventsKey,{treeNodeDragStart:({event:u,treeNode:w})=>{if(typeof e.allowDrag=="function"&&!e.allowDrag(w.node))return u.preventDefault(),!1;u.dataTransfer.effectAllowed="move";try{u.dataTransfer.setData("text/plain","")}catch{}c.value.draggingNode=w,o.emit("node-drag-start",w.node,u)},treeNodeDragOver:({event:u,treeNode:w})=>{const f=w,y=c.value.dropNode;y&&y.node.id!==f.node.id&&removeClass(y.$el,l.is("drop-inner"));const k=c.value.draggingNode;if(!k||!f)return;let T=!0,s=!0,$=!0,I=!0;typeof e.allowDrop=="function"&&(T=e.allowDrop(k.node,f.node,"prev"),I=s=e.allowDrop(k.node,f.node,"inner"),$=e.allowDrop(k.node,f.node,"next")),u.dataTransfer.dropEffect=s||T||$?"move":"none",(T||s||$)&&y?.node.id!==f.node.id&&(y&&o.emit("node-drag-leave",k.node,y.node,u),o.emit("node-drag-enter",k.node,f.node,u)),T||s||$?c.value.dropNode=f:c.value.dropNode=null,f.node.nextSibling===k.node&&($=!1),f.node.previousSibling===k.node&&(T=!1),f.node.contains(k.node,!1)&&(s=!1),(k.node===f.node||k.node.contains(f.node))&&(T=!1,s=!1,$=!1);const M=f.$el.querySelector(`.${l.be("node","content")}`).getBoundingClientRect(),_=n.value.getBoundingClientRect();let O;const R=T?s?.25:$?.45:1:-1,P=$?s?.75:T?.55:0:1;let D=-9999;const i=u.clientY-M.top;i<M.height*R?O="before":i>M.height*P?O="after":s?O="inner":O="none";const g=f.$el.querySelector(`.${l.be("node","expand-icon")}`).getBoundingClientRect(),E=a.value;O==="before"?D=g.top-_.top:O==="after"&&(D=g.bottom-_.top),E.style.top=`${D}px`,E.style.left=`${g.right-_.left}px`,O==="inner"?addClass(f.$el,l.is("drop-inner")):removeClass(f.$el,l.is("drop-inner")),c.value.showDropIndicator=O==="before"||O==="after",c.value.allowDrop=c.value.showDropIndicator||I,c.value.dropType=O,o.emit("node-drag-over",k.node,f.node,u)},treeNodeDragEnd:u=>{const{draggingNode:w,dropType:f,dropNode:y}=c.value;if(u.preventDefault(),u.dataTransfer&&(u.dataTransfer.dropEffect="move"),w&&y){const k={data:w.node.data};f!=="none"&&w.node.remove(),f==="before"?y.node.parent.insertBefore(k,y.node):f==="after"?y.node.parent.insertAfter(k,y.node):f==="inner"&&y.node.insertChild(k),f!=="none"&&(r.value.registerNode(k),r.value.key&&w.node.eachNode(T=>{var s;(s=r.value.nodesMap[T.data[r.value.key]])==null||s.setChecked(T.checked,!r.value.checkStrictly)})),removeClass(y.$el,l.is("drop-inner")),o.emit("node-drag-end",w.node,y.node,f,u),f!=="none"&&o.emit("node-drop",w.node,y.node,f,u)}w&&!y&&o.emit("node-drag-end",w.node,null,f,u),c.value.showDropIndicator=!1,c.value.draggingNode=null,c.value.dropNode=null,c.value.allowDrop=!0}}),{dragState:c}}const _sfc_main$6=defineComponent({name:"ElTreeNode",components:{ElCollapseTransition,ElCheckbox,NodeContent,ElIcon,Loading:loading_default},props:{node:{type:Node,default:()=>({})},props:{type:Object,default:()=>({})},accordion:Boolean,renderContent:Function,renderAfterExpand:Boolean,showCheckbox:{type:Boolean,default:!1}},emits:["node-expand"],setup(e,o){const n=useNamespace("tree"),{broadcastExpanded:a}=useNodeExpandEventBroadcast(e),r=inject("RootTree"),l=ref(!1),c=ref(!1),C=ref(null),p=ref(null),b=ref(null),u=inject(dragEventsKey),w=getCurrentInstance();provide("NodeInstance",w),e.node.expanded&&(l.value=!0,c.value=!0);const f=r.props.props.children||"children";watch(()=>{const i=e.node.data[f];return i&&[...i]},()=>{e.node.updateChildren()}),watch(()=>e.node.indeterminate,i=>{T(e.node.checked,i)}),watch(()=>e.node.checked,i=>{T(i,e.node.indeterminate)}),watch(()=>e.node.childNodes.length,()=>e.node.reInitChecked()),watch(()=>e.node.expanded,i=>{nextTick(()=>l.value=i),i&&(c.value=!0)});const y=i=>getNodeKey(r.props.nodeKey,i.data),k=i=>{const g=e.props.class;if(!g)return{};let E;if(isFunction(g)){const{data:A}=i;E=g(A,i)}else E=g;return isString(E)?{[E]:!0}:E},T=(i,g)=>{(C.value!==i||p.value!==g)&&r.ctx.emit("check-change",e.node.data,i,g),C.value=i,p.value=g},s=i=>{handleCurrentChange(r.store,r.ctx.emit,()=>r.store.value.setCurrentNode(e.node)),r.currentNode.value=e.node,r.props.expandOnClickNode&&I(),r.props.checkOnClickNode&&!e.node.disabled&&M(null,{target:{checked:!e.node.checked}}),r.ctx.emit("node-click",e.node.data,e.node,w,i)},$=i=>{r.instance.vnode.props.onNodeContextmenu&&(i.stopPropagation(),i.preventDefault()),r.ctx.emit("node-contextmenu",i,e.node.data,e.node,w)},I=()=>{e.node.isLeaf||(l.value?(r.ctx.emit("node-collapse",e.node.data,e.node,w),e.node.collapse()):e.node.expand(()=>{o.emit("node-expand",e.node.data,e.node,w)}))},M=(i,g)=>{e.node.setChecked(g.target.checked,!r.props.checkStrictly),nextTick(()=>{const E=r.store.value;r.ctx.emit("check",e.node.data,{checkedNodes:E.getCheckedNodes(),checkedKeys:E.getCheckedKeys(),halfCheckedNodes:E.getHalfCheckedNodes(),halfCheckedKeys:E.getHalfCheckedKeys()})})};return{ns:n,node$:b,tree:r,expanded:l,childNodeRendered:c,oldChecked:C,oldIndeterminate:p,getNodeKey:y,getNodeClass:k,handleSelectChange:T,handleClick:s,handleContextMenu:$,handleExpandIconClick:I,handleCheckChange:M,handleChildNodeExpand:(i,g,E)=>{a(g),r.ctx.emit("node-expand",i,g,E)},handleDragStart:i=>{r.props.draggable&&u.treeNodeDragStart({event:i,treeNode:e})},handleDragOver:i=>{i.preventDefault(),r.props.draggable&&u.treeNodeDragOver({event:i,treeNode:{$el:b.value,node:e.node}})},handleDrop:i=>{i.preventDefault()},handleDragEnd:i=>{r.props.draggable&&u.treeNodeDragEnd(i)},CaretRight:caret_right_default}}});function _sfc_render$1(e,o,n,a,r,l){const c=resolveComponent("el-icon"),C=resolveComponent("el-checkbox"),p=resolveComponent("loading"),b=resolveComponent("node-content"),u=resolveComponent("el-tree-node"),w=resolveComponent("el-collapse-transition");return withDirectives((openBlock(),createElementBlock("div",{ref:"node$",class:normalizeClass([e.ns.b("node"),e.ns.is("expanded",e.expanded),e.ns.is("current",e.node.isCurrent),e.ns.is("hidden",!e.node.visible),e.ns.is("focusable",!e.node.disabled),e.ns.is("checked",!e.node.disabled&&e.node.checked),e.getNodeClass(e.node)]),role:"treeitem",tabindex:"-1","aria-expanded":e.expanded,"aria-disabled":e.node.disabled,"aria-checked":e.node.checked,draggable:e.tree.props.draggable,"data-key":e.getNodeKey(e.node),onClick:withModifiers(e.handleClick,["stop"]),onContextmenu:e.handleContextMenu,onDragstart:withModifiers(e.handleDragStart,["stop"]),onDragover:withModifiers(e.handleDragOver,["stop"]),onDragend:withModifiers(e.handleDragEnd,["stop"]),onDrop:withModifiers(e.handleDrop,["stop"])},[createBaseVNode("div",{class:normalizeClass(e.ns.be("node","content")),style:normalizeStyle({paddingLeft:(e.node.level-1)*e.tree.props.indent+"px"})},[e.tree.props.icon||e.CaretRight?(openBlock(),createBlock(c,{key:0,class:normalizeClass([e.ns.be("node","expand-icon"),e.ns.is("leaf",e.node.isLeaf),{expanded:!e.node.isLeaf&&e.expanded}]),onClick:withModifiers(e.handleExpandIconClick,["stop"])},{default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(e.tree.props.icon||e.CaretRight)))]),_:1},8,["class","onClick"])):createCommentVNode("v-if",!0),e.showCheckbox?(openBlock(),createBlock(C,{key:1,"model-value":e.node.checked,indeterminate:e.node.indeterminate,disabled:!!e.node.disabled,onClick:withModifiers(()=>{},["stop"]),onChange:e.handleCheckChange},null,8,["model-value","indeterminate","disabled","onClick","onChange"])):createCommentVNode("v-if",!0),e.node.loading?(openBlock(),createBlock(c,{key:2,class:normalizeClass([e.ns.be("node","loading-icon"),e.ns.is("loading")])},{default:withCtx(()=>[createVNode(p)]),_:1},8,["class"])):createCommentVNode("v-if",!0),createVNode(b,{node:e.node,"render-content":e.renderContent},null,8,["node","render-content"])],6),createVNode(w,null,{default:withCtx(()=>[!e.renderAfterExpand||e.childNodeRendered?withDirectives((openBlock(),createElementBlock("div",{key:0,class:normalizeClass(e.ns.be("node","children")),role:"group","aria-expanded":e.expanded},[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.node.childNodes,f=>(openBlock(),createBlock(u,{key:e.getNodeKey(f),"render-content":e.renderContent,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,node:f,accordion:e.accordion,props:e.props,onNodeExpand:e.handleChildNodeExpand},null,8,["render-content","render-after-expand","show-checkbox","node","accordion","props","onNodeExpand"]))),128))],10,["aria-expanded"])),[[vShow,e.expanded]]):createCommentVNode("v-if",!0)]),_:1})],42,["aria-expanded","aria-disabled","aria-checked","draggable","data-key","onClick","onContextmenu","onDragstart","onDragover","onDragend","onDrop"])),[[vShow,e.node.visible]])}var ElTreeNode=_export_sfc(_sfc_main$6,[["render",_sfc_render$1],["__file","tree-node.vue"]]);function useKeydown({el$:e},o){const n=useNamespace("tree"),a=shallowRef([]),r=shallowRef([]);onMounted(()=>{c()}),onUpdated(()=>{a.value=Array.from(e.value.querySelectorAll("[role=treeitem]")),r.value=Array.from(e.value.querySelectorAll("input[type=checkbox]"))}),watch(r,C=>{C.forEach(p=>{p.setAttribute("tabindex","-1")})}),useEventListener(e,"keydown",C=>{const p=C.target;if(!p.className.includes(n.b("node")))return;const b=C.code;a.value=Array.from(e.value.querySelectorAll(`.${n.is("focusable")}[role=treeitem]`));const u=a.value.indexOf(p);let w;if([EVENT_CODE.up,EVENT_CODE.down].includes(b)){if(C.preventDefault(),b===EVENT_CODE.up){w=u===-1?0:u!==0?u-1:a.value.length-1;const y=w;for(;!o.value.getNode(a.value[w].dataset.key).canFocus;){if(w--,w===y){w=-1;break}w<0&&(w=a.value.length-1)}}else{w=u===-1?0:u<a.value.length-1?u+1:0;const y=w;for(;!o.value.getNode(a.value[w].dataset.key).canFocus;){if(w++,w===y){w=-1;break}w>=a.value.length&&(w=0)}}w!==-1&&a.value[w].focus()}[EVENT_CODE.left,EVENT_CODE.right].includes(b)&&(C.preventDefault(),p.click());const f=p.querySelector('[type="checkbox"]');[EVENT_CODE.enter,EVENT_CODE.space].includes(b)&&f&&(C.preventDefault(),f.click())});const c=()=>{var C;a.value=Array.from(e.value.querySelectorAll(`.${n.is("focusable")}[role=treeitem]`)),r.value=Array.from(e.value.querySelectorAll("input[type=checkbox]"));const p=e.value.querySelectorAll(`.${n.is("checked")}[role=treeitem]`);if(p.length){p[0].setAttribute("tabindex","0");return}(C=a.value[0])==null||C.setAttribute("tabindex","0")}}const _sfc_main$5=defineComponent({name:"ElTree",components:{ElTreeNode},props:{data:{type:Array,default:()=>[]},emptyText:{type:String},renderAfterExpand:{type:Boolean,default:!0},nodeKey:String,checkStrictly:Boolean,defaultExpandAll:Boolean,expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:Boolean,checkDescendants:{type:Boolean,default:!1},autoExpandParent:{type:Boolean,default:!0},defaultCheckedKeys:Array,defaultExpandedKeys:Array,currentNodeKey:[String,Number],renderContent:Function,showCheckbox:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},allowDrag:Function,allowDrop:Function,props:{type:Object,default:()=>({children:"children",label:"label",disabled:"disabled"})},lazy:{type:Boolean,default:!1},highlightCurrent:Boolean,load:Function,filterNodeMethod:Function,accordion:Boolean,indent:{type:Number,default:18},icon:{type:iconPropType}},emits:["check-change","current-change","node-click","node-contextmenu","node-collapse","node-expand","check","node-drag-start","node-drag-end","node-drop","node-drag-leave","node-drag-enter","node-drag-over"],setup(e,o){const{t:n}=useLocale(),a=useNamespace("tree"),r=inject(selectKey,null),l=ref(new TreeStore({key:e.nodeKey,data:e.data,lazy:e.lazy,props:e.props,load:e.load,currentNodeKey:e.currentNodeKey,checkStrictly:e.checkStrictly,checkDescendants:e.checkDescendants,defaultCheckedKeys:e.defaultCheckedKeys,defaultExpandedKeys:e.defaultExpandedKeys,autoExpandParent:e.autoExpandParent,defaultExpandAll:e.defaultExpandAll,filterNodeMethod:e.filterNodeMethod}));l.value.initialize();const c=ref(l.value.root),C=ref(null),p=ref(null),b=ref(null),{broadcastExpanded:u}=useNodeExpandEventBroadcast(e),{dragState:w}=useDragNodeHandler({props:e,ctx:o,el$:p,dropIndicator$:b,store:l});useKeydown({el$:p},l);const f=computed(()=>{const{childNodes:F}=c.value,x=r?r.hasFilteredOptions!==0:!1;return(!F||F.length===0||F.every(({visible:N})=>!N))&&!x});watch(()=>e.currentNodeKey,F=>{l.value.setCurrentNodeKey(F)}),watch(()=>e.defaultCheckedKeys,F=>{l.value.setDefaultCheckedKey(F)}),watch(()=>e.defaultExpandedKeys,F=>{l.value.setDefaultExpandedKeys(F)}),watch(()=>e.data,F=>{l.value.setData(F)},{deep:!0}),watch(()=>e.checkStrictly,F=>{l.value.checkStrictly=F});const y=F=>{if(!e.filterNodeMethod)throw new Error("[Tree] filterNodeMethod is required when filter");l.value.filter(F)},k=F=>getNodeKey(e.nodeKey,F.data),T=F=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getNodePath");const x=l.value.getNode(F);if(!x)return[];const N=[x.data];let m=x.parent;for(;m&&m!==c.value;)N.push(m.data),m=m.parent;return N.reverse()},s=(F,x)=>l.value.getCheckedNodes(F,x),$=F=>l.value.getCheckedKeys(F),I=()=>{const F=l.value.getCurrentNode();return F?F.data:null},M=()=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getCurrentKey");const F=I();return F?F[e.nodeKey]:null},_=(F,x)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedNodes");l.value.setCheckedNodes(F,x)},O=(F,x)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedKeys");l.value.setCheckedKeys(F,x)},R=(F,x,N)=>{l.value.setChecked(F,x,N)},P=()=>l.value.getHalfCheckedNodes(),D=()=>l.value.getHalfCheckedKeys(),i=(F,x=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentNode");handleCurrentChange(l,o.emit,()=>{u(F),l.value.setUserCurrentNode(F,x)})},g=(F,x=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentKey");handleCurrentChange(l,o.emit,()=>{u(),l.value.setCurrentNodeKey(F,x)})},E=F=>l.value.getNode(F),A=F=>{l.value.remove(F)},L=(F,x)=>{l.value.append(F,x)},j=(F,x)=>{l.value.insertBefore(F,x)},U=(F,x)=>{l.value.insertAfter(F,x)},q=(F,x,N)=>{u(x),o.emit("node-expand",F,x,N)},z=(F,x)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in updateKeyChild");l.value.updateChildren(F,x)};return provide("RootTree",{ctx:o,props:e,store:l,root:c,currentNode:C,instance:getCurrentInstance()}),provide(formItemContextKey,void 0),{ns:a,store:l,root:c,currentNode:C,dragState:w,el$:p,dropIndicator$:b,isEmpty:f,filter:y,getNodeKey:k,getNodePath:T,getCheckedNodes:s,getCheckedKeys:$,getCurrentNode:I,getCurrentKey:M,setCheckedNodes:_,setCheckedKeys:O,setChecked:R,getHalfCheckedNodes:P,getHalfCheckedKeys:D,setCurrentNode:i,setCurrentKey:g,t:n,getNode:E,remove:A,append:L,insertBefore:j,insertAfter:U,handleNodeExpand:q,updateKeyChildren:z}}});function _sfc_render(e,o,n,a,r,l){const c=resolveComponent("el-tree-node");return openBlock(),createElementBlock("div",{ref:"el$",class:normalizeClass([e.ns.b(),e.ns.is("dragging",!!e.dragState.draggingNode),e.ns.is("drop-not-allow",!e.dragState.allowDrop),e.ns.is("drop-inner",e.dragState.dropType==="inner"),{[e.ns.m("highlight-current")]:e.highlightCurrent}]),role:"tree"},[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.root.childNodes,C=>(openBlock(),createBlock(c,{key:e.getNodeKey(C),node:C,props:e.props,accordion:e.accordion,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,"render-content":e.renderContent,onNodeExpand:e.handleNodeExpand},null,8,["node","props","accordion","render-after-expand","show-checkbox","render-content","onNodeExpand"]))),128)),e.isEmpty?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass(e.ns.e("empty-block"))},[renderSlot(e.$slots,"empty",{},()=>{var C;return[createBaseVNode("span",{class:normalizeClass(e.ns.e("empty-text"))},toDisplayString((C=e.emptyText)!=null?C:e.t("el.tree.emptyText")),3)]})],2)):createCommentVNode("v-if",!0),withDirectives(createBaseVNode("div",{ref:"dropIndicator$",class:normalizeClass(e.ns.e("drop-indicator"))},null,2),[[vShow,e.dragState.showDropIndicator]])],2)}var Tree=_export_sfc(_sfc_main$5,[["render",_sfc_render],["__file","tree.vue"]]);const ElTree=withInstall(Tree),useSelect=(e,{attrs:o,emit:n},{select:a,tree:r,key:l})=>{const c=useNamespace("tree-select");return watch(()=>e.data,()=>{e.filterable&&nextTick(()=>{var p,b;(b=r.value)==null||b.filter((p=a.value)==null?void 0:p.states.inputValue)})},{flush:"post"}),{...pick(toRefs(e),Object.keys(ElSelect.props)),...o,"onUpdate:modelValue":p=>n(UPDATE_MODEL_EVENT,p),valueKey:l,popperClass:computed(()=>{const p=[c.e("popper")];return e.popperClass&&p.push(e.popperClass),p.join(" ")}),filterMethod:(p="")=>{var b;e.filterMethod?e.filterMethod(p):e.remoteMethod?e.remoteMethod(p):(b=r.value)==null||b.filter(p)}}},component=defineComponent({extends:ElOption,setup(e,o){const n=ElOption.setup(e,o);delete n.selectOptionClick;const a=getCurrentInstance().proxy;return nextTick(()=>{n.select.states.cachedOptions.get(a.value)||n.select.onOptionCreate(a)}),watch(()=>o.attrs.visible,r=>{n.states.visible=r},{immediate:!0}),n},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function isValidValue(e){return e||e===0}function isValidArray(e){return Array.isArray(e)&&e.length}function toValidArray(e){return Array.isArray(e)?e:isValidValue(e)?[e]:[]}function treeFind(e,o,n,a,r){for(let l=0;l<e.length;l++){const c=e[l];if(o(c,l,e,r))return a?a(c,l,e,r):c;{const C=n(c);if(isValidArray(C)){const p=treeFind(C,o,n,a,c);if(p)return p}}}}function treeEach(e,o,n,a){for(let r=0;r<e.length;r++){const l=e[r];o(l,r,e,a);const c=n(l);isValidArray(c)&&treeEach(c,o,n,l)}}const useTree=(e,{attrs:o,slots:n,emit:a},{select:r,tree:l,key:c})=>{watch(()=>e.modelValue,()=>{e.showCheckbox&&nextTick(()=>{const f=l.value;f&&!isEqual(f.getCheckedKeys(),toValidArray(e.modelValue))&&f.setCheckedKeys(toValidArray(e.modelValue))})},{immediate:!0,deep:!0});const C=computed(()=>({value:c.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),p=(f,y)=>{var k;const T=C.value[f];return isFunction(T)?T(y,(k=l.value)==null?void 0:k.getNode(p("value",y))):y[T]},b=toValidArray(e.modelValue).map(f=>treeFind(e.data||[],y=>p("value",y)===f,y=>p("children",y),(y,k,T,s)=>s&&p("value",s))).filter(f=>isValidValue(f)),u=computed(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const f=[];return treeEach(e.data.concat(e.cacheData),y=>{const k=p("value",y);f.push({value:k,currentLabel:p("label",y),isDisabled:p("disabled",y)})},y=>p("children",y)),f}),w=()=>{var f;return(f=l.value)==null?void 0:f.getCheckedKeys().filter(y=>{var k;const T=(k=l.value)==null?void 0:k.getNode(y);return!isNil(T)&&isEmpty(T.childNodes)})};return{...pick(toRefs(e),Object.keys(ElTree.props)),...o,nodeKey:c,expandOnClickNode:computed(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:computed(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(b):b),renderContent:(f,{node:y,data:k,store:T})=>f(component,{value:p("value",k),label:p("label",k),disabled:p("disabled",k),visible:y.visible},e.renderContent?()=>e.renderContent(f,{node:y,data:k,store:T}):n.default?()=>n.default({node:y,data:k,store:T}):void 0),filterNodeMethod:(f,y,k)=>e.filterNodeMethod?e.filterNodeMethod(f,y,k):f?new RegExp(escapeStringRegexp(f),"i").test(p("label",y)||""):!0,onNodeClick:(f,y,k)=>{var T,s,$,I;if((T=o.onNodeClick)==null||T.call(o,f,y,k),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||y.isLeaf)){if(!p("disabled",f)){const M=(s=r.value)==null?void 0:s.states.options.get(p("value",f));($=r.value)==null||$.handleOptionSelect(M)}}else e.expandOnClickNode&&k.proxy.handleExpandIconClick();(I=r.value)==null||I.focus()}},onCheck:(f,y)=>{var k;if(!e.showCheckbox)return;const T=p("value",f),s={};treeEach([l.value.store.root],_=>s[_.key]=_,_=>_.childNodes);const $=y.checkedKeys,I=e.multiple?toValidArray(e.modelValue).filter(_=>!(_ in s)&&!$.includes(_)):[],M=I.concat($);if(e.checkStrictly)a(UPDATE_MODEL_EVENT,e.multiple?M:M.includes(T)?T:void 0);else if(e.multiple){const _=w();a(UPDATE_MODEL_EVENT,I.concat(_))}else{const _=treeFind([f],P=>!isValidArray(p("children",P))&&!p("disabled",P),P=>p("children",P)),O=_?p("value",_):void 0,R=isValidValue(e.modelValue)&&!!treeFind([f],P=>p("value",P)===e.modelValue,P=>p("children",P));a(UPDATE_MODEL_EVENT,O===e.modelValue||R?void 0:O)}nextTick(()=>{var _;const O=toValidArray(e.modelValue);l.value.setCheckedKeys(O),(_=o.onCheck)==null||_.call(o,f,{checkedKeys:l.value.getCheckedKeys(),checkedNodes:l.value.getCheckedNodes(),halfCheckedKeys:l.value.getHalfCheckedKeys(),halfCheckedNodes:l.value.getHalfCheckedNodes()})}),(k=r.value)==null||k.focus()},onNodeExpand:(f,y,k)=>{var T;(T=o.onNodeExpand)==null||T.call(o,f,y,k),nextTick(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&y.checked){const s={},$=l.value.getCheckedKeys();treeEach([l.value.store.root],_=>s[_.key]=_,_=>_.childNodes);const I=toValidArray(e.modelValue).filter(_=>!(_ in s)&&!$.includes(_)),M=w();a(UPDATE_MODEL_EVENT,I.concat(M))}})},cacheOptions:u}};var CacheOptions=defineComponent({props:{data:{type:Array,default:()=>[]}},setup(e){const o=inject(selectKey);return watch(()=>e.data,()=>{var n;e.data.forEach(r=>{o.states.cachedOptions.has(r.value)||o.states.cachedOptions.set(r.value,r)});const a=((n=o.selectRef)==null?void 0:n.querySelectorAll("input"))||[];isClient&&!Array.from(a).includes(document.activeElement)&&o.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const _sfc_main$4=defineComponent({name:"ElTreeSelect",inheritAttrs:!1,props:{...ElSelect.props,...ElTree.props,cacheData:{type:Array,default:()=>[]}},setup(e,o){const{slots:n,expose:a}=o,r=ref(),l=ref(),c=computed(()=>e.nodeKey||e.valueKey||"value"),C=useSelect(e,o,{select:r,tree:l,key:c}),{cacheOptions:p,...b}=useTree(e,o,{select:r,tree:l,key:c}),u=reactive({});return a(u),onMounted(()=>{Object.assign(u,{...pick(l.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...pick(r.value,["focus","blur"])})}),()=>h(ElSelect,reactive({...C,ref:w=>r.value=w}),{...n,default:()=>[h(CacheOptions,{data:p.value}),h(ElTree,reactive({...b,ref:w=>l.value=w}))]})}});var TreeSelect=_export_sfc(_sfc_main$4,[["__file","tree-select.vue"]]);const ElTreeSelect=withInstall(TreeSelect),_hoisted_1$3={key:0,class:"mask-box"},_hoisted_2$3={flex:"","flex-row":"","flex-items-center":""},_hoisted_3$3={key:1,class:"mask-box show-mask"},_hoisted_4$3={key:2,class:"label"},_hoisted_5$2={key:3,flex:"","flex-row":"","flex-items-center":""},_sfc_main$3=defineComponent({__name:"DialogArgItem",props:{argItem:{type:Object,required:!0},edit:{type:Boolean,default:!1}},emits:["onEdit","onDelete"],setup(e,{emit:o}){useCssVars(b=>({"4b4157b4":unref(l),b824605c:unref(c)}));const n=o,a=b=>["switch","numberInput","numberRangeInput"].includes(b)?"row-item arg-item":"arg-item",r=["input","FileInput","DirInput","slider"],{appAsideBgColor:l}=useAppTheme(),c=computed(()=>(l.value==="#272727"?"#f6f6f6":"#272727")+"B0"),C=b=>{n("onEdit",b)},p=b=>{n("onDelete",b)};return(b,u)=>{const w=ElTag,f=ElText,y=ElIcon,k=ElButton,T=ElButtonGroup,s=ElSelect,$=__unplugin_components_6$1,I=__unplugin_components_5,M=__unplugin_components_7,_=ElSwitch,O=__unplugin_components_10,R=ElInputNumber,P=ElInput,D=_sfc_main$8;return openBlock(),createElementBlock("div",{class:normalizeClass(a(e.argItem.componentType))},[e.edit?(openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("div",_hoisted_2$3,[createVNode(w,{type:"primary",size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.argItem.componentType),1)]),_:1}),createVNode(f,{class:"info"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.argItem.name),1)]),_:1})]),createVNode(T,null,{default:withCtx(()=>[createVNode(k,{onClick:u[0]||(u[0]=i=>C(e.argItem.id)),link:"",class:"btn",type:"primary"},{default:withCtx(()=>[createVNode(y,{class:"btn"},{default:withCtx(()=>u[11]||(u[11]=[createBaseVNode("span",{"i-mdi-playlist-edit":"",class:"btn"},null,-1)])),_:1})]),_:1}),createVNode(k,{type:"danger",onClick:u[1]||(u[1]=i=>p(e.argItem.id)),link:"",class:"btn"},{default:withCtx(()=>[createVNode(y,{class:"btn"},{default:withCtx(()=>u[12]||(u[12]=[createBaseVNode("span",{"i-mdi-delete-outline":"",class:"btn"},null,-1)])),_:1})]),_:1})]),_:1})])):(openBlock(),createElementBlock("div",_hoisted_3$3)),e.argItem?.label!==void 0&&!r.includes(e.argItem.componentType)&&e.edit?(openBlock(),createElementBlock("span",_hoisted_4$3,toDisplayString(e.argItem.label),1)):createCommentVNode("",!0),e.edit?(openBlock(),createElementBlock(Fragment,{key:4},[e.argItem&&e.argItem.componentType==="select"?(openBlock(),createBlock(s,{key:0,modelValue:e.argItem.value,"onUpdate:modelValue":u[2]||(u[2]=i=>e.argItem.value=i),filterable:"",multiple:e.argItem.multiple,clearable:e.argItem.multiple,"allow-create":!e.argItem.notAllowCreate,"default-first-option":"",placeholder:e.argItem.placeholder||"请选择"},null,8,["modelValue","multiple","clearable","allow-create","placeholder"])):e.argItem&&e.argItem.componentType==="FileInput"?(openBlock(),createBlock($,{key:1,modelValue:e.argItem.value,"onUpdate:modelValue":u[3]||(u[3]=i=>e.argItem.value=i),label:e.argItem.label,verify:e.argItem.verifyPath,multiple:e.argItem.multiple},null,8,["modelValue","label","verify","multiple"])):e.argItem&&e.argItem.componentType==="RectInput"?(openBlock(),createBlock(I,{key:2,modelValue:e.argItem.value,"onUpdate:modelValue":u[4]||(u[4]=i=>e.argItem.value=i)},null,8,["modelValue"])):e.argItem&&e.argItem.componentType==="slider"?(openBlock(),createBlock(M,{key:3,modelValue:e.argItem.value,"onUpdate:modelValue":u[5]||(u[5]=i=>e.argItem.value=i),max:e.argItem.range?.max,min:e.argItem.range?.min,step:e.argItem.range?.step,label:e.argItem.label,size:"small",width:100},null,8,["modelValue","max","min","step","label"])):e.argItem&&e.argItem.componentType==="switch"?(openBlock(),createBlock(_,{key:4,modelValue:e.argItem.value,"onUpdate:modelValue":u[6]||(u[6]=i=>e.argItem.value=i),"active-text":e.argItem.activeText||"是","inactive-text":e.argItem.inactiveText||"否",size:"small"},null,8,["modelValue","active-text","inactive-text"])):e.argItem&&e.argItem.componentType==="DirInput"?(openBlock(),createBlock(O,{key:5,modelValue:e.argItem.value,"onUpdate:modelValue":u[7]||(u[7]=i=>e.argItem.value=i),label:e.argItem.label,suffix:e.argItem.suffix||"",verify:e.argItem.verifyPath},null,8,["modelValue","label","suffix","verify"])):e.argItem&&e.argItem.componentType==="numberInput"?(openBlock(),createBlock(R,{key:6,modelValue:e.argItem.value,"onUpdate:modelValue":u[8]||(u[8]=i=>e.argItem.value=i),"value-on-clear":0,size:"small"},null,8,["modelValue"])):e.argItem&&e.argItem.componentType==="input"?(openBlock(),createBlock(P,{key:7,modelValue:e.argItem.value,"onUpdate:modelValue":u[9]||(u[9]=i=>e.argItem.value=i),size:"small"},{prepend:withCtx(()=>[createTextVNode(toDisplayString(e.argItem.label),1)]),_:1},8,["modelValue"])):e.argItem&&e.argItem.componentType==="numberRangeInput"?(openBlock(),createBlock(D,{key:8,modelValue:e.argItem.value,"onUpdate:modelValue":u[10]||(u[10]=i=>e.argItem.value=i)},null,8,["modelValue"])):createCommentVNode("",!0)],64)):(openBlock(),createElementBlock("div",_hoisted_5$2,[createVNode(w,{type:"primary",size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.argItem.componentType),1)]),_:1}),createVNode(f,null,{default:withCtx(()=>[createTextVNode(toDisplayString(e.argItem.label),1)]),_:1})]))],2)}}}),__unplugin_components_13$1=_export_sfc$1(_sfc_main$3,[["__scopeId","data-v-a68d7acc"]]),_hoisted_1$2={class:"dialog-form"},_hoisted_2$2={"w-full":"",flex:"","flex-row":"","pos-relative":"","h-85vh":"","position-relative":""},_hoisted_3$2={"overflow-y-scroll":"","overflow-x-hidden":"","p-3":"","box-border":"",class:"b1"},_hoisted_4$2={"flex-1":"","h-full":"","overflow-y-scroll":"","overflow-x-hidden":"","ml-1":"","p-3":"","box-border":"",class:"b1"},_sfc_main$2=defineComponent({__name:"DialogArgEditor",props:mergeModels({documentParams:{type:Array,default:[]}},{modelValue:{default:[]},modelModifiers:{}}),emits:["update:modelValue"],setup(__props){useCssVars(e=>({"373d42b4":unref(appAsideBgColor)}));const props=__props,editDialogForm=reactive({componentType:void 0,noTest:!1,onlyTest:!1,name:"",label:"",displayCondition:[],placeholder:"请输入",component:{select:{optionType:"array",options:[],fnOptionsStr:'(store) => {return ["a1","a2"]}',selectOptionSeparator:"",notAllowCreate:!1,multiple:!1,value:"",mValue:[]},fileInput:{verifyPath:!1,suffix:"",multiple:!1,value:"",mValue:[]},input:{value:""},rectInput:{value:{x:0,y:0,width:0,height:0},targetSrc:""},slider:{value:0,range:{min:0,max:100,step:1}},switch:{value:!1,activeText:"是",inactiveText:"否"},dirInput:{value:"",suffix:"",verifyPath:!1},numberInput:{value:0},numberRangeInput:{value:[0,100],limit:[0,100]}},dialog:{visible:!1,targetId:""}}),onOnlyTestChange=()=>{editDialogForm.onlyTest&&(editDialogForm.noTest=!1)},onNoTestChange=()=>{editDialogForm.noTest&&(editDialogForm.onlyTest=!1)},model=useModel(__props,"modelValue"),displayConditionOption=computed(()=>model.value.filter(e=>e.name!==editDialogForm.name).map(e=>({id:e.id,name:e.name,label:e.label}))),localArgs=[{componentType:"input",value:"",desc:"文本输入框"},{componentType:"RectInput",value:{x:0,y:0,width:0,height:0},targetSrc:"",desc:"矩形参数输入框"},{componentType:"slider",value:0,range:{min:0,max:100,step:1},desc:"滑块进度条"},{componentType:"switch",value:!1,activeText:"是",inactiveText:"否",desc:"切换按钮"},{componentType:"DirInput",value:"",suffix:"",verifyPath:!1,desc:"目录输入框"},{componentType:"numberInput",value:0,desc:"数字输入框"},{componentType:"numberRangeInput",value:[0,100],limit:[0,100],desc:"数字范围输入框"},{desc:"单选下拉框(字符串数组选项)",componentType:"select",value:"",options:[],selectOptionSeparator:"",notAllowCreate:!0,multiple:!1},{desc:"单选下拉框(函数返回选项)",componentType:"select",value:"",options:e=>["Option1","Option2"],selectOptionSeparator:"",notAllowCreate:!0,multiple:!1},{desc:"多选下拉框",componentType:"select",value:[],options:[],selectOptionSeparator:"",notAllowCreate:!1,multiple:!0},{componentType:"FileInput",value:"",suffix:"",verifyPath:!1,desc:"单文件选择"},{componentType:"FileInput",value:[],suffix:"",verifyPath:!1,desc:"多文件选择",multiple:!0}].map(e=>({...e,id:nanoid(),onlyTest:!1,noTest:!1,name:"",label:e.desc||e.componentType,displayCondition:[],placeholder:""})),clone=e=>({...e,id:nanoid(),label:e.desc}),{appAsideBgColor}=useAppTheme(),parseFnStr=fnStr=>{try{const fn=eval(fnStr);return fn(useListStore())}catch(e){return[]}},editArg=e=>{const o=model.value?.find(n=>n.id===e);if(o){if(editDialogForm.componentType=o.componentType,editDialogForm.noTest=!!o.noTest,editDialogForm.onlyTest=!!o.onlyTest,editDialogForm.name=o.name,editDialogForm.label=o.label,editDialogForm.displayCondition=o.displayCondition||[],editDialogForm.placeholder=o.placeholder||"",o.componentType==="select"){const n=o,a=Array.isArray(n.options)?"array":"function";editDialogForm.component.select.optionType=a,Array.isArray(n.options)?editDialogForm.component.select.options=n.options.map(r=>""+r):editDialogForm.component.select.fnOptionsStr=n.options.toString(),editDialogForm.component.select.selectOptionSeparator=n.selectOptionSeparator||"",editDialogForm.component.select.notAllowCreate=!!n.notAllowCreate,editDialogForm.component.select.multiple=!!n.multiple,n.multiple?editDialogForm.component.select.mValue=n.value:editDialogForm.component.select.value=n.value}else if(o.componentType==="FileInput"){const n=o;editDialogForm.component.fileInput.verifyPath=!!n.verifyPath,editDialogForm.component.fileInput.suffix=n.suffix||"",editDialogForm.component.fileInput.multiple=!!n.multiple,n.multiple?editDialogForm.component.fileInput.mValue=n.value:editDialogForm.component.fileInput.value=n.value}else if(o.componentType==="input"){const n=o;editDialogForm.component.input.value=n.value}else if(o.componentType==="RectInput"){const n=o;editDialogForm.component.rectInput.value=n.value,editDialogForm.component.rectInput.targetSrc=n.targetSrc||""}else if(o.componentType==="slider"){const n=o;editDialogForm.component.slider.value=n.value,editDialogForm.component.slider.range=n.range}else if(o.componentType==="switch"){const n=o;editDialogForm.component.switch.value=n.value,editDialogForm.component.switch.activeText=n.activeText||"是",editDialogForm.component.switch.inactiveText=n.inactiveText||"否"}else if(o.componentType==="DirInput"){const n=o;editDialogForm.component.dirInput.value=n.value,editDialogForm.component.dirInput.suffix=n.suffix||"",editDialogForm.component.dirInput.verifyPath=!!n.verifyPath}else if(o.componentType==="numberInput"){const n=o;editDialogForm.component.numberInput.value=n.value}else if(o.componentType==="numberRangeInput"){const n=o;editDialogForm.component.numberRangeInput.value=n.value,editDialogForm.component.numberRangeInput.limit=n.limit||[0,0]}editDialogForm.dialog.targetId=e,editDialogForm.dialog.visible=!0}else ElMessage.error("编辑失败：未找到对应参数!")},editDialogCallback=()=>{const target=model.value?.find(e=>e.id===editDialogForm.dialog.targetId&&e.componentType===editDialogForm.componentType);if(target){if(target.componentType==="DirInput")target.suffix=editDialogForm.component.dirInput.suffix,target.verifyPath=editDialogForm.component.dirInput.verifyPath,target.value=editDialogForm.component.dirInput.value;else if(target.componentType==="FileInput"){if(editDialogForm.component.fileInput.multiple){const e=target;e.multiple=!0,e.value=editDialogForm.component.fileInput.mValue}else{const e=target;e.multiple=!1,e.value=editDialogForm.component.fileInput.value}target.suffix=editDialogForm.component.fileInput.suffix,target.verifyPath=editDialogForm.component.fileInput.verifyPath}else if(target.componentType==="input")target.value=editDialogForm.component.input.value;else if(target.componentType==="RectInput")target.value=editDialogForm.component.rectInput.value,target.targetSrc=editDialogForm.component.rectInput.targetSrc;else if(target.componentType==="slider")target.value=editDialogForm.component.slider.value,target.range=editDialogForm.component.slider.range;else if(target.componentType==="switch")target.value=editDialogForm.component.switch.value,target.activeText=editDialogForm.component.switch.activeText,target.inactiveText=editDialogForm.component.switch.inactiveText;else if(target.componentType==="numberInput")target.value=editDialogForm.component.numberInput.value;else if(target.componentType==="numberRangeInput")target.value=editDialogForm.component.numberRangeInput.value,target.limit=editDialogForm.component.numberRangeInput.limit;else{const{multiple}=editDialogForm.component.select;editDialogForm.component.select.optionType==="array"?target.options=editDialogForm.component.select.options:target.options=eval(editDialogForm.component.select.fnOptionsStr);const t=target;multiple?(t.value=editDialogForm.component.select.mValue,t.multiple=!0):(t.value=editDialogForm.component.select.value,t.multiple=!1),target.selectOptionSeparator=editDialogForm.component.select.selectOptionSeparator,target.notAllowCreate=editDialogForm.component.select.notAllowCreate}target.name=editDialogForm.name,target.label=editDialogForm.label,target.displayCondition=editDialogForm.displayCondition,target.placeholder=editDialogForm.placeholder,target.noTest=editDialogForm.noTest,target.onlyTest=editDialogForm.onlyTest,ElMessage.success("编辑成功")}else ElMessage.error("编辑失败：未找到对应参数!");editDialogForm.dialog.visible=!1},delArg=e=>{model.value=model.value?.filter(o=>o.id!==e),ElMessage.success("删除成功")};return(e,o)=>{const n=ElOption,a=ElSelect,r=ElInput,l=ElFormItem,c=ElSwitch,C=__unplugin_components_5,p=ElInputNumber,b=__unplugin_components_7,u=_sfc_main$8,w=ElForm,f=_sfc_main$9,y=ElText,k=ElDivider,T=__unplugin_components_13$1;return openBlock(),createElementBlock(Fragment,null,[createVNode(f,{callback:editDialogCallback,title:"修改参数",modelValue:unref(editDialogForm).dialog.visible,"onUpdate:modelValue":o[36]||(o[36]=s=>unref(editDialogForm).dialog.visible=s)},{element:withCtx(()=>[createBaseVNode("div",_hoisted_1$2,[createVNode(w,{"label-position":"left","label-width":"150px",model:unref(editDialogForm)},{default:withCtx(()=>[createVNode(l,{label:"字段命名",prop:"name"},{default:withCtx(()=>[props.documentParams.length?(openBlock(),createBlock(a,{key:0,modelValue:unref(editDialogForm).name,"onUpdate:modelValue":o[0]||(o[0]=s=>unref(editDialogForm).name=s),filterable:"","allow-create":""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(props.documentParams,s=>(openBlock(),createBlock(n,{key:s.id,label:s.name,value:s.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(openBlock(),createBlock(r,{key:1,modelValue:unref(editDialogForm).name,"onUpdate:modelValue":o[1]||(o[1]=s=>unref(editDialogForm).name=s)},null,8,["modelValue"]))]),_:1}),createVNode(l,{label:"字段标签",prop:"label"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).label,"onUpdate:modelValue":o[2]||(o[2]=s=>unref(editDialogForm).label=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"不在API调试中使用",prop:"noTest"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).noTest,"onUpdate:modelValue":o[3]||(o[3]=s=>unref(editDialogForm).noTest=s),onChange:onNoTestChange},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"仅在API调试中使用",prop:"onlyTest"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).onlyTest,"onUpdate:modelValue":o[4]||(o[4]=s=>unref(editDialogForm).onlyTest=s),onChange:onOnlyTestChange},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"显示条件",prop:"displayCondition"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).displayCondition,"onUpdate:modelValue":o[5]||(o[5]=s=>unref(editDialogForm).displayCondition=s),multiple:"",placeholder:"选择被依赖的字段，当被依赖字段值为true时本字段才显示"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(displayConditionOption),s=>(openBlock(),createBlock(n,{key:s.id,label:s.name+`(${s.label})`,value:s.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),createVNode(l,{label:"输入提示",prop:"placeholder"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).placeholder,"onUpdate:modelValue":o[6]||(o[6]=s=>unref(editDialogForm).placeholder=s)},null,8,["modelValue"])]),_:1}),unref(editDialogForm).componentType==="DirInput"?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(l,{label:"后缀",prop:"component.dirInput.suffix"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.dirInput.suffix,"onUpdate:modelValue":o[7]||(o[7]=s=>unref(editDialogForm).component.dirInput.suffix=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"验证路径",prop:"component.dirInput.verifyPath"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.dirInput.verifyPath,"onUpdate:modelValue":o[8]||(o[8]=s=>unref(editDialogForm).component.dirInput.verifyPath=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"默认值",prop:"component.dirInput.value"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.dirInput.value,"onUpdate:modelValue":o[9]||(o[9]=s=>unref(editDialogForm).component.dirInput.value=s)},null,8,["modelValue"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="FileInput"?(openBlock(),createElementBlock(Fragment,{key:1},[createVNode(l,{label:"后缀",prop:"component.fileInput.suffix"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.fileInput.suffix,"onUpdate:modelValue":o[10]||(o[10]=s=>unref(editDialogForm).component.fileInput.suffix=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"验证路径",prop:"component.fileInput.verifyPath"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.fileInput.verifyPath,"onUpdate:modelValue":o[11]||(o[11]=s=>unref(editDialogForm).component.fileInput.verifyPath=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"是否多选",prop:"component.fileInput.multiple"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.fileInput.multiple,"onUpdate:modelValue":o[12]||(o[12]=s=>unref(editDialogForm).component.fileInput.multiple=s)},null,8,["modelValue"])]),_:1}),unref(editDialogForm).component.fileInput.multiple?(openBlock(),createBlock(l,{key:0,label:"默认值",prop:"component.fileInput.mValue"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).component.fileInput.mValue,"onUpdate:modelValue":o[13]||(o[13]=s=>unref(editDialogForm).component.fileInput.mValue=s),multiple:"","allow-create":"",filterable:""},null,8,["modelValue"])]),_:1})):(openBlock(),createBlock(l,{key:1,label:"默认值",prop:"component.fileInput.value"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.fileInput.value,"onUpdate:modelValue":o[14]||(o[14]=s=>unref(editDialogForm).component.fileInput.value=s)},null,8,["modelValue"])]),_:1}))],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="input"?(openBlock(),createBlock(l,{key:2,label:"默认值",prop:"component.input.value"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.input.value,"onUpdate:modelValue":o[15]||(o[15]=s=>unref(editDialogForm).component.input.value=s)},null,8,["modelValue"])]),_:1})):createCommentVNode("",!0),unref(editDialogForm).componentType==="RectInput"?(openBlock(),createElementBlock(Fragment,{key:3},[createVNode(l,{label:"目标图片路径",prop:"component.rectInput.targetSrc"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.rectInput.targetSrc,"onUpdate:modelValue":o[16]||(o[16]=s=>unref(editDialogForm).component.rectInput.targetSrc=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"默认值",prop:"component.rectInput.value"},{default:withCtx(()=>[createVNode(C,{modelValue:unref(editDialogForm).component.rectInput.value,"onUpdate:modelValue":o[17]||(o[17]=s=>unref(editDialogForm).component.rectInput.value=s)},null,8,["modelValue"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="select"?(openBlock(),createElementBlock(Fragment,{key:4},[createVNode(l,{label:"选项类型",prop:"component.select.optionType"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).component.select.optionType,"onUpdate:modelValue":o[18]||(o[18]=s=>unref(editDialogForm).component.select.optionType=s)},{default:withCtx(()=>[createVNode(n,{label:"数组",value:"array"}),createVNode(n,{label:"函数",value:"function"})]),_:1},8,["modelValue"])]),_:1}),unref(editDialogForm).component.select.optionType==="array"?(openBlock(),createBlock(l,{key:0,label:"选项",prop:"component.select.options"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).component.select.options,"onUpdate:modelValue":o[19]||(o[19]=s=>unref(editDialogForm).component.select.options=s),multiple:"",filterable:"","allow-create":""},null,8,["modelValue"])]),_:1})):(openBlock(),createBlock(l,{key:1,label:"选项",prop:"component.select.fnOptionsStr"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.select.fnOptionsStr,"onUpdate:modelValue":o[20]||(o[20]=s=>unref(editDialogForm).component.select.fnOptionsStr=s)},null,8,["modelValue"])]),_:1})),createVNode(l,{label:"选项分隔符",prop:"component.select.selectOptionSeparator"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.select.selectOptionSeparator,"onUpdate:modelValue":o[21]||(o[21]=s=>unref(editDialogForm).component.select.selectOptionSeparator=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"是否多选",prop:"component.select.multiple"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.select.multiple,"onUpdate:modelValue":o[22]||(o[22]=s=>unref(editDialogForm).component.select.multiple=s)},null,8,["modelValue"])]),_:1}),unref(editDialogForm).component.select.multiple?(openBlock(),createBlock(l,{key:2,label:"不允许新建",prop:"component.select.notAllowCreate"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.select.notAllowCreate,"onUpdate:modelValue":o[23]||(o[23]=s=>unref(editDialogForm).component.select.notAllowCreate=s)},null,8,["modelValue"])]),_:1})):createCommentVNode("",!0),unref(editDialogForm).component.select.multiple?(openBlock(),createBlock(l,{key:3,label:"默认值",prop:"component.select.mValue"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).component.select.mValue,"onUpdate:modelValue":o[24]||(o[24]=s=>unref(editDialogForm).component.select.mValue=s),multiple:"","allow-create":!unref(editDialogForm).component.select.notAllowCreate,filterable:""},{default:withCtx(()=>[unref(editDialogForm).component.select.optionType==="array"?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(unref(editDialogForm).component.select.options,s=>(openBlock(),createBlock(n,{key:s,label:s,value:s},null,8,["label","value"]))),128)):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(parseFnStr(unref(editDialogForm).component.select.fnOptionsStr),s=>(openBlock(),createBlock(n,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue","allow-create"])]),_:1})):(openBlock(),createBlock(l,{key:4,label:"默认值",prop:"component.select.value"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).component.select.value,"onUpdate:modelValue":o[25]||(o[25]=s=>unref(editDialogForm).component.select.value=s),"allow-create":!unref(editDialogForm).component.select.notAllowCreate,filterable:""},{default:withCtx(()=>[unref(editDialogForm).component.select.optionType==="array"?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(unref(editDialogForm).component.select.options,s=>(openBlock(),createBlock(n,{key:s,label:s,value:s},null,8,["label","value"]))),128)):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(parseFnStr(unref(editDialogForm).component.select.fnOptionsStr),s=>(openBlock(),createBlock(n,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue","allow-create"])]),_:1}))],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="slider"?(openBlock(),createElementBlock(Fragment,{key:5},[createVNode(l,{label:"最小值",prop:"component.slider.range.min"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.slider.range.min,"onUpdate:modelValue":o[26]||(o[26]=s=>unref(editDialogForm).component.slider.range.min=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"最大值",prop:"component.slider.range.max"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.slider.range.max,"onUpdate:modelValue":o[27]||(o[27]=s=>unref(editDialogForm).component.slider.range.max=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"步长",prop:"component.slider.range.step"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.slider.range.step,"onUpdate:modelValue":o[28]||(o[28]=s=>unref(editDialogForm).component.slider.range.step=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"默认值",prop:"component.slider.value"},{default:withCtx(()=>[createVNode(b,{modelValue:unref(editDialogForm).component.slider.value,"onUpdate:modelValue":o[29]||(o[29]=s=>unref(editDialogForm).component.slider.value=s),step:unref(editDialogForm).component.slider.range.step,min:unref(editDialogForm).component.slider.range.min,max:unref(editDialogForm).component.slider.range.max,width:100,label:"默认值","hide-label":""},null,8,["modelValue","step","min","max"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="switch"?(openBlock(),createElementBlock(Fragment,{key:6},[createVNode(l,{label:"开启文本",prop:"component.switch.activeText"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.switch.activeText,"onUpdate:modelValue":o[30]||(o[30]=s=>unref(editDialogForm).component.switch.activeText=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"关闭文本",prop:"component.switch.inactiveText"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.switch.inactiveText,"onUpdate:modelValue":o[31]||(o[31]=s=>unref(editDialogForm).component.switch.inactiveText=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"默认值",prop:"component.switch.value"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.switch.value,"onUpdate:modelValue":o[32]||(o[32]=s=>unref(editDialogForm).component.switch.value=s),"active-text":unref(editDialogForm).component.switch.activeText,"inactive-text":unref(editDialogForm).component.switch.inactiveText},null,8,["modelValue","active-text","inactive-text"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="numberInput"?(openBlock(),createBlock(l,{key:7,label:"默认值",prop:"component.numberInput.value"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.numberInput.value,"onUpdate:modelValue":o[33]||(o[33]=s=>unref(editDialogForm).component.numberInput.value=s)},null,8,["modelValue"])]),_:1})):createCommentVNode("",!0),unref(editDialogForm).componentType==="numberRangeInput"?(openBlock(),createElementBlock(Fragment,{key:8},[createVNode(l,{label:"范围限制",prop:"component.numberRangeInput.limit"},{default:withCtx(()=>[createVNode(u,{modelValue:unref(editDialogForm).component.numberRangeInput.limit,"onUpdate:modelValue":o[34]||(o[34]=s=>unref(editDialogForm).component.numberRangeInput.limit=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"默认值",prop:"component.numberRangeInput.value"},{default:withCtx(()=>[createVNode(u,{modelValue:unref(editDialogForm).component.numberRangeInput.value,"onUpdate:modelValue":o[35]||(o[35]=s=>unref(editDialogForm).component.numberRangeInput.value=s),limit:unref(editDialogForm).component.numberRangeInput.limit},null,8,["modelValue","limit"])]),_:1})],64)):createCommentVNode("",!0)]),_:1},8,["model"])])]),_:1},8,["modelValue"]),createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[createVNode(y,null,{default:withCtx(()=>o[39]||(o[39]=[createTextVNode("预设组件")])),_:1}),createVNode(k),createVNode(unref(lo),{modelValue:unref(localArgs),"onUpdate:modelValue":o[37]||(o[37]=s=>isRef(localArgs)?localArgs.value=s:null),animation:150,group:{name:"args",pull:"clone",put:!1},ghostClass:"ghost",clone,sort:!1},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(localArgs),s=>(openBlock(),createBlock(T,{key:s.id,argItem:s},null,8,["argItem"]))),128))]),_:1},8,["modelValue"])]),createBaseVNode("div",_hoisted_4$2,[createVNode(y,null,{default:withCtx(()=>o[40]||(o[40]=[createTextVNode("弹窗参数组件")])),_:1}),createVNode(k),createVNode(unref(lo),{"h-full":"","w-full":"",modelValue:model.value,"onUpdate:modelValue":o[38]||(o[38]=s=>model.value=s),animation:150,group:{name:"args"},ghostClass:"ghost",sort:!0},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(model.value,s=>(openBlock(),createBlock(T,{key:s.id,argItem:s,edit:"",onOnEdit:editArg,onOnDelete:delArg},null,8,["argItem"]))),128))]),_:1},8,["modelValue"])])])],64)}}}),__unplugin_components_13=_export_sfc$1(_sfc_main$2,[["__scopeId","data-v-570c14f9"]]),defaultInvokeTemplateOptions=()=>({name:"",scope:"",weight:1,disabled:!1,document:{howToUse:"",params:[],returnValue:{instructions:"",type:"void"},example:{title:"",code:""},searchKeys:[],codeSnippet:""},dialog:{title:"",content:"",args:[],notOpen:!1}});class InvokeTemplate{options;contentCache={};constructor(e){e.scope=e.scope||"",e.weight=e.weight||5,e.disabled=e.disabled!==void 0?e.disabled:!1,this.options=e}genParamList(){const e=this.options.document.params;return e?e.map(o=>{const n=Array.isArray(o.type)?o.type.map(a=>`"${a}"`).join(" | "):o.type;return o.default?`${o.name}: ${n} = ${o.type==="string"||Array.isArray(o.type)?`'${o.default}'`:o.default},`:n.trim().length?`${o.name}${o.required?"":"?"}: ${n},`:`${o.name},`}).join(`
  `):""}genArgList(){const e=this.options.dialog.args;if(e){const o=JSON.stringify(e,null,2),n=/"([^"]+)":/g;return o.replace(n,"$1:")}else return""}genCBOptionNames(){const e=this.options.dialog.args;return e?e.map(o=>o.name).join(", "):""}genCBOption(){const e=this.options.dialog.args;return e?.length?`${e.map(o=>{let n="string";const a=["numberInput","numberRangeInput","slider"];return o.componentType==="switch"?n="boolean":o.componentType==="RectInput"?n=`{
      x: number;
      y: number;
      width: number;
      height: number;
    }`:a.includes(o.componentType)&&(n="number"),`${o.name}: ${n}`}).join(`;
    `)};
    `:""}defaultSnippet(){const{returnValue:e,params:o}=this.options.document;let n="";if(e?.type){const a=e.type.toLocaleLowerCase();let r=0;e.type.toLocaleLowerCase()!=="promise<void>"&&e.type.toLocaleLowerCase()!=="void"&&e.type.toLocaleLowerCase()!=="undefined"&&(n="${1:const res = }",r++);const l=o?.map(c=>`\${${++r}:${Array.isArray(c.type)?c.type[0]:c.type==="string"?`'${c.name}'`:c.name}}`||"").join(", ")||"";n+=`${a.includes("promise")?"await ":""}${this.options.name}(${l});\${0:}`}return n}get indexTemplate(){return`import { apiDocument } from "./document";
import { ${this.options.name}Fn } from "./exportFn";
import { modelCallback } from "./modelCallback";
import { dialogOptions } from "./dialog";
import { declaration } from "./declaration";
import { auxiliary } from "./auxiliary";
export const ${this.options.name}Api = <InvokeApiMethodType>{
  ${this.options.scope.length?`scope: '${this.options.scope}',
  `:""}name: "${this.options.name}",
  exportFn: {
    fn: ${this.options.name}Fn,
  },
  testModule: {
    weight: ${this.options.weight},
    dialog: dialogOptions,
    callback: modelCallback,
    document: apiDocument,
  },
  //提供给编辑器的类型声明
  declaration,
  //编辑-快速填写或修改方法参数 辅助模块
  auxiliary${this.options.disabled?`,
  disabled: true`:""}
};`}genRetract(e,o=2){return" ".repeat(e*o)}genParamListStr(e,o=2){return`[${e?`
`+this.genRetract(o):""}${e?e.map(n=>`{
${this.genRetract(o+1)}name: "${n.name}",
${this.genRetract(o+1)}required: ${n.required?"true":"false"},
${this.genRetract(o+1)}instructions: "${n.instructions}",
${this.genRetract(o+1)}type: ${Array.isArray(n.type)?`[${n.type.map(a=>`'${a}'`).join(", ")}]`:`'${n.type}'`},
${this.genRetract(o+1)}default: "${n.type==="string"?`${n.default.includes('"')||n.default.includes("'")?`'${n.default}'`:n.default}`:n.default}",
${this.genRetract(o+1)}children: ${this.genParamListStr(n.children,o+2)}
${this.genRetract(o)}}`).join(`,
`+this.genRetract(o)):""}${e?`
`+this.genRetract(o-1):""}]`}get documentTemplate(){const d=this.options.document,prefixStr="export const apiDocument = <ApiDocumentType>",tempStr=`{
  howToUse: "${d.howToUse}",
  params: ${this.genParamListStr(d.params)},
  returnValue: {
    ${d?.returnValue?.instructions?`instructions: "${d.returnValue.instructions}",
    `:""}type: \`${d?.returnValue?.type||""}\`,
  },
  example: {
    ${d?.example?.title?`title: "${d.example.title.replace(/"/g,"'")}",`:'title: "",'}
    code: \`${d?.example?.code||""}\`,
  },
  searchKeys: [${d?.searchKeys?.map(e=>`'${e}'`).join(", ")}],
  codeSnippet:
    "${d?.codeSnippet||this.defaultSnippet()}",
};`;try{let res=JSON.stringify(eval(`const t = ${tempStr};t`),void 0,2);const regex=/"([^"]+)":/g;return res=res.replace(regex,"$1:"),`${prefixStr}${res}`}catch(e){return`${prefixStr}${tempStr}`}}get exportFnTemplate(){const e=this.options.name;return`export const ${e}Fn = async (
  ${this.genParamList()}
  taskId?: string
) => {
  const { notAllowedFnId } = useScriptRuntime();
  if (taskId && notAllowedFnId.value.includes(taskId)) {
    return false;
  }
  try {
    //TODO
  } catch (e) {
    console.error("${e}FnError: ", e);
  }
};`}get declaration(){return`export const declaration = \`${this.options.scope.length?"":"declare "}function ${this.options.name}(
  ${this.genParamList()}
): ${this.options.document.returnValue?.type||"void"};
\`;`}get dialogTemplate(){const{title:e,notOpen:o,content:n,args:a}=this.options.dialog;return`export const dialogOptions = <TestModuleDialogType>{
  ${o?`notOpen: true,
  `:""}${e?`title: "${e}",
  `:""}targetMethodName: "${this.options.name}",
  ${n?`content: "${n}",
  `:""}args: ${a?this.genArgList():"[]"}
};`}get dialogCBTemplate(){const{name:e,scope:o,document:n,dialog:a}=this.options,r=n.example?.code.replace(/\(.*\)/,`(${this.genCBOptionNames()})`);return a.notOpen?`export const modelCallback = async (
  _options: {
    ${this.genCBOption()}replaceCurFnArgs?: (targetArgs: string) => void;
  },
  testModuleCtx: {
    showDetails: ShowDetailsFn;
  }
) => {
  testModuleCtx.showDetails("此方法无法直接调用，请在脚本中使用！", "${o.length?`${o}.`:""}${e}");
};`:`import { auxiliary } from "./auxiliary";
import { ${e}Fn } from "./exportFn";
export const modelCallback = async (
  options: {
    ${this.genCBOption()}replaceCurFnArgs?: (targetArgs: string) => void;
  },
  testModuleCtx: {
    showDetails: ShowDetailsFn;
  }
) => {
  if (options.replaceCurFnArgs) {
    //快速填写或修改方法参数弹窗点击确定时
    auxiliary.parameterReplace(options);
    AutoTipUtils.apiAutoTip();
    return;
  }
  //测试调用时
  const { ${this.genCBOptionNames()} } = options;
  console.time("${e}耗时");
  const res = await ${e}Fn(${this.genCBOptionNames()});
  console.time("${e}耗时");
  const selfModule = getInvokeApiMethods().find((i) => i.name === "${e}"${o.length?` && i.scope === "${o}"`:""})?.testModule!;
  //修改示例代码
  selfModule.document!.example!.code = \`${r}\`;
  testModuleCtx.showDetails(JSON.stringify(res), "${o.length?`${o}.`:""}${e}");
};
`}get auxiliaryTemplate(){const{name:e,scope:o}=this.options;return`export const auxiliary = <AuxiliaryType>{
  //快速编辑/修改参数弹窗打开时触发
  onDialogOpen: async (_close,...args) => {
    //处理来自编辑器的参数
    const params = await AutoTipUtils.paramsProcess(...args);
    const selfModule = getInvokeApiMethods().find((i) => i.name === "${e}"${o.length?` && i.scope === "${o}"`:""});
    const dialog = selfModule!.testModule!.dialog;
    if (!dialog.args) {
      return;
    }
    //根据参数的位置给弹窗对应的组件进行回填赋值
    dialog.args.forEach((i, index) => {
      /**
       * 例如函数本身有5个参数，而弹窗只有两个参数，params为编辑器中输入的5个参数，
       * index为弹窗中的参数位置，i.value为弹窗中组件的值
       * @example:
      switch (index) {
        case 0:
          //第一个参数为RectInput组件的值，刚好是函数前四个参数，故赋值如下
          i.value = {
            x: +params[0] || 0,
            y: +params[1] || 0,
            width: +params[2] || 0,
            height: +params[3] || 0,
          };
          break;
        case 1:
          //第二个参数为FileInput组件的值，AutoTipUtils.pathStrReset用来处理路径字符串
          i.value = AutoTipUtils.pathStrReset(params[4] || "");
          break;
        default:
          break;
      }
      */
    });
  },
  /**
   * 参数处理方法, 快速填写/修改参数弹窗点击确定时，会将弹窗中组件的值传入options，
   * 并且提供一个replaceCurFnArgs方法用来替换编辑器中当前函数的参数
  */
  parameterReplace: (options: {
    ${this.genCBOption()}replaceCurFnArgs: (targetArgs: string) => void;
  }) => {
    //根据实际情况去替换编辑器中的参数
    options.replaceCurFnArgs(
        ""/*替换后的参数字符串*/
    );
  },
};
`}async create(){const{scope:e,name:o}=this.options;try{const n=await pathUtils.resolve(await pathUtils.getInstallDir(),"../../../src/invokes/"),a=await pathUtils.resolve(n,e.length?`${e}/${o}`:o),r=await pathUtils.join(a,"index.ts"),l=await pathUtils.join(a,"document.ts"),c=await pathUtils.join(a,"exportFn.ts"),C=await pathUtils.join(a,"dialog.ts"),p=await pathUtils.join(a,"auxiliary.ts"),b=await pathUtils.join(a,"declaration.ts"),u=await pathUtils.join(a,"modelCallback.ts");return await Promise.all([fsUtils.writeFile(r,this.indexTemplate),fsUtils.writeFile(l,this.documentTemplate),fsUtils.writeFile(c,this.exportFnTemplate),fsUtils.writeFile(C,this.dialogTemplate),fsUtils.writeFile(p,this.auxiliaryTemplate),fsUtils.writeFile(b,this.declaration),fsUtils.writeFile(u,this.dialogCBTemplate)]),!0}catch{return!1}}async syncOtherFileName(e,o){const n=this.options.name,a=new RegExp(`i\\.name\\s?={2,3}\\s?[\`"']${o}[\`"']`,"g");try{const r=await pathUtils.resolve(e,"../exportFn.ts");let l;this.contentCache[r]?l=this.contentCache[r]:l=await fsUtils.readFile(r);const c=l.replace(new RegExp(`${o}Fn`,"g"),n+"Fn"),C=await pathUtils.resolve(e,"../auxiliary.ts");let p;this.contentCache[C]?p=this.contentCache[C]:p=await fsUtils.readFile(C);const b=p.replace(a,`i.name === "${n}"`),u=await pathUtils.resolve(e,"../declaration.ts");let w;this.contentCache[u]?w=this.contentCache[u]:w=await fsUtils.readFile(u);const f=w.replace(new RegExp(`function ${o}`,"g"),`function ${n}`),y=await pathUtils.resolve(e,"../modelCallback.ts");let k;this.contentCache[y]?k=this.contentCache[y]:k=await fsUtils.readFile(y);let T=k.replace(new RegExp(`${o}Fn`,"g"),`${n}Fn`);T=T.replace(new RegExp(`${o}耗时`,"g"),`${n}耗时`),T=T.replace(a,`i.name === "${n}"`),T=T.replace(new RegExp(`"${o}"`,"g"),`"${n}"`),T=T.replace(new RegExp(`\\.${o}`,"g"),`.${n}`),T=T.replace(new RegExp(`${o}\\(`,"g"),`${n}(`);const s=await pathUtils.resolve(e,"../document.ts");let $;this.contentCache[s]?$=this.contentCache[s]:$=await fsUtils.readFile(s);const I=$.replace(new RegExp(`${o}\\(`,"g"),`${n}(`);await Promise.all([fsUtils.writeFile(r,c),fsUtils.writeFile(C,b),fsUtils.writeFile(u,f),fsUtils.writeFile(y,T),fsUtils.writeFile(s,I)]),this.contentCache[r]=l,this.contentCache[C]=p,this.contentCache[u]=w,this.contentCache[y]=k,this.contentCache[s]=$}catch(r){console.error("syncOtherFileName error:",r)}}async syncOtherFileScope(e,o){const n=this.options.scope,a=new RegExp(`i\\.scope\\s?={2,3}\\s?[\`"']${o}[\`"']`,"g"),r=`i.scope === "${n}"`;try{const l=await pathUtils.resolve(e,"../auxiliary.ts");let c;this.contentCache[l]?c=this.contentCache[l]:c=await fsUtils.readFile(l);const C=c.replace(a,r),p=await pathUtils.resolve(e,"../modelCallback.ts");let b;this.contentCache[p]?b=this.contentCache[p]:b=await fsUtils.readFile(p);let u=b.replace(a,`i.scope === "${n}"`);u=u.replace(new RegExp(`${o}\\.`,"g"),`${n}.`);const w=await pathUtils.resolve(e,"../document.ts");let f;this.contentCache[w]?f=this.contentCache[w]:f=await fsUtils.readFile(w);const y=f.replace(new RegExp(`${o}\\.`,"g"),`${n}.`),k=await pathUtils.resolve(e,"../declaration.ts");let T;this.contentCache[k]?T=this.contentCache[k]:T=await fsUtils.readFile(k);let s=T;this.options.scope.trim().length?s=T.replace(/declare /,""):s.includes("declare function")||(s=y.replace(/function /,"declare function ")),await Promise.all([fsUtils.writeFile(l,C),fsUtils.writeFile(p,u),fsUtils.writeFile(w,y),fsUtils.writeFile(k,s)]),this.contentCache[l]=c,this.contentCache[p]=b,this.contentCache[w]=f,this.contentCache[k]=T}catch(l){console.error("syncOtherFileScope error:",l)}}async applyIndexOptions(e,o){if(!await exists(e)){console.error(`文件${e}不存在`);return}let a;this.contentCache[e]?a=this.contentCache[e]:a=await fsUtils.readFile(e);const r={nameChanged:!1,scopeChanged:!1};let l=a;const c=await astWorker.parseInvokeApiConfig(a,o.name+"Api");return this.options.disabled&&(c.disabled===void 0?l=l.replace(/name:\s*['"`].*['"`],?/,`name: '${this.options.name}',
  disabled: true,`):l=l.replace(/disabled:\s*false,/,"disabled: true,")),c.testModule.weight!==this.options.weight&&(l=l.replace(/weight:\s*\d+,/,`weight: ${this.options.weight},`)),this.options.name!==c.name&&(l=l.replace(/fn:\s*.*Fn,/,`fn: ${this.options.name}Fn,`),l=l.replace(/import\s+\{\s*.*Fn\s*\}\s+from\s+".\/exportFn";?/,`import { ${this.options.name}Fn } from "./exportFn";`),l=l.replace(/export const .*Api\s*=/,`export const ${this.options.name}Api =`),l=l.replace(/name:\s*['"`].*['"`],?/,`name: '${this.options.name}',`),r.nameChanged=!0,await this.syncOtherFileName(e,c.name)),this.options.scope!==c.scope&&(c.scope!==void 0?l=l.replace(/scope:\s*['"`].*['"`],?/,this.options.scope.trim().length?`scope: '${this.options.scope}',`:""):this.options.scope.trim().length&&(l=l.replace(/name:\s*['"`].*['"`],?/,`scope: '${this.options.scope}',
  name: '${this.options.name}',`)),r.scopeChanged=!0,await this.syncOtherFileScope(e,c.scope)),l=l.replace(/^\s*\n/gm,""),l!==a&&(await fsUtils.writeFile(e,l),this.contentCache[e]=l),r}async applyDocumentOptions(documentFilePath){const exist=await exists(documentFilePath);if(!exist){console.error(`文件${documentFilePath}不存在`);return}let oldDocumentContent;this.contentCache[documentFilePath]?oldDocumentContent=this.contentCache[documentFilePath]:oldDocumentContent=await fsUtils.readFile(documentFilePath);const oldCode=eval(`${oldDocumentContent.replace("<ApiDocumentType>","").replace("export ","")};apiDocument`);let newCode=eval(`${this.documentTemplate.replace("<ApiDocumentType>","").replace("export ","")};apiDocument`);JSON.stringify(oldCode)!==JSON.stringify(newCode)&&(await fsUtils.writeFile(documentFilePath,this.documentTemplate),this.contentCache[documentFilePath]=this.documentTemplate)}async applyDialogOptions(dialogFilePath){const exist=await exists(dialogFilePath);if(!exist){console.error(`文件${dialogFilePath}不存在`);return}let oldDialogContent;this.contentCache[dialogFilePath]?oldDialogContent=this.contentCache[dialogFilePath]:oldDialogContent=await fsUtils.readFile(dialogFilePath);const oldCode=eval(`${oldDialogContent.replace("<TestModuleDialogType>","").replace("export ","")};dialogOptions`);let newCode=eval(`${this.dialogTemplate.replace("<TestModuleDialogType>","").replace("export ","")};dialogOptions`);JSON.stringify(oldCode)!==JSON.stringify(newCode)&&(await fsUtils.writeFile(dialogFilePath,this.dialogTemplate),this.contentCache[dialogFilePath]=this.dialogTemplate)}async apply(e,o){try{let n;o.scope?n=await pathUtils.resolve(e,"../../../"):n=await pathUtils.resolve(e,"../../");const a=await pathUtils.resolve(e,"../"),r=await pathUtils.resolve(n,`${this.options.scope.length?this.options.scope+"/":""}${this.options.name}`);if(await exists(await pathUtils.resolve(r,"index.ts")))return ElMessage.error(`${this.options.scope?this.options.scope+".":""}${this.options.name} 已存在,无法完成修改！`),!1;const c=await pathUtils.resolve(e,"../dialog.ts"),C=await pathUtils.resolve(e,"../document.ts"),p=await this.applyIndexOptions(e,o);if(await this.applyDocumentOptions(C),await this.applyDialogOptions(c),p?.nameChanged||p?.scopeChanged)if(await fsUtils.moveChildToNewDir(a,r))ElMessage.success("更新成功");else return console.error("更新失败",a,r,this.options.scope),ElMessage.error("更新失败"),!1;return!0}catch(n){return console.error("apply new options error:",n),!1}}}const _hoisted_1$1={"w-full":""},_hoisted_2$1={"w-full":"","box-border":"",flex:"","flex-col":""},_hoisted_3$1={class:"form-item"},_hoisted_4$1={class:"form-item"},_hoisted_5$1={class:"form-item"},_hoisted_6$1={flex:"","flex-row":"","flex-items-center":""},_hoisted_7$1={class:"form-item"},_hoisted_8={flex:"","flex-col":""},_hoisted_9={class:"form-item"},_hoisted_10={"i-mdi-chevron-down":""},_hoisted_11={"i-mdi-chevron-left":""},_hoisted_12={flex:"","flex-col":"","pl-5":"","box-border":"","mt-2":""},_hoisted_13={flex:"","flex-col":"","flex-items-start":"","mb-2":""},_hoisted_14={flex:"","flex-col":"","flex-items-start":"","mb-2":""},_hoisted_15={class:"value"},_hoisted_16={"w-full":"",flex:"","flex-row":"","flex-items-center":"","justify-center":""},_hoisted_17={flex:"","flex-col":"","flex-items-start":"","mb-2":"","w-full":""},_hoisted_18={"w-full":"","box-border":"","pl-2":""},_hoisted_19={class:"form-item","w-full":""},_hoisted_20={class:"value"},_hoisted_21={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","p-8px":""},_hoisted_22={flex:"","flex-col":"","flex-items-start":"","mb-2":"","w-full":""},_hoisted_23={"w-full":"","box-border":"","pl-2":""},_hoisted_24={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","p-8px":""},_hoisted_25={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","p-8px":""},_hoisted_26={flex:"","flex-row":"","flex-items-center":"","w-full":"","justify-between":"","pr-2":"","mb-2":"","box-border":""},_hoisted_27={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","pr-2":""},_hoisted_28={flex:"","flex-col":""},_hoisted_29={class:"form-item"},_hoisted_30={"i-mdi-chevron-down":""},_hoisted_31={"i-mdi-chevron-left":""},_hoisted_32={flex:"","flex-col":"","pl-5":"","box-border":"","w-full":"","pr-2":""},_hoisted_33={class:"form-item"},_hoisted_34={key:0},_hoisted_35={class:"form-item"},_hoisted_36={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","pl-8px":""},_hoisted_37={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","pl-8px":""},_hoisted_38={class:"form-item"},_hoisted_39={"i-mdi-chevron-down":""},_hoisted_40={"i-mdi-chevron-left":""},_hoisted_41={flex:"","flex-col":"","pl-5":"","box-border":"","w-full":"","pr-2":""},_sfc_main$1=defineComponent({__name:"InvokesManagerForm",props:mergeModels({scopeList:{type:Array,required:!0},anchorModel:{type:String,default:"horizontal"},anchorIdPrefix:{type:String,required:!0}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:o}){const n=useModel(e,"modelValue"),a=reactive([{name:"auxiliary",title:"辅助代码",code:"",show:!1,path:""},{name:"fn",title:"API本体",code:"",show:!1,path:""},{name:"cb",title:"《快捷输入/修改参数弹窗》回调代码",code:"",show:!1,path:""}]),r=async()=>{let D="";p.value.find(U=>(U.label===n.value.name?D=U.fullPath:U.children&&U.children.find(q=>{q.label===n.value.name&&(D=q.fullPath)}),!!D));const i=await pathUtils.resolve(D,"../auxiliary.ts"),g=a.find(U=>U.name==="auxiliary"),E=a.find(U=>U.name==="fn"),A=a.find(U=>U.name==="cb");if(await exists(i)){const U=await fsUtils.readFile(i);g.code=U,g.path=i}else g.code="",g.path="";const L=await pathUtils.resolve(D,"../exportFn.ts");if(await exists(L)){const U=await fsUtils.readFile(L);E.code=U,E.path=L}else E.code="",E.path="";const j=await pathUtils.resolve(D,"../modelCallback.ts");if(await exists(j)){const U=await fsUtils.readFile(j);A.code=U,A.path=j}else A.code="",A.path=""};watch(n,r,{deep:!0});const l=computed(()=>n.value.document.params),c=e,C=ref("");watchEffect(()=>{if(n.value.document,!n.value.document.codeSnippet?.trim().length){const D=new InvokeTemplate(n.value);C.value=D.defaultSnippet()}});const p=ref([]),b=ref(!0),u=ref(!0),w=()=>{if(n.value?.scope){let D=n.value.scope;n.value.scope=D.charAt(0).toUpperCase()+D.slice(1)}},{getApiModules:f}=useCore(),y=async()=>{const D=await f(!1,!0,!0),{groupRecordToOptions:i,dataGrouping:g}=dataStructureUtils,E=i(g(D,"scope"),"name","id",["disabled","id","fullPath","scope","testModule"]);p.value=E.map(A=>({...A,enabled:!A.disabled,disabled:!1,children:A.children?.map(L=>({...L,enabled:!L.disabled,disabled:!1}))}))};let k;onBeforeUnmount(()=>{k&&k()}),onMounted(async()=>{k=await listen("tauri://focus",D=>{D.windowLabel===getCurrent().label&&r()}),await y(),r()});const T=(D,i)=>{const g=dataStructureUtils.findByIdInTree(i,n.value.document.params);g&&(D?(g.type=g.type.split("|"),g.type.includes(g.default)||(g.default=g.type[0])):g.type=g.type.join("|"))},s=["string","number","boolean","object","array","function","null","undefined"],$=(D,i)=>{const g=D?s.filter(L=>L.toLocaleLowerCase().includes(D.toLocaleLowerCase())):s,E=`'${D}'`;g.includes(E)||g.push(E);const A=`Promise<${D}>`;!g.includes(A)&&!g.includes(A.toLocaleLowerCase())&&!D.toLocaleLowerCase().includes("promise")&&g.push(A),!s.includes(D)&&!g.includes(D)&&(!D.includes("'")||!D.includes('"'))&&g.push(D),i(g.map(L=>({value:L})))},I=D=>{if(D===void 0)n.value.document.params?n.value.document.params.push({id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}):n.value.document.params=[{id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}];else{const i=dataStructureUtils.findByIdInTree(D,n.value.document.params);i&&(i.children?i.children.push({id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}):i.children=[{id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}])}},M=D=>{const i=dataStructureUtils.getTreeParentById(D,n.value.document.params);if(i){const g=i.findIndex(E=>E.id===D);if(g>0){if(!i[g].required&&i[g-1].required){ElMessage.warning("非必填参数不允许在必填参数之前");return}const E=i[g];i[g]=i[g-1],i[g-1]=E}}},_=D=>{const i=dataStructureUtils.getTreeParentById(D,n.value.document.params);if(i){const g=i.findIndex(E=>E.id===D);if(g<i.length-1){if(i[g].required&&!i[g+1].required){ElMessage.warning("必填参数不允许在非必填参数之后");return}const E=i[g];i[g]=i[g+1],i[g+1]=E}}},O=async D=>{if(D===void 0)try{await ElMessageBox.confirm("确定清空所有参数吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}),n.value.document.params=[],ElMessage.info("清空完成")}catch{}else try{await ElMessageBox.confirm("确定删除该参数吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"});const i=dataStructureUtils.getTreeParentById(D,n.value.document.params);i.splice(i.findIndex(g=>g.id===D),1),ElMessage.info("删除完成")}catch{}},R=(D,i)=>{i.required&&i.default!==""&&(i.default="");const g=dataStructureUtils.getTreeParentById(D,n.value.document.params);g&&g.sort((E,A)=>E.required===A.required?0:E.required?-1:1)};return o({codeSnippetPlaceholder:C,changeFormShow:D=>{switch(D){case 0:b.value=!0;break;case 1:u.value=!0;break;default:a[D-2].show=!0;break}}}),(D,i)=>{const g=ElText,E=ElInput,A=ElSwitch,L=ElOption,j=ElTag,U=ElSelect,q=ElInputNumber,z=ElIcon,F=ElButton,x=ElTableColumn,N=ElAutocomplete,m=ElCheckbox,V=ElTable,S=__unplugin_components_13,H=__unplugin_components_14;return openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,[createVNode(g,{tag:"b",id:c.anchorIdPrefix+"-api-name"},{default:withCtx(()=>i[19]||(i[19]=[createTextVNode("API名称")])),_:1},8,["id"]),createVNode(E,{modelValue:n.value.name,"onUpdate:modelValue":i[0]||(i[0]=v=>n.value.name=v),placeholder:"API名称",style:{width:"240px"}},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_4$1,[createVNode(g,{tag:"b",id:c.anchorIdPrefix+"-api-state"},{default:withCtx(()=>i[20]||(i[20]=[createTextVNode("API状态")])),_:1},8,["id"]),createVNode(A,{modelValue:n.value.disabled,"onUpdate:modelValue":i[1]||(i[1]=v=>n.value.disabled=v),"active-text":"禁用","inactive-text":"启用",style:{"--el-switch-on-color":"#ff4949","--el-switch-off-color":"var(--el-color-primary)"}},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_5$1,[createVNode(g,{tag:"b",id:c.anchorIdPrefix+"-ns"},{default:withCtx(()=>i[21]||(i[21]=[createTextVNode("命名空间(namespace)")])),_:1},8,["id"]),createVNode(U,{modelValue:n.value.scope,"onUpdate:modelValue":i[2]||(i[2]=v=>n.value.scope=v),filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"Root",style:{width:"240px"},onChange:w},{label:withCtx(({label:v})=>[createBaseVNode("div",_hoisted_6$1,[c.scopeList.find(B=>B.label===v)?createCommentVNode("",!0):(openBlock(),createBlock(j,{key:0,size:"small",type:"success","mr-1":""},{default:withCtx(()=>i[22]||(i[22]=[createTextVNode("new")])),_:1})),createVNode(g,null,{default:withCtx(()=>[createTextVNode(toDisplayString(v),1)]),_:2},1024)])]),default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(c.scopeList,(v,B)=>(openBlock(),createBlock(L,{key:B,label:v.label,value:v.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),createBaseVNode("div",_hoisted_7$1,[createVNode(g,{tag:"b",id:c.anchorIdPrefix+"-weight"},{default:withCtx(()=>i[23]||(i[23]=[createTextVNode("显示权重(越大默认排序越靠前)")])),_:1},8,["id"]),createVNode(q,{modelValue:n.value.weight,"onUpdate:modelValue":i[3]||(i[3]=v=>n.value.weight=v),min:0,placeholder:"显示权重"},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_8,[createBaseVNode("div",_hoisted_9,[createVNode(g,{tag:"b",id:c.anchorIdPrefix+"-api-doc"},{default:withCtx(()=>i[24]||(i[24]=[createTextVNode("API文档")])),_:1},8,["id"]),createVNode(F,{link:"",onClick:i[4]||(i[4]=v=>b.value=!unref(b))},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>[withDirectives(createBaseVNode("span",_hoisted_10,null,512),[[vShow,unref(b)]]),withDirectives(createBaseVNode("span",_hoisted_11,null,512),[[vShow,!unref(b)]])]),_:1})]),_:1})]),withDirectives(createBaseVNode("div",_hoisted_12,[createBaseVNode("div",_hoisted_13,[createVNode(g,{"self-start":"","mb-2":""},{default:withCtx(()=>i[25]||(i[25]=[createTextVNode("API使用介绍")])),_:1}),createVNode(E,{modelValue:n.value.document.howToUse,"onUpdate:modelValue":i[5]||(i[5]=v=>n.value.document.howToUse=v),type:"textarea",placeholder:"API使用介绍",autosize:""},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_14,[createVNode(g,{"self-start":"","mb-2":""},{default:withCtx(()=>i[26]||(i[26]=[createTextVNode("API参数")])),_:1}),createVNode(V,{data:n.value.document.params,"table-layout":"fixed","row-key":"id","default-expand-all":"",border:!0,"max-height":"75vh"},{default:withCtx(()=>[createVNode(x,{prop:"name",label:"参数名",fixed:"",width:"180"},{default:withCtx(v=>[createVNode(E,{modelValue:v.row.name,"onUpdate:modelValue":B=>v.row.name=B,placeholder:"参数名"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(x,{prop:"required",label:"必填",width:"70"},{default:withCtx(v=>[createVNode(A,{modelValue:v.row.required,"onUpdate:modelValue":B=>v.row.required=B,"active-text":"是","inactive-text":"否","inline-prompt":"",onChange:B=>R(v.row.id,v.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),createVNode(x,{prop:"instructions",label:"说明",width:"260"},{default:withCtx(v=>[createVNode(E,{modelValue:v.row.instructions,"onUpdate:modelValue":B=>v.row.instructions=B,type:"textarea",placeholder:"说明",size:"small",autosize:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(x,{prop:"type",label:"类型",width:"200"},{default:withCtx(v=>[Array.isArray(v.row.type)?(openBlock(),createBlock(U,{key:0,multiple:"",modelValue:v.row.type,"onUpdate:modelValue":B=>v.row.type=B,filterable:"","allow-create":""},null,8,["modelValue","onUpdate:modelValue"])):(openBlock(),createBlock(N,{key:1,modelValue:v.row.type,"onUpdate:modelValue":B=>v.row.type=B,"fetch-suggestions":$,clearable:"",placeholder:"请输入类型名称"},{default:withCtx(({item:B})=>[createBaseVNode("div",_hoisted_15,toDisplayString(B.value),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])),createVNode(m,{"ml-1":"",checked:Array.isArray(v.row.type),label:"枚举",size:"small",onChange:B=>T(B,v.row.id)},null,8,["checked","onChange"])]),_:1}),createVNode(x,{prop:"default",label:"默认值"},{default:withCtx(v=>[Array.isArray(v.row.type)?(openBlock(),createBlock(U,{key:0,modelValue:v.row.default,"onUpdate:modelValue":B=>v.row.default=B,size:"small",disabled:v.row.required,filterable:"","allow-create":"",clearable:""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(v.row.type,B=>(openBlock(),createBlock(L,{key:B,label:B,value:B},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])):(openBlock(),createBlock(E,{key:1,modelValue:v.row.default,"onUpdate:modelValue":B=>v.row.default=B,placeholder:"默认值",size:"small",disabled:v.row.required},null,8,["modelValue","onUpdate:modelValue","disabled"]))]),_:1}),createVNode(x,{fixed:"right",width:"100"},{header:withCtx(()=>[createVNode(F,{link:"",type:"danger",size:"large",onClick:i[6]||(i[6]=v=>O())},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>i[27]||(i[27]=[createBaseVNode("span",{"i-mdi-sort-variant-remove":""},null,-1)])),_:1})]),_:1}),createVNode(F,{link:"",type:"primary",size:"large",onClick:i[7]||(i[7]=v=>I())},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>i[28]||(i[28]=[createBaseVNode("span",{"i-mdi-playlist-plus":""},null,-1)])),_:1})]),_:1})]),default:withCtx(v=>[createBaseVNode("div",_hoisted_16,[createVNode(F,{link:"",class:"ml-1",type:"danger",onClick:B=>O(v.row.id)},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>i[29]||(i[29]=[createBaseVNode("span",{"i-mdi-close":""},null,-1)])),_:1})]),_:2},1032,["onClick"]),createVNode(F,{link:"",class:"ml-1",type:"primary",onClick:B=>I(v.row.id)},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>i[30]||(i[30]=[createBaseVNode("span",{"i-mdi-filter-variant-plus":""},null,-1)])),_:1})]),_:2},1032,["onClick"]),createVNode(F,{link:"",class:"ml-1",onClick:B=>M(v.row.id)},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>i[31]||(i[31]=[createBaseVNode("span",{"i-mdi-arrow-up-thin":""},null,-1)])),_:1})]),_:2},1032,["onClick"]),createVNode(F,{link:"",class:"ml-1",onClick:B=>_(v.row.id)},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>i[32]||(i[32]=[createBaseVNode("span",{"i-mdi-arrow-down-thin":""},null,-1)])),_:1})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])]),createBaseVNode("div",_hoisted_17,[createVNode(g,{"self-start":""},{default:withCtx(()=>i[33]||(i[33]=[createTextVNode("返回值")])),_:1}),createBaseVNode("div",_hoisted_18,[createBaseVNode("div",_hoisted_19,[createVNode(g,null,{default:withCtx(()=>i[34]||(i[34]=[createTextVNode("类型")])),_:1}),createVNode(N,{modelValue:n.value.document.returnValue.type,"onUpdate:modelValue":i[8]||(i[8]=v=>n.value.document.returnValue.type=v),style:{width:"480px"},"fetch-suggestions":$,clearable:"",placeholder:"请输入类型名称"},{default:withCtx(({item:v})=>[createBaseVNode("div",_hoisted_20,toDisplayString(v.value),1)]),_:1},8,["modelValue"])]),createBaseVNode("div",_hoisted_21,[createVNode(g,{"self-start":"","mb-2":""},{default:withCtx(()=>i[35]||(i[35]=[createTextVNode("返回值说明")])),_:1}),createVNode(E,{modelValue:n.value.document.returnValue.instructions,"onUpdate:modelValue":i[9]||(i[9]=v=>n.value.document.returnValue.instructions=v),type:"textarea",placeholder:"返回值说明",autosize:""},null,8,["modelValue"])])])]),createBaseVNode("div",_hoisted_22,[createVNode(g,{"self-start":""},{default:withCtx(()=>i[36]||(i[36]=[createTextVNode("示例")])),_:1}),createBaseVNode("div",_hoisted_23,[createBaseVNode("div",_hoisted_24,[createVNode(g,{"self-start":""},{default:withCtx(()=>i[37]||(i[37]=[createTextVNode("标题")])),_:1}),createVNode(E,{modelValue:n.value.document.example.title,"onUpdate:modelValue":i[10]||(i[10]=v=>n.value.document.example.title=v),type:"textarea",placeholder:"示例标题",autosize:""},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_25,[createVNode(g,{"self-start":""},{default:withCtx(()=>i[38]||(i[38]=[createTextVNode("代码")])),_:1}),createVNode(E,{modelValue:n.value.document.example.code,"onUpdate:modelValue":i[11]||(i[11]=v=>n.value.document.example.code=v),type:"textarea",placeholder:"示例代码",autosize:""},null,8,["modelValue"])])])]),createBaseVNode("div",_hoisted_26,[createVNode(g,null,{default:withCtx(()=>i[39]||(i[39]=[createTextVNode("搜索关键词")])),_:1}),createVNode(U,{multiple:"",filterable:"","allow-create":"",modelValue:n.value.document.searchKeys,"onUpdate:modelValue":i[12]||(i[12]=v=>n.value.document.searchKeys=v),style:{width:"480px"},placeholder:"可以添加搜索关键词"},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_27,[createVNode(g,{"self-start":""},{default:withCtx(()=>i[40]||(i[40]=[createTextVNode("代码片段(不填按照下面提示的内容生成)")])),_:1}),createVNode(E,{modelValue:n.value.document.codeSnippet,"onUpdate:modelValue":i[13]||(i[13]=v=>n.value.document.codeSnippet=v),type:"textarea",placeholder:unref(C),autosize:""},null,8,["modelValue","placeholder"])])],512),[[vShow,unref(b)]])]),createBaseVNode("div",_hoisted_28,[createBaseVNode("div",_hoisted_29,[createVNode(g,{tag:"b",id:c.anchorIdPrefix+"-api-test"},{default:withCtx(()=>i[41]||(i[41]=[createTextVNode("测试弹窗/快速修改参数弹窗")])),_:1},8,["id"]),createVNode(F,{link:"",onClick:i[14]||(i[14]=v=>u.value=!unref(u))},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>[withDirectives(createBaseVNode("span",_hoisted_30,null,512),[[vShow,unref(u)]]),withDirectives(createBaseVNode("span",_hoisted_31,null,512),[[vShow,!unref(u)]])]),_:1})]),_:1})]),withDirectives(createBaseVNode("div",_hoisted_32,[createBaseVNode("div",_hoisted_33,[createVNode(g,null,{default:withCtx(()=>i[42]||(i[42]=[createTextVNode("不启用[测试弹窗/快速修改参数弹窗]")])),_:1}),createVNode(A,{modelValue:n.value.dialog.notOpen,"onUpdate:modelValue":i[15]||(i[15]=v=>n.value.dialog.notOpen=v),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),n.value.dialog.notOpen?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_34,[createBaseVNode("div",_hoisted_35,[createVNode(g,null,{default:withCtx(()=>i[43]||(i[43]=[createTextVNode("在API测试窗口显示的名称")])),_:1}),createVNode(E,{modelValue:n.value.dialog.title,"onUpdate:modelValue":i[16]||(i[16]=v=>n.value.dialog.title=v),placeholder:"在API测试窗口显示的名称",style:{width:"240px"}},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_36,[createVNode(g,{"self-start":""},{default:withCtx(()=>i[44]||(i[44]=[createTextVNode("弹窗中显示的内容(用于对API进行介绍或者说明)")])),_:1}),createVNode(E,{modelValue:n.value.dialog.content,"onUpdate:modelValue":i[17]||(i[17]=v=>n.value.dialog.content=v),autosize:"",placeholder:"弹窗中显示的内容",type:"textarea"},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_37,[createVNode(g,{"self-start":""},{default:withCtx(()=>i[45]||(i[45]=[createTextVNode("弹窗组件编辑(可从左侧将指定参数组件拖拽至右侧)")])),_:1}),createVNode(S,{modelValue:n.value.dialog.args,"onUpdate:modelValue":i[18]||(i[18]=v=>n.value.dialog.args=v),"document-params":unref(l)},null,8,["modelValue","document-params"])])]))],512),[[vShow,unref(u)]])]),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(a),v=>(openBlock(),createElementBlock("div",{flex:"","flex-col":"",key:v.name},[createBaseVNode("div",_hoisted_38,[createVNode(g,{tag:"b",id:c.anchorIdPrefix+"-"+v.name},{default:withCtx(()=>[createTextVNode(toDisplayString(v.title),1)]),_:2},1032,["id"]),createVNode(F,{link:"",onClick:B=>v.show=!v.show},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>[withDirectives(createBaseVNode("span",_hoisted_39,null,512),[[vShow,v.show]]),withDirectives(createBaseVNode("span",_hoisted_40,null,512),[[vShow,!v.show]])]),_:2},1024)]),_:2},1032,["onClick"])]),withDirectives(createBaseVNode("div",_hoisted_41,[createVNode(H,{"raw-code":v.code,"file-path":v.path},null,8,["raw-code","file-path"])],512),[[vShow,v.show]])]))),128))])])}}}),__unplugin_components_6=_export_sfc$1(_sfc_main$1,[["__scopeId","data-v-571d3edf"]]),_hoisted_1={class:"container-root","w-full":"","h-full":"","pos-relative":"","p-0":"","box-border":"","overflow-hidden":"",flex:"","p-5px":"","flex-col":""},_hoisted_2={"h-40px":"",flex:"","flex-row":"","justify-between":"","flex-items-center":"","w-full":"","p-5px":"","box-border":"","border-rd-10px":""},_hoisted_3={flex:"","flex-row":"","justify-end":"","flex-items-center":""},_hoisted_4={flex:"","flex-items-center":"","flex-row":""},_hoisted_5=["onClick"],_hoisted_6={key:1,"w-120px":"","ml-5":"","flex-col":"","mt-10":""},_hoisted_7=["onClick"],_sfc_main=defineComponent({__name:"InvokesManager",setup(e){useCssVars(x=>({"3e6eb27f":unref(C)}));const o=ref(""),n=ref(),a=ref(),r=["管理API","创建API"],l=ref("管理API"),c=ref(null),{appBackground:C}=useAppTheme(),p=ref("");let b="";const u=ref({manager:defaultInvokeTemplateOptions(),create:defaultInvokeTemplateOptions()}),w=reactive([]);let f="";watch(p,()=>{const x=I.value.map(m=>m.children?m.children:[m]).flat().map(m=>({...m,scope:m.scope?m.scope:""})).find(m=>m.id===p.value),N={name:x?.label||"",scope:x?.scope||"",weight:x?.testModule?.weight||1,disabled:x?.disabled||!1,document:x?.testModule?.document||{howToUse:"",params:[],returnValue:{instructions:"",type:""},example:{title:"",code:""},searchKeys:[],codeSnippet:""},dialog:x?.testModule?.dialog||{title:"",content:"",args:[]}};u.value.manager=N,f=x?.fullPath||"",b=JSON.stringify(N),w.splice(0,w.length,{label:"Root",value:""},...I.value.filter(m=>m.children).map(m=>({label:m.children[0].scope||"Root",value:m.children[0].scope||""})))});const y=computed(()=>b!==JSON.stringify(u.value.manager)&&!!p.value.length),k=(x=!0)=>{u.value.manager=JSON.parse(b),x&&ElMessage.success("重置成功")},T=async()=>{const x=JSON.parse(b);await new InvokeTemplate(JSON.parse(b)).apply(f,x)&&(b=JSON.stringify(u.value.manager))},s=async()=>{try{await ElMessageBox.confirm("删除后无法恢复，请谨慎删除！",`删除${u.value.manager.scope}.${u.value.manager.name}`,{confirmButtonText:"删除",cancelButtonText:"取消",confirmButtonClass:"el-button--danger",type:"error"})}catch{return}try{const x=await pathUtils.resolve(f,"../"),N=await pathUtils.resolve(x,"../");await fsUtils.deleteDir(x,!0)?(await fsUtils.deleteDir(N,!1,!0),ElMessage.success("删除成功")):ElMessage.error("删除失败")}catch(x){console.error(x),ElMessage.error("删除失败")}},$=async x=>{if(y.value){try{await ElMessageBox.confirm("是否保存当前修改？","提示",{confirmButtonText:"保存",cancelButtonText:"放弃更改",type:"warning"})}catch{k(!1),x.srcElement?.click();return}T()}},I=ref([]),{getApiModules:M}=useCore(),_=x=>{I.value=x.map(N=>({...N,enabled:!N.disabled,disabled:!1,testModule:{...N.testModule,document:{...N.testModule?.document,params:dataStructureUtils.genTreeArrNodeId(N.testModule?.document?.params||[]),returnValue:{...N.testModule?.document?.returnValue,instructions:N.testModule?.document?.returnValue?.instructions||""},example:{...N.testModule?.document?.example,title:N.testModule?.document?.example?.title||"",code:N.testModule?.document?.example?.code||""},searchKeys:N.testModule?.document?.searchKeys||[],codeSnippet:N.testModule?.document?.codeSnippet||""},dialog:{...N.testModule?.dialog,args:N.testModule?.dialog?.args?.map(m=>{const V=nanoid();return m.componentType==="DirInput"?{...m,id:V,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1,suffix:m.suffix||"",verifyPath:m.verifyPath||!1}:m.componentType==="FileInput"?{...m,id:V,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1,suffix:m.suffix||"",verifyPath:m.verifyPath||!1,multiple:m.multiple||!1,value:m.value||(m.multiple?[]:"")}:m.componentType==="RectInput"?{...m,id:V,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1,targetSrc:m.targetSrc||""}:m.componentType==="select"?{...m,id:V,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1,options:m.options||[],multiple:m.multiple||!1,value:m.value||(m.multiple?[]:""),selectOptionSeparator:m.selectOptionSeparator||"",notAllowCreate:m.notAllowCreate||!1}:m.componentType==="numberRangeInput"?{...m,id:V,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1,limit:m.limit||[0,0]}:m.componentType==="switch"?{...m,id:V,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1,activeText:m.activeText||"是",inactiveText:m.inactiveText||"否"}:m.componentType==="slider"?{...m,id:V,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1,range:m.range||{max:1,min:0,step:.1}}:{...m,id:V,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1}}),notOpen:N.testModule?.dialog?.notOpen||!1,title:N.testModule?.dialog?.title||"",content:N.testModule?.dialog?.content||""}},children:N.children?.map(m=>({...m,enabled:!m.disabled,disabled:!1,testModule:{...m.testModule,document:{...m.testModule?.document,params:dataStructureUtils.genTreeArrNodeId(m.testModule?.document?.params||[]),returnValue:{...m.testModule?.document?.returnValue,instructions:m.testModule?.document?.returnValue?.instructions||""},example:{...m.testModule?.document?.example,title:m.testModule?.document?.example?.title||"",code:m.testModule?.document?.example?.code||""},searchKeys:m.testModule?.document?.searchKeys||[],codeSnippet:m.testModule?.document?.codeSnippet||""},dialog:{...m.testModule?.dialog,args:m.testModule?.dialog?.args?.map(V=>{const S=nanoid();return V.componentType==="DirInput"?{...V,id:S,noTest:V.noTest||!1,onlyTest:V.onlyTest||!1,suffix:V.suffix||"",verifyPath:V.verifyPath||!1}:V.componentType==="FileInput"?{...V,id:S,noTest:V.noTest||!1,onlyTest:V.onlyTest||!1,suffix:V.suffix||"",verifyPath:V.verifyPath||!1,multiple:V.multiple||!1,value:V.value||(V.multiple?[]:"")}:V.componentType==="RectInput"?{...V,id:S,noTest:V.noTest||!1,onlyTest:V.onlyTest||!1,targetSrc:V.targetSrc||""}:V.componentType==="select"?{...V,id:S,noTest:V.noTest||!1,onlyTest:V.onlyTest||!1,options:V.options||[],multiple:V.multiple||!1,value:V.value||(V.multiple?[]:""),selectOptionSeparator:V.selectOptionSeparator||"",notAllowCreate:V.notAllowCreate||!1}:V.componentType==="numberRangeInput"?{...V,id:S,noTest:V.noTest||!1,onlyTest:V.onlyTest||!1,limit:V.limit||[0,0]}:V.componentType==="switch"?{...V,id:S,noTest:V.noTest||!1,onlyTest:V.onlyTest||!1,activeText:V.activeText||"是",inactiveText:V.inactiveText||"否"}:V.componentType==="slider"?{...V,id:S,noTest:V.noTest||!1,onlyTest:V.onlyTest||!1,range:V.range||{max:1,min:0,step:.1}}:{...V,id:S,noTest:V.noTest||!1,onlyTest:V.onlyTest||!1}}),notOpen:m.testModule?.dialog?.notOpen||!1,title:m.testModule?.dialog?.title||"",content:m.testModule?.dialog?.content||""}}}))})),I.value[0]&&(I.value[0].children&&I.value[0].children[0]?p.value=I.value[0].children[0].id:p.value=I.value[0].id)},O=async()=>{const x=JSON.parse(JSON.stringify(await M(!1,!0,!0))),{groupRecordToOptions:N,dataGrouping:m}=dataStructureUtils,V=N(m(x,"scope"),"name","id",["disabled","id","fullPath","scope","testModule"]);_(V)},R=ref("horizontal"),P=async()=>{await appWindow.isMaximized()?R.value="vertical":R.value="horizontal"},D=reactive([{value:"api-name",label:"名称"},{value:"api-state",label:"状态"},{value:"ns",label:"命名空间"},{value:"weight",label:"权重"},{value:"api-doc",label:"文档"},{value:"api-test",label:"弹窗"},{value:"auxiliary",label:"辅助代码"},{value:"fn",label:"API本体"},{value:"cb",label:"回调代码"}]),i=x=>{const N=document.getElementById((l.value==="管理API"?"manager":"create")+"-"+x);if(N){const V=D.slice(-5).map(S=>S.value).indexOf(x);if(V!==-1){let S;l.value==="创建API"?S=n.value.changeFormShow:S=a.value.changeFormShow,S&&S(V)}nextTick(()=>{N.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})})}};let g={manager:D[0].value,create:D[0].value};watch(o,x=>{l.value==="管理API"?g.manager=x:g.create=x});const E=()=>{l.value==="创建API"?(o.value=g.create,setTimeout(()=>{i(g.create)},100)):(o.value=g.manager,setTimeout(()=>{i(g.manager)},100))};let A,L=!1,j=0;const U=x=>{A&&clearTimeout(A),A=setTimeout(()=>{const N=x.target.scrollTop||0,m=D.find(V=>{const S=document.getElementById((l.value==="管理API"?"manager":"create")+"-"+V.value);if(S){const H=S.getBoundingClientRect();return H.top>=70&&H.bottom<=window.innerHeight}return!1});if(m)o.value=m.value,L=!1;else if(N<j){const V=D.findIndex(S=>S.value===o.value);V>0&&!L&&(o.value=D[V-1].value,L=!0)}j=N})};onMounted(async()=>{await O(),P(),window.addEventListener("resize",P),c.value?.addEventListener("scroll",U),o.value=D[0].value,invokeBaseApi.closeSplashscreen()}),onUnmounted(()=>{window.removeEventListener("resize",P),c.value?.removeEventListener("scroll",U)});const q=(x,N)=>{const m=N.testModule?.dialog,V=N.testModule?.document;return N.label.toLocaleLowerCase().includes(x.toLocaleLowerCase())||m?.title?.toLocaleLowerCase().includes(x.toLocaleLowerCase())||m?.content?.toLocaleLowerCase().includes(x.toLocaleLowerCase())||V?.howToUse?.toLocaleLowerCase().includes(x.toLocaleLowerCase())||V?.searchKeys?.some(S=>S.toLocaleLowerCase().includes(x.toLocaleLowerCase()))},z=async()=>{try{await ElMessageBox.confirm("是否清空当前内容？","提示",{confirmButtonText:"清空",cancelButtonText:"取消",type:"warning"})}catch{return}u.value.create=defaultInvokeTemplateOptions(),ElMessage.success("清空完成")},F=()=>{const{codeSnippetPlaceholder:x}=n.value;u.value.create.document.codeSnippet?.trim().length||(u.value.create.document.codeSnippet=x),new InvokeTemplate(u.value.create).create(),ElMessage.success("创建成功")};return(x,N)=>{const m=ElSegmented,V=ElText,S=ElTag,H=ElTreeSelect,v=ElButton,B=ElButtonGroup,Y=__unplugin_components_6,G=ElEmpty;return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createVNode(m,{modelValue:unref(l),"onUpdate:modelValue":N[0]||(N[0]=K=>isRef(l)?l.value=K:null),options:r,"ml-1":"",onChange:E},null,8,["modelValue"]),createBaseVNode("div",_hoisted_3,[withDirectives(createVNode(V,{tag:"b"},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(y)?"*":""),1)]),_:1},512),[[vShow,unref(l)==="管理API"]]),withDirectives(createVNode(H,{size:"small",onClick:$,"w-300px":"","mr-10px":"",modelValue:unref(p),"onUpdate:modelValue":N[1]||(N[1]=K=>isRef(p)?p.value=K:null),data:unref(I),"filter-node-method":q,clearable:"",placeholder:"请选择API",filterable:"","default-expand-all":""},{default:withCtx(({data:{label:K,children:J,enabled:W}})=>[createBaseVNode("div",_hoisted_4,[createTextVNode(toDisplayString(K),1),J?(openBlock(),createBlock(S,{key:0,"ml-1":"",size:"small"},{default:withCtx(()=>N[6]||(N[6]=[createTextVNode("namespace")])),_:1})):createCommentVNode("",!0),W?createCommentVNode("",!0):(openBlock(),createBlock(S,{key:1,size:"small",type:"danger","ml-1":""},{default:withCtx(()=>N[7]||(N[7]=[createTextVNode("已禁用")])),_:1}))])]),_:1},8,["modelValue","data"]),[[vShow,unref(l)==="管理API"]]),withDirectives(createVNode(B,{"ml-1":"",size:"small"},{default:withCtx(()=>[createVNode(v,{type:"danger",onClick:s},{default:withCtx(()=>N[8]||(N[8]=[createTextVNode("删除API")])),_:1}),createVNode(v,{onClick:N[2]||(N[2]=K=>k(!0)),disabled:!unref(y)},{default:withCtx(()=>N[9]||(N[9]=[createTextVNode("恢复修改前")])),_:1},8,["disabled"]),createVNode(v,{type:"primary",onClick:T,disabled:!unref(y)},{default:withCtx(()=>N[10]||(N[10]=[createTextVNode("保存修改")])),_:1},8,["disabled"])]),_:1},512),[[vShow,unref(l)==="管理API"]]),withDirectives(createVNode(B,{"ml-1":"",size:"small"},{default:withCtx(()=>[createVNode(v,{onClick:z},{default:withCtx(()=>N[11]||(N[11]=[createTextVNode("清空内容")])),_:1}),createVNode(v,{type:"primary",onClick:F},{default:withCtx(()=>N[12]||(N[12]=[createTextVNode("保存新建")])),_:1})]),_:1},512),[[vShow,unref(l)==="创建API"]])])]),createBaseVNode("div",{flex:"","w-full":"",class:"content-container",style:normalizeStyle({flexDirection:unref(R)==="horizontal"?"column":"row"})},[unref(R)==="horizontal"?(openBlock(),createBlock(m,{key:0,modelValue:unref(o),"onUpdate:modelValue":N[3]||(N[3]=K=>isRef(o)?o.value=K:null),options:unref(D),size:"small",block:!0},{default:withCtx(({item:K})=>[typeof K=="object"?(openBlock(),createElementBlock("div",{key:0,onClick:J=>i(K.value)},toDisplayString(K.label),9,_hoisted_5)):createCommentVNode("",!0)]),_:1},8,["modelValue","options"])):createCommentVNode("",!0),createBaseVNode("div",{"overflow-y-scroll":"","overflow-x-hidden":"",ref_key:"scrollRef",ref:c,"flex-1":""},[withDirectives(createVNode(Y,{ref_key:"IMFRef_manager",ref:a,modelValue:unref(u).manager,"onUpdate:modelValue":N[4]||(N[4]=K=>unref(u).manager=K),"scope-list":unref(w),"anchor-model":unref(R),"anchor-id-prefix":"manager"},null,8,["modelValue","scope-list","anchor-model"]),[[vShow,unref(l)==="管理API"&&unref(p)]]),withDirectives(createVNode(G,{description:"请选择一个API进行管理"},null,512),[[vShow,unref(l)==="管理API"&&!unref(p)]]),withDirectives(createVNode(Y,{ref_key:"IMFRef",ref:n,modelValue:unref(u).create,"onUpdate:modelValue":N[5]||(N[5]=K=>unref(u).create=K),"scope-list":unref(w),"anchor-model":unref(R),"anchor-id-prefix":"create"},null,8,["modelValue","scope-list","anchor-model"]),[[vShow,unref(l)==="创建API"]])],512),unref(R)==="vertical"?(openBlock(),createElementBlock("div",_hoisted_6,[createVNode(V,{tag:"b"},{default:withCtx(()=>N[13]||(N[13]=[createTextVNode("表单项")])),_:1}),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(D),K=>(openBlock(),createElementBlock("div",{class:normalizeClass(["link-item",{active:unref(o)===K.value}]),onClick:J=>i(K.value),link:"",key:K.value},toDisplayString(K.label),11,_hoisted_7))),128))])):createCommentVNode("",!0)],4)])}}}),InvokesManager=_export_sfc$1(_sfc_main,[["__scopeId","data-v-85220140"]]);export{InvokesManager as default};
