import{d as N,E as B,bV as J,c as A,F as S,o as u,a as C,g as e,b as t,w as n,n as d,p,P as R,Q as K,e as x,t as V,I as L,bz as M,L as Z,cb as H,v as X,x as P,Z as F,z as Y,y as j,a2 as ee,cc as D,cd as te,ce as $,B as oe,J as z,cf as se,N as ne,cg as le,ch as ae,_ as O,ci as re,cj as ue,ck as ce,G as ie,u as de,h as pe,i as me}from"./index-BG1F5OCk.js";import{E as q}from"./el-empty-C87_4zF1.js";import{E as _e}from"./el-card-1_DYkBIo.js";import{E as fe}from"./el-checkbox-BGCHRVHo.js";import{E as ve}from"./el-segmented-CF_gvMHI.js";const ge={class:"wss-panel"},we={key:0},ye={flex:"","flex-row":"","items-center":"","w-full":""},ke={flex:"","flex-row":"","items-center":"","mt-4":""},xe={flex:"","flex-row":"","items-center":"","justify-between":"","w-full":"","mt-4":""},Ee={flex:"","flex-row":"","items-center":"","justify-between":"","w-full":""},be=N({__name:"WssPanel",setup(w){const{wssState:c,onMsg:a,responseReq:o}=M(),{controlDeviceInfo:r,autoOnline:m,autoAsk:f,controlCode:i,refreshCode:y,updateCode:E}=Z();a(s=>{if(s.type==="LINK_REQ"){if(r.id===s.deviceId){o(!0),B.warning("已有设备正在控制中");return}if(r.accessToken=s.accessToken,!s.code||s.code==="")if(f.value){J.confirm(`是否允许${s.deviceId}远程控制`,"远程控制请求",{confirmButtonText:"允许",cancelButtonText:"拒绝",type:"warning"}).then(()=>{o(!0),r.id=s.deviceId}).catch(()=>{o(!1,"用户拒绝连接")});return}else{o(!1,"不接受无访问码请求");return}if(i.value===s.code)r.id=s.deviceId,o(!0);else{r.id="",o(!1,"访问码错误");return}}});const v=A(()=>i.value.split("").filter((s,l)=>l<4)),k=()=>{const s=i.value;H(s),B.success("复制成功")};return S(()=>{m.value&&(c.value="在线")}),(s,l)=>{const g=X,b=P,I=F,T=Y,U=j,_=ee,Q=_e,W=q;return u(),C("div",ge,[e(c)==="在线"?(u(),C("div",we,[t(Q,{shadow:"hover"},{default:n(()=>[d("div",ye,[t(b,{h4:"","mr-3":""},{default:n(()=>[t(g,null,{default:n(()=>l[2]||(l[2]=[d("span",{"i-mdi-lock":""},null,-1)])),_:1}),l[3]||(l[3]=p("远程控制访问码"))]),_:1}),t(T,{effect:"dark",content:"刷新访问码",placement:"top"},{default:n(()=>[t(I,{link:"",onClick:e(y),size:"large"},{default:n(()=>[t(g,{size:"large"},{default:n(()=>l[4]||(l[4]=[d("span",{"i-mdi-shield-sync":""},null,-1)])),_:1})]),_:1},8,["onClick"])]),_:1}),t(T,{effect:"dark",content:"修改访问码",placement:"top"},{default:n(()=>[t(I,{link:"",onClick:e(E),size:"large"},{default:n(()=>[t(g,{size:"large"},{default:n(()=>l[5]||(l[5]=[d("span",{"i-mdi-shield-edit":""},null,-1)])),_:1})]),_:1},8,["onClick"])]),_:1})]),d("div",ke,[(u(!0),C(R,null,K(e(v),(h,G)=>(u(),x(U,{key:G,"mr-2":""},{default:n(()=>[p(V(h),1)]),_:2},1024))),128)),t(I,{type:"primary",link:"",onClick:k},{default:n(()=>l[6]||(l[6]=[p("复制")])),_:1})]),d("div",xe,[t(b,null,{default:n(()=>l[7]||(l[7]=[p("自动上线")])),_:1}),t(_,{modelValue:e(m),"onUpdate:modelValue":l[0]||(l[0]=h=>L(m)?m.value=h:null)},null,8,["modelValue"])]),d("div",Ee,[t(b,null,{default:n(()=>l[8]||(l[8]=[p("无访问码时询问")])),_:1}),t(_,{modelValue:e(f),"onUpdate:modelValue":l[1]||(l[1]=h=>L(f)?f.value=h:null)},null,8,["modelValue"])])]),_:1})])):(u(),x(W,{key:1,description:"当前处于离线状态，如想开启远程被控功能，请切换至在线状态"}))])}}}),{isLogin:Ve,username:Ce}=$(),Be=async(w,c)=>{try{const a=await D.post("auth/login",{username:w,password:c});return a.data.message&&a.data.message.includes("login successful")?(te(a.data.token),Ve.value=!0,Ce.value=w,!0):!1}catch(a){return B.error("登录失败:"+a.response?.data?.message),!1}},Ie=async(w,c)=>{try{const a=await D.post("auth/register",{username:w,password:c});return!!(a.data.message&&a.data.message.includes("registered successfully"))}catch(a){return B.error("注册失败:"+a.response?.data?.message),!1}},he=N({__name:"AccountAuth",setup(w){const c=!se,{autoLogin:a,form:o,formShow:r,formRules:m,resetLastUserInfoToForm:f,saveLastUserInfo:i}=$(),y=oe("formEl"),E=()=>{r.value=r.value==="login"?"register":"login",y.value?.resetFields()},v=()=>{y.value?.validate(async k=>{k&&(r.value==="login"?await Be(o.username,o.password)&&(a.value&&i(),B.success("登录成功")):await Ie(o.username,o.password)&&(B.success("注册成功"),r.value="login"))})};return S(()=>{a.value=f(),a.value&&v()}),(k,s)=>{const l=q,g=ne,b=le,I=ae,T=fe,U=F;return e(c)?(u(),x(l,{key:0,description:"playground环境不支持当前功能"})):(u(),C(R,{key:1},[d("h1",null,"用户"+V(e(r)==="login"?"登录":"注册"),1),t(I,{"inline-message":"",model:e(o),className:"form",rules:e(m),ref_key:"formEl",ref:y},{default:n(()=>[t(b,{label:"用户名",prop:"username","label-position":"top",class:"form-item"},{default:n(()=>[t(g,{modelValue:e(o).username,"onUpdate:modelValue":s[0]||(s[0]=_=>e(o).username=_),clearable:""},null,8,["modelValue"])]),_:1}),t(b,{label:"密码",prop:"password","label-position":"top",class:"form-item"},{default:n(()=>[t(g,{modelValue:e(o).password,"onUpdate:modelValue":s[1]||(s[1]=_=>e(o).password=_),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(r)==="register"?(u(),x(b,{key:0,label:"重复密码",prop:"rePassword","label-position":"top",class:"form-item"},{default:n(()=>[t(g,{modelValue:e(o).rePassword,"onUpdate:modelValue":s[2]||(s[2]=_=>e(o).rePassword=_),type:"password","show-password":""},null,8,["modelValue"])]),_:1})):z("",!0)]),_:1},8,["model","rules"]),e(r)==="login"?(u(),x(T,{key:0,modelValue:e(a),"onUpdate:modelValue":s[3]||(s[3]=_=>L(a)?a.value=_:null),label:"自动登录",size:"large"},null,8,["modelValue"])):z("",!0),t(U,{type:"primary",class:"btn",onClick:v},{default:n(()=>[p(V(e(r)==="login"?"登录":"注册"),1)]),_:1}),t(U,{type:"primary",link:"",onClick:E,class:"btn"},{default:n(()=>[p(" 前往"+V(e(r)==="login"?"注册":"登录"),1)]),_:1})],64))}}}),Ae=O(he,[["__scopeId","data-v-3c9d3881"]]),Te={"w-full":""},Ue={flex:"","flex-row":"","items-center":"","w-full":"","justify-between":""},Le={flex:"","flex-row":"","items-center":""},Ne={flex:"","flex-row":"","items-center":""},$e=N({__name:"AccountTitleBar",setup(w){const{username:c,logout:a}=$(),{wssState:o}=M(),r=A(()=>c.value[0]?.toUpperCase()||""),m=A(()=>o.value==="在线"?"success":"warning");return(f,i)=>{const y=ue,E=ce,v=P,k=j,s=ve,l=F;return u(),C("div",Te,[d("div",Ue,[d("div",Le,[t(E,{type:e(m),"is-dot":""},{default:n(()=>[t(y,{size:30},{default:n(()=>[p(V(e(r)),1)]),_:1})]),_:1},8,["type"]),t(v,{truncated:""},{default:n(()=>[p(V(e(c)),1)]),_:1}),t(k,{size:"small",type:"info","ml-1":""},{default:n(()=>[t(v,{truncated:""},{default:n(()=>[p(V(e(re)),1)]),_:1})]),_:1})]),d("div",Ne,[t(s,{modelValue:e(o),"onUpdate:modelValue":i[0]||(i[0]=g=>L(o)?o.value=g:null),options:["在线","离线"],"mr-5":""},null,8,["modelValue"]),t(l,{onClick:e(a),link:"",type:"danger"},{default:n(()=>i[1]||(i[1]=[p("退出登录")])),_:1},8,["onClick"])])])])}}}),ze={class:"account-main"},Se=N({__name:"Account",setup(w){de(i=>({"7e723c85":e(m),daef5b64:e(f)}));const{appAsideBgColor:c,appBackground:a}=pe(),{isEditing:o}=me(),{isLogin:r}=$(),m=A(()=>o.value?c?.value:a?.value),f=A(()=>o.value?"0":"10px 10px 10px 0");return S(()=>{ie.closeSplashscreen()}),(i,y)=>{const E=$e,v=Ae,k=be;return u(),C("div",ze,[e(r)?(u(),x(E,{key:0})):(u(),x(v,{key:1})),e(r)?(u(),x(k,{key:2,class:"panel"})):z("",!0)])}}}),De=O(Se,[["__scopeId","data-v-e39bfee0"]]);export{De as default};
