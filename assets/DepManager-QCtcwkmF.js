import{d as U,u as Y,m as e,Q as te,r as M,O as ne,C as se,g as le,n as ae,af as ie,o as n,i as m,a as $,l as _,j as k,w as o,t as v,ab as B,aj as V,ay as I,c as r,a9 as N,D as C,X as oe,ac as j,aT as G,p as W,by as X,bA as re,e as J,ae as R,ag as ce,bB as ue,bC as de}from"./.pnpm-D_Vtnb2u.js";import{k as pe,a2 as z,Y as q,_ as E,u as K,Q as S}from"./index-CQveOEMM.js";import{f as _e}from"./fs-C5TBDgLP.js";const me={class:"content"},fe={key:0,class:"info"},ge={key:0},be={key:1},ye={key:2},ke={class:"btns","element-loading-text":"安装中"},ve=U({__name:"InstallDep",setup(y){Y(d=>({"60e45285":e(c)}));const a=te(),l=M([]),x=pe(),{app:w,ocr:h}=ne(x),u=M(),{allLibsName:t}=q(),c=M("auto"),s=se({success:0,fail:0,failLabel:[],installed:!1,loading:!1});let g;const A=d=>{const{paths:i}=d.payload;Array.isArray(i)&&O(i)};le(async()=>{g=await a.listen("tauri://drag-drop",A),await ae();const{height:d}=u.value.getBoundingClientRect();c.value=`${d}px`}),ie(()=>{g()});const F=()=>{l.value=[]},O=async d=>{if(d||(d=await _e.selectFile(!0)),d){const i=l.value.map(f=>f.path),p=[...new Set([...i,...d])].map(f=>({path:f,label:f.split("\\")[f.split("\\").length-1]})).filter(f=>t.value.find(D=>D.split("->").find(ee=>ee.includes(f.label))));if(l.value.length+d.length!==p.length&&C({title:"提示",message:"所选的部分依赖已在列表中或者无效，已自动过滤",type:"warning",position:"bottom-right"}),p.find(f=>f.label.includes("base_dep_pkg.7z"))){const f=p.find(L=>L.label.includes("simple_dep_pkg.7z"));f&&(p.splice(p.indexOf(f),1),C({title:"提示",message:"已选择普通版依赖包，已将精简版依赖包移除。",type:"info",position:"bottom-right"}))}l.value=p,await b(p)&&C({title:"提示",message:"当前为完整版，如果继续安装基础版依赖包，将会把OCR运行方式设置为基础版(CPU)。",type:"warning",position:"bottom-right"})}},P=d=>{l.value=l.value.filter(i=>i.path!==d)},b=async d=>w.value.dependenceState==="完整版"?!!d.find(p=>p.label.includes("base_dep_pkg.7z")):!1,H=async(d=!1)=>{s.loading=!0;const i=[];s.success=0,s.fail=0,s.failLabel=[];const p=l.value.slice(0),T=await b(p);for(let L=0;L<p.length;L++){const D=l.value.pop();D&&(await z.installDep(D,!1,T,h.value.value)?s.success++:(i.push(D.label),s.fail++))}s.failLabel=i,s.installed=!0,T&&!i.includes("base_dep_pkg.7z")&&h.value.value==="GPU"&&(h.value.value="CPU",C({title:"提示",message:"由于在完整版上安装了基础版依赖包，为了避免出错，已将OCR运行方式设置为基础版(CPU)。",type:"info",position:"bottom-right"})),C({title:"提示",message:"安装完成",type:"success",position:"bottom-right"}),await z.checkDepUpdate(),s.loading=!1,d&&re();const f=setTimeout(()=>{s.installed=!1,clearTimeout(f)},1e4)},Z=async()=>{let d=!1;const i=l.value.find(p=>p.path.includes("screenOperation.dll"));i&&await z.libExists("screenOperation.dll")&&(d=!0),d?oe.confirm("检测到存在文件更新后需要重启才能生效，是否继续？","提示",{confirmButtonText:"继续",cancelButtonText:"取消",type:"warning"}).then(async()=>{await z.pushUpdateDep(i.path),await H(!0)}):await H()};return(d,i)=>{const p=j,T=G,f=W,L=X;return n(),m("div",{class:"install-dep",ref_key:"contentRef",ref:u},[$("div",me,[!e(l).length&&e(s).installed?(n(),m("div",fe,[$("div",null,[i[1]||(i[1]=_(" 安装成功：")),k(p,{size:"small"},{default:o(()=>[_(v(e(s).success),1)]),_:1})]),$("div",null,[i[2]||(i[2]=_(" 安装失败：")),k(p,{type:"danger",size:"small"},{default:o(()=>[_(v(e(s).fail),1)]),_:1})]),e(s).failLabel.length?(n(),m("div",ge,"安装失败的依赖名：")):B("",!0),(n(!0),m(V,null,I(e(s).failLabel,D=>(n(),r(p,{key:D,type:"info"},{default:o(()=>[_(v(D),1)]),_:2},1024))),128))])):!e(l).length&&!e(s).installed?(n(),m("div",be,[k(T,{description:"暂无安装任务,可点击右边按钮或者将文件拖入此处进行安装"})])):B("",!0),e(l).length?(n(),m("div",ye,"安装任务队列：")):B("",!0),(n(!0),m(V,null,I(e(l),D=>(n(),r(p,{key:D.path,class:"dep-tag",closable:"",type:"info",onClose:Q=>P(D.path)},{default:o(()=>[_(v(D.label),1)]),_:2},1032,["onClose"]))),128))]),N((n(),m("div",ke,[e(l).length?(n(),r(f,{key:0,class:"clear-btn",onClick:F},{default:o(()=>i[3]||(i[3]=[_("清空列表")])),_:1})):B("",!0),k(f,{class:"select-btn",onClick:i[0]||(i[0]=D=>O())},{default:o(()=>i[4]||(i[4]=[_("选择本地依赖文件")])),_:1}),k(f,{class:"install-btn",onClick:Z,type:"primary",disabled:!e(l).length},{default:o(()=>[_("安装"+v(e(l).length?`(${e(l).length})`:""),1)]),_:1},8,["disabled"])])),[[L,e(s).loading]])],512)}}}),we=E(ve,[["__scopeId","data-v-6f362507"]]),he={class:"dep-pkg-item"},De={class:"header"},Ce={class:"desc"},xe=U({__name:"DepPkgItem",props:{item:{type:Object,required:!0},currentVersion:{type:String,default:""}},setup(y){Y(u=>({"47345af8":e(l),"37ab6828":e(x)}));const a=y,{appAsideBgColor:l,appBackground:x}=K(),w=J(()=>!!a.item.download_url.find(u=>u.origin==="阿里云盘")),h=async u=>{if(u===1){const t=a.item.download_url.find(c=>c.origin.includes("移动云盘"));t?(await R("open_in_default_browser",{url:t.url}),t.pwd&&(S(t.pwd),C({title:"提示",message:"移动云盘提取码已复制到剪切板",type:"success",position:"bottom-right"}))):C({title:"提示",message:"未找到移动云盘下载链接",type:"error",position:"bottom-right"})}else{const t=a.item.download_url.find(c=>c.origin.includes("阿里云盘"));t?(await R("open_in_default_browser",{url:t.url}),t.pwd&&(S(t.pwd),C({title:"提示",message:"阿里云盘提取码已复制到剪切板",type:"success",position:"bottom-right"}))):C({title:"提示",message:"未找到阿里云盘下载链接",type:"error",position:"bottom-right"})}};return(u,t)=>{const c=j,s=W;return n(),m("div",he,[$("div",De,[$("div",null,[_(v(y.item.name)+" ",1),k(c,{size:"small"},{default:o(()=>[_(v(y.item.version),1)]),_:1}),$("span",Ce,v(y.item.desc),1)]),$("div",null,[e(w)?(n(),r(s,{key:0,size:"small",onClick:t[0]||(t[0]=g=>h(2))},{default:o(()=>t[2]||(t[2]=[_("阿里云盘下载")])),_:1})):B("",!0),k(s,{size:"small",onClick:t[1]||(t[1]=g=>h(1))},{default:o(()=>t[3]||(t[3]=[_("移动云盘下载")])),_:1})])]),$("div",null,[(n(!0),m(V,null,I(y.item.child_files,g=>(n(),r(c,{type:"info",key:g},{default:o(()=>[_(v(g),1)]),_:2},1024))),128))])])}}}),$e=E(xe,[["__scopeId","data-v-138f3660"]]),Be={key:0,class:"dep-pkg-list"},Ve=U({__name:"DepPkgDownload",setup(y){const{depPkgList:a}=q();return(l,x)=>{const w=$e,h=G;return e(a).length?(n(),m("div",Be,[(n(!0),m(V,null,I(e(a),u=>(n(),r(w,{key:u.name,item:u},null,8,["item"]))),128))])):(n(),r(h,{key:1,description:"暂无依赖包"}))}}}),Ie=E(Ve,[["__scopeId","data-v-36b07396"]]),Le={class:"lack-dep-item"},Pe={key:0},Te={key:1},ze=U({__name:"LackItem",props:{item:{type:Object,required:!0},currentVersion:{type:String,default:""}},setup(y){Y(u=>({"759ab915":e(l),"1265cf3b":e(x)}));const a=y,{appAsideBgColor:l,appBackground:x}=K(),w=J(()=>!!a.item.download_url.find(u=>u.origin==="阿里云盘")),h=async u=>{if(u===1){const t=a.item.download_url.find(c=>c.origin.includes("移动云盘"));t?(await R("open_in_default_browser",{url:t.url}),t.pwd&&(S(t.pwd),C({title:"提示",message:"移动云盘提取码已复制到剪切板",type:"success",position:"bottom-right"}))):C({title:"提示",message:"未找到移动云盘下载链接",type:"error",position:"bottom-right"})}else{const t=a.item.download_url.find(c=>c.origin.includes("阿里云盘"));t?(await R("open_in_default_browser",{url:t.url}),t.pwd&&(S(t.pwd),C({title:"提示",message:"阿里云盘提取码已复制到剪切板",type:"success",position:"bottom-right"}))):C({title:"提示",message:"未找到阿里云盘下载链接",type:"error",position:"bottom-right"})}};return(u,t)=>{const c=j,s=W;return n(),m("div",Le,[y.item.currentVersion?(n(),m("div",Pe,[_(v(y.item.name)+" ",1),k(c,{type:"info",size:"small"},{default:o(()=>[_(v(y.item.currentVersion)+"->"+v(y.item.version),1)]),_:1})])):(n(),m("div",Te,[_(v(y.item.name)+" ",1),k(c,{type:"info",size:"small"},{default:o(()=>[_(v(y.item.version),1)]),_:1})])),$("div",null,[e(w)?(n(),r(s,{key:0,size:"small",onClick:t[0]||(t[0]=g=>h(2))},{default:o(()=>t[2]||(t[2]=[_("阿里云盘下载")])),_:1})):B("",!0),k(s,{size:"small",onClick:t[1]||(t[1]=g=>h(1))},{default:o(()=>t[3]||(t[3]=[_("移动云盘下载")])),_:1})])])}}}),Ue=E(ze,[["__scopeId","data-v-52357fa1"]]),Ee={class:"dep-manager"},Ae=U({__name:"DepManager",setup(y){const{lackDependence:a,activeDrewerName:l,needUpdateDepList:x,contentLoading:w}=q(),h=async u=>{u!=="install"&&(w.value=!0,await z.checkDepUpdate(),w.value=!1)};return(u,t)=>{const c=Ue,s=G,g=ue,A=de,F=Ie,O=we,P=X;return n(),m("div",Ee,[k(A,{modelValue:e(l),"onUpdate:modelValue":t[0]||(t[0]=b=>ce(l)?l.value=b:null),class:"tabs",onTabChange:h,"tab-position":"top"},{default:o(()=>[N((n(),r(g,{label:"缺失依赖下载",name:"lackDepDownload"},{default:o(()=>[e(a)&&(e(a)[0]?.length||e(a)[1]?.length||e(a)[2]?.length)?(n(),r(A,{key:0,"tab-position":"left"},{default:o(()=>[k(g,{label:`精简版(${e(a)[0]?.length||0})`},{default:o(()=>[e(a)[0].length?(n(!0),m(V,{key:0},I(e(a)[0],b=>(n(),r(c,{key:0+b.name,item:b},null,8,["item"]))),128)):(n(),r(s,{key:1,description:"依赖满足精简版要求，没有缺失依赖项。"}))]),_:1},8,["label"]),k(g,{label:`基础版(${e(a)[1]?.length||0})`},{default:o(()=>[e(a)[1].length?(n(!0),m(V,{key:0},I(e(a)[1],b=>(n(),r(c,{key:1+b.name,item:b},null,8,["item"]))),128)):(n(),r(s,{key:1,description:"依赖满足基础版要求，没有缺失依赖项。"}))]),_:1},8,["label"]),k(g,{label:`完整版(${e(a)[2]?.length||0})`},{default:o(()=>[e(a)[2].length?(n(!0),m(V,{key:0},I(e(a)[2],b=>(n(),r(c,{key:2+b.name,item:b},null,8,["item"]))),128)):(n(),r(s,{key:1,description:"依赖满足完整版要求，没有缺失依赖项。"}))]),_:1},8,["label"])]),_:1})):(n(),r(s,{key:1,description:"没有缺失依赖项。"}))]),_:1})),[[P,e(w)]]),k(g,{label:"依赖包下载",name:"depPackageDownload"},{default:o(()=>[e(l)==="depPackageDownload"?N((n(),r(F,{key:0},null,512)),[[P,e(w)]]):B("",!0)]),_:1}),N((n(),r(g,{label:"可更新依赖",name:"haveUpdateDep"},{default:o(()=>[e(x).length?(n(!0),m(V,{key:0},I(e(x),b=>(n(),r(c,{key:b.name,item:b,currentVersion:b.currentVersion},null,8,["item","currentVersion"]))),128)):(n(),r(s,{key:1,description:"暂无依赖需要更新，所有依赖皆为最新版。"}))]),_:1})),[[P,e(w)]]),k(g,{label:"依赖安装",name:"install"},{default:o(()=>[e(l)==="install"?(n(),r(O,{key:0})):B("",!0)]),_:1})]),_:1},8,["modelValue"])])}}}),Se=E(Ae,[["__scopeId","data-v-d0a15c37"]]);export{Se as default};
