import{d as U,E as I,bV as J,c as T,F as L,o as c,a as C,g as e,b as t,w as n,n as p,p as m,P as F,Q as K,e as x,t as E,I as A,bz as R,L as O,cb as Z,v as H,x as P,Z as S,z as X,y as j,a2 as Y,cc as M,cd as ee,ce as $,B as te,J as z,N as se,cf as oe,cg as ne,_ as D,ch as le,ci as ae,cj as re,G as ue,u as ie,h as ce,i as de}from"./index-DZzuFKiJ.js";import{E as pe}from"./el-empty-DnTRWnNF.js";import{E as me}from"./el-card-B-jOrWIw.js";import{E as _e}from"./el-checkbox-BUrwd91y.js";import{E as fe}from"./el-segmented-BtguYzNk.js";const ve={class:"wss-panel"},ge={key:0},we={flex:"","flex-row":"","items-center":"","w-full":""},ke={flex:"","flex-row":"","items-center":"","mt-4":""},ye={flex:"","flex-row":"","items-center":"","justify-between":"","w-full":"","mt-4":""},xe={flex:"","flex-row":"","items-center":"","justify-between":"","w-full":""},Ee=U({__name:"WssPanel",setup(w){const{wssState:r,onMsg:s,responseReq:l}=R(),{controlDeviceInfo:d,autoOnline:_,autoAsk:v,controlCode:i,refreshCode:b,updateCode:k}=O();s(a=>{if(a.type==="LINK_REQ"){if(d.id===a.deviceId){l(!0),I.warning("已有设备正在控制中");return}if(d.accessToken=a.accessToken,!a.code||a.code==="")if(v.value){J.confirm(`是否允许${a.deviceId}远程控制`,"远程控制请求",{confirmButtonText:"允许",cancelButtonText:"拒绝",type:"warning"}).then(()=>{l(!0),d.id=a.deviceId}).catch(()=>{l(!1,"用户拒绝连接")});return}else{l(!1,"不接受无访问码请求");return}if(i.value===a.code)d.id=a.deviceId,l(!0);else{d.id="",l(!1,"访问码错误");return}}});const g=T(()=>i.value.split("").filter((a,o)=>o<4)),u=()=>{const a=i.value;Z(a),I.success("复制成功")};return L(()=>{_.value&&(r.value="在线")}),(a,o)=>{const y=H,B=P,V=S,f=X,q=j,N=Y,Q=me,W=pe;return c(),C("div",ve,[e(r)==="在线"?(c(),C("div",ge,[t(Q,{shadow:"hover"},{default:n(()=>[p("div",we,[t(B,{h4:"","mr-3":""},{default:n(()=>[t(y,null,{default:n(()=>o[2]||(o[2]=[p("span",{"i-mdi-lock":""},null,-1)])),_:1}),o[3]||(o[3]=m("远程控制访问码"))]),_:1}),t(f,{effect:"dark",content:"刷新访问码",placement:"top"},{default:n(()=>[t(V,{link:"",onClick:e(b),size:"large"},{default:n(()=>[t(y,{size:"large"},{default:n(()=>o[4]||(o[4]=[p("span",{"i-mdi-shield-sync":""},null,-1)])),_:1})]),_:1},8,["onClick"])]),_:1}),t(f,{effect:"dark",content:"修改访问码",placement:"top"},{default:n(()=>[t(V,{link:"",onClick:e(k),size:"large"},{default:n(()=>[t(y,{size:"large"},{default:n(()=>o[5]||(o[5]=[p("span",{"i-mdi-shield-edit":""},null,-1)])),_:1})]),_:1},8,["onClick"])]),_:1})]),p("div",ke,[(c(!0),C(F,null,K(e(g),(h,G)=>(c(),x(q,{key:G,"mr-2":""},{default:n(()=>[m(E(h),1)]),_:2},1024))),128)),t(V,{type:"primary",link:"",onClick:u},{default:n(()=>o[6]||(o[6]=[m("复制")])),_:1})]),p("div",ye,[t(B,null,{default:n(()=>o[7]||(o[7]=[m("自动上线")])),_:1}),t(N,{modelValue:e(_),"onUpdate:modelValue":o[0]||(o[0]=h=>A(_)?_.value=h:null)},null,8,["modelValue"])]),p("div",xe,[t(B,null,{default:n(()=>o[8]||(o[8]=[m("无访问码时询问")])),_:1}),t(N,{modelValue:e(v),"onUpdate:modelValue":o[1]||(o[1]=h=>A(v)?v.value=h:null)},null,8,["modelValue"])])]),_:1})])):(c(),x(W,{key:1,description:"当前处于离线状态，如想开启远程被控功能，请切换至在线状态"}))])}}}),{isLogin:be,username:Ve}=$(),Ce=async(w,r)=>{try{const s=await M.post("auth/login",{username:w,password:r});return s.data.message&&s.data.message.includes("login successful")?(ee(s.data.token),be.value=!0,Ve.value=w,!0):!1}catch(s){return I.error("登录失败:"+s.response?.data?.message),!1}},Ie=async(w,r)=>{try{const s=await M.post("auth/register",{username:w,password:r});return!!(s.data.message&&s.data.message.includes("registered successfully"))}catch(s){return I.error("注册失败:"+s.response?.data?.message),!1}},Be=U({__name:"AccountAuth",setup(w){const{autoLogin:r,form:s,formShow:l,formRules:d,resetLastUserInfoToForm:_,saveLastUserInfo:v}=$(),i=te("formEl"),b=()=>{l.value=l.value==="login"?"register":"login",i.value?.resetFields()},k=()=>{i.value?.validate(async g=>{g&&(l.value==="login"?await Ce(s.username,s.password)&&(r.value&&v(),I.success("登录成功")):await Ie(s.username,s.password)&&(I.success("注册成功"),l.value="login"))})};return L(()=>{r.value=_(),r.value&&k()}),(g,u)=>{const a=se,o=oe,y=ne,B=_e,V=S;return c(),C(F,null,[p("h1",null,"用户"+E(e(l)==="login"?"登录":"注册"),1),t(y,{"inline-message":"",model:e(s),className:"form",rules:e(d),ref_key:"formEl",ref:i},{default:n(()=>[t(o,{label:"用户名",prop:"username","label-position":"top",class:"form-item"},{default:n(()=>[t(a,{modelValue:e(s).username,"onUpdate:modelValue":u[0]||(u[0]=f=>e(s).username=f),clearable:""},null,8,["modelValue"])]),_:1}),t(o,{label:"密码",prop:"password","label-position":"top",class:"form-item"},{default:n(()=>[t(a,{modelValue:e(s).password,"onUpdate:modelValue":u[1]||(u[1]=f=>e(s).password=f),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(l)==="register"?(c(),x(o,{key:0,label:"重复密码",prop:"rePassword","label-position":"top",class:"form-item"},{default:n(()=>[t(a,{modelValue:e(s).rePassword,"onUpdate:modelValue":u[2]||(u[2]=f=>e(s).rePassword=f),type:"password","show-password":""},null,8,["modelValue"])]),_:1})):z("",!0)]),_:1},8,["model","rules"]),e(l)==="login"?(c(),x(B,{key:0,modelValue:e(r),"onUpdate:modelValue":u[3]||(u[3]=f=>A(r)?r.value=f:null),label:"自动登录",size:"large"},null,8,["modelValue"])):z("",!0),t(V,{type:"primary",class:"btn",onClick:k},{default:n(()=>[m(E(e(l)==="login"?"登录":"注册"),1)]),_:1}),t(V,{type:"primary",link:"",onClick:b,class:"btn"},{default:n(()=>[m(" 前往"+E(e(l)==="login"?"注册":"登录"),1)]),_:1})],64)}}}),he=D(Be,[["__scopeId","data-v-642e6343"]]),Te={"w-full":""},Ae={flex:"","flex-row":"","items-center":"","w-full":"","justify-between":""},Ue={flex:"","flex-row":"","items-center":""},$e={flex:"","flex-row":"","items-center":""},ze=U({__name:"AccountTitleBar",setup(w){const{username:r,logout:s}=$(),{wssState:l}=R(),d=T(()=>r.value[0]?.toUpperCase()||""),_=T(()=>l.value==="在线"?"success":"warning");return(v,i)=>{const b=ae,k=re,g=P,u=j,a=fe,o=S;return c(),C("div",Te,[p("div",Ae,[p("div",Ue,[t(k,{type:e(_),"is-dot":""},{default:n(()=>[t(b,{size:30},{default:n(()=>[m(E(e(d)),1)]),_:1})]),_:1},8,["type"]),t(g,{truncated:""},{default:n(()=>[m(E(e(r)),1)]),_:1}),t(u,{size:"small",type:"info","ml-1":""},{default:n(()=>[t(g,{truncated:""},{default:n(()=>[m(E(e(le)),1)]),_:1})]),_:1})]),p("div",$e,[t(a,{modelValue:e(l),"onUpdate:modelValue":i[0]||(i[0]=y=>A(l)?l.value=y:null),options:["在线","离线"],"mr-5":""},null,8,["modelValue"]),t(o,{onClick:e(s),link:"",type:"danger"},{default:n(()=>i[1]||(i[1]=[m("退出登录")])),_:1},8,["onClick"])])])])}}}),Le={class:"account-main"},Se=U({__name:"Account",setup(w){ie(i=>({"7e723c85":e(_),daef5b64:e(v)}));const{appAsideBgColor:r,appBackground:s}=ce(),{isEditing:l}=de(),{isLogin:d}=$(),_=T(()=>l.value?r?.value:s?.value),v=T(()=>l.value?"0":"10px 10px 10px 0");return L(()=>{ue.closeSplashscreen()}),(i,b)=>{const k=ze,g=he,u=Ee;return c(),C("div",Le,[e(d)?(c(),x(k,{key:0})):(c(),x(g,{key:1})),e(d)?(c(),x(u,{key:2,class:"panel"})):z("",!0)])}}}),Me=D(Se,[["__scopeId","data-v-e39bfee0"]]);export{Me as default};
