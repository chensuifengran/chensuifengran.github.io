import{d as L,F as B,U as G,e as A,g as S,o as u,i as C,m as e,j as t,w as n,a as d,l as p,ah as F,aw as H,c as x,t as V,ae as $,E as J,q as M,p as z,ab as X,aa as j,az as Y,b5 as Z,aR as q,aO as ee,a9 as R,ak as te,al as se,am as oe,aW as ne,R as le,bd as ae,b1 as re,u as ue}from"./.pnpm-B-riUXVB.js";import{q as D,f as ie,Q as ce,$ as O,T as de,U as N,V as pe,_ as P,W as _e,i as me,u as fe,a as ve}from"./index-DhEYsvJM.js";const ge={class:"wss-panel"},we={key:0},ke={flex:"","flex-row":"","items-center":"","w-full":""},ye={flex:"","flex-row":"","items-center":"","mt-4":""},xe={flex:"","flex-row":"","items-center":"","justify-between":"","w-full":"","mt-4":""},be={flex:"","flex-row":"","items-center":"","justify-between":"","w-full":""},Ee=L({__name:"WssPanel",setup(w){const{wssState:i,onMsg:a,responseReq:s}=D(),{controlDeviceInfo:r,autoOnline:_,autoAsk:f,controlCode:c,refreshCode:k,updateCode:b}=ie();a(o=>{if(o.type==="LINK_REQ"){if(r.id===o.deviceId){s(!0),B.warning("已有设备正在控制中");return}if(r.accessToken=o.accessToken,!o.code||o.code==="")if(f.value){G.confirm(`是否允许${o.deviceId}远程控制`,"远程控制请求",{confirmButtonText:"允许",cancelButtonText:"拒绝",type:"warning"}).then(()=>{s(!0),r.id=o.deviceId}).catch(()=>{s(!1,"用户拒绝连接")});return}else{s(!1,"不接受无访问码请求");return}if(c.value===o.code)r.id=o.deviceId,s(!0);else{r.id="",s(!1,"访问码错误");return}}});const v=A(()=>c.value.split("").filter((o,l)=>l<4)),y=()=>{const o=c.value;ce(o),B.success("复制成功")};return S(()=>{_.value&&(i.value="在线")}),(o,l)=>{const g=J,E=M,I=z,U=X,h=j,m=Y,W=Z,Q=q;return u(),C("div",ge,[e(i)==="在线"?(u(),C("div",we,[t(W,{shadow:"hover"},{default:n(()=>[d("div",ke,[t(E,{h4:"","mr-3":""},{default:n(()=>[t(g,null,{default:n(()=>l[2]||(l[2]=[d("span",{"i-mdi-lock":""},null,-1)])),_:1}),l[3]||(l[3]=p("远程控制访问码"))]),_:1}),t(U,{effect:"dark",content:"刷新访问码",placement:"top"},{default:n(()=>[t(I,{link:"",onClick:e(k),size:"large"},{default:n(()=>[t(g,{size:"large"},{default:n(()=>l[4]||(l[4]=[d("span",{"i-mdi-shield-sync":""},null,-1)])),_:1})]),_:1},8,["onClick"])]),_:1}),t(U,{effect:"dark",content:"修改访问码",placement:"top"},{default:n(()=>[t(I,{link:"",onClick:e(b),size:"large"},{default:n(()=>[t(g,{size:"large"},{default:n(()=>l[5]||(l[5]=[d("span",{"i-mdi-shield-edit":""},null,-1)])),_:1})]),_:1},8,["onClick"])]),_:1})]),d("div",ye,[(u(!0),C(F,null,H(e(v),(T,K)=>(u(),x(h,{key:K,"mr-2":""},{default:n(()=>[p(V(T),1)]),_:2},1024))),128)),t(I,{type:"primary",link:"",onClick:y},{default:n(()=>l[6]||(l[6]=[p("复制")])),_:1})]),d("div",xe,[t(E,null,{default:n(()=>l[7]||(l[7]=[p("自动上线")])),_:1}),t(m,{modelValue:e(_),"onUpdate:modelValue":l[0]||(l[0]=T=>$(_)?_.value=T:null)},null,8,["modelValue"])]),d("div",be,[t(E,null,{default:n(()=>l[8]||(l[8]=[p("无访问码时询问")])),_:1}),t(m,{modelValue:e(f),"onUpdate:modelValue":l[1]||(l[1]=T=>$(f)?f.value=T:null)},null,8,["modelValue"])])]),_:1})])):(u(),x(Q,{key:1,description:"当前处于离线状态，如想开启远程被控功能，请切换至在线状态"}))])}}}),{isLogin:Ve,username:Ce}=N(),Be=async(w,i)=>{try{const a=await O.post("auth/login",{username:w,password:i});return a.data.message&&a.data.message.includes("login successful")?(de(a.data.token),Ve.value=!0,Ce.value=w,!0):!1}catch(a){return B.error("登录失败:"+a.response?.data?.message),!1}},Ie=async(w,i)=>{try{const a=await O.post("auth/register",{username:w,password:i});return!!(a.data.message&&a.data.message.includes("registered successfully"))}catch(a){return B.error("注册失败:"+a.response?.data?.message),!1}},Te=L({__name:"AccountAuth",setup(w){const i=!pe,{autoLogin:a,form:s,formShow:r,formRules:_,resetLastUserInfoToForm:f,saveLastUserInfo:c}=N(),k=ee("formEl"),b=()=>{r.value=r.value==="login"?"register":"login",k.value?.resetFields()},v=()=>{k.value?.validate(async y=>{y&&(r.value==="login"?await Be(s.username,s.password)&&(a.value&&c(),B.success("登录成功")):await Ie(s.username,s.password)&&(B.success("注册成功"),r.value="login"))})};return S(()=>{a.value=f(),a.value&&v()}),(y,o)=>{const l=q,g=te,E=se,I=oe,U=ne,h=z;return e(i)?(u(),x(l,{key:0,description:"playground环境不支持当前功能"})):(u(),C(F,{key:1},[d("h1",null,"用户"+V(e(r)==="login"?"登录":"注册"),1),t(I,{"inline-message":"",model:e(s),className:"form",rules:e(_),ref_key:"formEl",ref:k},{default:n(()=>[t(E,{label:"用户名",prop:"username","label-position":"top",class:"form-item"},{default:n(()=>[t(g,{modelValue:e(s).username,"onUpdate:modelValue":o[0]||(o[0]=m=>e(s).username=m),clearable:""},null,8,["modelValue"])]),_:1}),t(E,{label:"密码",prop:"password","label-position":"top",class:"form-item"},{default:n(()=>[t(g,{modelValue:e(s).password,"onUpdate:modelValue":o[1]||(o[1]=m=>e(s).password=m),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(r)==="register"?(u(),x(E,{key:0,label:"重复密码",prop:"rePassword","label-position":"top",class:"form-item"},{default:n(()=>[t(g,{modelValue:e(s).rePassword,"onUpdate:modelValue":o[2]||(o[2]=m=>e(s).rePassword=m),type:"password","show-password":""},null,8,["modelValue"])]),_:1})):R("",!0)]),_:1},8,["model","rules"]),e(r)==="login"?(u(),x(U,{key:0,modelValue:e(a),"onUpdate:modelValue":o[3]||(o[3]=m=>$(a)?a.value=m:null),label:"自动登录",size:"large"},null,8,["modelValue"])):R("",!0),t(h,{type:"primary",class:"btn",onClick:v},{default:n(()=>[p(V(e(r)==="login"?"登录":"注册"),1)]),_:1}),t(h,{type:"primary",link:"",onClick:b,class:"btn"},{default:n(()=>[p(" 前往"+V(e(r)==="login"?"注册":"登录"),1)]),_:1})],64))}}}),Ae=P(Te,[["__scopeId","data-v-3c9d3881"]]),Ue={"w-full":""},he={flex:"","flex-row":"","items-center":"","w-full":"","justify-between":""},$e={flex:"","flex-row":"","items-center":""},Le={flex:"","flex-row":"","items-center":""},Ne=L({__name:"AccountTitleBar",setup(w){const{username:i,logout:a}=N(),{wssState:s}=D(),r=A(()=>i.value[0]?.toUpperCase()||""),_=A(()=>s.value==="在线"?"success":"warning");return(f,c)=>{const k=le,b=ae,v=M,y=j,o=re,l=z;return u(),C("div",Ue,[d("div",he,[d("div",$e,[t(b,{type:e(_),"is-dot":""},{default:n(()=>[t(k,{size:30},{default:n(()=>[p(V(e(r)),1)]),_:1})]),_:1},8,["type"]),t(v,{truncated:""},{default:n(()=>[p(V(e(i)),1)]),_:1}),t(y,{size:"small",type:"info","ml-1":""},{default:n(()=>[t(v,{truncated:""},{default:n(()=>[p(V(e(_e)),1)]),_:1})]),_:1})]),d("div",Le,[t(o,{modelValue:e(s),"onUpdate:modelValue":c[0]||(c[0]=g=>$(s)?s.value=g:null),options:["在线","离线"],"mr-5":""},null,8,["modelValue"]),t(l,{onClick:e(a),link:"",type:"danger"},{default:n(()=>c[1]||(c[1]=[p("退出登录")])),_:1},8,["onClick"])])])])}}}),Re={class:"account-main"},Se=L({__name:"Account",setup(w){ue(c=>({"7e723c85":e(_),daef5b64:e(f)}));const{appAsideBgColor:i,appBackground:a}=fe(),{isEditing:s}=ve(),{isLogin:r}=N(),_=A(()=>s.value?i?.value:a?.value),f=A(()=>s.value?"0":"10px 10px 10px 0");return S(()=>{me.closeSplashscreen()}),(c,k)=>{const b=Ne,v=Ae,y=Ee;return u(),C("div",Re,[e(r)?(u(),x(b,{key:0})):(u(),x(v,{key:1})),e(r)?(u(),x(y,{key:2,class:"panel"})):R("",!0)])}}}),Me=P(Se,[["__scopeId","data-v-e39bfee0"]]);export{Me as default};
