import{L as Be}from"./Loading-Cl3JNtrw.js";import{d as ye,U as $e,V as Ve,l as L,W as Me,B as Ce,X as ne,o as R,g as te,w as l,m,b as s,n as d,i as o,a as Q,F as oe,D as le,Y as fe,C as ve,q as ke,Z as Fe,$ as ze,T as xe,a0 as We,a1 as ae,a2 as ie,y as Je,a3 as Ke,j as Ge,s as He,z as Ye,a4 as c,R as E,a5 as je,a6 as qe,O as ge,N as D,a7 as Qe,a8 as j,a9 as q,p as Xe,f as Ze,k as M,aa as he,v as et,H as tt,t as I,M as ot,ab as st,ac as nt,ad as ce,Q as lt,E as at,ae as it,I as rt,_ as ut}from"./index-waqMAD9w.js";import{E as dt}from"./el-checkbox-nZVyJgm2.js";import{E as mt}from"./el-drawer-CnJYKWkZ.js";import{f as se}from"./fs-DcIWFZQa.js";const pt={class:"orp"},ft={"w-full":""},vt={class:"op-item"},gt={key:0,class:"op-item"},ct={class:"op-item"},_t={key:1,class:"op-item"},yt={class:"op-item"},Vt={key:2,class:"op-item"},Ct={class:"op-item"},kt={"w-full":""},xt={class:"op-item"},wt={class:"op-item"},St={"mt-1":"",flex:"","flex-row":"","flex-items-center":"","flex-justify-center":""},bt=ye({__name:"OperationRecordPanel",setup(P){const x=$e(),{saveDialog:X,saveConfig:O,showCopyBtn:F}=We(),{openOperationRecordDrawer:N}=Ve(),z={merge_mouse_options:{merge:!0,max_interval_ms:300,merge_drag:!0},merge_key_options:{merge_repeat:!0,repeat_max_interval_ms:50,merge_press_release:!0,press_release_max_interval_ms:200},generateComment:!1,hiddenWindowBeforeRunning:!0},i=L(z),[y,B]=Me("operation-capture-setting-form");Ce(()=>{y.value&&(i.value=JSON.parse(JSON.stringify(y.value)))}),ne(i,()=>{B(i.value)},{deep:!0});const w=()=>{i.value=JSON.parse(JSON.stringify(z))},$=L(!1),Z=async()=>{$.value=!0;try{i.value.hiddenWindowBeforeRunning&&(x.hide(),await fe.notify.sendCustom({name:"init",message:""}));const A=await ve.captureOperation(JSON.parse(JSON.stringify(i.value)),i.value.generateComment);await fe.notify.sendCustom({name:"stop",message:""}),O.name="操作记录",O.code=A,X.value=!0,F.value=!0}catch(A){console.error(A)}finally{$.value=!1}},h=()=>ve.stopCaptureOperation();return(A,t)=>{const V=ke,S=Fe,T=ze,a=xe,p=mt;return R(),te(p,{modelValue:o(N),"onUpdate:modelValue":t[9]||(t[9]=r=>le(N)?N.value=r:null),title:"操作录制面板",direction:"rtl",size:"50%",class:"orp-drawer"},{default:l(()=>[m("div",pt,[m("div",ft,[m("div",vt,[s(V,null,{default:l(()=>t[10]||(t[10]=[d("合并重复输入的按键")])),_:1}),s(S,{modelValue:o(i).merge_key_options.merge_repeat,"onUpdate:modelValue":t[0]||(t[0]=r=>o(i).merge_key_options.merge_repeat=r)},null,8,["modelValue"])]),o(i).merge_key_options.merge_repeat?(R(),Q("div",gt,[s(V,null,{default:l(()=>t[11]||(t[11]=[d("需要合并的重复按键按下时间最大间隔(ms)")])),_:1}),s(T,{style:{"margin-left":"10px"},modelValue:o(i).merge_key_options.repeat_max_interval_ms,"onUpdate:modelValue":t[1]||(t[1]=r=>o(i).merge_key_options.repeat_max_interval_ms=r),min:1,size:"small"},null,8,["modelValue"])])):oe("",!0),m("div",ct,[s(V,null,{default:l(()=>t[12]||(t[12]=[d("合并相同按键的按下和释放")])),_:1}),s(S,{modelValue:o(i).merge_key_options.merge_press_release,"onUpdate:modelValue":t[2]||(t[2]=r=>o(i).merge_key_options.merge_press_release=r)},null,8,["modelValue"])]),o(i).merge_key_options.merge_press_release?(R(),Q("div",_t,[s(V,null,{default:l(()=>t[13]||(t[13]=[d("需要合并的按键按下与释放最大间隔(ms)")])),_:1}),s(T,{style:{"margin-left":"10px"},modelValue:o(i).merge_key_options.press_release_max_interval_ms,"onUpdate:modelValue":t[3]||(t[3]=r=>o(i).merge_key_options.press_release_max_interval_ms=r),min:1,size:"small"},null,8,["modelValue"])])):oe("",!0),m("div",yt,[s(V,null,{default:l(()=>t[14]||(t[14]=[d("合并相同鼠标按钮按下和释放")])),_:1}),s(S,{modelValue:o(i).merge_mouse_options.merge,"onUpdate:modelValue":t[4]||(t[4]=r=>o(i).merge_mouse_options.merge=r)},null,8,["modelValue"])]),o(i).merge_mouse_options.merge?(R(),Q("div",Vt,[s(V,null,{default:l(()=>t[15]||(t[15]=[d("需要合并的鼠标按钮按下与释放最大间隔(ms)")])),_:1}),s(T,{style:{"margin-left":"10px"},modelValue:o(i).merge_mouse_options.max_interval_ms,"onUpdate:modelValue":t[5]||(t[5]=r=>o(i).merge_mouse_options.max_interval_ms=r),min:1,size:"small"},null,8,["modelValue"])])):oe("",!0),m("div",Ct,[s(V,null,{default:l(()=>t[16]||(t[16]=[d("合并鼠标按下与释放时坐标不一致为拖拽")])),_:1}),s(S,{modelValue:o(i).merge_mouse_options.merge_drag,"onUpdate:modelValue":t[6]||(t[6]=r=>o(i).merge_mouse_options.merge_drag=r)},null,8,["modelValue"])])]),m("div",kt,[m("div",xt,[s(V,null,{default:l(()=>t[17]||(t[17]=[d("生成注释")])),_:1}),s(S,{modelValue:o(i).generateComment,"onUpdate:modelValue":t[7]||(t[7]=r=>o(i).generateComment=r)},null,8,["modelValue"])]),m("div",wt,[s(V,null,{default:l(()=>t[18]||(t[18]=[d("开始录制时隐藏本窗口")])),_:1}),s(S,{modelValue:o(i).hiddenWindowBeforeRunning,"onUpdate:modelValue":t[8]||(t[8]=r=>o(i).hiddenWindowBeforeRunning=r)},null,8,["modelValue"])]),m("div",St,[s(a,{onClick:w},{default:l(()=>t[19]||(t[19]=[d("重置选项")])),_:1}),o($)?(R(),te(a,{key:1,type:"warning",onClick:h},{default:l(()=>t[21]||(t[21]=[d("停止录制")])),_:1})):(R(),te(a,{key:0,type:"primary",onClick:Z},{default:l(()=>t[20]||(t[20]=[d("开始录制")])),_:1}))])])])]),_:1},8,["modelValue"])}}}),Et=(P,x)=>{P.addAction({id:"fastFillParams",label:"快速填写参数",keybindings:[ae.CtrlCmd|ie.Tab],contextMenuGroupId:"navigation",contextMenuOrder:0,run:x})},Dt=(P,x)=>{P.addAction({id:"insertSnippetCode",label:"插入代码片段",keybindings:[ae.chord(ae.CtrlCmd|ie.KeyK,ie.KeyI)],contextMenuGroupId:"navigation",contextMenuOrder:.1,run:x})},_e={auxiliaryActionRegister:Et,insertSnippetCodeActionRegister:Dt},Rt={class:"script-editor-dev"},At={flex:"","flex-row":"","flex-items-center":""},Tt={class:"dialog-footer"},Ut={class:"dialog-footer"},It={class:"dialog-footer"},Lt={class:"dialog-footer"},Pt={id:"codeEditBox"},Ot={class:"loading"},Nt=ye({__name:"CodeEditor",setup(P){const x=Je("snippetSearchRef"),X=ot,O=Ke(),F=Ge(),{scriptList:N}=He(F),{findEditor:z,editorInit:i,editorValue:y,insertText:B,setText:w,formatCode:$,disposeEditor:Z,registerEditorEvent:h,unRegisterEditorEvent:A}=Ve(),{openId:t,preloadText:V,preloadPath:S,isEditing:T,fileInfo:a,declareMod:p,saveMod:r}=Ze(),b=L(""),we=async()=>{const n=F.codeSnippets.find(e=>e.name===b.value);if(n){const e=await se.readFile(n.filePath);B(c,e.trim()),st.success("代码片段插入成功")}U.value=!1},{invokeDynamicDialog:Se}=nt(),_=ce.getFnInfo(),{apiAutoTip:be}=ce,W=L(!0),J=n=>M().mockScriptList.value.find(v=>v.id===t.value)[n],re=L(),Ee=n=>{n.preventDefault();const{deltaY:e}=n;re.value.scrollLeft+=e},K=Ye({visible:!1,cb:()=>{},close_cb:()=>{}}),De=async()=>a.declare?(M().mockScriptList.value.find(n=>n.id===t.value).content=y.value,a.originData=y.value,D({title:"提示",message:"保存成功",type:"success",position:"bottom-right"}),!0):(D({title:"保存失败",message:"保存之前请先在脚本头部插入'脚本声明'或者将脚本声明补充完整",type:"error",position:"bottom-right"}),!1),Re=async()=>{const n=await se.selectFile(!1);n&&(r.savePath=n,a.savePath=n)},Ae=async()=>{r.visible=!1;try{await se.writeFile(a.savePath,y.value),a.originData=y.value;const n=lt();return N.value.push({id:n,savePath:a.savePath,name:a.name,version:a.version,description:a.description,setting:{autoImportLastRunConfig:!1,targetAdbDevice:"",excludeDevice:[],targetApp:"",autoStartTargetApp:!1}}),t.value=n,D({title:"提示",message:"保存成功",type:"success",position:"bottom-right"}),!0}catch(n){return console.error(n),D({title:"保存失败",message:JSON.stringify(n),type:"error",position:"bottom-right"}),!1}},Te=()=>{B(c,`/**
 * 请勿删除，此声明会在脚本读取时用到！
 * @version:${p.version}
 * @name:${p.name}
 * @description:${p.description}
 */`,!0),p.description="无",p.name="未命名脚本",p.version="v1.0",p.visible=!1},ue=n=>{if(n.key==="s"&&n.ctrlKey){$();const v=setTimeout(()=>{De(),clearTimeout(v)},200);n.preventDefault()}},U=L(!1),Ue=()=>{if(_.value){if(!_.value.haveAuxiliary){D({title:"提示",message:"当前函数无需填写参数或不支持快速填写参数。",type:"info",position:"bottom-right"});return}const n=e=>{B(c,e,!1,_.value.paramsRange)};Se(_.value.name,_.value.name,_.value.content||"","changeArgs",n,_.value.params)}};let G=null;const de=()=>{ge.currentRoute.value.name==="scriptEditor"&&(G&&clearTimeout(G),G=setTimeout(()=>{clearTimeout(G);const n=y.value;if(n.indexOf(" */")===-1)a.declare=!1;else{const e=n.indexOf(" */")+3,v=y.value.substring(0,e),f={name:"",version:"",description:""};if(v.replaceAll("/**","").replace(/ \* -{19}提示-{19}[\s\S]* \* -{42}/,"").replaceAll(`
 * `,"").replaceAll(`
 */`,"").trim().split("@").forEach(C=>{if(C!==""){const g=C.split(":");g[0]==="version"?f.version=g[1]:g[0]==="name"?f.name=g[1]:g[0]==="description"&&(f.description=g[1])}}),f.description===""||f.name===""||f.version==="")a.declare=!1;else{const C=M().mockScriptList,g=C.value.findIndex(ee=>ee.id===t?.value);t?.value!=="-1"&&(C.value[g].version=f.version,C.value[g].name=f.name,C.value[g].description=f.description),a.declare=!0,a.version=f.version,a.name=f.name,a.description=f.description}}},500))};ne(y,()=>{de()});const Ie=n=>{be(),a.lastData=y.value},me=()=>{z(c)?.layout()},Le=async(n="init",e)=>{{const v=J("content");a.originData=v||"",a.name=J("name"),a.description=J("description"),w(c,a.originData);return}},Pe=(n,e)=>{const v=n?M().mockCodeSnippetList.value.filter(f=>f.name.toLowerCase().includes(b.value.toLowerCase())||f.description.toLowerCase().includes(b.value.toLowerCase())||f.prefix.toLowerCase().includes(b.value.toLowerCase())):M().mockCodeSnippetList.value;e(v)};Ce(async()=>{T.value=!0,W.value=!1,window.addEventListener("resize",me),i(c),await pe(),document.getElementById(c)?.addEventListener("keydown",ue),h("mounted",n=>{_e.auxiliaryActionRegister(n,Ue),_e.insertSnippetCodeActionRegister(n,()=>{U.value=!0,setTimeout(()=>{x.value?.focus()})}),n.onDidChangeCursorPosition(Ie),w(c,a.originData||E());const e=setTimeout(()=>{de(),W.value=!0,clearTimeout(e)},200)})}),je(()=>{qe.clearCache(),A("mounted"),window.removeEventListener("resize",me),document.getElementById(c)?.removeEventListener("keydown",ue),Z(),T.value=!1});const pe=async()=>{const n=ge.currentRoute.value.name;if(t.value!=="-1"&&n==="scriptEditor"){const e=J("savePath");if(e)try{Le("init",e)}catch(v){console.error(v),D({title:"提示",message:"文件读取失败，进入新增模式",type:"error",position:"bottom-right"}),a.originData=E(),a.savePath="",w(c,E());return}else a.originData=E(),a.savePath="",w(c,E()),D({title:"提示",message:"文件读取失败，路径为空，进入新增模式",type:"error",position:"bottom-right"})}else t.value==="-1"&&n==="scriptEditor"&&(a.originData=E(),a.savePath="",w(c,E()))};return ne(t,pe),Qe(()=>{const n=V.value;he(()=>{w(c,n)})}),(n,e)=>{const v=bt,f=at,C=et,g=ke,ee=it,k=xe,H=tt,Y=rt,Oe=dt,Ne=Be;return R(),Q("div",Rt,[s(v),s(H,{modelValue:o(U),"onUpdate:modelValue":e[2]||(e[2]=u=>le(U)?U.value=u:null),title:"插入代码片段",width:"60%"},{footer:l(()=>[m("span",Tt,[s(k,{onClick:e[1]||(e[1]=u=>U.value=!1)},{default:l(()=>e[14]||(e[14]=[d("取消")])),_:1}),s(k,{type:"primary",onClick:we},{default:l(()=>e[15]||(e[15]=[d(" 确定 ")])),_:1})])]),default:l(()=>[s(ee,{modelValue:o(b),"onUpdate:modelValue":e[0]||(e[0]=u=>le(b)?b.value=u:null),"value-key":"name","fetch-suggestions":Pe,placeholder:"搜索代码片段:名称、备注、前缀",ref_key:"snippetSearchRef",ref:x},{suffix:l(()=>[s(f,null,{default:l(()=>e[13]||(e[13]=[m("span",{"i-mdi-text-search":""},null,-1)])),_:1})]),default:l(({item:u})=>[m("div",At,[s(C,{type:"primary",size:"small","mr-1":""},{default:l(()=>[d(I(u.prefix),1)]),_:2},1024),s(g,null,{default:l(()=>[d(I(u.name),1)]),_:2},1024)]),s(g,null,{default:l(()=>[d(I(u.description),1)]),_:2},1024)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),s(H,{modelValue:o(p).visible,"onUpdate:modelValue":e[7]||(e[7]=u=>o(p).visible=u),title:"插入脚本声明"},{footer:l(()=>[m("span",Ut,[s(k,{onClick:e[6]||(e[6]=u=>o(p).visible=!1)},{default:l(()=>e[16]||(e[16]=[d("取消")])),_:1}),s(k,{type:"primary",onClick:Te},{default:l(()=>e[17]||(e[17]=[d(" 确定 ")])),_:1})])]),default:l(()=>[e[18]||(e[18]=m("div",null,"脚本名称",-1)),s(Y,{modelValue:o(p).name,"onUpdate:modelValue":e[3]||(e[3]=u=>o(p).name=u)},null,8,["modelValue"]),e[19]||(e[19]=m("div",null,"脚本版本",-1)),s(Y,{modelValue:o(p).version,"onUpdate:modelValue":e[4]||(e[4]=u=>o(p).version=u)},null,8,["modelValue"]),e[20]||(e[20]=m("div",null,"脚本描述",-1)),s(Y,{modelValue:o(p).description,"onUpdate:modelValue":e[5]||(e[5]=u=>o(p).description=u)},null,8,["modelValue"])]),_:1},8,["modelValue"]),s(H,{modelValue:o(r).visible,"onUpdate:modelValue":e[10]||(e[10]=u=>o(r).visible=u),title:"保存脚本"},{footer:l(()=>[m("span",It,[s(k,{onClick:e[9]||(e[9]=u=>o(r).visible=!1)},{default:l(()=>e[22]||(e[22]=[d("取消")])),_:1}),s(k,{type:"primary",onClick:Ae},{default:l(()=>e[23]||(e[23]=[d(" 确定 ")])),_:1})])]),default:l(()=>[e[24]||(e[24]=m("div",null,"请选择脚本的保存路径",-1)),s(Y,{modelValue:o(r).savePath,"onUpdate:modelValue":e[8]||(e[8]=u=>o(r).savePath=u)},{append:l(()=>[s(k,{type:"primary",onClick:Re},{default:l(()=>e[21]||(e[21]=[d("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),s(H,{modelValue:o(K).visible,"onUpdate:modelValue":e[12]||(e[12]=u=>o(K).visible=u),title:"运行脚本"},{footer:l(()=>[m("span",Lt,[s(k,{onClick:o(K).close_cb},{default:l(()=>e[25]||(e[25]=[d("直接运行")])),_:1},8,["onClick"]),s(k,{type:"primary",onClick:o(K).cb},{default:l(()=>e[26]||(e[26]=[d(" 保存后运行 ")])),_:1},8,["onClick"])])]),default:l(()=>[e[27]||(e[27]=m("div",null,"检测到当前脚本已做更改，若不保存则运行最后一次保存的内容",-1)),s(Oe,{modelValue:o(O).editor.runAutoSave,"onUpdate:modelValue":e[11]||(e[11]=u=>o(O).editor.runAutoSave=u),label:"不再提醒,下次运行自动保存,可在设置页关闭自动保存",size:"large"},null,8,["modelValue"])]),_:1},8,["modelValue"]),j(m("div",Pt,null,512),[[q,o(W)]]),j(m("div",Ot,[s(Ne),e[28]||(e[28]=m("div",null,"编辑器加载中...",-1))],512),[[q,!o(W)]]),m("div",{class:"auto-api-tip scrollbar",onWheel:Xe(Ee,["stop"]),ref_key:"scrollbarRef",ref:re},[j(s(C,{style:{"margin-right":"3px"},size:"small",type:"success"},{default:l(()=>[d(I(o(X)?"[鼠标右键]":"Ctrl+Tab ：")+"快速填写/修改参数 ",1)]),_:1},512),[[q,o(_)?.haveAuxiliary]]),j(s(C,{size:"small",type:"info"},{default:l(()=>[d(I(o(_)?.name)+":"+I(o(_)?.content),1)]),_:1},512),[[q,o(_)?.name&&o(_)?.content]])],544)])}}}),Wt=ut(Nt,[["__scopeId","data-v-02a654da"]]);export{Wt as default};
