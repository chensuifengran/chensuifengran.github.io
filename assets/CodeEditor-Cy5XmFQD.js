import{L as Ne}from"./Loading-TrmNzmSD.js";import{d as ce,r as P,I as $e,g as _e,J as se,o as I,c as ee,w as l,a as d,j as s,l as u,m as t,i as q,a9 as te,ae as ne,F as ye,q as Ve,az as Be,as as Me,p as ke,aS as Fe,aT as le,aU as ae,aO as ze,M as Ge,A as Je,h as Ke,B as A,aV as We,a7 as H,a8 as j,aN as He,n as je,aa as qe,ai as Ye,t as L,G as Qe,E as Xe,au as Ze,ak as he,aW as et}from"./.pnpm-B-riUXVB.js";import{j as Ce,i as tt,k as ot,c as st,E as c,h as T,l as nt,r as fe,a as lt,d as B,I as at,m as it,A as ve,_ as rt}from"./index-DhEYsvJM.js";import{f as oe}from"./fs-BiKyf7QS.js";const ut={class:"orp"},dt={"w-full":""},mt={class:"op-item"},pt={key:0,class:"op-item"},ft={class:"op-item"},vt={key:1,class:"op-item"},gt={class:"op-item"},ct={key:2,class:"op-item"},_t={class:"op-item"},yt={"w-full":""},Vt={class:"op-item"},kt={class:"op-item"},Ct={"mt-1":"",flex:"","flex-row":"","flex-items-center":"","flex-justify-center":""},xt=ce({__name:"OperationRecordPanel",setup(U){const{openOperationRecordDrawer:C}=Ce(),M={merge_mouse_options:{merge:!0,max_interval_ms:300,merge_drag:!0},merge_key_options:{merge_repeat:!0,repeat_max_interval_ms:50,merge_press_release:!0,press_release_max_interval_ms:200},generateComment:!1,hiddenWindowBeforeRunning:!0},a=P(M),[O,Y]=$e("operation-capture-setting-form");_e(()=>{O.value&&(a.value=JSON.parse(JSON.stringify(O.value)))}),se(a,()=>{Y(a.value)},{deep:!0});const Q=()=>{a.value=JSON.parse(JSON.stringify(M))},X=P(!1),x=async()=>{{ye.warning("当前环境不支持录制操作");return}},N=()=>tt.stopCaptureOperation();return(b,o)=>{const V=Ve,S=Be,$=Me,_=ke,Z=Fe;return I(),ee(Z,{modelValue:t(C),"onUpdate:modelValue":o[9]||(o[9]=m=>ne(C)?C.value=m:null),title:"操作录制面板",direction:"rtl",size:"50%",class:"orp-drawer"},{default:l(()=>[d("div",ut,[d("div",dt,[d("div",mt,[s(V,null,{default:l(()=>o[10]||(o[10]=[u("合并重复输入的按键")])),_:1}),s(S,{modelValue:t(a).merge_key_options.merge_repeat,"onUpdate:modelValue":o[0]||(o[0]=m=>t(a).merge_key_options.merge_repeat=m)},null,8,["modelValue"])]),t(a).merge_key_options.merge_repeat?(I(),q("div",pt,[s(V,null,{default:l(()=>o[11]||(o[11]=[u("需要合并的重复按键按下时间最大间隔(ms)")])),_:1}),s($,{style:{"margin-left":"10px"},modelValue:t(a).merge_key_options.repeat_max_interval_ms,"onUpdate:modelValue":o[1]||(o[1]=m=>t(a).merge_key_options.repeat_max_interval_ms=m),min:1,size:"small"},null,8,["modelValue"])])):te("",!0),d("div",ft,[s(V,null,{default:l(()=>o[12]||(o[12]=[u("合并相同按键的按下和释放")])),_:1}),s(S,{modelValue:t(a).merge_key_options.merge_press_release,"onUpdate:modelValue":o[2]||(o[2]=m=>t(a).merge_key_options.merge_press_release=m)},null,8,["modelValue"])]),t(a).merge_key_options.merge_press_release?(I(),q("div",vt,[s(V,null,{default:l(()=>o[13]||(o[13]=[u("需要合并的按键按下与释放最大间隔(ms)")])),_:1}),s($,{style:{"margin-left":"10px"},modelValue:t(a).merge_key_options.press_release_max_interval_ms,"onUpdate:modelValue":o[3]||(o[3]=m=>t(a).merge_key_options.press_release_max_interval_ms=m),min:1,size:"small"},null,8,["modelValue"])])):te("",!0),d("div",gt,[s(V,null,{default:l(()=>o[14]||(o[14]=[u("合并相同鼠标按钮按下和释放")])),_:1}),s(S,{modelValue:t(a).merge_mouse_options.merge,"onUpdate:modelValue":o[4]||(o[4]=m=>t(a).merge_mouse_options.merge=m)},null,8,["modelValue"])]),t(a).merge_mouse_options.merge?(I(),q("div",ct,[s(V,null,{default:l(()=>o[15]||(o[15]=[u("需要合并的鼠标按钮按下与释放最大间隔(ms)")])),_:1}),s($,{style:{"margin-left":"10px"},modelValue:t(a).merge_mouse_options.max_interval_ms,"onUpdate:modelValue":o[5]||(o[5]=m=>t(a).merge_mouse_options.max_interval_ms=m),min:1,size:"small"},null,8,["modelValue"])])):te("",!0),d("div",_t,[s(V,null,{default:l(()=>o[16]||(o[16]=[u("合并鼠标按下与释放时坐标不一致为拖拽")])),_:1}),s(S,{modelValue:t(a).merge_mouse_options.merge_drag,"onUpdate:modelValue":o[6]||(o[6]=m=>t(a).merge_mouse_options.merge_drag=m)},null,8,["modelValue"])])]),d("div",yt,[d("div",Vt,[s(V,null,{default:l(()=>o[17]||(o[17]=[u("生成注释")])),_:1}),s(S,{modelValue:t(a).generateComment,"onUpdate:modelValue":o[7]||(o[7]=m=>t(a).generateComment=m)},null,8,["modelValue"])]),d("div",kt,[s(V,null,{default:l(()=>o[18]||(o[18]=[u("开始录制时隐藏本窗口")])),_:1}),s(S,{modelValue:t(a).hiddenWindowBeforeRunning,"onUpdate:modelValue":o[8]||(o[8]=m=>t(a).hiddenWindowBeforeRunning=m)},null,8,["modelValue"])]),d("div",Ct,[s(_,{onClick:Q},{default:l(()=>o[19]||(o[19]=[u("重置选项")])),_:1}),t(X)?(I(),ee(_,{key:1,type:"warning",onClick:N},{default:l(()=>o[21]||(o[21]=[u("停止录制")])),_:1})):(I(),ee(_,{key:0,type:"primary",onClick:x},{default:l(()=>o[20]||(o[20]=[u("开始录制")])),_:1}))])])])]),_:1},8,["modelValue"])}}}),wt=(U,C)=>{U.addAction({id:"fastFillParams",label:"快速填写参数",keybindings:[le.CtrlCmd|ae.Tab],contextMenuGroupId:"navigation",contextMenuOrder:0,run:C})},St=(U,C)=>{U.addAction({id:"insertSnippetCode",label:"插入代码片段",keybindings:[le.chord(le.CtrlCmd|ae.KeyK,ae.KeyI)],contextMenuGroupId:"navigation",contextMenuOrder:.1,run:C})},ge={auxiliaryActionRegister:wt,insertSnippetCodeActionRegister:St},bt={class:"script-editor-dev"},Et={flex:"","flex-row":"","flex-items-center":""},Dt={class:"dialog-footer"},At={class:"dialog-footer"},Tt={class:"dialog-footer"},It={class:"dialog-footer"},Rt={id:"codeEditBox"},Lt={class:"loading"},Pt=ce({__name:"CodeEditor",setup(U){const C=ze("snippetSearchRef"),M=at,a=ot(),O=st(),{scriptList:Y}=Ge(O),{findEditor:Q,editorInit:X,editorValue:x,insertText:N,setText:b,formatCode:o,disposeEditor:V,registerEditorEvent:S,unRegisterEditorEvent:$}=Ce(),{openId:_,preloadText:Z,preloadPath:m,isEditing:ie,fileInfo:i,declareMod:f,saveMod:E}=lt(),D=P(""),xe=async()=>{const n=O.codeSnippets.find(e=>e.name===D.value);if(n){const e=await oe.readFile(n.filePath);N(c,e.trim()),ye.success("代码片段插入成功")}R.value=!1},{invokeDynamicDialog:we}=it(),y=ve.getFnInfo(),{apiAutoTip:Se}=ve,F=P(!0),z=n=>B().mockScriptList.value.find(v=>v.id===_.value)[n],re=P(),be=n=>{n.preventDefault();const{deltaY:e}=n;re.value.scrollLeft+=e},G=Je({visible:!1,cb:()=>{},close_cb:()=>{}}),Ee=async()=>i.declare?(B().mockScriptList.value.find(n=>n.id===_.value).content=x.value,i.originData=x.value,A({title:"提示",message:"保存成功",type:"success",position:"bottom-right"}),!0):(A({title:"保存失败",message:"保存之前请先在脚本头部插入'脚本声明'或者将脚本声明补充完整",type:"error",position:"bottom-right"}),!1),De=async()=>{const n=await oe.selectFile(!1);n&&(E.savePath=n,i.savePath=n)},Ae=async()=>{E.visible=!1;try{await oe.writeFile(i.savePath,x.value),i.originData=x.value;const n=Qe();return Y.value.push({id:n,savePath:i.savePath,name:i.name,version:i.version,description:i.description,setting:{autoImportLastRunConfig:!1,targetAdbDevice:"",excludeDevice:[],targetApp:"",autoStartTargetApp:!1}}),_.value=n,A({title:"提示",message:"保存成功",type:"success",position:"bottom-right"}),!0}catch(n){return console.error(n),A({title:"保存失败",message:JSON.stringify(n),type:"error",position:"bottom-right"}),!1}},Te=()=>{N(c,`/**
 * 请勿删除，此声明会在脚本读取时用到！
 * @version:${f.version}
 * @name:${f.name}
 * @description:${f.description}
 */`,!0),f.description="无",f.name="未命名脚本",f.version="v1.0",f.visible=!1},ue=n=>{if(n.key==="s"&&n.ctrlKey){o();const v=setTimeout(()=>{Ee(),clearTimeout(v)},200);n.preventDefault()}},R=P(!1),Ie=()=>{if(y.value){if(!y.value.haveAuxiliary){A({title:"提示",message:"当前函数无需填写参数或不支持快速填写参数。",type:"info",position:"bottom-right"});return}const n=e=>{N(c,e,!1,y.value.paramsRange)};we(y.value.name,y.value.name,y.value.content||"","changeArgs",n,y.value.params)}};let J=null;const de=()=>{fe.currentRoute.value.name==="scriptEditor"&&(J&&clearTimeout(J),J=setTimeout(()=>{clearTimeout(J);const n=x.value;if(n.indexOf(" */")===-1)i.declare=!1;else{const e=n.indexOf(" */")+3,v=x.value.substring(0,e),p={name:"",version:"",description:""};if(v.replaceAll("/**","").replace(/ \* -{19}提示-{19}[\s\S]* \* -{42}/,"").replaceAll(`
 * `,"").replaceAll(`
 */`,"").trim().split("@").forEach(k=>{if(k!==""){const g=k.split(":");g[0]==="version"?p.version=g[1]:g[0]==="name"?p.name=g[1]:g[0]==="description"&&(p.description=g[1])}}),p.description===""||p.name===""||p.version==="")i.declare=!1;else{const k=B().mockScriptList,g=k.value.findIndex(h=>h.id===_?.value);_?.value!=="-1"&&(k.value[g].version=p.version,k.value[g].name=p.name,k.value[g].description=p.description),i.declare=!0,i.version=p.version,i.name=p.name,i.description=p.description}}},500))};se(x,()=>{de()});const Re=n=>{Se(),i.lastData=x.value},me=()=>{Q(c)?.layout()},Le=async(n="init",e)=>{{const v=z("content");i.originData=v||"",i.name=z("name"),i.description=z("description"),b(c,i.originData);return}},Pe=(n,e)=>{const v=n?B().mockCodeSnippetList.value.filter(p=>p.name.toLowerCase().includes(D.value.toLowerCase())||p.description.toLowerCase().includes(D.value.toLowerCase())||p.prefix.toLowerCase().includes(D.value.toLowerCase())):B().mockCodeSnippetList.value;e(v)};_e(async()=>{ie.value=!0,F.value=!1,window.addEventListener("resize",me),X(c),await pe(),document.getElementById(c)?.addEventListener("keydown",ue),S("mounted",n=>{ge.auxiliaryActionRegister(n,Ie),ge.insertSnippetCodeActionRegister(n,()=>{R.value=!0,setTimeout(()=>{C.value?.focus()})}),n.onDidChangeCursorPosition(Re),b(c,i.originData||T());const e=setTimeout(()=>{de(),F.value=!0,clearTimeout(e)},200)})}),Ke(()=>{nt.clearCache(),$("mounted"),window.removeEventListener("resize",me),document.getElementById(c)?.removeEventListener("keydown",ue),V(),ie.value=!1});const pe=async()=>{const n=fe.currentRoute.value.name;if(_.value!=="-1"&&n==="scriptEditor"){const e=z("savePath");if(e)try{Le("init",e)}catch(v){console.error(v),A({title:"提示",message:"文件读取失败，进入新增模式",type:"error",position:"bottom-right"}),i.originData=T(),i.savePath="",b(c,T());return}else i.originData=T(),i.savePath="",b(c,T()),A({title:"提示",message:"文件读取失败，路径为空，进入新增模式",type:"error",position:"bottom-right"})}else _.value==="-1"&&n==="scriptEditor"&&(i.originData=T(),i.savePath="",b(c,T()))};return se(_,pe),We(()=>{const n=Z.value;je(()=>{b(c,n)})}),(n,e)=>{const v=xt,p=Xe,k=qe,g=Ve,h=Ze,w=ke,K=Ye,W=he,Ue=et,Oe=Ne;return I(),q("div",bt,[s(v),s(K,{modelValue:t(R),"onUpdate:modelValue":e[2]||(e[2]=r=>ne(R)?R.value=r:null),title:"插入代码片段",width:"60%"},{footer:l(()=>[d("span",Dt,[s(w,{onClick:e[1]||(e[1]=r=>R.value=!1)},{default:l(()=>e[14]||(e[14]=[u("取消")])),_:1}),s(w,{type:"primary",onClick:xe},{default:l(()=>e[15]||(e[15]=[u(" 确定 ")])),_:1})])]),default:l(()=>[s(h,{modelValue:t(D),"onUpdate:modelValue":e[0]||(e[0]=r=>ne(D)?D.value=r:null),"value-key":"name","fetch-suggestions":Pe,placeholder:"搜索代码片段:名称、备注、前缀",ref_key:"snippetSearchRef",ref:C},{suffix:l(()=>[s(p,null,{default:l(()=>e[13]||(e[13]=[d("span",{"i-mdi-text-search":""},null,-1)])),_:1})]),default:l(({item:r})=>[d("div",Et,[s(k,{type:"primary",size:"small","mr-1":""},{default:l(()=>[u(L(r.prefix),1)]),_:2},1024),s(g,null,{default:l(()=>[u(L(r.name),1)]),_:2},1024)]),s(g,null,{default:l(()=>[u(L(r.description),1)]),_:2},1024)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),s(K,{modelValue:t(f).visible,"onUpdate:modelValue":e[7]||(e[7]=r=>t(f).visible=r),title:"插入脚本声明"},{footer:l(()=>[d("span",At,[s(w,{onClick:e[6]||(e[6]=r=>t(f).visible=!1)},{default:l(()=>e[16]||(e[16]=[u("取消")])),_:1}),s(w,{type:"primary",onClick:Te},{default:l(()=>e[17]||(e[17]=[u(" 确定 ")])),_:1})])]),default:l(()=>[e[18]||(e[18]=d("div",null,"脚本名称",-1)),s(W,{modelValue:t(f).name,"onUpdate:modelValue":e[3]||(e[3]=r=>t(f).name=r)},null,8,["modelValue"]),e[19]||(e[19]=d("div",null,"脚本版本",-1)),s(W,{modelValue:t(f).version,"onUpdate:modelValue":e[4]||(e[4]=r=>t(f).version=r)},null,8,["modelValue"]),e[20]||(e[20]=d("div",null,"脚本描述",-1)),s(W,{modelValue:t(f).description,"onUpdate:modelValue":e[5]||(e[5]=r=>t(f).description=r)},null,8,["modelValue"])]),_:1},8,["modelValue"]),s(K,{modelValue:t(E).visible,"onUpdate:modelValue":e[10]||(e[10]=r=>t(E).visible=r),title:"保存脚本"},{footer:l(()=>[d("span",Tt,[s(w,{onClick:e[9]||(e[9]=r=>t(E).visible=!1)},{default:l(()=>e[22]||(e[22]=[u("取消")])),_:1}),s(w,{type:"primary",onClick:Ae},{default:l(()=>e[23]||(e[23]=[u(" 确定 ")])),_:1})])]),default:l(()=>[e[24]||(e[24]=d("div",null,"请选择脚本的保存路径",-1)),s(W,{modelValue:t(E).savePath,"onUpdate:modelValue":e[8]||(e[8]=r=>t(E).savePath=r)},{append:l(()=>[s(w,{type:"primary",onClick:De},{default:l(()=>e[21]||(e[21]=[u("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),s(K,{modelValue:t(G).visible,"onUpdate:modelValue":e[12]||(e[12]=r=>t(G).visible=r),title:"运行脚本"},{footer:l(()=>[d("span",It,[s(w,{onClick:t(G).close_cb},{default:l(()=>e[25]||(e[25]=[u("直接运行")])),_:1},8,["onClick"]),s(w,{type:"primary",onClick:t(G).cb},{default:l(()=>e[26]||(e[26]=[u(" 保存后运行 ")])),_:1},8,["onClick"])])]),default:l(()=>[e[27]||(e[27]=d("div",null,"检测到当前脚本已做更改，若不保存则运行最后一次保存的内容",-1)),s(Ue,{modelValue:t(a).editor.runAutoSave,"onUpdate:modelValue":e[11]||(e[11]=r=>t(a).editor.runAutoSave=r),label:"不再提醒,下次运行自动保存,可在设置页关闭自动保存",size:"large"},null,8,["modelValue"])]),_:1},8,["modelValue"]),H(d("div",Rt,null,512),[[j,t(F)]]),H(d("div",Lt,[s(Oe),e[28]||(e[28]=d("div",null,"编辑器加载中...",-1))],512),[[j,!t(F)]]),d("div",{class:"auto-api-tip scrollbar",onWheel:He(be,["stop"]),ref_key:"scrollbarRef",ref:re},[H(s(k,{style:{"margin-right":"3px"},size:"small",type:"success"},{default:l(()=>[u(L(t(M)?"[鼠标右键]":"Ctrl+Tab ：")+"快速填写/修改参数 ",1)]),_:1},512),[[j,t(y)?.haveAuxiliary]]),H(s(k,{size:"small",type:"info"},{default:l(()=>[u(L(t(y)?.name)+":"+L(t(y)?.content),1)]),_:1},512),[[j,t(y)?.name&&t(y)?.content]])],544)])}}}),Bt=rt(Pt,[["__scopeId","data-v-41298556"]]);export{Bt as default};
