import{L as $e}from"./Loading-D8Kz5wui.js";import{d as ce,Y as _e,m as L,Z as Ne,F as ye,$ as se,o as R,g as ee,w as l,n as d,b as s,p as u,i as t,a as q,I as te,H as ne,E as Ve,G as Be,x as ke,a0 as Fe,a1 as Me,X as Ce,a2 as le,a3 as ae,B as ze,a4 as Ke,k as Ge,s as Je,C as We,a5 as c,W as A,a6 as He,a7 as Ye,Q as fe,P,a8 as qe,a9 as H,aa as Y,q as je,f as Qe,l as B,ab as Xe,y as Ze,J as he,t as I,O as et,ac as tt,ad as ve,V as ot,v as st,ae as nt,K as lt,_ as at}from"./index-fER-Z0jW.js";import{E as it}from"./el-checkbox-DDXe9Vfq.js";import{E as rt}from"./el-drawer-O_mTgUQJ.js";import{f as oe}from"./fs-AKkgYY9S.js";const ut={class:"orp"},dt={"w-full":""},mt={class:"op-item"},pt={key:0,class:"op-item"},ft={class:"op-item"},vt={key:1,class:"op-item"},gt={class:"op-item"},ct={key:2,class:"op-item"},_t={class:"op-item"},yt={"w-full":""},Vt={class:"op-item"},kt={class:"op-item"},Ct={"mt-1":"",flex:"","flex-row":"","flex-items-center":"","flex-justify-center":""},xt=ce({__name:"OperationRecordPanel",setup(U){const{openOperationRecordDrawer:C}=_e(),F={merge_mouse_options:{merge:!0,max_interval_ms:300,merge_drag:!0},merge_key_options:{merge_repeat:!0,repeat_max_interval_ms:50,merge_press_release:!0,press_release_max_interval_ms:200},generateComment:!1,hiddenWindowBeforeRunning:!0},a=L(F),[O,j]=Ne("operation-capture-setting-form");ye(()=>{O.value&&(a.value=JSON.parse(JSON.stringify(O.value)))}),se(a,()=>{j(a.value)},{deep:!0});const Q=()=>{a.value=JSON.parse(JSON.stringify(F))},X=L(!1),x=async()=>{{Ve.warning("当前环境不支持录制操作");return}},$=()=>Be.stopCaptureOperation();return(E,o)=>{const V=ke,b=Fe,N=Me,_=Ce,Z=rt;return R(),ee(Z,{modelValue:t(C),"onUpdate:modelValue":o[9]||(o[9]=m=>ne(C)?C.value=m:null),title:"操作录制面板",direction:"rtl",size:"50%",class:"orp-drawer"},{default:l(()=>[d("div",ut,[d("div",dt,[d("div",mt,[s(V,null,{default:l(()=>o[10]||(o[10]=[u("合并重复输入的按键")])),_:1}),s(b,{modelValue:t(a).merge_key_options.merge_repeat,"onUpdate:modelValue":o[0]||(o[0]=m=>t(a).merge_key_options.merge_repeat=m)},null,8,["modelValue"])]),t(a).merge_key_options.merge_repeat?(R(),q("div",pt,[s(V,null,{default:l(()=>o[11]||(o[11]=[u("需要合并的重复按键按下时间最大间隔(ms)")])),_:1}),s(N,{style:{"margin-left":"10px"},modelValue:t(a).merge_key_options.repeat_max_interval_ms,"onUpdate:modelValue":o[1]||(o[1]=m=>t(a).merge_key_options.repeat_max_interval_ms=m),min:1,size:"small"},null,8,["modelValue"])])):te("",!0),d("div",ft,[s(V,null,{default:l(()=>o[12]||(o[12]=[u("合并相同按键的按下和释放")])),_:1}),s(b,{modelValue:t(a).merge_key_options.merge_press_release,"onUpdate:modelValue":o[2]||(o[2]=m=>t(a).merge_key_options.merge_press_release=m)},null,8,["modelValue"])]),t(a).merge_key_options.merge_press_release?(R(),q("div",vt,[s(V,null,{default:l(()=>o[13]||(o[13]=[u("需要合并的按键按下与释放最大间隔(ms)")])),_:1}),s(N,{style:{"margin-left":"10px"},modelValue:t(a).merge_key_options.press_release_max_interval_ms,"onUpdate:modelValue":o[3]||(o[3]=m=>t(a).merge_key_options.press_release_max_interval_ms=m),min:1,size:"small"},null,8,["modelValue"])])):te("",!0),d("div",gt,[s(V,null,{default:l(()=>o[14]||(o[14]=[u("合并相同鼠标按钮按下和释放")])),_:1}),s(b,{modelValue:t(a).merge_mouse_options.merge,"onUpdate:modelValue":o[4]||(o[4]=m=>t(a).merge_mouse_options.merge=m)},null,8,["modelValue"])]),t(a).merge_mouse_options.merge?(R(),q("div",ct,[s(V,null,{default:l(()=>o[15]||(o[15]=[u("需要合并的鼠标按钮按下与释放最大间隔(ms)")])),_:1}),s(N,{style:{"margin-left":"10px"},modelValue:t(a).merge_mouse_options.max_interval_ms,"onUpdate:modelValue":o[5]||(o[5]=m=>t(a).merge_mouse_options.max_interval_ms=m),min:1,size:"small"},null,8,["modelValue"])])):te("",!0),d("div",_t,[s(V,null,{default:l(()=>o[16]||(o[16]=[u("合并鼠标按下与释放时坐标不一致为拖拽")])),_:1}),s(b,{modelValue:t(a).merge_mouse_options.merge_drag,"onUpdate:modelValue":o[6]||(o[6]=m=>t(a).merge_mouse_options.merge_drag=m)},null,8,["modelValue"])])]),d("div",yt,[d("div",Vt,[s(V,null,{default:l(()=>o[17]||(o[17]=[u("生成注释")])),_:1}),s(b,{modelValue:t(a).generateComment,"onUpdate:modelValue":o[7]||(o[7]=m=>t(a).generateComment=m)},null,8,["modelValue"])]),d("div",kt,[s(V,null,{default:l(()=>o[18]||(o[18]=[u("开始录制时隐藏本窗口")])),_:1}),s(b,{modelValue:t(a).hiddenWindowBeforeRunning,"onUpdate:modelValue":o[8]||(o[8]=m=>t(a).hiddenWindowBeforeRunning=m)},null,8,["modelValue"])]),d("div",Ct,[s(_,{onClick:Q},{default:l(()=>o[19]||(o[19]=[u("重置选项")])),_:1}),t(X)?(R(),ee(_,{key:1,type:"warning",onClick:$},{default:l(()=>o[21]||(o[21]=[u("停止录制")])),_:1})):(R(),ee(_,{key:0,type:"primary",onClick:x},{default:l(()=>o[20]||(o[20]=[u("开始录制")])),_:1}))])])])]),_:1},8,["modelValue"])}}}),wt=(U,C)=>{U.addAction({id:"fastFillParams",label:"快速填写参数",keybindings:[le.CtrlCmd|ae.Tab],contextMenuGroupId:"navigation",contextMenuOrder:0,run:C})},bt=(U,C)=>{U.addAction({id:"insertSnippetCode",label:"插入代码片段",keybindings:[le.chord(le.CtrlCmd|ae.KeyK,ae.KeyI)],contextMenuGroupId:"navigation",contextMenuOrder:.1,run:C})},ge={auxiliaryActionRegister:wt,insertSnippetCodeActionRegister:bt},Et={class:"script-editor-dev"},St={flex:"","flex-row":"","flex-items-center":""},Dt={class:"dialog-footer"},At={class:"dialog-footer"},Pt={class:"dialog-footer"},Rt={class:"dialog-footer"},Tt={id:"codeEditBox"},It={class:"loading"},Lt=ce({__name:"CodeEditor",setup(U){const C=ze("snippetSearchRef"),F=et,a=Ke(),O=Ge(),{scriptList:j}=Je(O),{findEditor:Q,editorInit:X,editorValue:x,insertText:$,setText:E,formatCode:o,disposeEditor:V,registerEditorEvent:b,unRegisterEditorEvent:N}=_e(),{openId:_,preloadText:Z,preloadPath:m,isEditing:ie,fileInfo:i,declareMod:f,saveMod:S}=Qe(),D=L(""),xe=async()=>{const n=O.codeSnippets.find(e=>e.name===D.value);if(n){const e=await oe.readFile(n.filePath);$(c,e.trim()),Ve.success("代码片段插入成功")}T.value=!1},{invokeDynamicDialog:we}=tt(),y=ve.getFnInfo(),{apiAutoTip:be}=ve,M=L(!0),z=n=>B().mockScriptList.value.find(v=>v.id===_.value)[n],re=L(),Ee=n=>{n.preventDefault();const{deltaY:e}=n;re.value.scrollLeft+=e},K=We({visible:!1,cb:()=>{},close_cb:()=>{}}),Se=async()=>i.declare?(B().mockScriptList.value.find(n=>n.id===_.value).content=x.value,i.originData=x.value,P({title:"提示",message:"保存成功",type:"success",position:"bottom-right"}),!0):(P({title:"保存失败",message:"保存之前请先在脚本头部插入'脚本声明'或者将脚本声明补充完整",type:"error",position:"bottom-right"}),!1),De=async()=>{const n=await oe.selectFile(!1);n&&(S.savePath=n,i.savePath=n)},Ae=async()=>{S.visible=!1;try{await oe.writeFile(i.savePath,x.value),i.originData=x.value;const n=ot();return j.value.push({id:n,savePath:i.savePath,name:i.name,version:i.version,description:i.description,setting:{autoImportLastRunConfig:!1,targetAdbDevice:"",excludeDevice:[],targetApp:"",autoStartTargetApp:!1}}),_.value=n,P({title:"提示",message:"保存成功",type:"success",position:"bottom-right"}),!0}catch(n){return console.error(n),P({title:"保存失败",message:JSON.stringify(n),type:"error",position:"bottom-right"}),!1}},Pe=()=>{$(c,`/**
 * 请勿删除，此声明会在脚本读取时用到！
 * @version:${f.version}
 * @name:${f.name}
 * @description:${f.description}
 */`,!0),f.description="无",f.name="未命名脚本",f.version="v1.0",f.visible=!1},ue=n=>{if(n.key==="s"&&n.ctrlKey){o();const v=setTimeout(()=>{Se(),clearTimeout(v)},200);n.preventDefault()}},T=L(!1),Re=()=>{if(y.value){if(!y.value.haveAuxiliary){P({title:"提示",message:"当前函数无需填写参数或不支持快速填写参数。",type:"info",position:"bottom-right"});return}const n=e=>{$(c,e,!1,y.value.paramsRange)};we(y.value.name,y.value.name,y.value.content||"","changeArgs",n,y.value.params)}};let G=null;const de=()=>{fe.currentRoute.value.name==="scriptEditor"&&(G&&clearTimeout(G),G=setTimeout(()=>{clearTimeout(G);const n=x.value;if(n.indexOf(" */")===-1)i.declare=!1;else{const e=n.indexOf(" */")+3,v=x.value.substring(0,e),p={name:"",version:"",description:""};if(v.replaceAll("/**","").replace(/ \* -{19}提示-{19}[\s\S]* \* -{42}/,"").replaceAll(`
 * `,"").replaceAll(`
 */`,"").trim().split("@").forEach(k=>{if(k!==""){const g=k.split(":");g[0]==="version"?p.version=g[1]:g[0]==="name"?p.name=g[1]:g[0]==="description"&&(p.description=g[1])}}),p.description===""||p.name===""||p.version==="")i.declare=!1;else{const k=B().mockScriptList,g=k.value.findIndex(h=>h.id===_?.value);_?.value!=="-1"&&(k.value[g].version=p.version,k.value[g].name=p.name,k.value[g].description=p.description),i.declare=!0,i.version=p.version,i.name=p.name,i.description=p.description}}},500))};se(x,()=>{de()});const Te=n=>{be(),i.lastData=x.value},me=()=>{Q(c)?.layout()},Ie=async(n="init",e)=>{{const v=z("content");i.originData=v||"",i.name=z("name"),i.description=z("description"),E(c,i.originData);return}},Le=(n,e)=>{const v=n?B().mockCodeSnippetList.value.filter(p=>p.name.toLowerCase().includes(D.value.toLowerCase())||p.description.toLowerCase().includes(D.value.toLowerCase())||p.prefix.toLowerCase().includes(D.value.toLowerCase())):B().mockCodeSnippetList.value;e(v)};ye(async()=>{ie.value=!0,M.value=!1,window.addEventListener("resize",me),X(c),await pe(),document.getElementById(c)?.addEventListener("keydown",ue),b("mounted",n=>{ge.auxiliaryActionRegister(n,Re),ge.insertSnippetCodeActionRegister(n,()=>{T.value=!0,setTimeout(()=>{C.value?.focus()})}),n.onDidChangeCursorPosition(Te),E(c,i.originData||A());const e=setTimeout(()=>{de(),M.value=!0,clearTimeout(e)},200)})}),He(()=>{Ye.clearCache(),N("mounted"),window.removeEventListener("resize",me),document.getElementById(c)?.removeEventListener("keydown",ue),V(),ie.value=!1});const pe=async()=>{const n=fe.currentRoute.value.name;if(_.value!=="-1"&&n==="scriptEditor"){const e=z("savePath");if(e)try{Ie("init",e)}catch(v){console.error(v),P({title:"提示",message:"文件读取失败，进入新增模式",type:"error",position:"bottom-right"}),i.originData=A(),i.savePath="",E(c,A());return}else i.originData=A(),i.savePath="",E(c,A()),P({title:"提示",message:"文件读取失败，路径为空，进入新增模式",type:"error",position:"bottom-right"})}else _.value==="-1"&&n==="scriptEditor"&&(i.originData=A(),i.savePath="",E(c,A()))};return se(_,pe),qe(()=>{const n=Z.value;Xe(()=>{E(c,n)})}),(n,e)=>{const v=xt,p=st,k=Ze,g=ke,h=nt,w=Ce,J=he,W=lt,Ue=it,Oe=$e;return R(),q("div",Et,[s(v),s(J,{modelValue:t(T),"onUpdate:modelValue":e[2]||(e[2]=r=>ne(T)?T.value=r:null),title:"插入代码片段",width:"60%"},{footer:l(()=>[d("span",Dt,[s(w,{onClick:e[1]||(e[1]=r=>T.value=!1)},{default:l(()=>e[14]||(e[14]=[u("取消")])),_:1}),s(w,{type:"primary",onClick:xe},{default:l(()=>e[15]||(e[15]=[u(" 确定 ")])),_:1})])]),default:l(()=>[s(h,{modelValue:t(D),"onUpdate:modelValue":e[0]||(e[0]=r=>ne(D)?D.value=r:null),"value-key":"name","fetch-suggestions":Le,placeholder:"搜索代码片段:名称、备注、前缀",ref_key:"snippetSearchRef",ref:C},{suffix:l(()=>[s(p,null,{default:l(()=>e[13]||(e[13]=[d("span",{"i-mdi-text-search":""},null,-1)])),_:1})]),default:l(({item:r})=>[d("div",St,[s(k,{type:"primary",size:"small","mr-1":""},{default:l(()=>[u(I(r.prefix),1)]),_:2},1024),s(g,null,{default:l(()=>[u(I(r.name),1)]),_:2},1024)]),s(g,null,{default:l(()=>[u(I(r.description),1)]),_:2},1024)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),s(J,{modelValue:t(f).visible,"onUpdate:modelValue":e[7]||(e[7]=r=>t(f).visible=r),title:"插入脚本声明"},{footer:l(()=>[d("span",At,[s(w,{onClick:e[6]||(e[6]=r=>t(f).visible=!1)},{default:l(()=>e[16]||(e[16]=[u("取消")])),_:1}),s(w,{type:"primary",onClick:Pe},{default:l(()=>e[17]||(e[17]=[u(" 确定 ")])),_:1})])]),default:l(()=>[e[18]||(e[18]=d("div",null,"脚本名称",-1)),s(W,{modelValue:t(f).name,"onUpdate:modelValue":e[3]||(e[3]=r=>t(f).name=r)},null,8,["modelValue"]),e[19]||(e[19]=d("div",null,"脚本版本",-1)),s(W,{modelValue:t(f).version,"onUpdate:modelValue":e[4]||(e[4]=r=>t(f).version=r)},null,8,["modelValue"]),e[20]||(e[20]=d("div",null,"脚本描述",-1)),s(W,{modelValue:t(f).description,"onUpdate:modelValue":e[5]||(e[5]=r=>t(f).description=r)},null,8,["modelValue"])]),_:1},8,["modelValue"]),s(J,{modelValue:t(S).visible,"onUpdate:modelValue":e[10]||(e[10]=r=>t(S).visible=r),title:"保存脚本"},{footer:l(()=>[d("span",Pt,[s(w,{onClick:e[9]||(e[9]=r=>t(S).visible=!1)},{default:l(()=>e[22]||(e[22]=[u("取消")])),_:1}),s(w,{type:"primary",onClick:Ae},{default:l(()=>e[23]||(e[23]=[u(" 确定 ")])),_:1})])]),default:l(()=>[e[24]||(e[24]=d("div",null,"请选择脚本的保存路径",-1)),s(W,{modelValue:t(S).savePath,"onUpdate:modelValue":e[8]||(e[8]=r=>t(S).savePath=r)},{append:l(()=>[s(w,{type:"primary",onClick:De},{default:l(()=>e[21]||(e[21]=[u("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),s(J,{modelValue:t(K).visible,"onUpdate:modelValue":e[12]||(e[12]=r=>t(K).visible=r),title:"运行脚本"},{footer:l(()=>[d("span",Rt,[s(w,{onClick:t(K).close_cb},{default:l(()=>e[25]||(e[25]=[u("直接运行")])),_:1},8,["onClick"]),s(w,{type:"primary",onClick:t(K).cb},{default:l(()=>e[26]||(e[26]=[u(" 保存后运行 ")])),_:1},8,["onClick"])])]),default:l(()=>[e[27]||(e[27]=d("div",null,"检测到当前脚本已做更改，若不保存则运行最后一次保存的内容",-1)),s(Ue,{modelValue:t(a).editor.runAutoSave,"onUpdate:modelValue":e[11]||(e[11]=r=>t(a).editor.runAutoSave=r),label:"不再提醒,下次运行自动保存,可在设置页关闭自动保存",size:"large"},null,8,["modelValue"])]),_:1},8,["modelValue"]),H(d("div",Tt,null,512),[[Y,t(M)]]),H(d("div",It,[s(Oe),e[28]||(e[28]=d("div",null,"编辑器加载中...",-1))],512),[[Y,!t(M)]]),d("div",{class:"auto-api-tip scrollbar",onWheel:je(Ee,["stop"]),ref_key:"scrollbarRef",ref:re},[H(s(k,{style:{"margin-right":"3px"},size:"small",type:"success"},{default:l(()=>[u(I(t(F)?"[鼠标右键]":"Ctrl+Tab ：")+"快速填写/修改参数 ",1)]),_:1},512),[[Y,t(y)?.haveAuxiliary]]),H(s(k,{size:"small",type:"info"},{default:l(()=>[u(I(t(y)?.name)+":"+I(t(y)?.content),1)]),_:1},512),[[Y,t(y)?.name&&t(y)?.content]])],544)])}}}),Ft=at(Lt,[["__scopeId","data-v-41298556"]]);export{Ft as default};
