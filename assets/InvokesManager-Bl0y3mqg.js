import{d as defineComponent,u as useCssVars,m as unref,e as computed,o as openBlock,i as createElementBlock,a as createBaseVNode,j as createVNode,w as withCtx,l as createTextVNode,t as toDisplayString,ab as createCommentVNode,aj as Fragment,c as createBlock,at as normalizeClass,ac as ElTag,q as ElText,E as ElIcon,p as ElButton,aR as ElButtonGroup,aA as ElSelect,aB as ElSwitch,au as ElInputNumber,am as ElInput,ap as mergeModels,C as reactive,aq as useModel,I as nanoid,ay as renderList,ag as isRef,aS as lo,H as ElMessage,az as ElOption,an as ElFormItem,ao as ElForm,bq as ElDivider,Y as exists,L as watch,r as ref,aX as watchEffect,h as onBeforeUnmount,g as onMounted,B as listen,Q as getCurrentWebviewWindow,a9 as withDirectives,aa as vShow,X as ElMessageBox,b8 as ElTableColumn,aw as ElAutocomplete,aY as ElCheckbox,b9 as ElTable,af as onUnmounted,ai as normalizeStyle,b3 as ElSegmented,br as ElTreeSelect,aT as ElEmpty,n as nextTick}from"./.pnpm-D_Vtnb2u.js";import{d as dataStructureUtils,_ as __unplugin_components_14}from"./dataStructure-e7NRF88o.js";import{u as useAppTheme,v as __unplugin_components_6$1,Z as __unplugin_components_5,a0 as __unplugin_components_7,w as __unplugin_components_10,t as _sfc_main$4,_ as _export_sfc,c as useListStore,a1 as _sfc_main$5,p as pathUtils,l as astWorker,m as useCore,i as invokeBaseApi}from"./index-CQveOEMM.js";import{f as fsUtils}from"./fs-C5TBDgLP.js";const _hoisted_1$3={key:0,class:"mask-box"},_hoisted_2$3={flex:"","flex-row":"","flex-items-center":""},_hoisted_3$3={key:1,class:"mask-box show-mask"},_hoisted_4$3={key:2,class:"label"},_hoisted_5$2={key:3,flex:"","flex-row":"","flex-items-center":""},_sfc_main$3=defineComponent({__name:"DialogArgItem",props:{argItem:{type:Object,required:!0},edit:{type:Boolean,default:!1}},emits:["onEdit","onDelete"],setup(o,{emit:e}){useCssVars(V=>({ea0ac288:unref(s),"5636247c":unref(p)}));const l=e,f=V=>["switch","numberInput","numberRangeInput"].includes(V)?"row-item arg-item":"arg-item",v=["input","FileInput","DirInput","slider"],{appAsideBgColor:s}=useAppTheme(),p=computed(()=>(s.value==="#272727"?"#f6f6f6":"#272727")+"B0"),N=V=>{l("onEdit",V)},T=V=>{l("onDelete",V)};return(V,g)=>{const C=ElTag,$=ElText,B=ElIcon,k=ElButton,b=ElButtonGroup,n=ElSelect,E=__unplugin_components_6$1,R=__unplugin_components_5,S=__unplugin_components_7,q=ElSwitch,j=__unplugin_components_10,J=ElInputNumber,M=ElInput,h=_sfc_main$4;return openBlock(),createElementBlock("div",{class:normalizeClass(f(o.argItem.componentType))},[o.edit?(openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("div",_hoisted_2$3,[createVNode(C,{type:"primary",size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(o.argItem.componentType),1)]),_:1}),createVNode($,{class:"info"},{default:withCtx(()=>[createTextVNode(toDisplayString(o.argItem.name),1)]),_:1})]),createVNode(b,null,{default:withCtx(()=>[createVNode(k,{onClick:g[0]||(g[0]=a=>N(o.argItem.id)),link:"",class:"btn",type:"primary"},{default:withCtx(()=>[createVNode(B,{class:"btn"},{default:withCtx(()=>g[11]||(g[11]=[createBaseVNode("span",{"i-mdi-playlist-edit":"",class:"btn"},null,-1)])),_:1})]),_:1}),createVNode(k,{type:"danger",onClick:g[1]||(g[1]=a=>T(o.argItem.id)),link:"",class:"btn"},{default:withCtx(()=>[createVNode(B,{class:"btn"},{default:withCtx(()=>g[12]||(g[12]=[createBaseVNode("span",{"i-mdi-delete-outline":"",class:"btn"},null,-1)])),_:1})]),_:1})]),_:1})])):(openBlock(),createElementBlock("div",_hoisted_3$3)),o.argItem?.label!==void 0&&!v.includes(o.argItem.componentType)&&o.edit?(openBlock(),createElementBlock("span",_hoisted_4$3,toDisplayString(o.argItem.label),1)):createCommentVNode("",!0),o.edit?(openBlock(),createElementBlock(Fragment,{key:4},[o.argItem&&o.argItem.componentType==="select"?(openBlock(),createBlock(n,{key:0,modelValue:o.argItem.value,"onUpdate:modelValue":g[2]||(g[2]=a=>o.argItem.value=a),filterable:"",multiple:o.argItem.multiple,clearable:o.argItem.multiple,"allow-create":!o.argItem.notAllowCreate,"default-first-option":"",placeholder:o.argItem.placeholder||"请选择"},null,8,["modelValue","multiple","clearable","allow-create","placeholder"])):o.argItem&&o.argItem.componentType==="FileInput"?(openBlock(),createBlock(E,{key:1,modelValue:o.argItem.value,"onUpdate:modelValue":g[3]||(g[3]=a=>o.argItem.value=a),label:o.argItem.label,verify:o.argItem.verifyPath,multiple:o.argItem.multiple},null,8,["modelValue","label","verify","multiple"])):o.argItem&&o.argItem.componentType==="RectInput"?(openBlock(),createBlock(R,{key:2,modelValue:o.argItem.value,"onUpdate:modelValue":g[4]||(g[4]=a=>o.argItem.value=a)},null,8,["modelValue"])):o.argItem&&o.argItem.componentType==="slider"?(openBlock(),createBlock(S,{key:3,modelValue:o.argItem.value,"onUpdate:modelValue":g[5]||(g[5]=a=>o.argItem.value=a),max:o.argItem.range?.max,min:o.argItem.range?.min,step:o.argItem.range?.step,label:o.argItem.label,size:"small",width:100},null,8,["modelValue","max","min","step","label"])):o.argItem&&o.argItem.componentType==="switch"?(openBlock(),createBlock(q,{key:4,modelValue:o.argItem.value,"onUpdate:modelValue":g[6]||(g[6]=a=>o.argItem.value=a),"active-text":o.argItem.activeText||"是","inactive-text":o.argItem.inactiveText||"否",size:"small"},null,8,["modelValue","active-text","inactive-text"])):o.argItem&&o.argItem.componentType==="DirInput"?(openBlock(),createBlock(j,{key:5,modelValue:o.argItem.value,"onUpdate:modelValue":g[7]||(g[7]=a=>o.argItem.value=a),label:o.argItem.label,suffix:o.argItem.suffix||"",verify:o.argItem.verifyPath},null,8,["modelValue","label","suffix","verify"])):o.argItem&&o.argItem.componentType==="numberInput"?(openBlock(),createBlock(J,{key:6,modelValue:o.argItem.value,"onUpdate:modelValue":g[8]||(g[8]=a=>o.argItem.value=a),"value-on-clear":0,size:"small"},null,8,["modelValue"])):o.argItem&&o.argItem.componentType==="input"?(openBlock(),createBlock(M,{key:7,modelValue:o.argItem.value,"onUpdate:modelValue":g[9]||(g[9]=a=>o.argItem.value=a),size:"small"},{prepend:withCtx(()=>[createTextVNode(toDisplayString(o.argItem.label),1)]),_:1},8,["modelValue"])):o.argItem&&o.argItem.componentType==="numberRangeInput"?(openBlock(),createBlock(h,{key:8,modelValue:o.argItem.value,"onUpdate:modelValue":g[10]||(g[10]=a=>o.argItem.value=a)},null,8,["modelValue"])):createCommentVNode("",!0)],64)):(openBlock(),createElementBlock("div",_hoisted_5$2,[createVNode(C,{type:"primary",size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(o.argItem.componentType),1)]),_:1}),createVNode($,null,{default:withCtx(()=>[createTextVNode(toDisplayString(o.argItem.label),1)]),_:1})]))],2)}}}),__unplugin_components_13$1=_export_sfc(_sfc_main$3,[["__scopeId","data-v-cef03f0f"]]),_hoisted_1$2={class:"dialog-form"},_hoisted_2$2={"w-full":"",flex:"","flex-row":"","pos-relative":"","h-85vh":"","position-relative":""},_hoisted_3$2={"overflow-y-scroll":"","overflow-x-hidden":"","p-3":"","box-border":"",class:"b1"},_hoisted_4$2={"flex-1":"","h-full":"","overflow-y-scroll":"","overflow-x-hidden":"","ml-1":"","p-3":"","box-border":"",class:"b1"},_sfc_main$2=defineComponent({__name:"DialogArgEditor",props:mergeModels({documentParams:{type:Array,default:[]}},{modelValue:{default:[]},modelModifiers:{}}),emits:["update:modelValue"],setup(__props){useCssVars(o=>({"4f3ba3ac":unref(appAsideBgColor)}));const props=__props,editDialogForm=reactive({componentType:void 0,noTest:!1,onlyTest:!1,name:"",label:"",displayCondition:[],placeholder:"请输入",component:{select:{optionType:"array",options:[],fnOptionsStr:'(store) => {return ["a1","a2"]}',selectOptionSeparator:"",notAllowCreate:!1,multiple:!1,value:"",mValue:[]},fileInput:{verifyPath:!1,suffix:"",multiple:!1,value:"",mValue:[]},input:{value:""},rectInput:{value:{x:0,y:0,width:0,height:0},targetSrc:""},slider:{value:0,range:{min:0,max:100,step:1}},switch:{value:!1,activeText:"是",inactiveText:"否"},dirInput:{value:"",suffix:"",verifyPath:!1},numberInput:{value:0},numberRangeInput:{value:[0,100],limit:[0,100]}},dialog:{visible:!1,targetId:""}}),onOnlyTestChange=()=>{editDialogForm.onlyTest&&(editDialogForm.noTest=!1)},onNoTestChange=()=>{editDialogForm.noTest&&(editDialogForm.onlyTest=!1)},model=useModel(__props,"modelValue"),displayConditionOption=computed(()=>model.value.filter(o=>o.name!==editDialogForm.name).map(o=>({id:o.id,name:o.name,label:o.label}))),localArgs=[{componentType:"input",value:"",desc:"文本输入框"},{componentType:"RectInput",value:{x:0,y:0,width:0,height:0},targetSrc:"",desc:"矩形参数输入框"},{componentType:"slider",value:0,range:{min:0,max:100,step:1},desc:"滑块进度条"},{componentType:"switch",value:!1,activeText:"是",inactiveText:"否",desc:"切换按钮"},{componentType:"DirInput",value:"",suffix:"",verifyPath:!1,desc:"目录输入框"},{componentType:"numberInput",value:0,desc:"数字输入框"},{componentType:"numberRangeInput",value:[0,100],limit:[0,100],desc:"数字范围输入框"},{desc:"单选下拉框(字符串数组选项)",componentType:"select",value:"",options:[],selectOptionSeparator:"",notAllowCreate:!0,multiple:!1},{desc:"单选下拉框(函数返回选项)",componentType:"select",value:"",options:o=>["Option1","Option2"],selectOptionSeparator:"",notAllowCreate:!0,multiple:!1},{desc:"多选下拉框",componentType:"select",value:[],options:[],selectOptionSeparator:"",notAllowCreate:!1,multiple:!0},{componentType:"FileInput",value:"",suffix:"",verifyPath:!1,desc:"单文件选择"},{componentType:"FileInput",value:[],suffix:"",verifyPath:!1,desc:"多文件选择",multiple:!0}].map(o=>({...o,id:nanoid(),onlyTest:!1,noTest:!1,name:"",label:o.desc||o.componentType,displayCondition:[],placeholder:""})),clone=o=>({...o,id:nanoid(),label:o.desc}),{appAsideBgColor}=useAppTheme(),parseFnStr=fnStr=>{try{const fn=eval(fnStr);return fn(useListStore())}catch(o){return[]}},editArg=o=>{const e=model.value?.find(l=>l.id===o);if(e){if(editDialogForm.componentType=e.componentType,editDialogForm.noTest=!!e.noTest,editDialogForm.onlyTest=!!e.onlyTest,editDialogForm.name=e.name,editDialogForm.label=e.label,editDialogForm.displayCondition=e.displayCondition||[],editDialogForm.placeholder=e.placeholder||"",e.componentType==="select"){const l=e,f=Array.isArray(l.options)?"array":"function";editDialogForm.component.select.optionType=f,Array.isArray(l.options)?editDialogForm.component.select.options=l.options.map(v=>""+v):editDialogForm.component.select.fnOptionsStr=l.options.toString(),editDialogForm.component.select.selectOptionSeparator=l.selectOptionSeparator||"",editDialogForm.component.select.notAllowCreate=!!l.notAllowCreate,editDialogForm.component.select.multiple=!!l.multiple,l.multiple?editDialogForm.component.select.mValue=l.value:editDialogForm.component.select.value=l.value}else if(e.componentType==="FileInput"){const l=e;editDialogForm.component.fileInput.verifyPath=!!l.verifyPath,editDialogForm.component.fileInput.suffix=l.suffix||"",editDialogForm.component.fileInput.multiple=!!l.multiple,l.multiple?editDialogForm.component.fileInput.mValue=l.value:editDialogForm.component.fileInput.value=l.value}else if(e.componentType==="input"){const l=e;editDialogForm.component.input.value=l.value}else if(e.componentType==="RectInput"){const l=e;editDialogForm.component.rectInput.value=l.value,editDialogForm.component.rectInput.targetSrc=l.targetSrc||""}else if(e.componentType==="slider"){const l=e;editDialogForm.component.slider.value=l.value,editDialogForm.component.slider.range=l.range}else if(e.componentType==="switch"){const l=e;editDialogForm.component.switch.value=l.value,editDialogForm.component.switch.activeText=l.activeText||"是",editDialogForm.component.switch.inactiveText=l.inactiveText||"否"}else if(e.componentType==="DirInput"){const l=e;editDialogForm.component.dirInput.value=l.value,editDialogForm.component.dirInput.suffix=l.suffix||"",editDialogForm.component.dirInput.verifyPath=!!l.verifyPath}else if(e.componentType==="numberInput"){const l=e;editDialogForm.component.numberInput.value=l.value}else if(e.componentType==="numberRangeInput"){const l=e;editDialogForm.component.numberRangeInput.value=l.value,editDialogForm.component.numberRangeInput.limit=l.limit||[0,0]}editDialogForm.dialog.targetId=o,editDialogForm.dialog.visible=!0}else ElMessage.error("编辑失败：未找到对应参数!")},editDialogCallback=()=>{const target=model.value?.find(o=>o.id===editDialogForm.dialog.targetId&&o.componentType===editDialogForm.componentType);if(target){if(target.componentType==="DirInput")target.suffix=editDialogForm.component.dirInput.suffix,target.verifyPath=editDialogForm.component.dirInput.verifyPath,target.value=editDialogForm.component.dirInput.value;else if(target.componentType==="FileInput"){if(editDialogForm.component.fileInput.multiple){const o=target;o.multiple=!0,o.value=editDialogForm.component.fileInput.mValue}else{const o=target;o.multiple=!1,o.value=editDialogForm.component.fileInput.value}target.suffix=editDialogForm.component.fileInput.suffix,target.verifyPath=editDialogForm.component.fileInput.verifyPath}else if(target.componentType==="input")target.value=editDialogForm.component.input.value;else if(target.componentType==="RectInput")target.value=editDialogForm.component.rectInput.value,target.targetSrc=editDialogForm.component.rectInput.targetSrc;else if(target.componentType==="slider")target.value=editDialogForm.component.slider.value,target.range=editDialogForm.component.slider.range;else if(target.componentType==="switch")target.value=editDialogForm.component.switch.value,target.activeText=editDialogForm.component.switch.activeText,target.inactiveText=editDialogForm.component.switch.inactiveText;else if(target.componentType==="numberInput")target.value=editDialogForm.component.numberInput.value;else if(target.componentType==="numberRangeInput")target.value=editDialogForm.component.numberRangeInput.value,target.limit=editDialogForm.component.numberRangeInput.limit;else{const{multiple}=editDialogForm.component.select;editDialogForm.component.select.optionType==="array"?target.options=editDialogForm.component.select.options:target.options=eval(editDialogForm.component.select.fnOptionsStr);const t=target;multiple?(t.value=editDialogForm.component.select.mValue,t.multiple=!0):(t.value=editDialogForm.component.select.value,t.multiple=!1),target.selectOptionSeparator=editDialogForm.component.select.selectOptionSeparator,target.notAllowCreate=editDialogForm.component.select.notAllowCreate}target.name=editDialogForm.name,target.label=editDialogForm.label,target.displayCondition=editDialogForm.displayCondition,target.placeholder=editDialogForm.placeholder,target.noTest=editDialogForm.noTest,target.onlyTest=editDialogForm.onlyTest,ElMessage.success("编辑成功")}else ElMessage.error("编辑失败：未找到对应参数!");editDialogForm.dialog.visible=!1},delArg=o=>{model.value=model.value?.filter(e=>e.id!==o),ElMessage.success("删除成功")};return(o,e)=>{const l=ElOption,f=ElSelect,v=ElInput,s=ElFormItem,p=ElSwitch,N=__unplugin_components_5,T=ElInputNumber,V=__unplugin_components_7,g=_sfc_main$4,C=ElForm,$=_sfc_main$5,B=ElText,k=ElDivider,b=__unplugin_components_13$1;return openBlock(),createElementBlock(Fragment,null,[createVNode($,{callback:editDialogCallback,title:"修改参数",modelValue:unref(editDialogForm).dialog.visible,"onUpdate:modelValue":e[36]||(e[36]=n=>unref(editDialogForm).dialog.visible=n)},{element:withCtx(()=>[createBaseVNode("div",_hoisted_1$2,[createVNode(C,{"label-position":"left","label-width":"150px",model:unref(editDialogForm)},{default:withCtx(()=>[createVNode(s,{label:"字段命名",prop:"name"},{default:withCtx(()=>[props.documentParams.length?(openBlock(),createBlock(f,{key:0,modelValue:unref(editDialogForm).name,"onUpdate:modelValue":e[0]||(e[0]=n=>unref(editDialogForm).name=n),filterable:"","allow-create":""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(props.documentParams,n=>(openBlock(),createBlock(l,{key:n.id,label:n.name,value:n.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(openBlock(),createBlock(v,{key:1,modelValue:unref(editDialogForm).name,"onUpdate:modelValue":e[1]||(e[1]=n=>unref(editDialogForm).name=n)},null,8,["modelValue"]))]),_:1}),createVNode(s,{label:"字段标签",prop:"label"},{default:withCtx(()=>[createVNode(v,{modelValue:unref(editDialogForm).label,"onUpdate:modelValue":e[2]||(e[2]=n=>unref(editDialogForm).label=n)},null,8,["modelValue"])]),_:1}),createVNode(s,{label:"不在API调试中使用",prop:"noTest"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).noTest,"onUpdate:modelValue":e[3]||(e[3]=n=>unref(editDialogForm).noTest=n),onChange:onNoTestChange},null,8,["modelValue"])]),_:1}),createVNode(s,{label:"仅在API调试中使用",prop:"onlyTest"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).onlyTest,"onUpdate:modelValue":e[4]||(e[4]=n=>unref(editDialogForm).onlyTest=n),onChange:onOnlyTestChange},null,8,["modelValue"])]),_:1}),createVNode(s,{label:"显示条件",prop:"displayCondition"},{default:withCtx(()=>[createVNode(f,{modelValue:unref(editDialogForm).displayCondition,"onUpdate:modelValue":e[5]||(e[5]=n=>unref(editDialogForm).displayCondition=n),multiple:"",placeholder:"选择被依赖的字段，当被依赖字段值为true时本字段才显示"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(displayConditionOption),n=>(openBlock(),createBlock(l,{key:n.id,label:n.name+`(${n.label})`,value:n.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),createVNode(s,{label:"输入提示",prop:"placeholder"},{default:withCtx(()=>[createVNode(v,{modelValue:unref(editDialogForm).placeholder,"onUpdate:modelValue":e[6]||(e[6]=n=>unref(editDialogForm).placeholder=n)},null,8,["modelValue"])]),_:1}),unref(editDialogForm).componentType==="DirInput"?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(s,{label:"后缀",prop:"component.dirInput.suffix"},{default:withCtx(()=>[createVNode(v,{modelValue:unref(editDialogForm).component.dirInput.suffix,"onUpdate:modelValue":e[7]||(e[7]=n=>unref(editDialogForm).component.dirInput.suffix=n)},null,8,["modelValue"])]),_:1}),createVNode(s,{label:"验证路径",prop:"component.dirInput.verifyPath"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.dirInput.verifyPath,"onUpdate:modelValue":e[8]||(e[8]=n=>unref(editDialogForm).component.dirInput.verifyPath=n)},null,8,["modelValue"])]),_:1}),createVNode(s,{label:"默认值",prop:"component.dirInput.value"},{default:withCtx(()=>[createVNode(v,{modelValue:unref(editDialogForm).component.dirInput.value,"onUpdate:modelValue":e[9]||(e[9]=n=>unref(editDialogForm).component.dirInput.value=n)},null,8,["modelValue"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="FileInput"?(openBlock(),createElementBlock(Fragment,{key:1},[createVNode(s,{label:"后缀",prop:"component.fileInput.suffix"},{default:withCtx(()=>[createVNode(v,{modelValue:unref(editDialogForm).component.fileInput.suffix,"onUpdate:modelValue":e[10]||(e[10]=n=>unref(editDialogForm).component.fileInput.suffix=n)},null,8,["modelValue"])]),_:1}),createVNode(s,{label:"验证路径",prop:"component.fileInput.verifyPath"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.fileInput.verifyPath,"onUpdate:modelValue":e[11]||(e[11]=n=>unref(editDialogForm).component.fileInput.verifyPath=n)},null,8,["modelValue"])]),_:1}),createVNode(s,{label:"是否多选",prop:"component.fileInput.multiple"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.fileInput.multiple,"onUpdate:modelValue":e[12]||(e[12]=n=>unref(editDialogForm).component.fileInput.multiple=n)},null,8,["modelValue"])]),_:1}),unref(editDialogForm).component.fileInput.multiple?(openBlock(),createBlock(s,{key:0,label:"默认值",prop:"component.fileInput.mValue"},{default:withCtx(()=>[createVNode(f,{modelValue:unref(editDialogForm).component.fileInput.mValue,"onUpdate:modelValue":e[13]||(e[13]=n=>unref(editDialogForm).component.fileInput.mValue=n),multiple:"","allow-create":"",filterable:""},null,8,["modelValue"])]),_:1})):(openBlock(),createBlock(s,{key:1,label:"默认值",prop:"component.fileInput.value"},{default:withCtx(()=>[createVNode(v,{modelValue:unref(editDialogForm).component.fileInput.value,"onUpdate:modelValue":e[14]||(e[14]=n=>unref(editDialogForm).component.fileInput.value=n)},null,8,["modelValue"])]),_:1}))],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="input"?(openBlock(),createBlock(s,{key:2,label:"默认值",prop:"component.input.value"},{default:withCtx(()=>[createVNode(v,{modelValue:unref(editDialogForm).component.input.value,"onUpdate:modelValue":e[15]||(e[15]=n=>unref(editDialogForm).component.input.value=n)},null,8,["modelValue"])]),_:1})):createCommentVNode("",!0),unref(editDialogForm).componentType==="RectInput"?(openBlock(),createElementBlock(Fragment,{key:3},[createVNode(s,{label:"目标图片路径",prop:"component.rectInput.targetSrc"},{default:withCtx(()=>[createVNode(v,{modelValue:unref(editDialogForm).component.rectInput.targetSrc,"onUpdate:modelValue":e[16]||(e[16]=n=>unref(editDialogForm).component.rectInput.targetSrc=n)},null,8,["modelValue"])]),_:1}),createVNode(s,{label:"默认值",prop:"component.rectInput.value"},{default:withCtx(()=>[createVNode(N,{modelValue:unref(editDialogForm).component.rectInput.value,"onUpdate:modelValue":e[17]||(e[17]=n=>unref(editDialogForm).component.rectInput.value=n)},null,8,["modelValue"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="select"?(openBlock(),createElementBlock(Fragment,{key:4},[createVNode(s,{label:"选项类型",prop:"component.select.optionType"},{default:withCtx(()=>[createVNode(f,{modelValue:unref(editDialogForm).component.select.optionType,"onUpdate:modelValue":e[18]||(e[18]=n=>unref(editDialogForm).component.select.optionType=n)},{default:withCtx(()=>[createVNode(l,{label:"数组",value:"array"}),createVNode(l,{label:"函数",value:"function"})]),_:1},8,["modelValue"])]),_:1}),unref(editDialogForm).component.select.optionType==="array"?(openBlock(),createBlock(s,{key:0,label:"选项",prop:"component.select.options"},{default:withCtx(()=>[createVNode(f,{modelValue:unref(editDialogForm).component.select.options,"onUpdate:modelValue":e[19]||(e[19]=n=>unref(editDialogForm).component.select.options=n),multiple:"",filterable:"","allow-create":""},null,8,["modelValue"])]),_:1})):(openBlock(),createBlock(s,{key:1,label:"选项",prop:"component.select.fnOptionsStr"},{default:withCtx(()=>[createVNode(v,{modelValue:unref(editDialogForm).component.select.fnOptionsStr,"onUpdate:modelValue":e[20]||(e[20]=n=>unref(editDialogForm).component.select.fnOptionsStr=n)},null,8,["modelValue"])]),_:1})),createVNode(s,{label:"选项分隔符",prop:"component.select.selectOptionSeparator"},{default:withCtx(()=>[createVNode(v,{modelValue:unref(editDialogForm).component.select.selectOptionSeparator,"onUpdate:modelValue":e[21]||(e[21]=n=>unref(editDialogForm).component.select.selectOptionSeparator=n)},null,8,["modelValue"])]),_:1}),createVNode(s,{label:"是否多选",prop:"component.select.multiple"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.select.multiple,"onUpdate:modelValue":e[22]||(e[22]=n=>unref(editDialogForm).component.select.multiple=n)},null,8,["modelValue"])]),_:1}),unref(editDialogForm).component.select.multiple?(openBlock(),createBlock(s,{key:2,label:"不允许新建",prop:"component.select.notAllowCreate"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.select.notAllowCreate,"onUpdate:modelValue":e[23]||(e[23]=n=>unref(editDialogForm).component.select.notAllowCreate=n)},null,8,["modelValue"])]),_:1})):createCommentVNode("",!0),unref(editDialogForm).component.select.multiple?(openBlock(),createBlock(s,{key:3,label:"默认值",prop:"component.select.mValue"},{default:withCtx(()=>[createVNode(f,{modelValue:unref(editDialogForm).component.select.mValue,"onUpdate:modelValue":e[24]||(e[24]=n=>unref(editDialogForm).component.select.mValue=n),multiple:"","allow-create":!unref(editDialogForm).component.select.notAllowCreate,filterable:""},{default:withCtx(()=>[unref(editDialogForm).component.select.optionType==="array"?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(unref(editDialogForm).component.select.options,n=>(openBlock(),createBlock(l,{key:n,label:n,value:n},null,8,["label","value"]))),128)):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(parseFnStr(unref(editDialogForm).component.select.fnOptionsStr),n=>(openBlock(),createBlock(l,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue","allow-create"])]),_:1})):(openBlock(),createBlock(s,{key:4,label:"默认值",prop:"component.select.value"},{default:withCtx(()=>[createVNode(f,{modelValue:unref(editDialogForm).component.select.value,"onUpdate:modelValue":e[25]||(e[25]=n=>unref(editDialogForm).component.select.value=n),"allow-create":!unref(editDialogForm).component.select.notAllowCreate,filterable:""},{default:withCtx(()=>[unref(editDialogForm).component.select.optionType==="array"?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(unref(editDialogForm).component.select.options,n=>(openBlock(),createBlock(l,{key:n,label:n,value:n},null,8,["label","value"]))),128)):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(parseFnStr(unref(editDialogForm).component.select.fnOptionsStr),n=>(openBlock(),createBlock(l,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue","allow-create"])]),_:1}))],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="slider"?(openBlock(),createElementBlock(Fragment,{key:5},[createVNode(s,{label:"最小值",prop:"component.slider.range.min"},{default:withCtx(()=>[createVNode(T,{modelValue:unref(editDialogForm).component.slider.range.min,"onUpdate:modelValue":e[26]||(e[26]=n=>unref(editDialogForm).component.slider.range.min=n)},null,8,["modelValue"])]),_:1}),createVNode(s,{label:"最大值",prop:"component.slider.range.max"},{default:withCtx(()=>[createVNode(T,{modelValue:unref(editDialogForm).component.slider.range.max,"onUpdate:modelValue":e[27]||(e[27]=n=>unref(editDialogForm).component.slider.range.max=n)},null,8,["modelValue"])]),_:1}),createVNode(s,{label:"步长",prop:"component.slider.range.step"},{default:withCtx(()=>[createVNode(T,{modelValue:unref(editDialogForm).component.slider.range.step,"onUpdate:modelValue":e[28]||(e[28]=n=>unref(editDialogForm).component.slider.range.step=n)},null,8,["modelValue"])]),_:1}),createVNode(s,{label:"默认值",prop:"component.slider.value"},{default:withCtx(()=>[createVNode(V,{modelValue:unref(editDialogForm).component.slider.value,"onUpdate:modelValue":e[29]||(e[29]=n=>unref(editDialogForm).component.slider.value=n),step:unref(editDialogForm).component.slider.range.step,min:unref(editDialogForm).component.slider.range.min,max:unref(editDialogForm).component.slider.range.max,width:100,label:"默认值","hide-label":""},null,8,["modelValue","step","min","max"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="switch"?(openBlock(),createElementBlock(Fragment,{key:6},[createVNode(s,{label:"开启文本",prop:"component.switch.activeText"},{default:withCtx(()=>[createVNode(v,{modelValue:unref(editDialogForm).component.switch.activeText,"onUpdate:modelValue":e[30]||(e[30]=n=>unref(editDialogForm).component.switch.activeText=n)},null,8,["modelValue"])]),_:1}),createVNode(s,{label:"关闭文本",prop:"component.switch.inactiveText"},{default:withCtx(()=>[createVNode(v,{modelValue:unref(editDialogForm).component.switch.inactiveText,"onUpdate:modelValue":e[31]||(e[31]=n=>unref(editDialogForm).component.switch.inactiveText=n)},null,8,["modelValue"])]),_:1}),createVNode(s,{label:"默认值",prop:"component.switch.value"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.switch.value,"onUpdate:modelValue":e[32]||(e[32]=n=>unref(editDialogForm).component.switch.value=n),"active-text":unref(editDialogForm).component.switch.activeText,"inactive-text":unref(editDialogForm).component.switch.inactiveText},null,8,["modelValue","active-text","inactive-text"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="numberInput"?(openBlock(),createBlock(s,{key:7,label:"默认值",prop:"component.numberInput.value"},{default:withCtx(()=>[createVNode(T,{modelValue:unref(editDialogForm).component.numberInput.value,"onUpdate:modelValue":e[33]||(e[33]=n=>unref(editDialogForm).component.numberInput.value=n)},null,8,["modelValue"])]),_:1})):createCommentVNode("",!0),unref(editDialogForm).componentType==="numberRangeInput"?(openBlock(),createElementBlock(Fragment,{key:8},[createVNode(s,{label:"范围限制",prop:"component.numberRangeInput.limit"},{default:withCtx(()=>[createVNode(g,{modelValue:unref(editDialogForm).component.numberRangeInput.limit,"onUpdate:modelValue":e[34]||(e[34]=n=>unref(editDialogForm).component.numberRangeInput.limit=n)},null,8,["modelValue"])]),_:1}),createVNode(s,{label:"默认值",prop:"component.numberRangeInput.value"},{default:withCtx(()=>[createVNode(g,{modelValue:unref(editDialogForm).component.numberRangeInput.value,"onUpdate:modelValue":e[35]||(e[35]=n=>unref(editDialogForm).component.numberRangeInput.value=n),limit:unref(editDialogForm).component.numberRangeInput.limit},null,8,["modelValue","limit"])]),_:1})],64)):createCommentVNode("",!0)]),_:1},8,["model"])])]),_:1},8,["modelValue"]),createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[createVNode(B,null,{default:withCtx(()=>e[39]||(e[39]=[createTextVNode("预设组件")])),_:1}),createVNode(k),createVNode(unref(lo),{modelValue:unref(localArgs),"onUpdate:modelValue":e[37]||(e[37]=n=>isRef(localArgs)?localArgs.value=n:null),animation:150,group:{name:"args",pull:"clone",put:!1},ghostClass:"ghost",clone,sort:!1},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(localArgs),n=>(openBlock(),createBlock(b,{key:n.id,argItem:n},null,8,["argItem"]))),128))]),_:1},8,["modelValue"])]),createBaseVNode("div",_hoisted_4$2,[createVNode(B,null,{default:withCtx(()=>e[40]||(e[40]=[createTextVNode("弹窗参数组件")])),_:1}),createVNode(k),createVNode(unref(lo),{"h-full":"","w-full":"",modelValue:model.value,"onUpdate:modelValue":e[38]||(e[38]=n=>model.value=n),animation:150,group:{name:"args"},ghostClass:"ghost",sort:!0},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(model.value,n=>(openBlock(),createBlock(b,{key:n.id,argItem:n,edit:"",onOnEdit:editArg,onOnDelete:delArg},null,8,["argItem"]))),128))]),_:1},8,["modelValue"])])])],64)}}}),__unplugin_components_13=_export_sfc(_sfc_main$2,[["__scopeId","data-v-9fcfe28b"]]),defaultInvokeTemplateOptions=()=>({name:"",scope:"",weight:1,disabled:!1,document:{howToUse:"",params:[],returnValue:{instructions:"",type:"void"},example:{title:"",code:""},searchKeys:[],codeSnippet:""},dialog:{title:"",content:"",args:[],notOpen:!1}});class InvokeTemplate{options;contentCache={};constructor(o){o.scope=o.scope||"",o.weight=o.weight||5,o.disabled=o.disabled!==void 0?o.disabled:!1,this.options=o}genParamList(){const o=this.options.document.params;return o?o.map(e=>{const l=Array.isArray(e.type)?e.type.map(f=>`"${f}"`).join(" | "):e.type;return e.default?`${e.name}: ${l} = ${e.type==="string"||Array.isArray(e.type)?`'${e.default}'`:e.default},`:l.trim().length?`${e.name}${e.required?"":"?"}: ${l},`:`${e.name},`}).join(`
  `):""}genArgList(){const o=this.options.dialog.args;if(o){const e=JSON.stringify(o,null,2),l=/"([^"]+)":/g;return e.replace(l,"$1:")}else return""}genCBOptionNames(){const o=this.options.dialog.args;return o?o.map(e=>e.name).join(", "):""}genCBOption(){const o=this.options.dialog.args;return o?.length?`${o.map(e=>{let l="string";const f=["numberInput","numberRangeInput","slider"];return e.componentType==="switch"?l="boolean":e.componentType==="RectInput"?l=`{
      x: number;
      y: number;
      width: number;
      height: number;
    }`:f.includes(e.componentType)&&(l="number"),`${e.name}: ${l}`}).join(`;
    `)};
    `:""}defaultSnippet(){const{returnValue:o,params:e}=this.options.document;let l="";if(o?.type){const f=o.type.toLocaleLowerCase();let v=0;o.type.toLocaleLowerCase()!=="promise<void>"&&o.type.toLocaleLowerCase()!=="void"&&o.type.toLocaleLowerCase()!=="undefined"&&(l="${1:const res = }",v++);const s=e?.map(p=>`\${${++v}:${Array.isArray(p.type)?p.type[0]:p.type==="string"?`'${p.name}'`:p.name}}`||"").join(", ")||"";l+=`${f.includes("promise")?"await ":""}${this.options.name}(${s});\${0:}`}return l}get indexTemplate(){return`import { apiDocument } from "./document";
import { ${this.options.name}Fn } from "./exportFn";
import { modelCallback } from "./modelCallback";
import { dialogOptions } from "./dialog";
import { declaration } from "./declaration";
import { auxiliary } from "./auxiliary";
export const ${this.options.name}Api = <InvokeApiMethodType>{
  ${this.options.scope.length?`scope: '${this.options.scope}',
  `:""}name: "${this.options.name}",
  exportFn: {
    fn: ${this.options.name}Fn,
  },
  testModule: {
    weight: ${this.options.weight},
    dialog: dialogOptions,
    callback: modelCallback,
    document: apiDocument,
  },
  //提供给编辑器的类型声明
  declaration,
  //编辑-快速填写或修改方法参数 辅助模块
  auxiliary${this.options.disabled?`,
  disabled: true`:""}
};`}genRetract(o,e=2){return" ".repeat(o*e)}genParamListStr(o,e=2){return`[${o?`
`+this.genRetract(e):""}${o?o.map(l=>`{
${this.genRetract(e+1)}name: "${l.name}",
${this.genRetract(e+1)}required: ${l.required?"true":"false"},
${this.genRetract(e+1)}instructions: "${l.instructions}",
${this.genRetract(e+1)}type: ${Array.isArray(l.type)?`[${l.type.map(f=>`'${f}'`).join(", ")}]`:`'${l.type}'`},
${this.genRetract(e+1)}default: "${l.type==="string"?`${l.default.includes('"')||l.default.includes("'")?`'${l.default}'`:l.default}`:l.default}",
${this.genRetract(e+1)}children: ${this.genParamListStr(l.children,e+2)}
${this.genRetract(e)}}`).join(`,
`+this.genRetract(e)):""}${o?`
`+this.genRetract(e-1):""}]`}get documentTemplate(){const d=this.options.document,prefixStr="export const apiDocument = <ApiDocumentType>",tempStr=`{
  howToUse: "${d.howToUse}",
  params: ${this.genParamListStr(d.params)},
  returnValue: {
    ${d?.returnValue?.instructions?`instructions: "${d.returnValue.instructions}",
    `:""}type: \`${d?.returnValue?.type||""}\`,
  },
  example: {
    ${d?.example?.title?`title: "${d.example.title.replace(/"/g,"'")}",`:'title: "",'}
    code: \`${d?.example?.code||""}\`,
  },
  searchKeys: [${d?.searchKeys?.map(o=>`'${o}'`).join(", ")}],
  codeSnippet:
    "${d?.codeSnippet||this.defaultSnippet()}",
};`;try{let res=JSON.stringify(eval(`const t = ${tempStr};t`),void 0,2);const regex=/"([^"]+)":/g;return res=res.replace(regex,"$1:"),`${prefixStr}${res}`}catch(o){return`${prefixStr}${tempStr}`}}get exportFnTemplate(){const o=this.options.name;return`export const ${o}Fn = async (
  ${this.genParamList()}
  taskId?: string
) => {
  const { notAllowedFnId } = useScriptRuntime();
  if (taskId && notAllowedFnId.value.includes(taskId)) {
    return false;
  }
  try {
    //TODO
  } catch (e) {
    console.error("${o}FnError: ", e);
  }
};`}get declaration(){return`export const declaration = \`${this.options.scope.length?"":"declare "}function ${this.options.name}(
  ${this.genParamList()}
): ${this.options.document.returnValue?.type||"void"};
\`;`}get dialogTemplate(){const{title:o,notOpen:e,content:l,args:f}=this.options.dialog;return`export const dialogOptions = <TestModuleDialogType>{
  ${e?`notOpen: true,
  `:""}${o?`title: "${o}",
  `:""}targetMethodName: "${this.options.name}",
  ${l?`content: "${l}",
  `:""}args: ${f?this.genArgList():"[]"}
};`}get dialogCBTemplate(){const{name:o,scope:e,document:l,dialog:f}=this.options,v=l.example?.code.replace(/\(.*\)/,`(${this.genCBOptionNames()})`);return f.notOpen?`export const modelCallback = async (
  _options: {
    ${this.genCBOption()}replaceCurFnArgs?: (targetArgs: string) => void;
  },
  testModuleCtx: {
    showDetails: ShowDetailsFn;
  }
) => {
  testModuleCtx.showDetails("此方法无法直接调用，请在脚本中使用！", "${e.length?`${e}.`:""}${o}");
};`:`import { auxiliary } from "./auxiliary";
import { ${o}Fn } from "./exportFn";
export const modelCallback = async (
  options: {
    ${this.genCBOption()}replaceCurFnArgs?: (targetArgs: string) => void;
  },
  testModuleCtx: {
    showDetails: ShowDetailsFn;
  }
) => {
  if (options.replaceCurFnArgs) {
    //快速填写或修改方法参数弹窗点击确定时
    auxiliary.parameterReplace(options);
    AutoTipUtils.apiAutoTip();
    return;
  }
  //测试调用时
  const { ${this.genCBOptionNames()} } = options;
  console.time("${o}耗时");
  const res = await ${o}Fn(${this.genCBOptionNames()});
  console.timeEnd("${o}耗时");
  const selfModule = getInvokeApiMethods().find((i) => i.name === "${o}"${e.length?` && i.scope === "${e}"`:""})?.testModule!;
  //修改示例代码
  selfModule.document!.example!.code = \`${v}\`;
  testModuleCtx.showDetails(JSON.stringify(res), "${e.length?`${e}.`:""}${o}");
};
`}get auxiliaryTemplate(){const{name:o,scope:e}=this.options;return`export const auxiliary = <AuxiliaryType>{
  //快速编辑/修改参数弹窗打开时触发
  onDialogOpen: async (_close,...args) => {
    //处理来自编辑器的参数
    const params = await AutoTipUtils.paramsProcess(...args);
    const selfModule = getInvokeApiMethods().find((i) => i.name === "${o}"${e.length?` && i.scope === "${e}"`:""});
    const dialog = selfModule!.testModule!.dialog;
    if (!dialog.args) {
      return;
    }
    //根据参数的位置给弹窗对应的组件进行回填赋值
    dialog.args.forEach((i, index) => {
      /**
       * 例如函数本身有5个参数，而弹窗只有两个参数，params为编辑器中输入的5个参数，
       * index为弹窗中的参数位置，i.value为弹窗中组件的值
       * @example:
      switch (index) {
        case 0:
          //第一个参数为RectInput组件的值，刚好是函数前四个参数，故赋值如下
          i.value = {
            x: +params[0] || 0,
            y: +params[1] || 0,
            width: +params[2] || 0,
            height: +params[3] || 0,
          };
          break;
        case 1:
          //第二个参数为FileInput组件的值，AutoTipUtils.pathStrReset用来处理路径字符串
          i.value = AutoTipUtils.pathStrReset(params[4] || "");
          break;
        default:
          break;
      }
      */
    });
  },
  /**
   * 参数处理方法, 快速填写/修改参数弹窗点击确定时，会将弹窗中组件的值传入options，
   * 并且提供一个replaceCurFnArgs方法用来替换编辑器中当前函数的参数
  */
  parameterReplace: (options: {
    ${this.genCBOption()}replaceCurFnArgs: (targetArgs: string) => void;
  }) => {
    //根据实际情况去替换编辑器中的参数
    options.replaceCurFnArgs(
        ""/*替换后的参数字符串*/
    );
  },
};
`}async create(){const{scope:o,name:e}=this.options;try{const l=await pathUtils.resolve(await pathUtils.getInstallDir(),"../../../src/invokes/"),f=await pathUtils.resolve(l,o.length?`${o}/${e}`:e),v=await pathUtils.join(f,"index.ts"),s=await pathUtils.join(f,"document.ts"),p=await pathUtils.join(f,"exportFn.ts"),N=await pathUtils.join(f,"dialog.ts"),T=await pathUtils.join(f,"auxiliary.ts"),V=await pathUtils.join(f,"declaration.ts"),g=await pathUtils.join(f,"modelCallback.ts");return await Promise.all([fsUtils.writeFile(v,this.indexTemplate),fsUtils.writeFile(s,this.documentTemplate),fsUtils.writeFile(p,this.exportFnTemplate),fsUtils.writeFile(N,this.dialogTemplate),fsUtils.writeFile(T,this.auxiliaryTemplate),fsUtils.writeFile(V,this.declaration),fsUtils.writeFile(g,this.dialogCBTemplate)]),!0}catch{return!1}}async syncOtherFileName(o,e){const l=this.options.name,f=new RegExp(`i\\.name\\s?={2,3}\\s?[\`"']${e}[\`"']`,"g");try{const v=await pathUtils.resolve(o,"../exportFn.ts");let s;this.contentCache[v]?s=this.contentCache[v]:s=await fsUtils.readFile(v);const p=s.replace(new RegExp(`${e}Fn`,"g"),l+"Fn"),N=await pathUtils.resolve(o,"../auxiliary.ts");let T;this.contentCache[N]?T=this.contentCache[N]:T=await fsUtils.readFile(N);const V=T.replace(f,`i.name === "${l}"`),g=await pathUtils.resolve(o,"../declaration.ts");let C;this.contentCache[g]?C=this.contentCache[g]:C=await fsUtils.readFile(g);const $=C.replace(new RegExp(`function ${e}`,"g"),`function ${l}`),B=await pathUtils.resolve(o,"../modelCallback.ts");let k;this.contentCache[B]?k=this.contentCache[B]:k=await fsUtils.readFile(B);let b=k.replace(new RegExp(`${e}Fn`,"g"),`${l}Fn`);b=b.replace(new RegExp(`${e}耗时`,"g"),`${l}耗时`),b=b.replace(f,`i.name === "${l}"`),b=b.replace(new RegExp(`"${e}"`,"g"),`"${l}"`),b=b.replace(new RegExp(`\\.${e}`,"g"),`.${l}`),b=b.replace(new RegExp(`${e}\\(`,"g"),`${l}(`);const n=await pathUtils.resolve(o,"../document.ts");let E;this.contentCache[n]?E=this.contentCache[n]:E=await fsUtils.readFile(n);const R=E.replace(new RegExp(`${e}\\(`,"g"),`${l}(`);await Promise.all([fsUtils.writeFile(v,p),fsUtils.writeFile(N,V),fsUtils.writeFile(g,$),fsUtils.writeFile(B,b),fsUtils.writeFile(n,R)]),this.contentCache[v]=s,this.contentCache[N]=T,this.contentCache[g]=C,this.contentCache[B]=k,this.contentCache[n]=E}catch(v){console.error("syncOtherFileName error:",v)}}async syncOtherFileScope(o,e){const l=this.options.scope,f=new RegExp(`i\\.scope\\s?={2,3}\\s?[\`"']${e}[\`"']`,"g"),v=`i.scope === "${l}"`;try{const s=await pathUtils.resolve(o,"../auxiliary.ts");let p;this.contentCache[s]?p=this.contentCache[s]:p=await fsUtils.readFile(s);const N=p.replace(f,v),T=await pathUtils.resolve(o,"../modelCallback.ts");let V;this.contentCache[T]?V=this.contentCache[T]:V=await fsUtils.readFile(T);let g=V.replace(f,`i.scope === "${l}"`);g=g.replace(new RegExp(`${e}\\.`,"g"),`${l}.`);const C=await pathUtils.resolve(o,"../document.ts");let $;this.contentCache[C]?$=this.contentCache[C]:$=await fsUtils.readFile(C);const B=$.replace(new RegExp(`${e}\\.`,"g"),`${l}.`),k=await pathUtils.resolve(o,"../declaration.ts");let b;this.contentCache[k]?b=this.contentCache[k]:b=await fsUtils.readFile(k);let n=b;this.options.scope.trim().length?n=b.replace(/declare /,""):n.includes("declare function")||(n=B.replace(/function /,"declare function ")),await Promise.all([fsUtils.writeFile(s,N),fsUtils.writeFile(T,g),fsUtils.writeFile(C,B),fsUtils.writeFile(k,n)]),this.contentCache[s]=p,this.contentCache[T]=V,this.contentCache[C]=$,this.contentCache[k]=b}catch(s){console.error("syncOtherFileScope error:",s)}}async applyIndexOptions(o,e){if(!await exists(o)){console.error(`文件${o}不存在`);return}let f;this.contentCache[o]?f=this.contentCache[o]:f=await fsUtils.readFile(o);const v={nameChanged:!1,scopeChanged:!1};let s=f;const p=await astWorker.parseInvokeApiConfig(f,e.name+"Api");return this.options.disabled&&(p.disabled===void 0?s=s.replace(/name:\s*['"`].*['"`],?/,`name: '${this.options.name}',
  disabled: true,`):s=s.replace(/disabled:\s*false,/,"disabled: true,")),p.testModule.weight!==this.options.weight&&(s=s.replace(/weight:\s*\d+,/,`weight: ${this.options.weight},`)),this.options.name!==p.name&&(s=s.replace(/fn:\s*.*Fn,/,`fn: ${this.options.name}Fn,`),s=s.replace(/import\s+\{\s*.*Fn\s*\}\s+from\s+".\/exportFn";?/,`import { ${this.options.name}Fn } from "./exportFn";`),s=s.replace(/export const .*Api\s*=/,`export const ${this.options.name}Api =`),s=s.replace(/name:\s*['"`].*['"`],?/,`name: '${this.options.name}',`),v.nameChanged=!0,await this.syncOtherFileName(o,p.name)),this.options.scope!==p.scope&&(p.scope!==void 0?s=s.replace(/scope:\s*['"`].*['"`],?/,this.options.scope.trim().length?`scope: '${this.options.scope}',`:""):this.options.scope.trim().length&&(s=s.replace(/name:\s*['"`].*['"`],?/,`scope: '${this.options.scope}',
  name: '${this.options.name}',`)),v.scopeChanged=!0,await this.syncOtherFileScope(o,p.scope)),s=s.replace(/^\s*\n/gm,""),s!==f&&(await fsUtils.writeFile(o,s),this.contentCache[o]=s),v}async applyDocumentOptions(documentFilePath){const exist=await exists(documentFilePath);if(!exist){console.error(`文件${documentFilePath}不存在`);return}let oldDocumentContent;this.contentCache[documentFilePath]?oldDocumentContent=this.contentCache[documentFilePath]:oldDocumentContent=await fsUtils.readFile(documentFilePath);const oldCode=eval(`${oldDocumentContent.replace("<ApiDocumentType>","").replace("export ","")};apiDocument`);let newCode=eval(`${this.documentTemplate.replace("<ApiDocumentType>","").replace("export ","")};apiDocument`);JSON.stringify(oldCode)!==JSON.stringify(newCode)&&(await fsUtils.writeFile(documentFilePath,this.documentTemplate),this.contentCache[documentFilePath]=this.documentTemplate)}async applyDialogOptions(dialogFilePath){const exist=await exists(dialogFilePath);if(!exist){console.error(`文件${dialogFilePath}不存在`);return}let oldDialogContent;this.contentCache[dialogFilePath]?oldDialogContent=this.contentCache[dialogFilePath]:oldDialogContent=await fsUtils.readFile(dialogFilePath);const oldCode=eval(`${oldDialogContent.replace("<TestModuleDialogType>","").replace("export ","")};dialogOptions`);let newCode=eval(`${this.dialogTemplate.replace("<TestModuleDialogType>","").replace("export ","")};dialogOptions`);JSON.stringify(oldCode)!==JSON.stringify(newCode)&&(await fsUtils.writeFile(dialogFilePath,this.dialogTemplate),this.contentCache[dialogFilePath]=this.dialogTemplate)}async apply(o,e){try{let l;e.scope?l=await pathUtils.resolve(o,"../../../"):l=await pathUtils.resolve(o,"../../");const f=await pathUtils.resolve(o,"../"),v=await pathUtils.resolve(l,`${this.options.scope.length?this.options.scope+"/":""}${this.options.name}`);if(await exists(await pathUtils.resolve(v,"index.ts")))return ElMessage.error(`${this.options.scope?this.options.scope+".":""}${this.options.name} 已存在,无法完成修改！`),!1;const p=await pathUtils.resolve(o,"../dialog.ts"),N=await pathUtils.resolve(o,"../document.ts"),T=await this.applyIndexOptions(o,e);if(await this.applyDocumentOptions(N),await this.applyDialogOptions(p),T?.nameChanged||T?.scopeChanged)if(await fsUtils.moveChildToNewDir(f,v))ElMessage.success("更新成功");else return console.error("更新失败",f,v,this.options.scope),ElMessage.error("更新失败"),!1;return!0}catch(l){return console.error("apply new options error:",l),!1}}}const _hoisted_1$1={"w-full":""},_hoisted_2$1={"w-full":"","box-border":"",flex:"","flex-col":""},_hoisted_3$1={class:"form-item"},_hoisted_4$1={class:"form-item"},_hoisted_5$1={class:"form-item"},_hoisted_6$1={flex:"","flex-row":"","flex-items-center":""},_hoisted_7$1={class:"form-item"},_hoisted_8={flex:"","flex-col":""},_hoisted_9={class:"form-item"},_hoisted_10={"i-mdi-chevron-down":""},_hoisted_11={"i-mdi-chevron-left":""},_hoisted_12={flex:"","flex-col":"","pl-5":"","box-border":"","mt-2":""},_hoisted_13={flex:"","flex-col":"","flex-items-start":"","mb-2":""},_hoisted_14={flex:"","flex-col":"","flex-items-start":"","mb-2":""},_hoisted_15={class:"value"},_hoisted_16={"w-full":"",flex:"","flex-row":"","flex-items-center":"","justify-center":""},_hoisted_17={flex:"","flex-col":"","flex-items-start":"","mb-2":"","w-full":""},_hoisted_18={"w-full":"","box-border":"","pl-2":""},_hoisted_19={class:"form-item","w-full":""},_hoisted_20={class:"value"},_hoisted_21={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","p-8px":""},_hoisted_22={flex:"","flex-col":"","flex-items-start":"","mb-2":"","w-full":""},_hoisted_23={"w-full":"","box-border":"","pl-2":""},_hoisted_24={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","p-8px":""},_hoisted_25={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","p-8px":""},_hoisted_26={flex:"","flex-row":"","flex-items-center":"","w-full":"","justify-between":"","pr-2":"","mb-2":"","box-border":""},_hoisted_27={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","pr-2":""},_hoisted_28={flex:"","flex-col":""},_hoisted_29={class:"form-item"},_hoisted_30={"i-mdi-chevron-down":""},_hoisted_31={"i-mdi-chevron-left":""},_hoisted_32={flex:"","flex-col":"","pl-5":"","box-border":"","w-full":"","pr-2":""},_hoisted_33={class:"form-item"},_hoisted_34={key:0},_hoisted_35={class:"form-item"},_hoisted_36={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","pl-8px":""},_hoisted_37={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","pl-8px":""},_hoisted_38={class:"form-item"},_hoisted_39={"i-mdi-chevron-down":""},_hoisted_40={"i-mdi-chevron-left":""},_hoisted_41={flex:"","flex-col":"","pl-5":"","box-border":"","w-full":"","pr-2":""},_sfc_main$1=defineComponent({__name:"InvokesManagerForm",props:mergeModels({scopeList:{type:Array,required:!0},anchorModel:{type:String,default:"horizontal"},anchorIdPrefix:{type:String,required:!0}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(o,{expose:e}){const l=useModel(o,"modelValue"),f=reactive([{name:"auxiliary",title:"辅助代码",code:"",show:!1,path:""},{name:"fn",title:"API本体",code:"",show:!1,path:""},{name:"cb",title:"《快捷输入/修改参数弹窗》回调代码",code:"",show:!1,path:""}]),v=async()=>{let h="";T.value.find(_=>(_.label===l.value.name?h=_.fullPath:_.children&&_.children.find(z=>{z.label===l.value.name&&(h=z.fullPath)}),!!h));const a=await pathUtils.resolve(h,"../auxiliary.ts"),c=f.find(_=>_.name==="auxiliary"),x=f.find(_=>_.name==="fn"),I=f.find(_=>_.name==="cb");if(await exists(a)){const _=await fsUtils.readFile(a);c.code=_,c.path=a}else c.code="",c.path="";const U=await pathUtils.resolve(h,"../exportFn.ts");if(await exists(U)){const _=await fsUtils.readFile(U);x.code=_,x.path=U}else x.code="",x.path="";const O=await pathUtils.resolve(h,"../modelCallback.ts");if(await exists(O)){const _=await fsUtils.readFile(O);I.code=_,I.path=O}else I.code="",I.path=""};watch(l,v,{deep:!0});const s=computed(()=>l.value.document.params),p=o,N=ref("");watchEffect(()=>{if(l.value.document,!l.value.document.codeSnippet?.trim().length){const h=new InvokeTemplate(l.value);N.value=h.defaultSnippet()}});const T=ref([]),V=ref(!0),g=ref(!0),C=()=>{if(l.value?.scope){let h=l.value.scope;l.value.scope=h.charAt(0).toUpperCase()+h.slice(1)}},{getApiModules:$}=useCore(),B=async()=>{const h=await $(!1,!0,!0),{groupRecordToOptions:a,dataGrouping:c}=dataStructureUtils,x=a(c(h,"scope"),"name","id",["disabled","id","fullPath","scope","testModule"]);T.value=x.map(I=>({...I,enabled:!I.disabled,disabled:!1,children:I.children?.map(U=>({...U,enabled:!U.disabled,disabled:!1}))}))};let k;onBeforeUnmount(()=>{k&&k()}),onMounted(async()=>{k=await listen("tauri://focus",h=>{v()},{target:getCurrentWebviewWindow().label}),await B(),v()});const b=(h,a)=>{const c=dataStructureUtils.findByIdInTree(a,l.value.document.params);c&&(h?(c.type=c.type.split("|"),c.type.includes(c.default)||(c.default=c.type[0])):c.type=c.type.join("|"))},n=["string","number","boolean","object","array","function","null","undefined"],E=(h,a)=>{const c=h?n.filter(U=>U.toLocaleLowerCase().includes(h.toLocaleLowerCase())):n,x=`'${h}'`;c.includes(x)||c.push(x);const I=`Promise<${h}>`;!c.includes(I)&&!c.includes(I.toLocaleLowerCase())&&!h.toLocaleLowerCase().includes("promise")&&c.push(I),!n.includes(h)&&!c.includes(h)&&(!h.includes("'")||!h.includes('"'))&&c.push(h),a(c.map(U=>({value:U})))},R=h=>{if(h===void 0)l.value.document.params?l.value.document.params.push({id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}):l.value.document.params=[{id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}];else{const a=dataStructureUtils.findByIdInTree(h,l.value.document.params);a&&(a.children?a.children.push({id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}):a.children=[{id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}])}},S=h=>{const a=dataStructureUtils.getTreeParentById(h,l.value.document.params);if(a){const c=a.findIndex(x=>x.id===h);if(c>0){if(!a[c].required&&a[c-1].required){ElMessage.warning("非必填参数不允许在必填参数之前");return}const x=a[c];a[c]=a[c-1],a[c-1]=x}}},q=h=>{const a=dataStructureUtils.getTreeParentById(h,l.value.document.params);if(a){const c=a.findIndex(x=>x.id===h);if(c<a.length-1){if(a[c].required&&!a[c+1].required){ElMessage.warning("必填参数不允许在非必填参数之后");return}const x=a[c];a[c]=a[c+1],a[c+1]=x}}},j=async h=>{if(h===void 0)try{await ElMessageBox.confirm("确定清空所有参数吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}),l.value.document.params=[],ElMessage.info("清空完成")}catch{}else try{await ElMessageBox.confirm("确定删除该参数吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"});const a=dataStructureUtils.getTreeParentById(h,l.value.document.params);a.splice(a.findIndex(c=>c.id===h),1),ElMessage.info("删除完成")}catch{}},J=(h,a)=>{a.required&&a.default!==""&&(a.default="");const c=dataStructureUtils.getTreeParentById(h,l.value.document.params);c&&c.sort((x,I)=>x.required===I.required?0:x.required?-1:1)};return e({codeSnippetPlaceholder:N,changeFormShow:h=>{switch(h){case 0:V.value=!0;break;case 1:g.value=!0;break;default:f[h-2].show=!0;break}}}),(h,a)=>{const c=ElText,x=ElInput,I=ElSwitch,U=ElOption,O=ElTag,_=ElSelect,z=ElInputNumber,A=ElIcon,P=ElButton,L=ElTableColumn,w=ElAutocomplete,m=ElCheckbox,i=ElTable,u=__unplugin_components_13,F=__unplugin_components_14;return openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,[createVNode(c,{tag:"b",id:p.anchorIdPrefix+"-api-name"},{default:withCtx(()=>a[19]||(a[19]=[createTextVNode("API名称")])),_:1},8,["id"]),createVNode(x,{modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=r=>l.value.name=r),placeholder:"API名称",style:{width:"240px"}},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_4$1,[createVNode(c,{tag:"b",id:p.anchorIdPrefix+"-api-state"},{default:withCtx(()=>a[20]||(a[20]=[createTextVNode("API状态")])),_:1},8,["id"]),createVNode(I,{modelValue:l.value.disabled,"onUpdate:modelValue":a[1]||(a[1]=r=>l.value.disabled=r),"active-text":"禁用","inactive-text":"启用",style:{"--el-switch-on-color":"#ff4949","--el-switch-off-color":"var(--el-color-primary)"}},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_5$1,[createVNode(c,{tag:"b",id:p.anchorIdPrefix+"-ns"},{default:withCtx(()=>a[21]||(a[21]=[createTextVNode("命名空间(namespace)")])),_:1},8,["id"]),createVNode(_,{modelValue:l.value.scope,"onUpdate:modelValue":a[2]||(a[2]=r=>l.value.scope=r),filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"Root",style:{width:"240px"},onChange:C},{label:withCtx(({label:r})=>[createBaseVNode("div",_hoisted_6$1,[p.scopeList.find(y=>y.label===r)?createCommentVNode("",!0):(openBlock(),createBlock(O,{key:0,size:"small",type:"success","mr-1":""},{default:withCtx(()=>a[22]||(a[22]=[createTextVNode("new")])),_:1})),createVNode(c,null,{default:withCtx(()=>[createTextVNode(toDisplayString(r),1)]),_:2},1024)])]),default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(p.scopeList,(r,y)=>(openBlock(),createBlock(U,{key:y,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),createBaseVNode("div",_hoisted_7$1,[createVNode(c,{tag:"b",id:p.anchorIdPrefix+"-weight"},{default:withCtx(()=>a[23]||(a[23]=[createTextVNode("显示权重(越大默认排序越靠前)")])),_:1},8,["id"]),createVNode(z,{modelValue:l.value.weight,"onUpdate:modelValue":a[3]||(a[3]=r=>l.value.weight=r),min:0,placeholder:"显示权重"},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_8,[createBaseVNode("div",_hoisted_9,[createVNode(c,{tag:"b",id:p.anchorIdPrefix+"-api-doc"},{default:withCtx(()=>a[24]||(a[24]=[createTextVNode("API文档")])),_:1},8,["id"]),createVNode(P,{link:"",onClick:a[4]||(a[4]=r=>V.value=!unref(V))},{default:withCtx(()=>[createVNode(A,{size:"large"},{default:withCtx(()=>[withDirectives(createBaseVNode("span",_hoisted_10,null,512),[[vShow,unref(V)]]),withDirectives(createBaseVNode("span",_hoisted_11,null,512),[[vShow,!unref(V)]])]),_:1})]),_:1})]),withDirectives(createBaseVNode("div",_hoisted_12,[createBaseVNode("div",_hoisted_13,[createVNode(c,{"self-start":"","mb-2":""},{default:withCtx(()=>a[25]||(a[25]=[createTextVNode("API使用介绍")])),_:1}),createVNode(x,{modelValue:l.value.document.howToUse,"onUpdate:modelValue":a[5]||(a[5]=r=>l.value.document.howToUse=r),type:"textarea",placeholder:"API使用介绍",autosize:""},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_14,[createVNode(c,{"self-start":"","mb-2":""},{default:withCtx(()=>a[26]||(a[26]=[createTextVNode("API参数")])),_:1}),createVNode(i,{data:l.value.document.params,"table-layout":"fixed","row-key":"id","default-expand-all":"",border:!0,"max-height":"75vh"},{default:withCtx(()=>[createVNode(L,{prop:"name",label:"参数名",fixed:"",width:"180"},{default:withCtx(r=>[createVNode(x,{modelValue:r.row.name,"onUpdate:modelValue":y=>r.row.name=y,placeholder:"参数名"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(L,{prop:"required",label:"必填",width:"70"},{default:withCtx(r=>[createVNode(I,{modelValue:r.row.required,"onUpdate:modelValue":y=>r.row.required=y,"active-text":"是","inactive-text":"否","inline-prompt":"",onChange:y=>J(r.row.id,r.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),createVNode(L,{prop:"instructions",label:"说明",width:"260"},{default:withCtx(r=>[createVNode(x,{modelValue:r.row.instructions,"onUpdate:modelValue":y=>r.row.instructions=y,type:"textarea",placeholder:"说明",size:"small",autosize:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(L,{prop:"type",label:"类型",width:"200"},{default:withCtx(r=>[Array.isArray(r.row.type)?(openBlock(),createBlock(_,{key:0,multiple:"",modelValue:r.row.type,"onUpdate:modelValue":y=>r.row.type=y,filterable:"","allow-create":""},null,8,["modelValue","onUpdate:modelValue"])):(openBlock(),createBlock(w,{key:1,modelValue:r.row.type,"onUpdate:modelValue":y=>r.row.type=y,"fetch-suggestions":E,clearable:"",placeholder:"请输入类型名称"},{default:withCtx(({item:y})=>[createBaseVNode("div",_hoisted_15,toDisplayString(y.value),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])),createVNode(m,{"ml-1":"",checked:Array.isArray(r.row.type),label:"枚举",size:"small",onChange:y=>b(y,r.row.id)},null,8,["checked","onChange"])]),_:1}),createVNode(L,{prop:"default",label:"默认值"},{default:withCtx(r=>[Array.isArray(r.row.type)?(openBlock(),createBlock(_,{key:0,modelValue:r.row.default,"onUpdate:modelValue":y=>r.row.default=y,size:"small",disabled:r.row.required,filterable:"","allow-create":"",clearable:""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(r.row.type,y=>(openBlock(),createBlock(U,{key:y,label:y,value:y},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])):(openBlock(),createBlock(x,{key:1,modelValue:r.row.default,"onUpdate:modelValue":y=>r.row.default=y,placeholder:"默认值",size:"small",disabled:r.row.required},null,8,["modelValue","onUpdate:modelValue","disabled"]))]),_:1}),createVNode(L,{fixed:"right",width:"100"},{header:withCtx(()=>[createVNode(P,{link:"",type:"danger",size:"large",onClick:a[6]||(a[6]=r=>j())},{default:withCtx(()=>[createVNode(A,{size:"large"},{default:withCtx(()=>a[27]||(a[27]=[createBaseVNode("span",{"i-mdi-sort-variant-remove":""},null,-1)])),_:1})]),_:1}),createVNode(P,{link:"",type:"primary",size:"large",onClick:a[7]||(a[7]=r=>R())},{default:withCtx(()=>[createVNode(A,{size:"large"},{default:withCtx(()=>a[28]||(a[28]=[createBaseVNode("span",{"i-mdi-playlist-plus":""},null,-1)])),_:1})]),_:1})]),default:withCtx(r=>[createBaseVNode("div",_hoisted_16,[createVNode(P,{link:"",class:"ml-1",type:"danger",onClick:y=>j(r.row.id)},{default:withCtx(()=>[createVNode(A,{size:"large"},{default:withCtx(()=>a[29]||(a[29]=[createBaseVNode("span",{"i-mdi-close":""},null,-1)])),_:1})]),_:2},1032,["onClick"]),createVNode(P,{link:"",class:"ml-1",type:"primary",onClick:y=>R(r.row.id)},{default:withCtx(()=>[createVNode(A,{size:"large"},{default:withCtx(()=>a[30]||(a[30]=[createBaseVNode("span",{"i-mdi-filter-variant-plus":""},null,-1)])),_:1})]),_:2},1032,["onClick"]),createVNode(P,{link:"",class:"ml-1",onClick:y=>S(r.row.id)},{default:withCtx(()=>[createVNode(A,{size:"large"},{default:withCtx(()=>a[31]||(a[31]=[createBaseVNode("span",{"i-mdi-arrow-up-thin":""},null,-1)])),_:1})]),_:2},1032,["onClick"]),createVNode(P,{link:"",class:"ml-1",onClick:y=>q(r.row.id)},{default:withCtx(()=>[createVNode(A,{size:"large"},{default:withCtx(()=>a[32]||(a[32]=[createBaseVNode("span",{"i-mdi-arrow-down-thin":""},null,-1)])),_:1})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])]),createBaseVNode("div",_hoisted_17,[createVNode(c,{"self-start":""},{default:withCtx(()=>a[33]||(a[33]=[createTextVNode("返回值")])),_:1}),createBaseVNode("div",_hoisted_18,[createBaseVNode("div",_hoisted_19,[createVNode(c,null,{default:withCtx(()=>a[34]||(a[34]=[createTextVNode("类型")])),_:1}),createVNode(w,{modelValue:l.value.document.returnValue.type,"onUpdate:modelValue":a[8]||(a[8]=r=>l.value.document.returnValue.type=r),style:{width:"480px"},"fetch-suggestions":E,clearable:"",placeholder:"请输入类型名称"},{default:withCtx(({item:r})=>[createBaseVNode("div",_hoisted_20,toDisplayString(r.value),1)]),_:1},8,["modelValue"])]),createBaseVNode("div",_hoisted_21,[createVNode(c,{"self-start":"","mb-2":""},{default:withCtx(()=>a[35]||(a[35]=[createTextVNode("返回值说明")])),_:1}),createVNode(x,{modelValue:l.value.document.returnValue.instructions,"onUpdate:modelValue":a[9]||(a[9]=r=>l.value.document.returnValue.instructions=r),type:"textarea",placeholder:"返回值说明",autosize:""},null,8,["modelValue"])])])]),createBaseVNode("div",_hoisted_22,[createVNode(c,{"self-start":""},{default:withCtx(()=>a[36]||(a[36]=[createTextVNode("示例")])),_:1}),createBaseVNode("div",_hoisted_23,[createBaseVNode("div",_hoisted_24,[createVNode(c,{"self-start":""},{default:withCtx(()=>a[37]||(a[37]=[createTextVNode("标题")])),_:1}),createVNode(x,{modelValue:l.value.document.example.title,"onUpdate:modelValue":a[10]||(a[10]=r=>l.value.document.example.title=r),type:"textarea",placeholder:"示例标题",autosize:""},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_25,[createVNode(c,{"self-start":""},{default:withCtx(()=>a[38]||(a[38]=[createTextVNode("代码")])),_:1}),createVNode(x,{modelValue:l.value.document.example.code,"onUpdate:modelValue":a[11]||(a[11]=r=>l.value.document.example.code=r),type:"textarea",placeholder:"示例代码",autosize:""},null,8,["modelValue"])])])]),createBaseVNode("div",_hoisted_26,[createVNode(c,null,{default:withCtx(()=>a[39]||(a[39]=[createTextVNode("搜索关键词")])),_:1}),createVNode(_,{multiple:"",filterable:"","allow-create":"",modelValue:l.value.document.searchKeys,"onUpdate:modelValue":a[12]||(a[12]=r=>l.value.document.searchKeys=r),style:{width:"480px"},placeholder:"可以添加搜索关键词"},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_27,[createVNode(c,{"self-start":""},{default:withCtx(()=>a[40]||(a[40]=[createTextVNode("代码片段(不填按照下面提示的内容生成)")])),_:1}),createVNode(x,{modelValue:l.value.document.codeSnippet,"onUpdate:modelValue":a[13]||(a[13]=r=>l.value.document.codeSnippet=r),type:"textarea",placeholder:unref(N),autosize:""},null,8,["modelValue","placeholder"])])],512),[[vShow,unref(V)]])]),createBaseVNode("div",_hoisted_28,[createBaseVNode("div",_hoisted_29,[createVNode(c,{tag:"b",id:p.anchorIdPrefix+"-api-test"},{default:withCtx(()=>a[41]||(a[41]=[createTextVNode("测试弹窗/快速修改参数弹窗")])),_:1},8,["id"]),createVNode(P,{link:"",onClick:a[14]||(a[14]=r=>g.value=!unref(g))},{default:withCtx(()=>[createVNode(A,{size:"large"},{default:withCtx(()=>[withDirectives(createBaseVNode("span",_hoisted_30,null,512),[[vShow,unref(g)]]),withDirectives(createBaseVNode("span",_hoisted_31,null,512),[[vShow,!unref(g)]])]),_:1})]),_:1})]),withDirectives(createBaseVNode("div",_hoisted_32,[createBaseVNode("div",_hoisted_33,[createVNode(c,null,{default:withCtx(()=>a[42]||(a[42]=[createTextVNode("不启用[测试弹窗/快速修改参数弹窗]")])),_:1}),createVNode(I,{modelValue:l.value.dialog.notOpen,"onUpdate:modelValue":a[15]||(a[15]=r=>l.value.dialog.notOpen=r),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),l.value.dialog.notOpen?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_34,[createBaseVNode("div",_hoisted_35,[createVNode(c,null,{default:withCtx(()=>a[43]||(a[43]=[createTextVNode("在API测试窗口显示的名称")])),_:1}),createVNode(x,{modelValue:l.value.dialog.title,"onUpdate:modelValue":a[16]||(a[16]=r=>l.value.dialog.title=r),placeholder:"在API测试窗口显示的名称",style:{width:"240px"}},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_36,[createVNode(c,{"self-start":""},{default:withCtx(()=>a[44]||(a[44]=[createTextVNode("弹窗中显示的内容(用于对API进行介绍或者说明)")])),_:1}),createVNode(x,{modelValue:l.value.dialog.content,"onUpdate:modelValue":a[17]||(a[17]=r=>l.value.dialog.content=r),autosize:"",placeholder:"弹窗中显示的内容",type:"textarea"},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_37,[createVNode(c,{"self-start":""},{default:withCtx(()=>a[45]||(a[45]=[createTextVNode("弹窗组件编辑(可从左侧将指定参数组件拖拽至右侧)")])),_:1}),createVNode(u,{modelValue:l.value.dialog.args,"onUpdate:modelValue":a[18]||(a[18]=r=>l.value.dialog.args=r),"document-params":unref(s)},null,8,["modelValue","document-params"])])]))],512),[[vShow,unref(g)]])]),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(f),r=>(openBlock(),createElementBlock("div",{flex:"","flex-col":"",key:r.name},[createBaseVNode("div",_hoisted_38,[createVNode(c,{tag:"b",id:p.anchorIdPrefix+"-"+r.name},{default:withCtx(()=>[createTextVNode(toDisplayString(r.title),1)]),_:2},1032,["id"]),createVNode(P,{link:"",onClick:y=>r.show=!r.show},{default:withCtx(()=>[createVNode(A,{size:"large"},{default:withCtx(()=>[withDirectives(createBaseVNode("span",_hoisted_39,null,512),[[vShow,r.show]]),withDirectives(createBaseVNode("span",_hoisted_40,null,512),[[vShow,!r.show]])]),_:2},1024)]),_:2},1032,["onClick"])]),withDirectives(createBaseVNode("div",_hoisted_41,[createVNode(F,{"raw-code":r.code,"file-path":r.path},null,8,["raw-code","file-path"])],512),[[vShow,r.show]])]))),128))])])}}}),__unplugin_components_6=_export_sfc(_sfc_main$1,[["__scopeId","data-v-1582449d"]]),_hoisted_1={class:"container-root","w-full":"","h-full":"","pos-relative":"","p-0":"","box-border":"","overflow-hidden":"",flex:"","p-5px":"","flex-col":""},_hoisted_2={"h-40px":"",flex:"","flex-row":"","justify-between":"","flex-items-center":"","w-full":"","p-5px":"","box-border":"","border-rd-10px":""},_hoisted_3={flex:"","flex-row":"","justify-end":"","flex-items-center":""},_hoisted_4={flex:"","flex-items-center":"","flex-row":""},_hoisted_5=["onClick"],_hoisted_6={key:1,"w-120px":"","ml-5":"","flex-col":"","mt-10":""},_hoisted_7=["onClick"],_sfc_main=defineComponent({__name:"InvokesManager",setup(o){useCssVars(w=>({"1a4a352e":unref(T)}));const e=getCurrentWebviewWindow(),l=ref(""),f=ref(),v=ref(),s=["管理API","创建API"],p=ref("管理API"),N=ref(null),{appBackground:T}=useAppTheme(),V=ref("");let g="";const C=ref({manager:defaultInvokeTemplateOptions(),create:defaultInvokeTemplateOptions()}),$=reactive([]);let B="";watch(V,()=>{const w=S.value.map(i=>i.children?i.children:[i]).flat().map(i=>({...i,scope:i.scope?i.scope:""})).find(i=>i.id===V.value),m={name:w?.label||"",scope:w?.scope||"",weight:w?.testModule?.weight||1,disabled:w?.disabled||!1,document:w?.testModule?.document||{howToUse:"",params:[],returnValue:{instructions:"",type:""},example:{title:"",code:""},searchKeys:[],codeSnippet:""},dialog:w?.testModule?.dialog||{title:"",content:"",args:[]}};C.value.manager=m,B=w?.fullPath||"",g=JSON.stringify(m),$.splice(0,$.length,{label:"Root",value:""},...S.value.filter(i=>i.children).map(i=>({label:i.children[0].scope||"Root",value:i.children[0].scope||""})))});const k=computed(()=>g!==JSON.stringify(C.value.manager)&&!!V.value.length),b=(w=!0)=>{C.value.manager=JSON.parse(g),w&&ElMessage.success("重置成功")},n=async()=>{const w=JSON.parse(g);await new InvokeTemplate(JSON.parse(g)).apply(B,w)&&(g=JSON.stringify(C.value.manager))},E=async()=>{try{await ElMessageBox.confirm("删除后无法恢复，请谨慎删除！",`删除${C.value.manager.scope}.${C.value.manager.name}`,{confirmButtonText:"删除",cancelButtonText:"取消",confirmButtonClass:"el-button--danger",type:"error"})}catch{return}try{const w=await pathUtils.resolve(B,"../"),m=await pathUtils.resolve(w,"../");await fsUtils.deleteDir(w,!0)?(await fsUtils.deleteDir(m,!1,!0),ElMessage.success("删除成功")):ElMessage.error("删除失败")}catch(w){console.error(w),ElMessage.error("删除失败")}},R=async w=>{if(k.value){try{await ElMessageBox.confirm("是否保存当前修改？","提示",{confirmButtonText:"保存",cancelButtonText:"放弃更改",type:"warning"})}catch{b(!1),w.srcElement?.click();return}n()}},S=ref([]),{getApiModules:q}=useCore(),j=w=>{S.value=w.map(m=>({...m,enabled:!m.disabled,disabled:!1,testModule:{...m.testModule,document:{...m.testModule?.document,params:dataStructureUtils.genTreeArrNodeId(m.testModule?.document?.params||[]),returnValue:{...m.testModule?.document?.returnValue,instructions:m.testModule?.document?.returnValue?.instructions||""},example:{...m.testModule?.document?.example,title:m.testModule?.document?.example?.title||"",code:m.testModule?.document?.example?.code||""},searchKeys:m.testModule?.document?.searchKeys||[],codeSnippet:m.testModule?.document?.codeSnippet||""},dialog:{...m.testModule?.dialog,args:m.testModule?.dialog?.args?.map(i=>{const u=nanoid();return i.componentType==="DirInput"?{...i,id:u,noTest:i.noTest||!1,onlyTest:i.onlyTest||!1,suffix:i.suffix||"",verifyPath:i.verifyPath||!1}:i.componentType==="FileInput"?{...i,id:u,noTest:i.noTest||!1,onlyTest:i.onlyTest||!1,suffix:i.suffix||"",verifyPath:i.verifyPath||!1,multiple:i.multiple||!1,value:i.value||(i.multiple?[]:"")}:i.componentType==="RectInput"?{...i,id:u,noTest:i.noTest||!1,onlyTest:i.onlyTest||!1,targetSrc:i.targetSrc||""}:i.componentType==="select"?{...i,id:u,noTest:i.noTest||!1,onlyTest:i.onlyTest||!1,options:i.options||[],multiple:i.multiple||!1,value:i.value||(i.multiple?[]:""),selectOptionSeparator:i.selectOptionSeparator||"",notAllowCreate:i.notAllowCreate||!1}:i.componentType==="numberRangeInput"?{...i,id:u,noTest:i.noTest||!1,onlyTest:i.onlyTest||!1,limit:i.limit||[0,0]}:i.componentType==="switch"?{...i,id:u,noTest:i.noTest||!1,onlyTest:i.onlyTest||!1,activeText:i.activeText||"是",inactiveText:i.inactiveText||"否"}:i.componentType==="slider"?{...i,id:u,noTest:i.noTest||!1,onlyTest:i.onlyTest||!1,range:i.range||{max:1,min:0,step:.1}}:{...i,id:u,noTest:i.noTest||!1,onlyTest:i.onlyTest||!1}}),notOpen:m.testModule?.dialog?.notOpen||!1,title:m.testModule?.dialog?.title||"",content:m.testModule?.dialog?.content||""}},children:m.children?.map(i=>({...i,enabled:!i.disabled,disabled:!1,testModule:{...i.testModule,document:{...i.testModule?.document,params:dataStructureUtils.genTreeArrNodeId(i.testModule?.document?.params||[]),returnValue:{...i.testModule?.document?.returnValue,instructions:i.testModule?.document?.returnValue?.instructions||""},example:{...i.testModule?.document?.example,title:i.testModule?.document?.example?.title||"",code:i.testModule?.document?.example?.code||""},searchKeys:i.testModule?.document?.searchKeys||[],codeSnippet:i.testModule?.document?.codeSnippet||""},dialog:{...i.testModule?.dialog,args:i.testModule?.dialog?.args?.map(u=>{const F=nanoid();return u.componentType==="DirInput"?{...u,id:F,noTest:u.noTest||!1,onlyTest:u.onlyTest||!1,suffix:u.suffix||"",verifyPath:u.verifyPath||!1}:u.componentType==="FileInput"?{...u,id:F,noTest:u.noTest||!1,onlyTest:u.onlyTest||!1,suffix:u.suffix||"",verifyPath:u.verifyPath||!1,multiple:u.multiple||!1,value:u.value||(u.multiple?[]:"")}:u.componentType==="RectInput"?{...u,id:F,noTest:u.noTest||!1,onlyTest:u.onlyTest||!1,targetSrc:u.targetSrc||""}:u.componentType==="select"?{...u,id:F,noTest:u.noTest||!1,onlyTest:u.onlyTest||!1,options:u.options||[],multiple:u.multiple||!1,value:u.value||(u.multiple?[]:""),selectOptionSeparator:u.selectOptionSeparator||"",notAllowCreate:u.notAllowCreate||!1}:u.componentType==="numberRangeInput"?{...u,id:F,noTest:u.noTest||!1,onlyTest:u.onlyTest||!1,limit:u.limit||[0,0]}:u.componentType==="switch"?{...u,id:F,noTest:u.noTest||!1,onlyTest:u.onlyTest||!1,activeText:u.activeText||"是",inactiveText:u.inactiveText||"否"}:u.componentType==="slider"?{...u,id:F,noTest:u.noTest||!1,onlyTest:u.onlyTest||!1,range:u.range||{max:1,min:0,step:.1}}:{...u,id:F,noTest:u.noTest||!1,onlyTest:u.onlyTest||!1}}),notOpen:i.testModule?.dialog?.notOpen||!1,title:i.testModule?.dialog?.title||"",content:i.testModule?.dialog?.content||""}}}))})),S.value[0]&&(S.value[0].children&&S.value[0].children[0]?V.value=S.value[0].children[0].id:V.value=S.value[0].id)},J=async()=>{const w=JSON.parse(JSON.stringify(await q(!1,!0,!0))),{groupRecordToOptions:m,dataGrouping:i}=dataStructureUtils,u=m(i(w,"scope"),"name","id",["disabled","id","fullPath","scope","testModule"]);j(u)},M=ref("horizontal"),h=async()=>{await e.isMaximized()?M.value="vertical":M.value="horizontal"},a=reactive([{value:"api-name",label:"名称"},{value:"api-state",label:"状态"},{value:"ns",label:"命名空间"},{value:"weight",label:"权重"},{value:"api-doc",label:"文档"},{value:"api-test",label:"弹窗"},{value:"auxiliary",label:"辅助代码"},{value:"fn",label:"API本体"},{value:"cb",label:"回调代码"}]),c=w=>{const m=document.getElementById((p.value==="管理API"?"manager":"create")+"-"+w);if(m){const u=a.slice(-5).map(F=>F.value).indexOf(w);if(u!==-1){let F;p.value==="创建API"?F=f.value.changeFormShow:F=v.value.changeFormShow,F&&F(u)}nextTick(()=>{m.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})})}};let x={manager:a[0].value,create:a[0].value};watch(l,w=>{p.value==="管理API"?x.manager=w:x.create=w});const I=()=>{p.value==="创建API"?(l.value=x.create,setTimeout(()=>{c(x.create)},100)):(l.value=x.manager,setTimeout(()=>{c(x.manager)},100))};let U,O=!1,_=0;const z=w=>{U&&clearTimeout(U),U=setTimeout(()=>{const m=w.target.scrollTop||0,i=a.find(u=>{const F=document.getElementById((p.value==="管理API"?"manager":"create")+"-"+u.value);if(F){const r=F.getBoundingClientRect();return r.top>=70&&r.bottom<=window.innerHeight}return!1});if(i)l.value=i.value,O=!1;else if(m<_){const u=a.findIndex(F=>F.value===l.value);u>0&&!O&&(l.value=a[u-1].value,O=!0)}_=m})};onMounted(async()=>{await J(),h(),window.addEventListener("resize",h),N.value?.addEventListener("scroll",z),l.value=a[0].value,invokeBaseApi.closeSplashscreen()}),onUnmounted(()=>{window.removeEventListener("resize",h),N.value?.removeEventListener("scroll",z)});const A=(w,m)=>{const i=m.testModule?.dialog,u=m.testModule?.document;return m.label.toLocaleLowerCase().includes(w.toLocaleLowerCase())||i?.title?.toLocaleLowerCase().includes(w.toLocaleLowerCase())||i?.content?.toLocaleLowerCase().includes(w.toLocaleLowerCase())||u?.howToUse?.toLocaleLowerCase().includes(w.toLocaleLowerCase())||u?.searchKeys?.some(F=>F.toLocaleLowerCase().includes(w.toLocaleLowerCase()))},P=async()=>{try{await ElMessageBox.confirm("是否清空当前内容？","提示",{confirmButtonText:"清空",cancelButtonText:"取消",type:"warning"})}catch{return}C.value.create=defaultInvokeTemplateOptions(),ElMessage.success("清空完成")},L=()=>{const{codeSnippetPlaceholder:w}=f.value;C.value.create.document.codeSnippet?.trim().length||(C.value.create.document.codeSnippet=w),new InvokeTemplate(C.value.create).create(),ElMessage.success("创建成功")};return(w,m)=>{const i=ElSegmented,u=ElText,F=ElTag,r=ElTreeSelect,y=ElButton,W=ElButtonGroup,H=__unplugin_components_6,G=ElEmpty;return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createVNode(i,{modelValue:unref(p),"onUpdate:modelValue":m[0]||(m[0]=D=>isRef(p)?p.value=D:null),options:s,"ml-1":"",onChange:I},null,8,["modelValue"]),createBaseVNode("div",_hoisted_3,[withDirectives(createVNode(u,{tag:"b"},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(k)?"*":""),1)]),_:1},512),[[vShow,unref(p)==="管理API"]]),withDirectives(createVNode(r,{size:"small",onClick:R,"w-300px":"","mr-10px":"",modelValue:unref(V),"onUpdate:modelValue":m[1]||(m[1]=D=>isRef(V)?V.value=D:null),data:unref(S),"filter-node-method":A,clearable:"",placeholder:"请选择API",filterable:"","default-expand-all":""},{default:withCtx(({data:{label:D,children:K,enabled:X}})=>[createBaseVNode("div",_hoisted_4,[createTextVNode(toDisplayString(D),1),K?(openBlock(),createBlock(F,{key:0,"ml-1":"",size:"small"},{default:withCtx(()=>m[6]||(m[6]=[createTextVNode("namespace")])),_:1})):createCommentVNode("",!0),X?createCommentVNode("",!0):(openBlock(),createBlock(F,{key:1,size:"small",type:"danger","ml-1":""},{default:withCtx(()=>m[7]||(m[7]=[createTextVNode("已禁用")])),_:1}))])]),_:1},8,["modelValue","data"]),[[vShow,unref(p)==="管理API"]]),withDirectives(createVNode(W,{"ml-1":"",size:"small"},{default:withCtx(()=>[createVNode(y,{type:"danger",onClick:E},{default:withCtx(()=>m[8]||(m[8]=[createTextVNode("删除API")])),_:1}),createVNode(y,{onClick:m[2]||(m[2]=D=>b(!0)),disabled:!unref(k)},{default:withCtx(()=>m[9]||(m[9]=[createTextVNode("恢复修改前")])),_:1},8,["disabled"]),createVNode(y,{type:"primary",onClick:n,disabled:!unref(k)},{default:withCtx(()=>m[10]||(m[10]=[createTextVNode("保存修改")])),_:1},8,["disabled"])]),_:1},512),[[vShow,unref(p)==="管理API"]]),withDirectives(createVNode(W,{"ml-1":"",size:"small"},{default:withCtx(()=>[createVNode(y,{onClick:P},{default:withCtx(()=>m[11]||(m[11]=[createTextVNode("清空内容")])),_:1}),createVNode(y,{type:"primary",onClick:L},{default:withCtx(()=>m[12]||(m[12]=[createTextVNode("保存新建")])),_:1})]),_:1},512),[[vShow,unref(p)==="创建API"]])])]),createBaseVNode("div",{flex:"","w-full":"",class:"content-container",style:normalizeStyle({flexDirection:unref(M)==="horizontal"?"column":"row"})},[unref(M)==="horizontal"?(openBlock(),createBlock(i,{key:0,modelValue:unref(l),"onUpdate:modelValue":m[3]||(m[3]=D=>isRef(l)?l.value=D:null),options:unref(a),size:"small",block:!0},{default:withCtx(({item:D})=>[typeof D=="object"?(openBlock(),createElementBlock("div",{key:0,onClick:K=>c(D.value)},toDisplayString(D.label),9,_hoisted_5)):createCommentVNode("",!0)]),_:1},8,["modelValue","options"])):createCommentVNode("",!0),createBaseVNode("div",{"overflow-y-scroll":"","overflow-x-hidden":"",ref_key:"scrollRef",ref:N,"flex-1":""},[withDirectives(createVNode(H,{ref_key:"IMFRef_manager",ref:v,modelValue:unref(C).manager,"onUpdate:modelValue":m[4]||(m[4]=D=>unref(C).manager=D),"scope-list":unref($),"anchor-model":unref(M),"anchor-id-prefix":"manager"},null,8,["modelValue","scope-list","anchor-model"]),[[vShow,unref(p)==="管理API"&&unref(V)]]),withDirectives(createVNode(G,{description:"请选择一个API进行管理"},null,512),[[vShow,unref(p)==="管理API"&&!unref(V)]]),withDirectives(createVNode(H,{ref_key:"IMFRef",ref:f,modelValue:unref(C).create,"onUpdate:modelValue":m[5]||(m[5]=D=>unref(C).create=D),"scope-list":unref($),"anchor-model":unref(M),"anchor-id-prefix":"create"},null,8,["modelValue","scope-list","anchor-model"]),[[vShow,unref(p)==="创建API"]])],512),unref(M)==="vertical"?(openBlock(),createElementBlock("div",_hoisted_6,[createVNode(u,{tag:"b"},{default:withCtx(()=>m[13]||(m[13]=[createTextVNode("表单项")])),_:1}),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(a),D=>(openBlock(),createElementBlock("div",{class:normalizeClass(["link-item",{active:unref(l)===D.value}]),onClick:K=>c(D.value),link:"",key:D.value},toDisplayString(D.label),11,_hoisted_7))),128))])):createCommentVNode("",!0)],4)])}}}),InvokesManager=_export_sfc(_sfc_main,[["__scopeId","data-v-42f93c6e"]]);export{InvokesManager as default};
