import{ag as buildProps,aM as definePropType,d as defineComponent,aj as useNamespace,c as computed,o as openBlock,a as createElementBlock,am as normalizeClass,g as unref,al as renderSlot,J as createCommentVNode,ar as normalizeStyle,an as _export_sfc,au as withInstall,bi as hasOwn,C as reactive,cx as isObject,cy as isPropAbsent,aq as inject,bx as h,ak as provide,m as ref,cz as removeClass,cA as addClass,cB as ElCollapseTransition,v as ElIcon,cC as loading_default,a1 as watch,H as nextTick,cD as caret_right_default,r as resolveComponent,ab as withDirectives,ac as vShow,n as createBaseVNode,e as createBlock,w as withCtx,f as resolveDynamicComponent,q as withModifiers,b as createVNode,P as Fragment,Q as renderList,ao as getCurrentInstance,bw as isFunction,bg as isString,bb as shallowRef,F as onMounted,cE as onUpdated,cF as useEventListener,b1 as EVENT_CODE,ap as iconPropType,aT as useLocale,cG as selectKey,cH as formItemContextKey,t as toDisplayString,cI as pick,cJ as toRefs,az as ElSelect,bf as UPDATE_MODEL_EVENT,ay as ElOption,aX as isEqual,cK as escapeStringRegexp,bh as isNil,aI as isEmpty,ba as isClient,u as useCssVars,h as useAppTheme,p as createTextVNode,y as ElTag,x as ElText,Z as ElButton,O as ElButtonGroup,bF as __unplugin_components_6$1,cL as __unplugin_components_5,cM as __unplugin_components_7,a2 as ElSwitch,cN as __unplugin_components_10,a3 as ElInputNumber,N as ElInput,bE as _sfc_main$9,_ as _export_sfc$1,cO as mergeModels,cP as useModel,X as nanoid,I as isRef,k as useListStore,E as ElMessage,cg as ElFormItem,ch as ElForm,cQ as _sfc_main$a,U as pathUtils,cR as exists,a9 as astWorker,aa as watchEffect,a8 as onBeforeUnmount,cS as listen,bT as getCurrentWebviewWindow,bV as ElMessageBox,af as ElAutocomplete,ad as useCore,G as invokeBaseApi,D as onUnmounted}from"./index-BG1F5OCk.js";import{E as ElEmpty}from"./el-empty-C87_4zF1.js";import{d as dataStructureUtils,E as ElTableColumn,a as ElTable,_ as __unplugin_components_14}from"./dataStructure-CPAvRWIe.js";/* empty css                        */import{l as lo}from"./vue-draggable-plus-J-SbjB0P.js";import{E as ElCheckbox}from"./el-checkbox-BGCHRVHo.js";import{f as fsUtils}from"./fs-Cv5Td1Dh.js";import{E as ElSegmented}from"./el-segmented-CF_gvMHI.js";import"./isArrayLikeObject-BTO2cGjA.js";const dividerProps=buildProps({direction:{type:String,values:["horizontal","vertical"],default:"horizontal"},contentPosition:{type:String,values:["left","center","right"],default:"center"},borderStyle:{type:definePropType(String),default:"solid"}}),__default__=defineComponent({name:"ElDivider"}),_sfc_main$8=defineComponent({...__default__,props:dividerProps,setup(e){const o=e,n=useNamespace("divider"),r=computed(()=>n.cssVar({"border-style":o.borderStyle}));return(a,l)=>(openBlock(),createElementBlock("div",{class:normalizeClass([unref(n).b(),unref(n).m(a.direction)]),style:normalizeStyle(unref(r)),role:"separator"},[a.$slots.default&&a.direction!=="vertical"?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass([unref(n).e("text"),unref(n).is(a.contentPosition)])},[renderSlot(a.$slots,"default")],2)):createCommentVNode("v-if",!0)],6))}});var Divider=_export_sfc(_sfc_main$8,[["__file","divider.vue"]]);const ElDivider=withInstall(Divider),NODE_KEY="$treeNodeId",markNodeData=function(e,o){!o||o[NODE_KEY]||Object.defineProperty(o,NODE_KEY,{value:e.id,enumerable:!1,configurable:!1,writable:!1})},getNodeKey=function(e,o){return e?o[e]:o[NODE_KEY]},handleCurrentChange=(e,o,n)=>{const r=e.value.currentNode;n();const a=e.value.currentNode;r!==a&&o("current-change",a?a.data:null,a)},getChildState=e=>{let o=!0,n=!0,r=!0;for(let a=0,l=e.length;a<l;a++){const c=e[a];(c.checked!==!0||c.indeterminate)&&(o=!1,c.disabled||(r=!1)),(c.checked!==!1||c.indeterminate)&&(n=!1)}return{all:o,none:n,allWithoutDisable:r,half:!o&&!n}},reInitChecked=function(e){if(e.childNodes.length===0||e.loading)return;const{all:o,none:n,half:r}=getChildState(e.childNodes);o?(e.checked=!0,e.indeterminate=!1):r?(e.checked=!1,e.indeterminate=!0):n&&(e.checked=!1,e.indeterminate=!1);const a=e.parent;!a||a.level===0||e.store.checkStrictly||reInitChecked(a)},getPropertyFromData=function(e,o){const n=e.store.props,r=e.data||{},a=n[o];if(typeof a=="function")return a(r,e);if(typeof a=="string")return r[a];if(typeof a>"u"){const l=r[o];return l===void 0?"":l}};let nodeIdSeed=0;class Node{constructor(o){this.id=nodeIdSeed++,this.text=null,this.checked=!1,this.indeterminate=!1,this.data=null,this.expanded=!1,this.parent=null,this.visible=!0,this.isCurrent=!1,this.canFocus=!1;for(const n in o)hasOwn(o,n)&&(this[n]=o[n]);this.level=0,this.loaded=!1,this.childNodes=[],this.loading=!1,this.parent&&(this.level=this.parent.level+1)}initialize(){const o=this.store;if(!o)throw new Error("[Node]store is required!");o.registerNode(this);const n=o.props;if(n&&typeof n.isLeaf<"u"){const l=getPropertyFromData(this,"isLeaf");typeof l=="boolean"&&(this.isLeafByUser=l)}if(o.lazy!==!0&&this.data?(this.setData(this.data),o.defaultExpandAll&&(this.expanded=!0,this.canFocus=!0)):this.level>0&&o.lazy&&o.defaultExpandAll&&!this.isLeafByUser&&this.expand(),Array.isArray(this.data)||markNodeData(this,this.data),!this.data)return;const r=o.defaultExpandedKeys,a=o.key;a&&r&&r.includes(this.key)&&this.expand(null,o.autoExpandParent),a&&o.currentNodeKey!==void 0&&this.key===o.currentNodeKey&&(o.currentNode=this,o.currentNode.isCurrent=!0),o.lazy&&o._initDefaultCheckedNode(this),this.updateLeafState(),this.parent&&(this.level===1||this.parent.expanded===!0)&&(this.canFocus=!0)}setData(o){Array.isArray(o)||markNodeData(this,o),this.data=o,this.childNodes=[];let n;this.level===0&&Array.isArray(this.data)?n=this.data:n=getPropertyFromData(this,"children")||[];for(let r=0,a=n.length;r<a;r++)this.insertChild({data:n[r]})}get label(){return getPropertyFromData(this,"label")}get key(){const o=this.store.key;return this.data?this.data[o]:null}get disabled(){return getPropertyFromData(this,"disabled")}get nextSibling(){const o=this.parent;if(o){const n=o.childNodes.indexOf(this);if(n>-1)return o.childNodes[n+1]}return null}get previousSibling(){const o=this.parent;if(o){const n=o.childNodes.indexOf(this);if(n>-1)return n>0?o.childNodes[n-1]:null}return null}contains(o,n=!0){return(this.childNodes||[]).some(r=>r===o||n&&r.contains(o))}remove(){const o=this.parent;o&&o.removeChild(this)}insertChild(o,n,r){if(!o)throw new Error("InsertChild error: child is required.");if(!(o instanceof Node)){if(!r){const a=this.getChildren(!0);a.includes(o.data)||(typeof n>"u"||n<0?a.push(o.data):a.splice(n,0,o.data))}Object.assign(o,{parent:this,store:this.store}),o=reactive(new Node(o)),o instanceof Node&&o.initialize()}o.level=this.level+1,typeof n>"u"||n<0?this.childNodes.push(o):this.childNodes.splice(n,0,o),this.updateLeafState()}insertBefore(o,n){let r;n&&(r=this.childNodes.indexOf(n)),this.insertChild(o,r)}insertAfter(o,n){let r;n&&(r=this.childNodes.indexOf(n),r!==-1&&(r+=1)),this.insertChild(o,r)}removeChild(o){const n=this.getChildren()||[],r=n.indexOf(o.data);r>-1&&n.splice(r,1);const a=this.childNodes.indexOf(o);a>-1&&(this.store&&this.store.deregisterNode(o),o.parent=null,this.childNodes.splice(a,1)),this.updateLeafState()}removeChildByData(o){let n=null;for(let r=0;r<this.childNodes.length;r++)if(this.childNodes[r].data===o){n=this.childNodes[r];break}n&&this.removeChild(n)}expand(o,n){const r=()=>{if(n){let a=this.parent;for(;a.level>0;)a.expanded=!0,a=a.parent}this.expanded=!0,o&&o(),this.childNodes.forEach(a=>{a.canFocus=!0})};this.shouldLoadData()?this.loadData(a=>{Array.isArray(a)&&(this.checked?this.setChecked(!0,!0):this.store.checkStrictly||reInitChecked(this),r())}):r()}doCreateChildren(o,n={}){o.forEach(r=>{this.insertChild(Object.assign({data:r},n),void 0,!0)})}collapse(){this.expanded=!1,this.childNodes.forEach(o=>{o.canFocus=!1})}shouldLoadData(){return this.store.lazy===!0&&this.store.load&&!this.loaded}updateLeafState(){if(this.store.lazy===!0&&this.loaded!==!0&&typeof this.isLeafByUser<"u"){this.isLeaf=this.isLeafByUser;return}const o=this.childNodes;if(!this.store.lazy||this.store.lazy===!0&&this.loaded===!0){this.isLeaf=!o||o.length===0;return}this.isLeaf=!1}setChecked(o,n,r,a){if(this.indeterminate=o==="half",this.checked=o===!0,this.store.checkStrictly)return;if(!(this.shouldLoadData()&&!this.store.checkDescendants)){const{all:c,allWithoutDisable:C}=getChildState(this.childNodes);!this.isLeaf&&!c&&C&&(this.checked=!1,o=!1);const p=()=>{if(n){const N=this.childNodes;for(let f=0,w=N.length;f<w;f++){const x=N[f];a=a||o!==!1;const b=x.disabled?x.checked:a;x.setChecked(b,n,!0,a)}const{half:u,all:y}=getChildState(N);y||(this.checked=y,this.indeterminate=u)}};if(this.shouldLoadData()){this.loadData(()=>{p(),reInitChecked(this)},{checked:o!==!1});return}else p()}const l=this.parent;!l||l.level===0||r||reInitChecked(l)}getChildren(o=!1){if(this.level===0)return this.data;const n=this.data;if(!n)return null;const r=this.store.props;let a="children";return r&&(a=r.children||"children"),n[a]===void 0&&(n[a]=null),o&&!n[a]&&(n[a]=[]),n[a]}updateChildren(){const o=this.getChildren()||[],n=this.childNodes.map(l=>l.data),r={},a=[];o.forEach((l,c)=>{const C=l[NODE_KEY];!!C&&n.findIndex(N=>N[NODE_KEY]===C)>=0?r[C]={index:c,data:l}:a.push({index:c,data:l})}),this.store.lazy||n.forEach(l=>{r[l[NODE_KEY]]||this.removeChildByData(l)}),a.forEach(({index:l,data:c})=>{this.insertChild({data:c},l)}),this.updateLeafState()}loadData(o,n={}){if(this.store.lazy===!0&&this.store.load&&!this.loaded&&(!this.loading||Object.keys(n).length)){this.loading=!0;const r=l=>{this.childNodes=[],this.doCreateChildren(l,n),this.loaded=!0,this.loading=!1,this.updateLeafState(),o&&o.call(this,l)},a=()=>{this.loading=!1};this.store.load(this,r,a)}else o&&o.call(this)}eachNode(o){const n=[this];for(;n.length;){const r=n.shift();n.unshift(...r.childNodes),o(r)}}reInitChecked(){this.store.checkStrictly||reInitChecked(this)}}class TreeStore{constructor(o){this.currentNode=null,this.currentNodeKey=null;for(const n in o)hasOwn(o,n)&&(this[n]=o[n]);this.nodesMap={}}initialize(){if(this.root=new Node({data:this.data,store:this}),this.root.initialize(),this.lazy&&this.load){const o=this.load;o(this.root,n=>{this.root.doCreateChildren(n),this._initDefaultCheckedNodes()})}else this._initDefaultCheckedNodes()}filter(o){const n=this.filterNodeMethod,r=this.lazy,a=function(l){const c=l.root?l.root.childNodes:l.childNodes;if(c.forEach(C=>{C.visible=n.call(C,o,C.data,C),a(C)}),!l.visible&&c.length){let C=!0;C=!c.some(p=>p.visible),l.root?l.root.visible=C===!1:l.visible=C===!1}o&&l.visible&&!l.isLeaf&&(!r||l.loaded)&&l.expand()};a(this)}setData(o){o!==this.root.data?(this.nodesMap={},this.root.setData(o),this._initDefaultCheckedNodes()):this.root.updateChildren()}getNode(o){if(o instanceof Node)return o;const n=isObject(o)?getNodeKey(this.key,o):o;return this.nodesMap[n]||null}insertBefore(o,n){const r=this.getNode(n);r.parent.insertBefore({data:o},r)}insertAfter(o,n){const r=this.getNode(n);r.parent.insertAfter({data:o},r)}remove(o){const n=this.getNode(o);n&&n.parent&&(n===this.currentNode&&(this.currentNode=null),n.parent.removeChild(n))}append(o,n){const r=isPropAbsent(n)?this.root:this.getNode(n);r&&r.insertChild({data:o})}_initDefaultCheckedNodes(){const o=this.defaultCheckedKeys||[],n=this.nodesMap;o.forEach(r=>{const a=n[r];a&&a.setChecked(!0,!this.checkStrictly)})}_initDefaultCheckedNode(o){(this.defaultCheckedKeys||[]).includes(o.key)&&o.setChecked(!0,!this.checkStrictly)}setDefaultCheckedKey(o){o!==this.defaultCheckedKeys&&(this.defaultCheckedKeys=o,this._initDefaultCheckedNodes())}registerNode(o){const n=this.key;!o||!o.data||(n?o.key!==void 0&&(this.nodesMap[o.key]=o):this.nodesMap[o.id]=o)}deregisterNode(o){!this.key||!o||!o.data||(o.childNodes.forEach(r=>{this.deregisterNode(r)}),delete this.nodesMap[o.key])}getCheckedNodes(o=!1,n=!1){const r=[],a=function(l){(l.root?l.root.childNodes:l.childNodes).forEach(C=>{(C.checked||n&&C.indeterminate)&&(!o||o&&C.isLeaf)&&r.push(C.data),a(C)})};return a(this),r}getCheckedKeys(o=!1){return this.getCheckedNodes(o).map(n=>(n||{})[this.key])}getHalfCheckedNodes(){const o=[],n=function(r){(r.root?r.root.childNodes:r.childNodes).forEach(l=>{l.indeterminate&&o.push(l.data),n(l)})};return n(this),o}getHalfCheckedKeys(){return this.getHalfCheckedNodes().map(o=>(o||{})[this.key])}_getAllNodes(){const o=[],n=this.nodesMap;for(const r in n)hasOwn(n,r)&&o.push(n[r]);return o}updateChildren(o,n){const r=this.nodesMap[o];if(!r)return;const a=r.childNodes;for(let l=a.length-1;l>=0;l--){const c=a[l];this.remove(c.data)}for(let l=0,c=n.length;l<c;l++){const C=n[l];this.append(C,r.data)}}_setCheckedKeys(o,n=!1,r){const a=this._getAllNodes().sort((p,N)=>p.level-N.level),l=Object.create(null),c=Object.keys(r);a.forEach(p=>p.setChecked(!1,!1));const C=p=>{p.childNodes.forEach(N=>{var u;l[N.data[o]]=!0,(u=N.childNodes)!=null&&u.length&&C(N)})};for(let p=0,N=a.length;p<N;p++){const u=a[p],y=u.data[o].toString();if(!c.includes(y)){u.checked&&!l[y]&&u.setChecked(!1,!1);continue}if(u.childNodes.length&&C(u),u.isLeaf||this.checkStrictly){u.setChecked(!0,!1);continue}if(u.setChecked(!0,!0),n){u.setChecked(!1,!1);const w=function(x){x.childNodes.forEach(s=>{s.isLeaf||s.setChecked(!1,!1),w(s)})};w(u)}}}setCheckedNodes(o,n=!1){const r=this.key,a={};o.forEach(l=>{a[(l||{})[r]]=!0}),this._setCheckedKeys(r,n,a)}setCheckedKeys(o,n=!1){this.defaultCheckedKeys=o;const r=this.key,a={};o.forEach(l=>{a[l]=!0}),this._setCheckedKeys(r,n,a)}setDefaultExpandedKeys(o){o=o||[],this.defaultExpandedKeys=o,o.forEach(n=>{const r=this.getNode(n);r&&r.expand(null,this.autoExpandParent)})}setChecked(o,n,r){const a=this.getNode(o);a&&a.setChecked(!!n,r)}getCurrentNode(){return this.currentNode}setCurrentNode(o){const n=this.currentNode;n&&(n.isCurrent=!1),this.currentNode=o,this.currentNode.isCurrent=!0}setUserCurrentNode(o,n=!0){const r=o[this.key],a=this.nodesMap[r];this.setCurrentNode(a),n&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0)}setCurrentNodeKey(o,n=!0){if(o==null){this.currentNode&&(this.currentNode.isCurrent=!1),this.currentNode=null;return}const r=this.getNode(o);r&&(this.setCurrentNode(r),n&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0))}}const _sfc_main$7=defineComponent({name:"ElTreeNodeContent",props:{node:{type:Object,required:!0},renderContent:Function},setup(e){const o=useNamespace("tree"),n=inject("NodeInstance"),r=inject("RootTree");return()=>{const a=e.node,{data:l,store:c}=a;return e.renderContent?e.renderContent(h,{_self:n,node:a,data:l,store:c}):renderSlot(r.ctx.slots,"default",{node:a,data:l},()=>[h("span",{class:o.be("node","label")},[a.label])])}}});var NodeContent=_export_sfc(_sfc_main$7,[["__file","tree-node-content.vue"]]);function useNodeExpandEventBroadcast(e){const o=inject("TreeNodeMap",null),n={treeNodeExpand:r=>{e.node!==r&&e.node.collapse()},children:[]};return o&&o.children.push(n),provide("TreeNodeMap",n),{broadcastExpanded:r=>{if(e.accordion)for(const a of n.children)a.treeNodeExpand(r)}}}const dragEventsKey=Symbol("dragEvents");function useDragNodeHandler({props:e,ctx:o,el$:n,dropIndicator$:r,store:a}){const l=useNamespace("tree"),c=ref({showDropIndicator:!1,draggingNode:null,dropNode:null,allowDrop:!0,dropType:null});return provide(dragEventsKey,{treeNodeDragStart:({event:u,treeNode:y})=>{if(typeof e.allowDrag=="function"&&!e.allowDrag(y.node))return u.preventDefault(),!1;u.dataTransfer.effectAllowed="move";try{u.dataTransfer.setData("text/plain","")}catch{}c.value.draggingNode=y,o.emit("node-drag-start",y.node,u)},treeNodeDragOver:({event:u,treeNode:y})=>{const f=y,w=c.value.dropNode;w&&w.node.id!==f.node.id&&removeClass(w.$el,l.is("drop-inner"));const x=c.value.draggingNode;if(!x||!f)return;let b=!0,s=!0,$=!0,O=!0;typeof e.allowDrop=="function"&&(b=e.allowDrop(x.node,f.node,"prev"),O=s=e.allowDrop(x.node,f.node,"inner"),$=e.allowDrop(x.node,f.node,"next")),u.dataTransfer.dropEffect=s||b||$?"move":"none",(b||s||$)&&w?.node.id!==f.node.id&&(w&&o.emit("node-drag-leave",x.node,w.node,u),o.emit("node-drag-enter",x.node,f.node,u)),b||s||$?c.value.dropNode=f:c.value.dropNode=null,f.node.nextSibling===x.node&&($=!1),f.node.previousSibling===x.node&&(b=!1),f.node.contains(x.node,!1)&&(s=!1),(x.node===f.node||x.node.contains(f.node))&&(b=!1,s=!1,$=!1);const S=f.$el.querySelector(`.${l.be("node","content")}`).getBoundingClientRect(),I=n.value.getBoundingClientRect();let M;const j=b?s?.25:$?.45:1:-1,K=$?s?.75:b?.55:0:1;let D=-9999;const i=u.clientY-S.top;i<S.height*j?M="before":i>S.height*K?M="after":s?M="inner":M="none";const g=f.$el.querySelector(`.${l.be("node","expand-icon")}`).getBoundingClientRect(),F=r.value;M==="before"?D=g.top-I.top:M==="after"&&(D=g.bottom-I.top),F.style.top=`${D}px`,F.style.left=`${g.right-I.left}px`,M==="inner"?addClass(f.$el,l.is("drop-inner")):removeClass(f.$el,l.is("drop-inner")),c.value.showDropIndicator=M==="before"||M==="after",c.value.allowDrop=c.value.showDropIndicator||O,c.value.dropType=M,o.emit("node-drag-over",x.node,f.node,u)},treeNodeDragEnd:u=>{const{draggingNode:y,dropType:f,dropNode:w}=c.value;if(u.preventDefault(),u.dataTransfer&&(u.dataTransfer.dropEffect="move"),y&&w){const x={data:y.node.data};f!=="none"&&y.node.remove(),f==="before"?w.node.parent.insertBefore(x,w.node):f==="after"?w.node.parent.insertAfter(x,w.node):f==="inner"&&w.node.insertChild(x),f!=="none"&&(a.value.registerNode(x),a.value.key&&y.node.eachNode(b=>{var s;(s=a.value.nodesMap[b.data[a.value.key]])==null||s.setChecked(b.checked,!a.value.checkStrictly)})),removeClass(w.$el,l.is("drop-inner")),o.emit("node-drag-end",y.node,w.node,f,u),f!=="none"&&o.emit("node-drop",y.node,w.node,f,u)}y&&!w&&o.emit("node-drag-end",y.node,null,f,u),c.value.showDropIndicator=!1,c.value.draggingNode=null,c.value.dropNode=null,c.value.allowDrop=!0}}),{dragState:c}}const _sfc_main$6=defineComponent({name:"ElTreeNode",components:{ElCollapseTransition,ElCheckbox,NodeContent,ElIcon,Loading:loading_default},props:{node:{type:Node,default:()=>({})},props:{type:Object,default:()=>({})},accordion:Boolean,renderContent:Function,renderAfterExpand:Boolean,showCheckbox:{type:Boolean,default:!1}},emits:["node-expand"],setup(e,o){const n=useNamespace("tree"),{broadcastExpanded:r}=useNodeExpandEventBroadcast(e),a=inject("RootTree"),l=ref(!1),c=ref(!1),C=ref(null),p=ref(null),N=ref(null),u=inject(dragEventsKey),y=getCurrentInstance();provide("NodeInstance",y),e.node.expanded&&(l.value=!0,c.value=!0);const f=a.props.props.children||"children";watch(()=>{const i=e.node.data[f];return i&&[...i]},()=>{e.node.updateChildren()}),watch(()=>e.node.indeterminate,i=>{b(e.node.checked,i)}),watch(()=>e.node.checked,i=>{b(i,e.node.indeterminate)}),watch(()=>e.node.childNodes.length,()=>e.node.reInitChecked()),watch(()=>e.node.expanded,i=>{nextTick(()=>l.value=i),i&&(c.value=!0)});const w=i=>getNodeKey(a.props.nodeKey,i.data),x=i=>{const g=e.props.class;if(!g)return{};let F;if(isFunction(g)){const{data:P}=i;F=g(P,i)}else F=g;return isString(F)?{[F]:!0}:F},b=(i,g)=>{(C.value!==i||p.value!==g)&&a.ctx.emit("check-change",e.node.data,i,g),C.value=i,p.value=g},s=i=>{handleCurrentChange(a.store,a.ctx.emit,()=>a.store.value.setCurrentNode(e.node)),a.currentNode.value=e.node,a.props.expandOnClickNode&&O(),a.props.checkOnClickNode&&!e.node.disabled&&S(null,{target:{checked:!e.node.checked}}),a.ctx.emit("node-click",e.node.data,e.node,y,i)},$=i=>{a.instance.vnode.props.onNodeContextmenu&&(i.stopPropagation(),i.preventDefault()),a.ctx.emit("node-contextmenu",i,e.node.data,e.node,y)},O=()=>{e.node.isLeaf||(l.value?(a.ctx.emit("node-collapse",e.node.data,e.node,y),e.node.collapse()):e.node.expand(()=>{o.emit("node-expand",e.node.data,e.node,y)}))},S=(i,g)=>{e.node.setChecked(g.target.checked,!a.props.checkStrictly),nextTick(()=>{const F=a.store.value;a.ctx.emit("check",e.node.data,{checkedNodes:F.getCheckedNodes(),checkedKeys:F.getCheckedKeys(),halfCheckedNodes:F.getHalfCheckedNodes(),halfCheckedKeys:F.getHalfCheckedKeys()})})};return{ns:n,node$:N,tree:a,expanded:l,childNodeRendered:c,oldChecked:C,oldIndeterminate:p,getNodeKey:w,getNodeClass:x,handleSelectChange:b,handleClick:s,handleContextMenu:$,handleExpandIconClick:O,handleCheckChange:S,handleChildNodeExpand:(i,g,F)=>{r(g),a.ctx.emit("node-expand",i,g,F)},handleDragStart:i=>{a.props.draggable&&u.treeNodeDragStart({event:i,treeNode:e})},handleDragOver:i=>{i.preventDefault(),a.props.draggable&&u.treeNodeDragOver({event:i,treeNode:{$el:N.value,node:e.node}})},handleDrop:i=>{i.preventDefault()},handleDragEnd:i=>{a.props.draggable&&u.treeNodeDragEnd(i)},CaretRight:caret_right_default}}});function _sfc_render$1(e,o,n,r,a,l){const c=resolveComponent("el-icon"),C=resolveComponent("el-checkbox"),p=resolveComponent("loading"),N=resolveComponent("node-content"),u=resolveComponent("el-tree-node"),y=resolveComponent("el-collapse-transition");return withDirectives((openBlock(),createElementBlock("div",{ref:"node$",class:normalizeClass([e.ns.b("node"),e.ns.is("expanded",e.expanded),e.ns.is("current",e.node.isCurrent),e.ns.is("hidden",!e.node.visible),e.ns.is("focusable",!e.node.disabled),e.ns.is("checked",!e.node.disabled&&e.node.checked),e.getNodeClass(e.node)]),role:"treeitem",tabindex:"-1","aria-expanded":e.expanded,"aria-disabled":e.node.disabled,"aria-checked":e.node.checked,draggable:e.tree.props.draggable,"data-key":e.getNodeKey(e.node),onClick:withModifiers(e.handleClick,["stop"]),onContextmenu:e.handleContextMenu,onDragstart:withModifiers(e.handleDragStart,["stop"]),onDragover:withModifiers(e.handleDragOver,["stop"]),onDragend:withModifiers(e.handleDragEnd,["stop"]),onDrop:withModifiers(e.handleDrop,["stop"])},[createBaseVNode("div",{class:normalizeClass(e.ns.be("node","content")),style:normalizeStyle({paddingLeft:(e.node.level-1)*e.tree.props.indent+"px"})},[e.tree.props.icon||e.CaretRight?(openBlock(),createBlock(c,{key:0,class:normalizeClass([e.ns.be("node","expand-icon"),e.ns.is("leaf",e.node.isLeaf),{expanded:!e.node.isLeaf&&e.expanded}]),onClick:withModifiers(e.handleExpandIconClick,["stop"])},{default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(e.tree.props.icon||e.CaretRight)))]),_:1},8,["class","onClick"])):createCommentVNode("v-if",!0),e.showCheckbox?(openBlock(),createBlock(C,{key:1,"model-value":e.node.checked,indeterminate:e.node.indeterminate,disabled:!!e.node.disabled,onClick:withModifiers(()=>{},["stop"]),onChange:e.handleCheckChange},null,8,["model-value","indeterminate","disabled","onClick","onChange"])):createCommentVNode("v-if",!0),e.node.loading?(openBlock(),createBlock(c,{key:2,class:normalizeClass([e.ns.be("node","loading-icon"),e.ns.is("loading")])},{default:withCtx(()=>[createVNode(p)]),_:1},8,["class"])):createCommentVNode("v-if",!0),createVNode(N,{node:e.node,"render-content":e.renderContent},null,8,["node","render-content"])],6),createVNode(y,null,{default:withCtx(()=>[!e.renderAfterExpand||e.childNodeRendered?withDirectives((openBlock(),createElementBlock("div",{key:0,class:normalizeClass(e.ns.be("node","children")),role:"group","aria-expanded":e.expanded},[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.node.childNodes,f=>(openBlock(),createBlock(u,{key:e.getNodeKey(f),"render-content":e.renderContent,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,node:f,accordion:e.accordion,props:e.props,onNodeExpand:e.handleChildNodeExpand},null,8,["render-content","render-after-expand","show-checkbox","node","accordion","props","onNodeExpand"]))),128))],10,["aria-expanded"])),[[vShow,e.expanded]]):createCommentVNode("v-if",!0)]),_:1})],42,["aria-expanded","aria-disabled","aria-checked","draggable","data-key","onClick","onContextmenu","onDragstart","onDragover","onDragend","onDrop"])),[[vShow,e.node.visible]])}var ElTreeNode=_export_sfc(_sfc_main$6,[["render",_sfc_render$1],["__file","tree-node.vue"]]);function useKeydown({el$:e},o){const n=useNamespace("tree"),r=shallowRef([]),a=shallowRef([]);onMounted(()=>{c()}),onUpdated(()=>{r.value=Array.from(e.value.querySelectorAll("[role=treeitem]")),a.value=Array.from(e.value.querySelectorAll("input[type=checkbox]"))}),watch(a,C=>{C.forEach(p=>{p.setAttribute("tabindex","-1")})}),useEventListener(e,"keydown",C=>{const p=C.target;if(!p.className.includes(n.b("node")))return;const N=C.code;r.value=Array.from(e.value.querySelectorAll(`.${n.is("focusable")}[role=treeitem]`));const u=r.value.indexOf(p);let y;if([EVENT_CODE.up,EVENT_CODE.down].includes(N)){if(C.preventDefault(),N===EVENT_CODE.up){y=u===-1?0:u!==0?u-1:r.value.length-1;const w=y;for(;!o.value.getNode(r.value[y].dataset.key).canFocus;){if(y--,y===w){y=-1;break}y<0&&(y=r.value.length-1)}}else{y=u===-1?0:u<r.value.length-1?u+1:0;const w=y;for(;!o.value.getNode(r.value[y].dataset.key).canFocus;){if(y++,y===w){y=-1;break}y>=r.value.length&&(y=0)}}y!==-1&&r.value[y].focus()}[EVENT_CODE.left,EVENT_CODE.right].includes(N)&&(C.preventDefault(),p.click());const f=p.querySelector('[type="checkbox"]');[EVENT_CODE.enter,EVENT_CODE.space].includes(N)&&f&&(C.preventDefault(),f.click())});const c=()=>{var C;r.value=Array.from(e.value.querySelectorAll(`.${n.is("focusable")}[role=treeitem]`)),a.value=Array.from(e.value.querySelectorAll("input[type=checkbox]"));const p=e.value.querySelectorAll(`.${n.is("checked")}[role=treeitem]`);if(p.length){p[0].setAttribute("tabindex","0");return}(C=r.value[0])==null||C.setAttribute("tabindex","0")}}const _sfc_main$5=defineComponent({name:"ElTree",components:{ElTreeNode},props:{data:{type:Array,default:()=>[]},emptyText:{type:String},renderAfterExpand:{type:Boolean,default:!0},nodeKey:String,checkStrictly:Boolean,defaultExpandAll:Boolean,expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:Boolean,checkDescendants:{type:Boolean,default:!1},autoExpandParent:{type:Boolean,default:!0},defaultCheckedKeys:Array,defaultExpandedKeys:Array,currentNodeKey:[String,Number],renderContent:Function,showCheckbox:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},allowDrag:Function,allowDrop:Function,props:{type:Object,default:()=>({children:"children",label:"label",disabled:"disabled"})},lazy:{type:Boolean,default:!1},highlightCurrent:Boolean,load:Function,filterNodeMethod:Function,accordion:Boolean,indent:{type:Number,default:18},icon:{type:iconPropType}},emits:["check-change","current-change","node-click","node-contextmenu","node-collapse","node-expand","check","node-drag-start","node-drag-end","node-drop","node-drag-leave","node-drag-enter","node-drag-over"],setup(e,o){const{t:n}=useLocale(),r=useNamespace("tree"),a=inject(selectKey,null),l=ref(new TreeStore({key:e.nodeKey,data:e.data,lazy:e.lazy,props:e.props,load:e.load,currentNodeKey:e.currentNodeKey,checkStrictly:e.checkStrictly,checkDescendants:e.checkDescendants,defaultCheckedKeys:e.defaultCheckedKeys,defaultExpandedKeys:e.defaultExpandedKeys,autoExpandParent:e.autoExpandParent,defaultExpandAll:e.defaultExpandAll,filterNodeMethod:e.filterNodeMethod}));l.value.initialize();const c=ref(l.value.root),C=ref(null),p=ref(null),N=ref(null),{broadcastExpanded:u}=useNodeExpandEventBroadcast(e),{dragState:y}=useDragNodeHandler({props:e,ctx:o,el$:p,dropIndicator$:N,store:l});useKeydown({el$:p},l);const f=computed(()=>{const{childNodes:T}=c.value,_=a?a.hasFilteredOptions!==0:!1;return(!T||T.length===0||T.every(({visible:E})=>!E))&&!_});watch(()=>e.currentNodeKey,T=>{l.value.setCurrentNodeKey(T)}),watch(()=>e.defaultCheckedKeys,T=>{l.value.setDefaultCheckedKey(T)}),watch(()=>e.defaultExpandedKeys,T=>{l.value.setDefaultExpandedKeys(T)}),watch(()=>e.data,T=>{l.value.setData(T)},{deep:!0}),watch(()=>e.checkStrictly,T=>{l.value.checkStrictly=T});const w=T=>{if(!e.filterNodeMethod)throw new Error("[Tree] filterNodeMethod is required when filter");l.value.filter(T)},x=T=>getNodeKey(e.nodeKey,T.data),b=T=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getNodePath");const _=l.value.getNode(T);if(!_)return[];const E=[_.data];let V=_.parent;for(;V&&V!==c.value;)E.push(V.data),V=V.parent;return E.reverse()},s=(T,_)=>l.value.getCheckedNodes(T,_),$=T=>l.value.getCheckedKeys(T),O=()=>{const T=l.value.getCurrentNode();return T?T.data:null},S=()=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getCurrentKey");const T=O();return T?T[e.nodeKey]:null},I=(T,_)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedNodes");l.value.setCheckedNodes(T,_)},M=(T,_)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedKeys");l.value.setCheckedKeys(T,_)},j=(T,_,E)=>{l.value.setChecked(T,_,E)},K=()=>l.value.getHalfCheckedNodes(),D=()=>l.value.getHalfCheckedKeys(),i=(T,_=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentNode");handleCurrentChange(l,o.emit,()=>{u(T),l.value.setUserCurrentNode(T,_)})},g=(T,_=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentKey");handleCurrentChange(l,o.emit,()=>{u(),l.value.setCurrentNodeKey(T,_)})},F=T=>l.value.getNode(T),P=T=>{l.value.remove(T)},R=(T,_)=>{l.value.append(T,_)},q=(T,_)=>{l.value.insertBefore(T,_)},U=(T,_)=>{l.value.insertAfter(T,_)},H=(T,_,E)=>{u(_),o.emit("node-expand",T,_,E)},z=(T,_)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in updateKeyChild");l.value.updateChildren(T,_)};return provide("RootTree",{ctx:o,props:e,store:l,root:c,currentNode:C,instance:getCurrentInstance()}),provide(formItemContextKey,void 0),{ns:r,store:l,root:c,currentNode:C,dragState:y,el$:p,dropIndicator$:N,isEmpty:f,filter:w,getNodeKey:x,getNodePath:b,getCheckedNodes:s,getCheckedKeys:$,getCurrentNode:O,getCurrentKey:S,setCheckedNodes:I,setCheckedKeys:M,setChecked:j,getHalfCheckedNodes:K,getHalfCheckedKeys:D,setCurrentNode:i,setCurrentKey:g,t:n,getNode:F,remove:P,append:R,insertBefore:q,insertAfter:U,handleNodeExpand:H,updateKeyChildren:z}}});function _sfc_render(e,o,n,r,a,l){const c=resolveComponent("el-tree-node");return openBlock(),createElementBlock("div",{ref:"el$",class:normalizeClass([e.ns.b(),e.ns.is("dragging",!!e.dragState.draggingNode),e.ns.is("drop-not-allow",!e.dragState.allowDrop),e.ns.is("drop-inner",e.dragState.dropType==="inner"),{[e.ns.m("highlight-current")]:e.highlightCurrent}]),role:"tree"},[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.root.childNodes,C=>(openBlock(),createBlock(c,{key:e.getNodeKey(C),node:C,props:e.props,accordion:e.accordion,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,"render-content":e.renderContent,onNodeExpand:e.handleNodeExpand},null,8,["node","props","accordion","render-after-expand","show-checkbox","render-content","onNodeExpand"]))),128)),e.isEmpty?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass(e.ns.e("empty-block"))},[renderSlot(e.$slots,"empty",{},()=>{var C;return[createBaseVNode("span",{class:normalizeClass(e.ns.e("empty-text"))},toDisplayString((C=e.emptyText)!=null?C:e.t("el.tree.emptyText")),3)]})],2)):createCommentVNode("v-if",!0),withDirectives(createBaseVNode("div",{ref:"dropIndicator$",class:normalizeClass(e.ns.e("drop-indicator"))},null,2),[[vShow,e.dragState.showDropIndicator]])],2)}var Tree=_export_sfc(_sfc_main$5,[["render",_sfc_render],["__file","tree.vue"]]);const ElTree=withInstall(Tree),useSelect=(e,{attrs:o,emit:n},{select:r,tree:a,key:l})=>{const c=useNamespace("tree-select");return watch(()=>e.data,()=>{e.filterable&&nextTick(()=>{var p,N;(N=a.value)==null||N.filter((p=r.value)==null?void 0:p.states.inputValue)})},{flush:"post"}),{...pick(toRefs(e),Object.keys(ElSelect.props)),...o,"onUpdate:modelValue":p=>n(UPDATE_MODEL_EVENT,p),valueKey:l,popperClass:computed(()=>{const p=[c.e("popper")];return e.popperClass&&p.push(e.popperClass),p.join(" ")}),filterMethod:(p="")=>{var N;e.filterMethod?e.filterMethod(p):e.remoteMethod?e.remoteMethod(p):(N=a.value)==null||N.filter(p)}}},component=defineComponent({extends:ElOption,setup(e,o){const n=ElOption.setup(e,o);delete n.selectOptionClick;const r=getCurrentInstance().proxy;return nextTick(()=>{n.select.states.cachedOptions.get(r.value)||n.select.onOptionCreate(r)}),watch(()=>o.attrs.visible,a=>{n.states.visible=a},{immediate:!0}),n},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function isValidValue(e){return e||e===0}function isValidArray(e){return Array.isArray(e)&&e.length}function toValidArray(e){return Array.isArray(e)?e:isValidValue(e)?[e]:[]}function treeFind(e,o,n,r,a){for(let l=0;l<e.length;l++){const c=e[l];if(o(c,l,e,a))return r?r(c,l,e,a):c;{const C=n(c);if(isValidArray(C)){const p=treeFind(C,o,n,r,c);if(p)return p}}}}function treeEach(e,o,n,r){for(let a=0;a<e.length;a++){const l=e[a];o(l,a,e,r);const c=n(l);isValidArray(c)&&treeEach(c,o,n,l)}}const useTree=(e,{attrs:o,slots:n,emit:r},{select:a,tree:l,key:c})=>{watch(()=>e.modelValue,()=>{e.showCheckbox&&nextTick(()=>{const f=l.value;f&&!isEqual(f.getCheckedKeys(),toValidArray(e.modelValue))&&f.setCheckedKeys(toValidArray(e.modelValue))})},{immediate:!0,deep:!0});const C=computed(()=>({value:c.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),p=(f,w)=>{var x;const b=C.value[f];return isFunction(b)?b(w,(x=l.value)==null?void 0:x.getNode(p("value",w))):w[b]},N=toValidArray(e.modelValue).map(f=>treeFind(e.data||[],w=>p("value",w)===f,w=>p("children",w),(w,x,b,s)=>s&&p("value",s))).filter(f=>isValidValue(f)),u=computed(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const f=[];return treeEach(e.data.concat(e.cacheData),w=>{const x=p("value",w);f.push({value:x,currentLabel:p("label",w),isDisabled:p("disabled",w)})},w=>p("children",w)),f}),y=()=>{var f;return(f=l.value)==null?void 0:f.getCheckedKeys().filter(w=>{var x;const b=(x=l.value)==null?void 0:x.getNode(w);return!isNil(b)&&isEmpty(b.childNodes)})};return{...pick(toRefs(e),Object.keys(ElTree.props)),...o,nodeKey:c,expandOnClickNode:computed(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:computed(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(N):N),renderContent:(f,{node:w,data:x,store:b})=>f(component,{value:p("value",x),label:p("label",x),disabled:p("disabled",x),visible:w.visible},e.renderContent?()=>e.renderContent(f,{node:w,data:x,store:b}):n.default?()=>n.default({node:w,data:x,store:b}):void 0),filterNodeMethod:(f,w,x)=>e.filterNodeMethod?e.filterNodeMethod(f,w,x):f?new RegExp(escapeStringRegexp(f),"i").test(p("label",w)||""):!0,onNodeClick:(f,w,x)=>{var b,s,$,O;if((b=o.onNodeClick)==null||b.call(o,f,w,x),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||w.isLeaf)){if(!p("disabled",f)){const S=(s=a.value)==null?void 0:s.states.options.get(p("value",f));($=a.value)==null||$.handleOptionSelect(S)}}else e.expandOnClickNode&&x.proxy.handleExpandIconClick();(O=a.value)==null||O.focus()}},onCheck:(f,w)=>{var x;if(!e.showCheckbox)return;const b=p("value",f),s={};treeEach([l.value.store.root],I=>s[I.key]=I,I=>I.childNodes);const $=w.checkedKeys,O=e.multiple?toValidArray(e.modelValue).filter(I=>!(I in s)&&!$.includes(I)):[],S=O.concat($);if(e.checkStrictly)r(UPDATE_MODEL_EVENT,e.multiple?S:S.includes(b)?b:void 0);else if(e.multiple){const I=y();r(UPDATE_MODEL_EVENT,O.concat(I))}else{const I=treeFind([f],K=>!isValidArray(p("children",K))&&!p("disabled",K),K=>p("children",K)),M=I?p("value",I):void 0,j=isValidValue(e.modelValue)&&!!treeFind([f],K=>p("value",K)===e.modelValue,K=>p("children",K));r(UPDATE_MODEL_EVENT,M===e.modelValue||j?void 0:M)}nextTick(()=>{var I;const M=toValidArray(e.modelValue);l.value.setCheckedKeys(M),(I=o.onCheck)==null||I.call(o,f,{checkedKeys:l.value.getCheckedKeys(),checkedNodes:l.value.getCheckedNodes(),halfCheckedKeys:l.value.getHalfCheckedKeys(),halfCheckedNodes:l.value.getHalfCheckedNodes()})}),(x=a.value)==null||x.focus()},onNodeExpand:(f,w,x)=>{var b;(b=o.onNodeExpand)==null||b.call(o,f,w,x),nextTick(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&w.checked){const s={},$=l.value.getCheckedKeys();treeEach([l.value.store.root],I=>s[I.key]=I,I=>I.childNodes);const O=toValidArray(e.modelValue).filter(I=>!(I in s)&&!$.includes(I)),S=y();r(UPDATE_MODEL_EVENT,O.concat(S))}})},cacheOptions:u}};var CacheOptions=defineComponent({props:{data:{type:Array,default:()=>[]}},setup(e){const o=inject(selectKey);return watch(()=>e.data,()=>{var n;e.data.forEach(a=>{o.states.cachedOptions.has(a.value)||o.states.cachedOptions.set(a.value,a)});const r=((n=o.selectRef)==null?void 0:n.querySelectorAll("input"))||[];isClient&&!Array.from(r).includes(document.activeElement)&&o.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const _sfc_main$4=defineComponent({name:"ElTreeSelect",inheritAttrs:!1,props:{...ElSelect.props,...ElTree.props,cacheData:{type:Array,default:()=>[]}},setup(e,o){const{slots:n,expose:r}=o,a=ref(),l=ref(),c=computed(()=>e.nodeKey||e.valueKey||"value"),C=useSelect(e,o,{select:a,tree:l,key:c}),{cacheOptions:p,...N}=useTree(e,o,{select:a,tree:l,key:c}),u=reactive({});return r(u),onMounted(()=>{Object.assign(u,{...pick(l.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...pick(a.value,["focus","blur"])})}),()=>h(ElSelect,reactive({...C,ref:y=>a.value=y}),{...n,default:()=>[h(CacheOptions,{data:p.value}),h(ElTree,reactive({...N,ref:y=>l.value=y}))]})}});var TreeSelect=_export_sfc(_sfc_main$4,[["__file","tree-select.vue"]]);const ElTreeSelect=withInstall(TreeSelect),_hoisted_1$3={key:0,class:"mask-box"},_hoisted_2$3={flex:"","flex-row":"","flex-items-center":""},_hoisted_3$3={key:1,class:"mask-box show-mask"},_hoisted_4$3={key:2,class:"label"},_hoisted_5$2={key:3,flex:"","flex-row":"","flex-items-center":""},_sfc_main$3=defineComponent({__name:"DialogArgItem",props:{argItem:{type:Object,required:!0},edit:{type:Boolean,default:!1}},emits:["onEdit","onDelete"],setup(e,{emit:o}){useCssVars(N=>({ea0ac288:unref(l),"5636247c":unref(c)}));const n=o,r=N=>["switch","numberInput","numberRangeInput"].includes(N)?"row-item arg-item":"arg-item",a=["input","FileInput","DirInput","slider"],{appAsideBgColor:l}=useAppTheme(),c=computed(()=>(l.value==="#272727"?"#f6f6f6":"#272727")+"B0"),C=N=>{n("onEdit",N)},p=N=>{n("onDelete",N)};return(N,u)=>{const y=ElTag,f=ElText,w=ElIcon,x=ElButton,b=ElButtonGroup,s=ElSelect,$=__unplugin_components_6$1,O=__unplugin_components_5,S=__unplugin_components_7,I=ElSwitch,M=__unplugin_components_10,j=ElInputNumber,K=ElInput,D=_sfc_main$9;return openBlock(),createElementBlock("div",{class:normalizeClass(r(e.argItem.componentType))},[e.edit?(openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("div",_hoisted_2$3,[createVNode(y,{type:"primary",size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.argItem.componentType),1)]),_:1}),createVNode(f,{class:"info"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.argItem.name),1)]),_:1})]),createVNode(b,null,{default:withCtx(()=>[createVNode(x,{onClick:u[0]||(u[0]=i=>C(e.argItem.id)),link:"",class:"btn",type:"primary"},{default:withCtx(()=>[createVNode(w,{class:"btn"},{default:withCtx(()=>u[11]||(u[11]=[createBaseVNode("span",{"i-mdi-playlist-edit":"",class:"btn"},null,-1)])),_:1})]),_:1}),createVNode(x,{type:"danger",onClick:u[1]||(u[1]=i=>p(e.argItem.id)),link:"",class:"btn"},{default:withCtx(()=>[createVNode(w,{class:"btn"},{default:withCtx(()=>u[12]||(u[12]=[createBaseVNode("span",{"i-mdi-delete-outline":"",class:"btn"},null,-1)])),_:1})]),_:1})]),_:1})])):(openBlock(),createElementBlock("div",_hoisted_3$3)),e.argItem?.label!==void 0&&!a.includes(e.argItem.componentType)&&e.edit?(openBlock(),createElementBlock("span",_hoisted_4$3,toDisplayString(e.argItem.label),1)):createCommentVNode("",!0),e.edit?(openBlock(),createElementBlock(Fragment,{key:4},[e.argItem&&e.argItem.componentType==="select"?(openBlock(),createBlock(s,{key:0,modelValue:e.argItem.value,"onUpdate:modelValue":u[2]||(u[2]=i=>e.argItem.value=i),filterable:"",multiple:e.argItem.multiple,clearable:e.argItem.multiple,"allow-create":!e.argItem.notAllowCreate,"default-first-option":"",placeholder:e.argItem.placeholder||"请选择"},null,8,["modelValue","multiple","clearable","allow-create","placeholder"])):e.argItem&&e.argItem.componentType==="FileInput"?(openBlock(),createBlock($,{key:1,modelValue:e.argItem.value,"onUpdate:modelValue":u[3]||(u[3]=i=>e.argItem.value=i),label:e.argItem.label,verify:e.argItem.verifyPath,multiple:e.argItem.multiple},null,8,["modelValue","label","verify","multiple"])):e.argItem&&e.argItem.componentType==="RectInput"?(openBlock(),createBlock(O,{key:2,modelValue:e.argItem.value,"onUpdate:modelValue":u[4]||(u[4]=i=>e.argItem.value=i)},null,8,["modelValue"])):e.argItem&&e.argItem.componentType==="slider"?(openBlock(),createBlock(S,{key:3,modelValue:e.argItem.value,"onUpdate:modelValue":u[5]||(u[5]=i=>e.argItem.value=i),max:e.argItem.range?.max,min:e.argItem.range?.min,step:e.argItem.range?.step,label:e.argItem.label,size:"small",width:100},null,8,["modelValue","max","min","step","label"])):e.argItem&&e.argItem.componentType==="switch"?(openBlock(),createBlock(I,{key:4,modelValue:e.argItem.value,"onUpdate:modelValue":u[6]||(u[6]=i=>e.argItem.value=i),"active-text":e.argItem.activeText||"是","inactive-text":e.argItem.inactiveText||"否",size:"small"},null,8,["modelValue","active-text","inactive-text"])):e.argItem&&e.argItem.componentType==="DirInput"?(openBlock(),createBlock(M,{key:5,modelValue:e.argItem.value,"onUpdate:modelValue":u[7]||(u[7]=i=>e.argItem.value=i),label:e.argItem.label,suffix:e.argItem.suffix||"",verify:e.argItem.verifyPath},null,8,["modelValue","label","suffix","verify"])):e.argItem&&e.argItem.componentType==="numberInput"?(openBlock(),createBlock(j,{key:6,modelValue:e.argItem.value,"onUpdate:modelValue":u[8]||(u[8]=i=>e.argItem.value=i),"value-on-clear":0,size:"small"},null,8,["modelValue"])):e.argItem&&e.argItem.componentType==="input"?(openBlock(),createBlock(K,{key:7,modelValue:e.argItem.value,"onUpdate:modelValue":u[9]||(u[9]=i=>e.argItem.value=i),size:"small"},{prepend:withCtx(()=>[createTextVNode(toDisplayString(e.argItem.label),1)]),_:1},8,["modelValue"])):e.argItem&&e.argItem.componentType==="numberRangeInput"?(openBlock(),createBlock(D,{key:8,modelValue:e.argItem.value,"onUpdate:modelValue":u[10]||(u[10]=i=>e.argItem.value=i)},null,8,["modelValue"])):createCommentVNode("",!0)],64)):(openBlock(),createElementBlock("div",_hoisted_5$2,[createVNode(y,{type:"primary",size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.argItem.componentType),1)]),_:1}),createVNode(f,null,{default:withCtx(()=>[createTextVNode(toDisplayString(e.argItem.label),1)]),_:1})]))],2)}}}),__unplugin_components_13$1=_export_sfc$1(_sfc_main$3,[["__scopeId","data-v-cef03f0f"]]),_hoisted_1$2={class:"dialog-form"},_hoisted_2$2={"w-full":"",flex:"","flex-row":"","pos-relative":"","h-85vh":"","position-relative":""},_hoisted_3$2={"overflow-y-scroll":"","overflow-x-hidden":"","p-3":"","box-border":"",class:"b1"},_hoisted_4$2={"flex-1":"","h-full":"","overflow-y-scroll":"","overflow-x-hidden":"","ml-1":"","p-3":"","box-border":"",class:"b1"},_sfc_main$2=defineComponent({__name:"DialogArgEditor",props:mergeModels({documentParams:{type:Array,default:[]}},{modelValue:{default:[]},modelModifiers:{}}),emits:["update:modelValue"],setup(__props){useCssVars(e=>({"4f3ba3ac":unref(appAsideBgColor)}));const props=__props,editDialogForm=reactive({componentType:void 0,noTest:!1,onlyTest:!1,name:"",label:"",displayCondition:[],placeholder:"请输入",component:{select:{optionType:"array",options:[],fnOptionsStr:'(store) => {return ["a1","a2"]}',selectOptionSeparator:"",notAllowCreate:!1,multiple:!1,value:"",mValue:[]},fileInput:{verifyPath:!1,suffix:"",multiple:!1,value:"",mValue:[]},input:{value:""},rectInput:{value:{x:0,y:0,width:0,height:0},targetSrc:""},slider:{value:0,range:{min:0,max:100,step:1}},switch:{value:!1,activeText:"是",inactiveText:"否"},dirInput:{value:"",suffix:"",verifyPath:!1},numberInput:{value:0},numberRangeInput:{value:[0,100],limit:[0,100]}},dialog:{visible:!1,targetId:""}}),onOnlyTestChange=()=>{editDialogForm.onlyTest&&(editDialogForm.noTest=!1)},onNoTestChange=()=>{editDialogForm.noTest&&(editDialogForm.onlyTest=!1)},model=useModel(__props,"modelValue"),displayConditionOption=computed(()=>model.value.filter(e=>e.name!==editDialogForm.name).map(e=>({id:e.id,name:e.name,label:e.label}))),localArgs=[{componentType:"input",value:"",desc:"文本输入框"},{componentType:"RectInput",value:{x:0,y:0,width:0,height:0},targetSrc:"",desc:"矩形参数输入框"},{componentType:"slider",value:0,range:{min:0,max:100,step:1},desc:"滑块进度条"},{componentType:"switch",value:!1,activeText:"是",inactiveText:"否",desc:"切换按钮"},{componentType:"DirInput",value:"",suffix:"",verifyPath:!1,desc:"目录输入框"},{componentType:"numberInput",value:0,desc:"数字输入框"},{componentType:"numberRangeInput",value:[0,100],limit:[0,100],desc:"数字范围输入框"},{desc:"单选下拉框(字符串数组选项)",componentType:"select",value:"",options:[],selectOptionSeparator:"",notAllowCreate:!0,multiple:!1},{desc:"单选下拉框(函数返回选项)",componentType:"select",value:"",options:e=>["Option1","Option2"],selectOptionSeparator:"",notAllowCreate:!0,multiple:!1},{desc:"多选下拉框",componentType:"select",value:[],options:[],selectOptionSeparator:"",notAllowCreate:!1,multiple:!0},{componentType:"FileInput",value:"",suffix:"",verifyPath:!1,desc:"单文件选择"},{componentType:"FileInput",value:[],suffix:"",verifyPath:!1,desc:"多文件选择",multiple:!0}].map(e=>({...e,id:nanoid(),onlyTest:!1,noTest:!1,name:"",label:e.desc||e.componentType,displayCondition:[],placeholder:""})),clone=e=>({...e,id:nanoid(),label:e.desc}),{appAsideBgColor}=useAppTheme(),parseFnStr=fnStr=>{try{const fn=eval(fnStr);return fn(useListStore())}catch(e){return[]}},editArg=e=>{const o=model.value?.find(n=>n.id===e);if(o){if(editDialogForm.componentType=o.componentType,editDialogForm.noTest=!!o.noTest,editDialogForm.onlyTest=!!o.onlyTest,editDialogForm.name=o.name,editDialogForm.label=o.label,editDialogForm.displayCondition=o.displayCondition||[],editDialogForm.placeholder=o.placeholder||"",o.componentType==="select"){const n=o,r=Array.isArray(n.options)?"array":"function";editDialogForm.component.select.optionType=r,Array.isArray(n.options)?editDialogForm.component.select.options=n.options.map(a=>""+a):editDialogForm.component.select.fnOptionsStr=n.options.toString(),editDialogForm.component.select.selectOptionSeparator=n.selectOptionSeparator||"",editDialogForm.component.select.notAllowCreate=!!n.notAllowCreate,editDialogForm.component.select.multiple=!!n.multiple,n.multiple?editDialogForm.component.select.mValue=n.value:editDialogForm.component.select.value=n.value}else if(o.componentType==="FileInput"){const n=o;editDialogForm.component.fileInput.verifyPath=!!n.verifyPath,editDialogForm.component.fileInput.suffix=n.suffix||"",editDialogForm.component.fileInput.multiple=!!n.multiple,n.multiple?editDialogForm.component.fileInput.mValue=n.value:editDialogForm.component.fileInput.value=n.value}else if(o.componentType==="input"){const n=o;editDialogForm.component.input.value=n.value}else if(o.componentType==="RectInput"){const n=o;editDialogForm.component.rectInput.value=n.value,editDialogForm.component.rectInput.targetSrc=n.targetSrc||""}else if(o.componentType==="slider"){const n=o;editDialogForm.component.slider.value=n.value,editDialogForm.component.slider.range=n.range}else if(o.componentType==="switch"){const n=o;editDialogForm.component.switch.value=n.value,editDialogForm.component.switch.activeText=n.activeText||"是",editDialogForm.component.switch.inactiveText=n.inactiveText||"否"}else if(o.componentType==="DirInput"){const n=o;editDialogForm.component.dirInput.value=n.value,editDialogForm.component.dirInput.suffix=n.suffix||"",editDialogForm.component.dirInput.verifyPath=!!n.verifyPath}else if(o.componentType==="numberInput"){const n=o;editDialogForm.component.numberInput.value=n.value}else if(o.componentType==="numberRangeInput"){const n=o;editDialogForm.component.numberRangeInput.value=n.value,editDialogForm.component.numberRangeInput.limit=n.limit||[0,0]}editDialogForm.dialog.targetId=e,editDialogForm.dialog.visible=!0}else ElMessage.error("编辑失败：未找到对应参数!")},editDialogCallback=()=>{const target=model.value?.find(e=>e.id===editDialogForm.dialog.targetId&&e.componentType===editDialogForm.componentType);if(target){if(target.componentType==="DirInput")target.suffix=editDialogForm.component.dirInput.suffix,target.verifyPath=editDialogForm.component.dirInput.verifyPath,target.value=editDialogForm.component.dirInput.value;else if(target.componentType==="FileInput"){if(editDialogForm.component.fileInput.multiple){const e=target;e.multiple=!0,e.value=editDialogForm.component.fileInput.mValue}else{const e=target;e.multiple=!1,e.value=editDialogForm.component.fileInput.value}target.suffix=editDialogForm.component.fileInput.suffix,target.verifyPath=editDialogForm.component.fileInput.verifyPath}else if(target.componentType==="input")target.value=editDialogForm.component.input.value;else if(target.componentType==="RectInput")target.value=editDialogForm.component.rectInput.value,target.targetSrc=editDialogForm.component.rectInput.targetSrc;else if(target.componentType==="slider")target.value=editDialogForm.component.slider.value,target.range=editDialogForm.component.slider.range;else if(target.componentType==="switch")target.value=editDialogForm.component.switch.value,target.activeText=editDialogForm.component.switch.activeText,target.inactiveText=editDialogForm.component.switch.inactiveText;else if(target.componentType==="numberInput")target.value=editDialogForm.component.numberInput.value;else if(target.componentType==="numberRangeInput")target.value=editDialogForm.component.numberRangeInput.value,target.limit=editDialogForm.component.numberRangeInput.limit;else{const{multiple}=editDialogForm.component.select;editDialogForm.component.select.optionType==="array"?target.options=editDialogForm.component.select.options:target.options=eval(editDialogForm.component.select.fnOptionsStr);const t=target;multiple?(t.value=editDialogForm.component.select.mValue,t.multiple=!0):(t.value=editDialogForm.component.select.value,t.multiple=!1),target.selectOptionSeparator=editDialogForm.component.select.selectOptionSeparator,target.notAllowCreate=editDialogForm.component.select.notAllowCreate}target.name=editDialogForm.name,target.label=editDialogForm.label,target.displayCondition=editDialogForm.displayCondition,target.placeholder=editDialogForm.placeholder,target.noTest=editDialogForm.noTest,target.onlyTest=editDialogForm.onlyTest,ElMessage.success("编辑成功")}else ElMessage.error("编辑失败：未找到对应参数!");editDialogForm.dialog.visible=!1},delArg=e=>{model.value=model.value?.filter(o=>o.id!==e),ElMessage.success("删除成功")};return(e,o)=>{const n=ElOption,r=ElSelect,a=ElInput,l=ElFormItem,c=ElSwitch,C=__unplugin_components_5,p=ElInputNumber,N=__unplugin_components_7,u=_sfc_main$9,y=ElForm,f=_sfc_main$a,w=ElText,x=ElDivider,b=__unplugin_components_13$1;return openBlock(),createElementBlock(Fragment,null,[createVNode(f,{callback:editDialogCallback,title:"修改参数",modelValue:unref(editDialogForm).dialog.visible,"onUpdate:modelValue":o[36]||(o[36]=s=>unref(editDialogForm).dialog.visible=s)},{element:withCtx(()=>[createBaseVNode("div",_hoisted_1$2,[createVNode(y,{"label-position":"left","label-width":"150px",model:unref(editDialogForm)},{default:withCtx(()=>[createVNode(l,{label:"字段命名",prop:"name"},{default:withCtx(()=>[props.documentParams.length?(openBlock(),createBlock(r,{key:0,modelValue:unref(editDialogForm).name,"onUpdate:modelValue":o[0]||(o[0]=s=>unref(editDialogForm).name=s),filterable:"","allow-create":""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(props.documentParams,s=>(openBlock(),createBlock(n,{key:s.id,label:s.name,value:s.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(openBlock(),createBlock(a,{key:1,modelValue:unref(editDialogForm).name,"onUpdate:modelValue":o[1]||(o[1]=s=>unref(editDialogForm).name=s)},null,8,["modelValue"]))]),_:1}),createVNode(l,{label:"字段标签",prop:"label"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).label,"onUpdate:modelValue":o[2]||(o[2]=s=>unref(editDialogForm).label=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"不在API调试中使用",prop:"noTest"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).noTest,"onUpdate:modelValue":o[3]||(o[3]=s=>unref(editDialogForm).noTest=s),onChange:onNoTestChange},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"仅在API调试中使用",prop:"onlyTest"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).onlyTest,"onUpdate:modelValue":o[4]||(o[4]=s=>unref(editDialogForm).onlyTest=s),onChange:onOnlyTestChange},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"显示条件",prop:"displayCondition"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).displayCondition,"onUpdate:modelValue":o[5]||(o[5]=s=>unref(editDialogForm).displayCondition=s),multiple:"",placeholder:"选择被依赖的字段，当被依赖字段值为true时本字段才显示"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(displayConditionOption),s=>(openBlock(),createBlock(n,{key:s.id,label:s.name+`(${s.label})`,value:s.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),createVNode(l,{label:"输入提示",prop:"placeholder"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).placeholder,"onUpdate:modelValue":o[6]||(o[6]=s=>unref(editDialogForm).placeholder=s)},null,8,["modelValue"])]),_:1}),unref(editDialogForm).componentType==="DirInput"?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(l,{label:"后缀",prop:"component.dirInput.suffix"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).component.dirInput.suffix,"onUpdate:modelValue":o[7]||(o[7]=s=>unref(editDialogForm).component.dirInput.suffix=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"验证路径",prop:"component.dirInput.verifyPath"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.dirInput.verifyPath,"onUpdate:modelValue":o[8]||(o[8]=s=>unref(editDialogForm).component.dirInput.verifyPath=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"默认值",prop:"component.dirInput.value"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).component.dirInput.value,"onUpdate:modelValue":o[9]||(o[9]=s=>unref(editDialogForm).component.dirInput.value=s)},null,8,["modelValue"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="FileInput"?(openBlock(),createElementBlock(Fragment,{key:1},[createVNode(l,{label:"后缀",prop:"component.fileInput.suffix"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).component.fileInput.suffix,"onUpdate:modelValue":o[10]||(o[10]=s=>unref(editDialogForm).component.fileInput.suffix=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"验证路径",prop:"component.fileInput.verifyPath"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.fileInput.verifyPath,"onUpdate:modelValue":o[11]||(o[11]=s=>unref(editDialogForm).component.fileInput.verifyPath=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"是否多选",prop:"component.fileInput.multiple"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.fileInput.multiple,"onUpdate:modelValue":o[12]||(o[12]=s=>unref(editDialogForm).component.fileInput.multiple=s)},null,8,["modelValue"])]),_:1}),unref(editDialogForm).component.fileInput.multiple?(openBlock(),createBlock(l,{key:0,label:"默认值",prop:"component.fileInput.mValue"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.fileInput.mValue,"onUpdate:modelValue":o[13]||(o[13]=s=>unref(editDialogForm).component.fileInput.mValue=s),multiple:"","allow-create":"",filterable:""},null,8,["modelValue"])]),_:1})):(openBlock(),createBlock(l,{key:1,label:"默认值",prop:"component.fileInput.value"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).component.fileInput.value,"onUpdate:modelValue":o[14]||(o[14]=s=>unref(editDialogForm).component.fileInput.value=s)},null,8,["modelValue"])]),_:1}))],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="input"?(openBlock(),createBlock(l,{key:2,label:"默认值",prop:"component.input.value"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).component.input.value,"onUpdate:modelValue":o[15]||(o[15]=s=>unref(editDialogForm).component.input.value=s)},null,8,["modelValue"])]),_:1})):createCommentVNode("",!0),unref(editDialogForm).componentType==="RectInput"?(openBlock(),createElementBlock(Fragment,{key:3},[createVNode(l,{label:"目标图片路径",prop:"component.rectInput.targetSrc"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).component.rectInput.targetSrc,"onUpdate:modelValue":o[16]||(o[16]=s=>unref(editDialogForm).component.rectInput.targetSrc=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"默认值",prop:"component.rectInput.value"},{default:withCtx(()=>[createVNode(C,{modelValue:unref(editDialogForm).component.rectInput.value,"onUpdate:modelValue":o[17]||(o[17]=s=>unref(editDialogForm).component.rectInput.value=s)},null,8,["modelValue"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="select"?(openBlock(),createElementBlock(Fragment,{key:4},[createVNode(l,{label:"选项类型",prop:"component.select.optionType"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.select.optionType,"onUpdate:modelValue":o[18]||(o[18]=s=>unref(editDialogForm).component.select.optionType=s)},{default:withCtx(()=>[createVNode(n,{label:"数组",value:"array"}),createVNode(n,{label:"函数",value:"function"})]),_:1},8,["modelValue"])]),_:1}),unref(editDialogForm).component.select.optionType==="array"?(openBlock(),createBlock(l,{key:0,label:"选项",prop:"component.select.options"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.select.options,"onUpdate:modelValue":o[19]||(o[19]=s=>unref(editDialogForm).component.select.options=s),multiple:"",filterable:"","allow-create":""},null,8,["modelValue"])]),_:1})):(openBlock(),createBlock(l,{key:1,label:"选项",prop:"component.select.fnOptionsStr"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).component.select.fnOptionsStr,"onUpdate:modelValue":o[20]||(o[20]=s=>unref(editDialogForm).component.select.fnOptionsStr=s)},null,8,["modelValue"])]),_:1})),createVNode(l,{label:"选项分隔符",prop:"component.select.selectOptionSeparator"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).component.select.selectOptionSeparator,"onUpdate:modelValue":o[21]||(o[21]=s=>unref(editDialogForm).component.select.selectOptionSeparator=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"是否多选",prop:"component.select.multiple"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.select.multiple,"onUpdate:modelValue":o[22]||(o[22]=s=>unref(editDialogForm).component.select.multiple=s)},null,8,["modelValue"])]),_:1}),unref(editDialogForm).component.select.multiple?(openBlock(),createBlock(l,{key:2,label:"不允许新建",prop:"component.select.notAllowCreate"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.select.notAllowCreate,"onUpdate:modelValue":o[23]||(o[23]=s=>unref(editDialogForm).component.select.notAllowCreate=s)},null,8,["modelValue"])]),_:1})):createCommentVNode("",!0),unref(editDialogForm).component.select.multiple?(openBlock(),createBlock(l,{key:3,label:"默认值",prop:"component.select.mValue"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.select.mValue,"onUpdate:modelValue":o[24]||(o[24]=s=>unref(editDialogForm).component.select.mValue=s),multiple:"","allow-create":!unref(editDialogForm).component.select.notAllowCreate,filterable:""},{default:withCtx(()=>[unref(editDialogForm).component.select.optionType==="array"?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(unref(editDialogForm).component.select.options,s=>(openBlock(),createBlock(n,{key:s,label:s,value:s},null,8,["label","value"]))),128)):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(parseFnStr(unref(editDialogForm).component.select.fnOptionsStr),s=>(openBlock(),createBlock(n,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue","allow-create"])]),_:1})):(openBlock(),createBlock(l,{key:4,label:"默认值",prop:"component.select.value"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.select.value,"onUpdate:modelValue":o[25]||(o[25]=s=>unref(editDialogForm).component.select.value=s),"allow-create":!unref(editDialogForm).component.select.notAllowCreate,filterable:""},{default:withCtx(()=>[unref(editDialogForm).component.select.optionType==="array"?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(unref(editDialogForm).component.select.options,s=>(openBlock(),createBlock(n,{key:s,label:s,value:s},null,8,["label","value"]))),128)):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(parseFnStr(unref(editDialogForm).component.select.fnOptionsStr),s=>(openBlock(),createBlock(n,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue","allow-create"])]),_:1}))],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="slider"?(openBlock(),createElementBlock(Fragment,{key:5},[createVNode(l,{label:"最小值",prop:"component.slider.range.min"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.slider.range.min,"onUpdate:modelValue":o[26]||(o[26]=s=>unref(editDialogForm).component.slider.range.min=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"最大值",prop:"component.slider.range.max"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.slider.range.max,"onUpdate:modelValue":o[27]||(o[27]=s=>unref(editDialogForm).component.slider.range.max=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"步长",prop:"component.slider.range.step"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.slider.range.step,"onUpdate:modelValue":o[28]||(o[28]=s=>unref(editDialogForm).component.slider.range.step=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"默认值",prop:"component.slider.value"},{default:withCtx(()=>[createVNode(N,{modelValue:unref(editDialogForm).component.slider.value,"onUpdate:modelValue":o[29]||(o[29]=s=>unref(editDialogForm).component.slider.value=s),step:unref(editDialogForm).component.slider.range.step,min:unref(editDialogForm).component.slider.range.min,max:unref(editDialogForm).component.slider.range.max,width:100,label:"默认值","hide-label":""},null,8,["modelValue","step","min","max"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="switch"?(openBlock(),createElementBlock(Fragment,{key:6},[createVNode(l,{label:"开启文本",prop:"component.switch.activeText"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).component.switch.activeText,"onUpdate:modelValue":o[30]||(o[30]=s=>unref(editDialogForm).component.switch.activeText=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"关闭文本",prop:"component.switch.inactiveText"},{default:withCtx(()=>[createVNode(a,{modelValue:unref(editDialogForm).component.switch.inactiveText,"onUpdate:modelValue":o[31]||(o[31]=s=>unref(editDialogForm).component.switch.inactiveText=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"默认值",prop:"component.switch.value"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.switch.value,"onUpdate:modelValue":o[32]||(o[32]=s=>unref(editDialogForm).component.switch.value=s),"active-text":unref(editDialogForm).component.switch.activeText,"inactive-text":unref(editDialogForm).component.switch.inactiveText},null,8,["modelValue","active-text","inactive-text"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="numberInput"?(openBlock(),createBlock(l,{key:7,label:"默认值",prop:"component.numberInput.value"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.numberInput.value,"onUpdate:modelValue":o[33]||(o[33]=s=>unref(editDialogForm).component.numberInput.value=s)},null,8,["modelValue"])]),_:1})):createCommentVNode("",!0),unref(editDialogForm).componentType==="numberRangeInput"?(openBlock(),createElementBlock(Fragment,{key:8},[createVNode(l,{label:"范围限制",prop:"component.numberRangeInput.limit"},{default:withCtx(()=>[createVNode(u,{modelValue:unref(editDialogForm).component.numberRangeInput.limit,"onUpdate:modelValue":o[34]||(o[34]=s=>unref(editDialogForm).component.numberRangeInput.limit=s)},null,8,["modelValue"])]),_:1}),createVNode(l,{label:"默认值",prop:"component.numberRangeInput.value"},{default:withCtx(()=>[createVNode(u,{modelValue:unref(editDialogForm).component.numberRangeInput.value,"onUpdate:modelValue":o[35]||(o[35]=s=>unref(editDialogForm).component.numberRangeInput.value=s),limit:unref(editDialogForm).component.numberRangeInput.limit},null,8,["modelValue","limit"])]),_:1})],64)):createCommentVNode("",!0)]),_:1},8,["model"])])]),_:1},8,["modelValue"]),createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[createVNode(w,null,{default:withCtx(()=>o[39]||(o[39]=[createTextVNode("预设组件")])),_:1}),createVNode(x),createVNode(unref(lo),{modelValue:unref(localArgs),"onUpdate:modelValue":o[37]||(o[37]=s=>isRef(localArgs)?localArgs.value=s:null),animation:150,group:{name:"args",pull:"clone",put:!1},ghostClass:"ghost",clone,sort:!1},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(localArgs),s=>(openBlock(),createBlock(b,{key:s.id,argItem:s},null,8,["argItem"]))),128))]),_:1},8,["modelValue"])]),createBaseVNode("div",_hoisted_4$2,[createVNode(w,null,{default:withCtx(()=>o[40]||(o[40]=[createTextVNode("弹窗参数组件")])),_:1}),createVNode(x),createVNode(unref(lo),{"h-full":"","w-full":"",modelValue:model.value,"onUpdate:modelValue":o[38]||(o[38]=s=>model.value=s),animation:150,group:{name:"args"},ghostClass:"ghost",sort:!0},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(model.value,s=>(openBlock(),createBlock(b,{key:s.id,argItem:s,edit:"",onOnEdit:editArg,onOnDelete:delArg},null,8,["argItem"]))),128))]),_:1},8,["modelValue"])])])],64)}}}),__unplugin_components_13=_export_sfc$1(_sfc_main$2,[["__scopeId","data-v-9fcfe28b"]]),defaultInvokeTemplateOptions=()=>({name:"",scope:"",weight:1,disabled:!1,document:{howToUse:"",params:[],returnValue:{instructions:"",type:"void"},example:{title:"",code:""},searchKeys:[],codeSnippet:""},dialog:{title:"",content:"",args:[],notOpen:!1}});class InvokeTemplate{options;contentCache={};constructor(e){e.scope=e.scope||"",e.weight=e.weight||5,e.disabled=e.disabled!==void 0?e.disabled:!1,this.options=e}genParamList(){const e=this.options.document.params;return e?e.map(o=>{const n=Array.isArray(o.type)?o.type.map(r=>`"${r}"`).join(" | "):o.type;return o.default?`${o.name}: ${n} = ${o.type==="string"||Array.isArray(o.type)?`'${o.default}'`:o.default},`:n.trim().length?`${o.name}${o.required?"":"?"}: ${n},`:`${o.name},`}).join(`
  `):""}genArgList(){const e=this.options.dialog.args;if(e){const o=JSON.stringify(e,null,2),n=/"([^"]+)":/g;return o.replace(n,"$1:")}else return""}genCBOptionNames(){const e=this.options.dialog.args;return e?e.map(o=>o.name).join(", "):""}genCBOption(){const e=this.options.dialog.args;return e?.length?`${e.map(o=>{let n="string";const r=["numberInput","numberRangeInput","slider"];return o.componentType==="switch"?n="boolean":o.componentType==="RectInput"?n=`{
      x: number;
      y: number;
      width: number;
      height: number;
    }`:r.includes(o.componentType)&&(n="number"),`${o.name}: ${n}`}).join(`;
    `)};
    `:""}defaultSnippet(){const{returnValue:e,params:o}=this.options.document;let n="";if(e?.type){const r=e.type.toLocaleLowerCase();let a=0;e.type.toLocaleLowerCase()!=="promise<void>"&&e.type.toLocaleLowerCase()!=="void"&&e.type.toLocaleLowerCase()!=="undefined"&&(n="${1:const res = }",a++);const l=o?.map(c=>`\${${++a}:${Array.isArray(c.type)?c.type[0]:c.type==="string"?`'${c.name}'`:c.name}}`||"").join(", ")||"";n+=`${r.includes("promise")?"await ":""}${this.options.name}(${l});\${0:}`}return n}get indexTemplate(){return`import { apiDocument } from "./document";
import { ${this.options.name}Fn } from "./exportFn";
import { modelCallback } from "./modelCallback";
import { dialogOptions } from "./dialog";
import { declaration } from "./declaration";
import { auxiliary } from "./auxiliary";
export const ${this.options.name}Api = <InvokeApiMethodType>{
  ${this.options.scope.length?`scope: '${this.options.scope}',
  `:""}name: "${this.options.name}",
  exportFn: {
    fn: ${this.options.name}Fn,
  },
  testModule: {
    weight: ${this.options.weight},
    dialog: dialogOptions,
    callback: modelCallback,
    document: apiDocument,
  },
  //提供给编辑器的类型声明
  declaration,
  //编辑-快速填写或修改方法参数 辅助模块
  auxiliary${this.options.disabled?`,
  disabled: true`:""}
};`}genRetract(e,o=2){return" ".repeat(e*o)}genParamListStr(e,o=2){return`[${e?`
`+this.genRetract(o):""}${e?e.map(n=>`{
${this.genRetract(o+1)}name: "${n.name}",
${this.genRetract(o+1)}required: ${n.required?"true":"false"},
${this.genRetract(o+1)}instructions: "${n.instructions}",
${this.genRetract(o+1)}type: ${Array.isArray(n.type)?`[${n.type.map(r=>`'${r}'`).join(", ")}]`:`'${n.type}'`},
${this.genRetract(o+1)}default: "${n.type==="string"?`${n.default.includes('"')||n.default.includes("'")?`'${n.default}'`:n.default}`:n.default}",
${this.genRetract(o+1)}children: ${this.genParamListStr(n.children,o+2)}
${this.genRetract(o)}}`).join(`,
`+this.genRetract(o)):""}${e?`
`+this.genRetract(o-1):""}]`}get documentTemplate(){const d=this.options.document,prefixStr="export const apiDocument = <ApiDocumentType>",tempStr=`{
  howToUse: "${d.howToUse}",
  params: ${this.genParamListStr(d.params)},
  returnValue: {
    ${d?.returnValue?.instructions?`instructions: "${d.returnValue.instructions}",
    `:""}type: \`${d?.returnValue?.type||""}\`,
  },
  example: {
    ${d?.example?.title?`title: "${d.example.title.replace(/"/g,"'")}",`:'title: "",'}
    code: \`${d?.example?.code||""}\`,
  },
  searchKeys: [${d?.searchKeys?.map(e=>`'${e}'`).join(", ")}],
  codeSnippet:
    "${d?.codeSnippet||this.defaultSnippet()}",
};`;try{let res=JSON.stringify(eval(`const t = ${tempStr};t`),void 0,2);const regex=/"([^"]+)":/g;return res=res.replace(regex,"$1:"),`${prefixStr}${res}`}catch(e){return`${prefixStr}${tempStr}`}}get exportFnTemplate(){const e=this.options.name;return`export const ${e}Fn = async (
  ${this.genParamList()}
  taskId?: string
) => {
  const { notAllowedFnId } = useScriptRuntime();
  if (taskId && notAllowedFnId.value.includes(taskId)) {
    return false;
  }
  try {
    //TODO
  } catch (e) {
    console.error("${e}FnError: ", e);
  }
};`}get declaration(){return`export const declaration = \`${this.options.scope.length?"":"declare "}function ${this.options.name}(
  ${this.genParamList()}
): ${this.options.document.returnValue?.type||"void"};
\`;`}get dialogTemplate(){const{title:e,notOpen:o,content:n,args:r}=this.options.dialog;return`export const dialogOptions = <TestModuleDialogType>{
  ${o?`notOpen: true,
  `:""}${e?`title: "${e}",
  `:""}targetMethodName: "${this.options.name}",
  ${n?`content: "${n}",
  `:""}args: ${r?this.genArgList():"[]"}
};`}get dialogCBTemplate(){const{name:e,scope:o,document:n,dialog:r}=this.options,a=n.example?.code.replace(/\(.*\)/,`(${this.genCBOptionNames()})`);return r.notOpen?`export const modelCallback = async (
  _options: {
    ${this.genCBOption()}replaceCurFnArgs?: (targetArgs: string) => void;
  },
  testModuleCtx: {
    showDetails: ShowDetailsFn;
  }
) => {
  testModuleCtx.showDetails("此方法无法直接调用，请在脚本中使用！", "${o.length?`${o}.`:""}${e}");
};`:`import { auxiliary } from "./auxiliary";
import { ${e}Fn } from "./exportFn";
export const modelCallback = async (
  options: {
    ${this.genCBOption()}replaceCurFnArgs?: (targetArgs: string) => void;
  },
  testModuleCtx: {
    showDetails: ShowDetailsFn;
  }
) => {
  if (options.replaceCurFnArgs) {
    //快速填写或修改方法参数弹窗点击确定时
    auxiliary.parameterReplace(options);
    AutoTipUtils.apiAutoTip();
    return;
  }
  //测试调用时
  const { ${this.genCBOptionNames()} } = options;
  console.time("${e}耗时");
  const res = await ${e}Fn(${this.genCBOptionNames()});
  console.timeEnd("${e}耗时");
  const selfModule = getInvokeApiMethods().find((i) => i.name === "${e}"${o.length?` && i.scope === "${o}"`:""})?.testModule!;
  //修改示例代码
  selfModule.document!.example!.code = \`${a}\`;
  testModuleCtx.showDetails(JSON.stringify(res), "${o.length?`${o}.`:""}${e}");
};
`}get auxiliaryTemplate(){const{name:e,scope:o}=this.options;return`export const auxiliary = <AuxiliaryType>{
  //快速编辑/修改参数弹窗打开时触发
  onDialogOpen: async (_close,...args) => {
    //处理来自编辑器的参数
    const params = await AutoTipUtils.paramsProcess(...args);
    const selfModule = getInvokeApiMethods().find((i) => i.name === "${e}"${o.length?` && i.scope === "${o}"`:""});
    const dialog = selfModule!.testModule!.dialog;
    if (!dialog.args) {
      return;
    }
    //根据参数的位置给弹窗对应的组件进行回填赋值
    dialog.args.forEach((i, index) => {
      /**
       * 例如函数本身有5个参数，而弹窗只有两个参数，params为编辑器中输入的5个参数，
       * index为弹窗中的参数位置，i.value为弹窗中组件的值
       * @example:
      switch (index) {
        case 0:
          //第一个参数为RectInput组件的值，刚好是函数前四个参数，故赋值如下
          i.value = {
            x: +params[0] || 0,
            y: +params[1] || 0,
            width: +params[2] || 0,
            height: +params[3] || 0,
          };
          break;
        case 1:
          //第二个参数为FileInput组件的值，AutoTipUtils.pathStrReset用来处理路径字符串
          i.value = AutoTipUtils.pathStrReset(params[4] || "");
          break;
        default:
          break;
      }
      */
    });
  },
  /**
   * 参数处理方法, 快速填写/修改参数弹窗点击确定时，会将弹窗中组件的值传入options，
   * 并且提供一个replaceCurFnArgs方法用来替换编辑器中当前函数的参数
  */
  parameterReplace: (options: {
    ${this.genCBOption()}replaceCurFnArgs: (targetArgs: string) => void;
  }) => {
    //根据实际情况去替换编辑器中的参数
    options.replaceCurFnArgs(
        ""/*替换后的参数字符串*/
    );
  },
};
`}async create(){const{scope:e,name:o}=this.options;try{const n=await pathUtils.resolve(await pathUtils.getInstallDir(),"../../../src/invokes/"),r=await pathUtils.resolve(n,e.length?`${e}/${o}`:o),a=await pathUtils.join(r,"index.ts"),l=await pathUtils.join(r,"document.ts"),c=await pathUtils.join(r,"exportFn.ts"),C=await pathUtils.join(r,"dialog.ts"),p=await pathUtils.join(r,"auxiliary.ts"),N=await pathUtils.join(r,"declaration.ts"),u=await pathUtils.join(r,"modelCallback.ts");return await Promise.all([fsUtils.writeFile(a,this.indexTemplate),fsUtils.writeFile(l,this.documentTemplate),fsUtils.writeFile(c,this.exportFnTemplate),fsUtils.writeFile(C,this.dialogTemplate),fsUtils.writeFile(p,this.auxiliaryTemplate),fsUtils.writeFile(N,this.declaration),fsUtils.writeFile(u,this.dialogCBTemplate)]),!0}catch{return!1}}async syncOtherFileName(e,o){const n=this.options.name,r=new RegExp(`i\\.name\\s?={2,3}\\s?[\`"']${o}[\`"']`,"g");try{const a=await pathUtils.resolve(e,"../exportFn.ts");let l;this.contentCache[a]?l=this.contentCache[a]:l=await fsUtils.readFile(a);const c=l.replace(new RegExp(`${o}Fn`,"g"),n+"Fn"),C=await pathUtils.resolve(e,"../auxiliary.ts");let p;this.contentCache[C]?p=this.contentCache[C]:p=await fsUtils.readFile(C);const N=p.replace(r,`i.name === "${n}"`),u=await pathUtils.resolve(e,"../declaration.ts");let y;this.contentCache[u]?y=this.contentCache[u]:y=await fsUtils.readFile(u);const f=y.replace(new RegExp(`function ${o}`,"g"),`function ${n}`),w=await pathUtils.resolve(e,"../modelCallback.ts");let x;this.contentCache[w]?x=this.contentCache[w]:x=await fsUtils.readFile(w);let b=x.replace(new RegExp(`${o}Fn`,"g"),`${n}Fn`);b=b.replace(new RegExp(`${o}耗时`,"g"),`${n}耗时`),b=b.replace(r,`i.name === "${n}"`),b=b.replace(new RegExp(`"${o}"`,"g"),`"${n}"`),b=b.replace(new RegExp(`\\.${o}`,"g"),`.${n}`),b=b.replace(new RegExp(`${o}\\(`,"g"),`${n}(`);const s=await pathUtils.resolve(e,"../document.ts");let $;this.contentCache[s]?$=this.contentCache[s]:$=await fsUtils.readFile(s);const O=$.replace(new RegExp(`${o}\\(`,"g"),`${n}(`);await Promise.all([fsUtils.writeFile(a,c),fsUtils.writeFile(C,N),fsUtils.writeFile(u,f),fsUtils.writeFile(w,b),fsUtils.writeFile(s,O)]),this.contentCache[a]=l,this.contentCache[C]=p,this.contentCache[u]=y,this.contentCache[w]=x,this.contentCache[s]=$}catch(a){console.error("syncOtherFileName error:",a)}}async syncOtherFileScope(e,o){const n=this.options.scope,r=new RegExp(`i\\.scope\\s?={2,3}\\s?[\`"']${o}[\`"']`,"g"),a=`i.scope === "${n}"`;try{const l=await pathUtils.resolve(e,"../auxiliary.ts");let c;this.contentCache[l]?c=this.contentCache[l]:c=await fsUtils.readFile(l);const C=c.replace(r,a),p=await pathUtils.resolve(e,"../modelCallback.ts");let N;this.contentCache[p]?N=this.contentCache[p]:N=await fsUtils.readFile(p);let u=N.replace(r,`i.scope === "${n}"`);u=u.replace(new RegExp(`${o}\\.`,"g"),`${n}.`);const y=await pathUtils.resolve(e,"../document.ts");let f;this.contentCache[y]?f=this.contentCache[y]:f=await fsUtils.readFile(y);const w=f.replace(new RegExp(`${o}\\.`,"g"),`${n}.`),x=await pathUtils.resolve(e,"../declaration.ts");let b;this.contentCache[x]?b=this.contentCache[x]:b=await fsUtils.readFile(x);let s=b;this.options.scope.trim().length?s=b.replace(/declare /,""):s.includes("declare function")||(s=w.replace(/function /,"declare function ")),await Promise.all([fsUtils.writeFile(l,C),fsUtils.writeFile(p,u),fsUtils.writeFile(y,w),fsUtils.writeFile(x,s)]),this.contentCache[l]=c,this.contentCache[p]=N,this.contentCache[y]=f,this.contentCache[x]=b}catch(l){console.error("syncOtherFileScope error:",l)}}async applyIndexOptions(e,o){if(!await exists(e)){console.error(`文件${e}不存在`);return}let r;this.contentCache[e]?r=this.contentCache[e]:r=await fsUtils.readFile(e);const a={nameChanged:!1,scopeChanged:!1};let l=r;const c=await astWorker.parseInvokeApiConfig(r,o.name+"Api");return this.options.disabled&&(c.disabled===void 0?l=l.replace(/name:\s*['"`].*['"`],?/,`name: '${this.options.name}',
  disabled: true,`):l=l.replace(/disabled:\s*false,/,"disabled: true,")),c.testModule.weight!==this.options.weight&&(l=l.replace(/weight:\s*\d+,/,`weight: ${this.options.weight},`)),this.options.name!==c.name&&(l=l.replace(/fn:\s*.*Fn,/,`fn: ${this.options.name}Fn,`),l=l.replace(/import\s+\{\s*.*Fn\s*\}\s+from\s+".\/exportFn";?/,`import { ${this.options.name}Fn } from "./exportFn";`),l=l.replace(/export const .*Api\s*=/,`export const ${this.options.name}Api =`),l=l.replace(/name:\s*['"`].*['"`],?/,`name: '${this.options.name}',`),a.nameChanged=!0,await this.syncOtherFileName(e,c.name)),this.options.scope!==c.scope&&(c.scope!==void 0?l=l.replace(/scope:\s*['"`].*['"`],?/,this.options.scope.trim().length?`scope: '${this.options.scope}',`:""):this.options.scope.trim().length&&(l=l.replace(/name:\s*['"`].*['"`],?/,`scope: '${this.options.scope}',
  name: '${this.options.name}',`)),a.scopeChanged=!0,await this.syncOtherFileScope(e,c.scope)),l=l.replace(/^\s*\n/gm,""),l!==r&&(await fsUtils.writeFile(e,l),this.contentCache[e]=l),a}async applyDocumentOptions(documentFilePath){const exist=await exists(documentFilePath);if(!exist){console.error(`文件${documentFilePath}不存在`);return}let oldDocumentContent;this.contentCache[documentFilePath]?oldDocumentContent=this.contentCache[documentFilePath]:oldDocumentContent=await fsUtils.readFile(documentFilePath);const oldCode=eval(`${oldDocumentContent.replace("<ApiDocumentType>","").replace("export ","")};apiDocument`);let newCode=eval(`${this.documentTemplate.replace("<ApiDocumentType>","").replace("export ","")};apiDocument`);JSON.stringify(oldCode)!==JSON.stringify(newCode)&&(await fsUtils.writeFile(documentFilePath,this.documentTemplate),this.contentCache[documentFilePath]=this.documentTemplate)}async applyDialogOptions(dialogFilePath){const exist=await exists(dialogFilePath);if(!exist){console.error(`文件${dialogFilePath}不存在`);return}let oldDialogContent;this.contentCache[dialogFilePath]?oldDialogContent=this.contentCache[dialogFilePath]:oldDialogContent=await fsUtils.readFile(dialogFilePath);const oldCode=eval(`${oldDialogContent.replace("<TestModuleDialogType>","").replace("export ","")};dialogOptions`);let newCode=eval(`${this.dialogTemplate.replace("<TestModuleDialogType>","").replace("export ","")};dialogOptions`);JSON.stringify(oldCode)!==JSON.stringify(newCode)&&(await fsUtils.writeFile(dialogFilePath,this.dialogTemplate),this.contentCache[dialogFilePath]=this.dialogTemplate)}async apply(e,o){try{let n;o.scope?n=await pathUtils.resolve(e,"../../../"):n=await pathUtils.resolve(e,"../../");const r=await pathUtils.resolve(e,"../"),a=await pathUtils.resolve(n,`${this.options.scope.length?this.options.scope+"/":""}${this.options.name}`);if(await exists(await pathUtils.resolve(a,"index.ts")))return ElMessage.error(`${this.options.scope?this.options.scope+".":""}${this.options.name} 已存在,无法完成修改！`),!1;const c=await pathUtils.resolve(e,"../dialog.ts"),C=await pathUtils.resolve(e,"../document.ts"),p=await this.applyIndexOptions(e,o);if(await this.applyDocumentOptions(C),await this.applyDialogOptions(c),p?.nameChanged||p?.scopeChanged)if(await fsUtils.moveChildToNewDir(r,a))ElMessage.success("更新成功");else return console.error("更新失败",r,a,this.options.scope),ElMessage.error("更新失败"),!1;return!0}catch(n){return console.error("apply new options error:",n),!1}}}const _hoisted_1$1={"w-full":""},_hoisted_2$1={"w-full":"","box-border":"",flex:"","flex-col":""},_hoisted_3$1={class:"form-item"},_hoisted_4$1={class:"form-item"},_hoisted_5$1={class:"form-item"},_hoisted_6$1={flex:"","flex-row":"","flex-items-center":""},_hoisted_7$1={class:"form-item"},_hoisted_8={flex:"","flex-col":""},_hoisted_9={class:"form-item"},_hoisted_10={"i-mdi-chevron-down":""},_hoisted_11={"i-mdi-chevron-left":""},_hoisted_12={flex:"","flex-col":"","pl-5":"","box-border":"","mt-2":""},_hoisted_13={flex:"","flex-col":"","flex-items-start":"","mb-2":""},_hoisted_14={flex:"","flex-col":"","flex-items-start":"","mb-2":""},_hoisted_15={class:"value"},_hoisted_16={"w-full":"",flex:"","flex-row":"","flex-items-center":"","justify-center":""},_hoisted_17={flex:"","flex-col":"","flex-items-start":"","mb-2":"","w-full":""},_hoisted_18={"w-full":"","box-border":"","pl-2":""},_hoisted_19={class:"form-item","w-full":""},_hoisted_20={class:"value"},_hoisted_21={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","p-8px":""},_hoisted_22={flex:"","flex-col":"","flex-items-start":"","mb-2":"","w-full":""},_hoisted_23={"w-full":"","box-border":"","pl-2":""},_hoisted_24={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","p-8px":""},_hoisted_25={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","p-8px":""},_hoisted_26={flex:"","flex-row":"","flex-items-center":"","w-full":"","justify-between":"","pr-2":"","mb-2":"","box-border":""},_hoisted_27={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","pr-2":""},_hoisted_28={flex:"","flex-col":""},_hoisted_29={class:"form-item"},_hoisted_30={"i-mdi-chevron-down":""},_hoisted_31={"i-mdi-chevron-left":""},_hoisted_32={flex:"","flex-col":"","pl-5":"","box-border":"","w-full":"","pr-2":""},_hoisted_33={class:"form-item"},_hoisted_34={key:0},_hoisted_35={class:"form-item"},_hoisted_36={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","pl-8px":""},_hoisted_37={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","pl-8px":""},_hoisted_38={class:"form-item"},_hoisted_39={"i-mdi-chevron-down":""},_hoisted_40={"i-mdi-chevron-left":""},_hoisted_41={flex:"","flex-col":"","pl-5":"","box-border":"","w-full":"","pr-2":""},_sfc_main$1=defineComponent({__name:"InvokesManagerForm",props:mergeModels({scopeList:{type:Array,required:!0},anchorModel:{type:String,default:"horizontal"},anchorIdPrefix:{type:String,required:!0}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:o}){const n=useModel(e,"modelValue"),r=reactive([{name:"auxiliary",title:"辅助代码",code:"",show:!1,path:""},{name:"fn",title:"API本体",code:"",show:!1,path:""},{name:"cb",title:"《快捷输入/修改参数弹窗》回调代码",code:"",show:!1,path:""}]),a=async()=>{let D="";p.value.find(U=>(U.label===n.value.name?D=U.fullPath:U.children&&U.children.find(H=>{H.label===n.value.name&&(D=H.fullPath)}),!!D));const i=await pathUtils.resolve(D,"../auxiliary.ts"),g=r.find(U=>U.name==="auxiliary"),F=r.find(U=>U.name==="fn"),P=r.find(U=>U.name==="cb");if(await exists(i)){const U=await fsUtils.readFile(i);g.code=U,g.path=i}else g.code="",g.path="";const R=await pathUtils.resolve(D,"../exportFn.ts");if(await exists(R)){const U=await fsUtils.readFile(R);F.code=U,F.path=R}else F.code="",F.path="";const q=await pathUtils.resolve(D,"../modelCallback.ts");if(await exists(q)){const U=await fsUtils.readFile(q);P.code=U,P.path=q}else P.code="",P.path=""};watch(n,a,{deep:!0});const l=computed(()=>n.value.document.params),c=e,C=ref("");watchEffect(()=>{if(n.value.document,!n.value.document.codeSnippet?.trim().length){const D=new InvokeTemplate(n.value);C.value=D.defaultSnippet()}});const p=ref([]),N=ref(!0),u=ref(!0),y=()=>{if(n.value?.scope){let D=n.value.scope;n.value.scope=D.charAt(0).toUpperCase()+D.slice(1)}},{getApiModules:f}=useCore(),w=async()=>{const D=await f(!1,!0,!0),{groupRecordToOptions:i,dataGrouping:g}=dataStructureUtils,F=i(g(D,"scope"),"name","id",["disabled","id","fullPath","scope","testModule"]);p.value=F.map(P=>({...P,enabled:!P.disabled,disabled:!1,children:P.children?.map(R=>({...R,enabled:!R.disabled,disabled:!1}))}))};let x;onBeforeUnmount(()=>{x&&x()}),onMounted(async()=>{x=await listen("tauri://focus",D=>{a()},{target:getCurrentWebviewWindow().label}),await w(),a()});const b=(D,i)=>{const g=dataStructureUtils.findByIdInTree(i,n.value.document.params);g&&(D?(g.type=g.type.split("|"),g.type.includes(g.default)||(g.default=g.type[0])):g.type=g.type.join("|"))},s=["string","number","boolean","object","array","function","null","undefined"],$=(D,i)=>{const g=D?s.filter(R=>R.toLocaleLowerCase().includes(D.toLocaleLowerCase())):s,F=`'${D}'`;g.includes(F)||g.push(F);const P=`Promise<${D}>`;!g.includes(P)&&!g.includes(P.toLocaleLowerCase())&&!D.toLocaleLowerCase().includes("promise")&&g.push(P),!s.includes(D)&&!g.includes(D)&&(!D.includes("'")||!D.includes('"'))&&g.push(D),i(g.map(R=>({value:R})))},O=D=>{if(D===void 0)n.value.document.params?n.value.document.params.push({id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}):n.value.document.params=[{id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}];else{const i=dataStructureUtils.findByIdInTree(D,n.value.document.params);i&&(i.children?i.children.push({id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}):i.children=[{id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}])}},S=D=>{const i=dataStructureUtils.getTreeParentById(D,n.value.document.params);if(i){const g=i.findIndex(F=>F.id===D);if(g>0){if(!i[g].required&&i[g-1].required){ElMessage.warning("非必填参数不允许在必填参数之前");return}const F=i[g];i[g]=i[g-1],i[g-1]=F}}},I=D=>{const i=dataStructureUtils.getTreeParentById(D,n.value.document.params);if(i){const g=i.findIndex(F=>F.id===D);if(g<i.length-1){if(i[g].required&&!i[g+1].required){ElMessage.warning("必填参数不允许在非必填参数之后");return}const F=i[g];i[g]=i[g+1],i[g+1]=F}}},M=async D=>{if(D===void 0)try{await ElMessageBox.confirm("确定清空所有参数吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}),n.value.document.params=[],ElMessage.info("清空完成")}catch{}else try{await ElMessageBox.confirm("确定删除该参数吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"});const i=dataStructureUtils.getTreeParentById(D,n.value.document.params);i.splice(i.findIndex(g=>g.id===D),1),ElMessage.info("删除完成")}catch{}},j=(D,i)=>{i.required&&i.default!==""&&(i.default="");const g=dataStructureUtils.getTreeParentById(D,n.value.document.params);g&&g.sort((F,P)=>F.required===P.required?0:F.required?-1:1)};return o({codeSnippetPlaceholder:C,changeFormShow:D=>{switch(D){case 0:N.value=!0;break;case 1:u.value=!0;break;default:r[D-2].show=!0;break}}}),(D,i)=>{const g=ElText,F=ElInput,P=ElSwitch,R=ElOption,q=ElTag,U=ElSelect,H=ElInputNumber,z=ElIcon,T=ElButton,_=ElTableColumn,E=ElAutocomplete,V=ElCheckbox,m=ElTable,k=__unplugin_components_13,A=__unplugin_components_14;return openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,[createVNode(g,{tag:"b",id:c.anchorIdPrefix+"-api-name"},{default:withCtx(()=>i[19]||(i[19]=[createTextVNode("API名称")])),_:1},8,["id"]),createVNode(F,{modelValue:n.value.name,"onUpdate:modelValue":i[0]||(i[0]=v=>n.value.name=v),placeholder:"API名称",style:{width:"240px"}},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_4$1,[createVNode(g,{tag:"b",id:c.anchorIdPrefix+"-api-state"},{default:withCtx(()=>i[20]||(i[20]=[createTextVNode("API状态")])),_:1},8,["id"]),createVNode(P,{modelValue:n.value.disabled,"onUpdate:modelValue":i[1]||(i[1]=v=>n.value.disabled=v),"active-text":"禁用","inactive-text":"启用",style:{"--el-switch-on-color":"#ff4949","--el-switch-off-color":"var(--el-color-primary)"}},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_5$1,[createVNode(g,{tag:"b",id:c.anchorIdPrefix+"-ns"},{default:withCtx(()=>i[21]||(i[21]=[createTextVNode("命名空间(namespace)")])),_:1},8,["id"]),createVNode(U,{modelValue:n.value.scope,"onUpdate:modelValue":i[2]||(i[2]=v=>n.value.scope=v),filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"Root",style:{width:"240px"},onChange:y},{label:withCtx(({label:v})=>[createBaseVNode("div",_hoisted_6$1,[c.scopeList.find(B=>B.label===v)?createCommentVNode("",!0):(openBlock(),createBlock(q,{key:0,size:"small",type:"success","mr-1":""},{default:withCtx(()=>i[22]||(i[22]=[createTextVNode("new")])),_:1})),createVNode(g,null,{default:withCtx(()=>[createTextVNode(toDisplayString(v),1)]),_:2},1024)])]),default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(c.scopeList,(v,B)=>(openBlock(),createBlock(R,{key:B,label:v.label,value:v.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),createBaseVNode("div",_hoisted_7$1,[createVNode(g,{tag:"b",id:c.anchorIdPrefix+"-weight"},{default:withCtx(()=>i[23]||(i[23]=[createTextVNode("显示权重(越大默认排序越靠前)")])),_:1},8,["id"]),createVNode(H,{modelValue:n.value.weight,"onUpdate:modelValue":i[3]||(i[3]=v=>n.value.weight=v),min:0,placeholder:"显示权重"},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_8,[createBaseVNode("div",_hoisted_9,[createVNode(g,{tag:"b",id:c.anchorIdPrefix+"-api-doc"},{default:withCtx(()=>i[24]||(i[24]=[createTextVNode("API文档")])),_:1},8,["id"]),createVNode(T,{link:"",onClick:i[4]||(i[4]=v=>N.value=!unref(N))},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>[withDirectives(createBaseVNode("span",_hoisted_10,null,512),[[vShow,unref(N)]]),withDirectives(createBaseVNode("span",_hoisted_11,null,512),[[vShow,!unref(N)]])]),_:1})]),_:1})]),withDirectives(createBaseVNode("div",_hoisted_12,[createBaseVNode("div",_hoisted_13,[createVNode(g,{"self-start":"","mb-2":""},{default:withCtx(()=>i[25]||(i[25]=[createTextVNode("API使用介绍")])),_:1}),createVNode(F,{modelValue:n.value.document.howToUse,"onUpdate:modelValue":i[5]||(i[5]=v=>n.value.document.howToUse=v),type:"textarea",placeholder:"API使用介绍",autosize:""},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_14,[createVNode(g,{"self-start":"","mb-2":""},{default:withCtx(()=>i[26]||(i[26]=[createTextVNode("API参数")])),_:1}),createVNode(m,{data:n.value.document.params,"table-layout":"fixed","row-key":"id","default-expand-all":"",border:!0,"max-height":"75vh"},{default:withCtx(()=>[createVNode(_,{prop:"name",label:"参数名",fixed:"",width:"180"},{default:withCtx(v=>[createVNode(F,{modelValue:v.row.name,"onUpdate:modelValue":B=>v.row.name=B,placeholder:"参数名"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(_,{prop:"required",label:"必填",width:"70"},{default:withCtx(v=>[createVNode(P,{modelValue:v.row.required,"onUpdate:modelValue":B=>v.row.required=B,"active-text":"是","inactive-text":"否","inline-prompt":"",onChange:B=>j(v.row.id,v.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),createVNode(_,{prop:"instructions",label:"说明",width:"260"},{default:withCtx(v=>[createVNode(F,{modelValue:v.row.instructions,"onUpdate:modelValue":B=>v.row.instructions=B,type:"textarea",placeholder:"说明",size:"small",autosize:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(_,{prop:"type",label:"类型",width:"200"},{default:withCtx(v=>[Array.isArray(v.row.type)?(openBlock(),createBlock(U,{key:0,multiple:"",modelValue:v.row.type,"onUpdate:modelValue":B=>v.row.type=B,filterable:"","allow-create":""},null,8,["modelValue","onUpdate:modelValue"])):(openBlock(),createBlock(E,{key:1,modelValue:v.row.type,"onUpdate:modelValue":B=>v.row.type=B,"fetch-suggestions":$,clearable:"",placeholder:"请输入类型名称"},{default:withCtx(({item:B})=>[createBaseVNode("div",_hoisted_15,toDisplayString(B.value),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])),createVNode(V,{"ml-1":"",checked:Array.isArray(v.row.type),label:"枚举",size:"small",onChange:B=>b(B,v.row.id)},null,8,["checked","onChange"])]),_:1}),createVNode(_,{prop:"default",label:"默认值"},{default:withCtx(v=>[Array.isArray(v.row.type)?(openBlock(),createBlock(U,{key:0,modelValue:v.row.default,"onUpdate:modelValue":B=>v.row.default=B,size:"small",disabled:v.row.required,filterable:"","allow-create":"",clearable:""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(v.row.type,B=>(openBlock(),createBlock(R,{key:B,label:B,value:B},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])):(openBlock(),createBlock(F,{key:1,modelValue:v.row.default,"onUpdate:modelValue":B=>v.row.default=B,placeholder:"默认值",size:"small",disabled:v.row.required},null,8,["modelValue","onUpdate:modelValue","disabled"]))]),_:1}),createVNode(_,{fixed:"right",width:"100"},{header:withCtx(()=>[createVNode(T,{link:"",type:"danger",size:"large",onClick:i[6]||(i[6]=v=>M())},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>i[27]||(i[27]=[createBaseVNode("span",{"i-mdi-sort-variant-remove":""},null,-1)])),_:1})]),_:1}),createVNode(T,{link:"",type:"primary",size:"large",onClick:i[7]||(i[7]=v=>O())},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>i[28]||(i[28]=[createBaseVNode("span",{"i-mdi-playlist-plus":""},null,-1)])),_:1})]),_:1})]),default:withCtx(v=>[createBaseVNode("div",_hoisted_16,[createVNode(T,{link:"",class:"ml-1",type:"danger",onClick:B=>M(v.row.id)},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>i[29]||(i[29]=[createBaseVNode("span",{"i-mdi-close":""},null,-1)])),_:1})]),_:2},1032,["onClick"]),createVNode(T,{link:"",class:"ml-1",type:"primary",onClick:B=>O(v.row.id)},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>i[30]||(i[30]=[createBaseVNode("span",{"i-mdi-filter-variant-plus":""},null,-1)])),_:1})]),_:2},1032,["onClick"]),createVNode(T,{link:"",class:"ml-1",onClick:B=>S(v.row.id)},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>i[31]||(i[31]=[createBaseVNode("span",{"i-mdi-arrow-up-thin":""},null,-1)])),_:1})]),_:2},1032,["onClick"]),createVNode(T,{link:"",class:"ml-1",onClick:B=>I(v.row.id)},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>i[32]||(i[32]=[createBaseVNode("span",{"i-mdi-arrow-down-thin":""},null,-1)])),_:1})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])]),createBaseVNode("div",_hoisted_17,[createVNode(g,{"self-start":""},{default:withCtx(()=>i[33]||(i[33]=[createTextVNode("返回值")])),_:1}),createBaseVNode("div",_hoisted_18,[createBaseVNode("div",_hoisted_19,[createVNode(g,null,{default:withCtx(()=>i[34]||(i[34]=[createTextVNode("类型")])),_:1}),createVNode(E,{modelValue:n.value.document.returnValue.type,"onUpdate:modelValue":i[8]||(i[8]=v=>n.value.document.returnValue.type=v),style:{width:"480px"},"fetch-suggestions":$,clearable:"",placeholder:"请输入类型名称"},{default:withCtx(({item:v})=>[createBaseVNode("div",_hoisted_20,toDisplayString(v.value),1)]),_:1},8,["modelValue"])]),createBaseVNode("div",_hoisted_21,[createVNode(g,{"self-start":"","mb-2":""},{default:withCtx(()=>i[35]||(i[35]=[createTextVNode("返回值说明")])),_:1}),createVNode(F,{modelValue:n.value.document.returnValue.instructions,"onUpdate:modelValue":i[9]||(i[9]=v=>n.value.document.returnValue.instructions=v),type:"textarea",placeholder:"返回值说明",autosize:""},null,8,["modelValue"])])])]),createBaseVNode("div",_hoisted_22,[createVNode(g,{"self-start":""},{default:withCtx(()=>i[36]||(i[36]=[createTextVNode("示例")])),_:1}),createBaseVNode("div",_hoisted_23,[createBaseVNode("div",_hoisted_24,[createVNode(g,{"self-start":""},{default:withCtx(()=>i[37]||(i[37]=[createTextVNode("标题")])),_:1}),createVNode(F,{modelValue:n.value.document.example.title,"onUpdate:modelValue":i[10]||(i[10]=v=>n.value.document.example.title=v),type:"textarea",placeholder:"示例标题",autosize:""},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_25,[createVNode(g,{"self-start":""},{default:withCtx(()=>i[38]||(i[38]=[createTextVNode("代码")])),_:1}),createVNode(F,{modelValue:n.value.document.example.code,"onUpdate:modelValue":i[11]||(i[11]=v=>n.value.document.example.code=v),type:"textarea",placeholder:"示例代码",autosize:""},null,8,["modelValue"])])])]),createBaseVNode("div",_hoisted_26,[createVNode(g,null,{default:withCtx(()=>i[39]||(i[39]=[createTextVNode("搜索关键词")])),_:1}),createVNode(U,{multiple:"",filterable:"","allow-create":"",modelValue:n.value.document.searchKeys,"onUpdate:modelValue":i[12]||(i[12]=v=>n.value.document.searchKeys=v),style:{width:"480px"},placeholder:"可以添加搜索关键词"},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_27,[createVNode(g,{"self-start":""},{default:withCtx(()=>i[40]||(i[40]=[createTextVNode("代码片段(不填按照下面提示的内容生成)")])),_:1}),createVNode(F,{modelValue:n.value.document.codeSnippet,"onUpdate:modelValue":i[13]||(i[13]=v=>n.value.document.codeSnippet=v),type:"textarea",placeholder:unref(C),autosize:""},null,8,["modelValue","placeholder"])])],512),[[vShow,unref(N)]])]),createBaseVNode("div",_hoisted_28,[createBaseVNode("div",_hoisted_29,[createVNode(g,{tag:"b",id:c.anchorIdPrefix+"-api-test"},{default:withCtx(()=>i[41]||(i[41]=[createTextVNode("测试弹窗/快速修改参数弹窗")])),_:1},8,["id"]),createVNode(T,{link:"",onClick:i[14]||(i[14]=v=>u.value=!unref(u))},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>[withDirectives(createBaseVNode("span",_hoisted_30,null,512),[[vShow,unref(u)]]),withDirectives(createBaseVNode("span",_hoisted_31,null,512),[[vShow,!unref(u)]])]),_:1})]),_:1})]),withDirectives(createBaseVNode("div",_hoisted_32,[createBaseVNode("div",_hoisted_33,[createVNode(g,null,{default:withCtx(()=>i[42]||(i[42]=[createTextVNode("不启用[测试弹窗/快速修改参数弹窗]")])),_:1}),createVNode(P,{modelValue:n.value.dialog.notOpen,"onUpdate:modelValue":i[15]||(i[15]=v=>n.value.dialog.notOpen=v),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),n.value.dialog.notOpen?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_34,[createBaseVNode("div",_hoisted_35,[createVNode(g,null,{default:withCtx(()=>i[43]||(i[43]=[createTextVNode("在API测试窗口显示的名称")])),_:1}),createVNode(F,{modelValue:n.value.dialog.title,"onUpdate:modelValue":i[16]||(i[16]=v=>n.value.dialog.title=v),placeholder:"在API测试窗口显示的名称",style:{width:"240px"}},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_36,[createVNode(g,{"self-start":""},{default:withCtx(()=>i[44]||(i[44]=[createTextVNode("弹窗中显示的内容(用于对API进行介绍或者说明)")])),_:1}),createVNode(F,{modelValue:n.value.dialog.content,"onUpdate:modelValue":i[17]||(i[17]=v=>n.value.dialog.content=v),autosize:"",placeholder:"弹窗中显示的内容",type:"textarea"},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_37,[createVNode(g,{"self-start":""},{default:withCtx(()=>i[45]||(i[45]=[createTextVNode("弹窗组件编辑(可从左侧将指定参数组件拖拽至右侧)")])),_:1}),createVNode(k,{modelValue:n.value.dialog.args,"onUpdate:modelValue":i[18]||(i[18]=v=>n.value.dialog.args=v),"document-params":unref(l)},null,8,["modelValue","document-params"])])]))],512),[[vShow,unref(u)]])]),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(r),v=>(openBlock(),createElementBlock("div",{flex:"","flex-col":"",key:v.name},[createBaseVNode("div",_hoisted_38,[createVNode(g,{tag:"b",id:c.anchorIdPrefix+"-"+v.name},{default:withCtx(()=>[createTextVNode(toDisplayString(v.title),1)]),_:2},1032,["id"]),createVNode(T,{link:"",onClick:B=>v.show=!v.show},{default:withCtx(()=>[createVNode(z,{size:"large"},{default:withCtx(()=>[withDirectives(createBaseVNode("span",_hoisted_39,null,512),[[vShow,v.show]]),withDirectives(createBaseVNode("span",_hoisted_40,null,512),[[vShow,!v.show]])]),_:2},1024)]),_:2},1032,["onClick"])]),withDirectives(createBaseVNode("div",_hoisted_41,[createVNode(A,{"raw-code":v.code,"file-path":v.path},null,8,["raw-code","file-path"])],512),[[vShow,v.show]])]))),128))])])}}}),__unplugin_components_6=_export_sfc$1(_sfc_main$1,[["__scopeId","data-v-1582449d"]]),_hoisted_1={class:"container-root","w-full":"","h-full":"","pos-relative":"","p-0":"","box-border":"","overflow-hidden":"",flex:"","p-5px":"","flex-col":""},_hoisted_2={"h-40px":"",flex:"","flex-row":"","justify-between":"","flex-items-center":"","w-full":"","p-5px":"","box-border":"","border-rd-10px":""},_hoisted_3={flex:"","flex-row":"","justify-end":"","flex-items-center":""},_hoisted_4={flex:"","flex-items-center":"","flex-row":""},_hoisted_5=["onClick"],_hoisted_6={key:1,"w-120px":"","ml-5":"","flex-col":"","mt-10":""},_hoisted_7=["onClick"],_sfc_main=defineComponent({__name:"InvokesManager",setup(e){useCssVars(E=>({"1a4a352e":unref(p)}));const o=getCurrentWebviewWindow(),n=ref(""),r=ref(),a=ref(),l=["管理API","创建API"],c=ref("管理API"),C=ref(null),{appBackground:p}=useAppTheme(),N=ref("");let u="";const y=ref({manager:defaultInvokeTemplateOptions(),create:defaultInvokeTemplateOptions()}),f=reactive([]);let w="";watch(N,()=>{const E=S.value.map(m=>m.children?m.children:[m]).flat().map(m=>({...m,scope:m.scope?m.scope:""})).find(m=>m.id===N.value),V={name:E?.label||"",scope:E?.scope||"",weight:E?.testModule?.weight||1,disabled:E?.disabled||!1,document:E?.testModule?.document||{howToUse:"",params:[],returnValue:{instructions:"",type:""},example:{title:"",code:""},searchKeys:[],codeSnippet:""},dialog:E?.testModule?.dialog||{title:"",content:"",args:[]}};y.value.manager=V,w=E?.fullPath||"",u=JSON.stringify(V),f.splice(0,f.length,{label:"Root",value:""},...S.value.filter(m=>m.children).map(m=>({label:m.children[0].scope||"Root",value:m.children[0].scope||""})))});const x=computed(()=>u!==JSON.stringify(y.value.manager)&&!!N.value.length),b=(E=!0)=>{y.value.manager=JSON.parse(u),E&&ElMessage.success("重置成功")},s=async()=>{const E=JSON.parse(u);await new InvokeTemplate(JSON.parse(u)).apply(w,E)&&(u=JSON.stringify(y.value.manager))},$=async()=>{try{await ElMessageBox.confirm("删除后无法恢复，请谨慎删除！",`删除${y.value.manager.scope}.${y.value.manager.name}`,{confirmButtonText:"删除",cancelButtonText:"取消",confirmButtonClass:"el-button--danger",type:"error"})}catch{return}try{const E=await pathUtils.resolve(w,"../"),V=await pathUtils.resolve(E,"../");await fsUtils.deleteDir(E,!0)?(await fsUtils.deleteDir(V,!1,!0),ElMessage.success("删除成功")):ElMessage.error("删除失败")}catch(E){console.error(E),ElMessage.error("删除失败")}},O=async E=>{if(x.value){try{await ElMessageBox.confirm("是否保存当前修改？","提示",{confirmButtonText:"保存",cancelButtonText:"放弃更改",type:"warning"})}catch{b(!1),E.srcElement?.click();return}s()}},S=ref([]),{getApiModules:I}=useCore(),M=E=>{S.value=E.map(V=>({...V,enabled:!V.disabled,disabled:!1,testModule:{...V.testModule,document:{...V.testModule?.document,params:dataStructureUtils.genTreeArrNodeId(V.testModule?.document?.params||[]),returnValue:{...V.testModule?.document?.returnValue,instructions:V.testModule?.document?.returnValue?.instructions||""},example:{...V.testModule?.document?.example,title:V.testModule?.document?.example?.title||"",code:V.testModule?.document?.example?.code||""},searchKeys:V.testModule?.document?.searchKeys||[],codeSnippet:V.testModule?.document?.codeSnippet||""},dialog:{...V.testModule?.dialog,args:V.testModule?.dialog?.args?.map(m=>{const k=nanoid();return m.componentType==="DirInput"?{...m,id:k,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1,suffix:m.suffix||"",verifyPath:m.verifyPath||!1}:m.componentType==="FileInput"?{...m,id:k,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1,suffix:m.suffix||"",verifyPath:m.verifyPath||!1,multiple:m.multiple||!1,value:m.value||(m.multiple?[]:"")}:m.componentType==="RectInput"?{...m,id:k,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1,targetSrc:m.targetSrc||""}:m.componentType==="select"?{...m,id:k,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1,options:m.options||[],multiple:m.multiple||!1,value:m.value||(m.multiple?[]:""),selectOptionSeparator:m.selectOptionSeparator||"",notAllowCreate:m.notAllowCreate||!1}:m.componentType==="numberRangeInput"?{...m,id:k,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1,limit:m.limit||[0,0]}:m.componentType==="switch"?{...m,id:k,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1,activeText:m.activeText||"是",inactiveText:m.inactiveText||"否"}:m.componentType==="slider"?{...m,id:k,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1,range:m.range||{max:1,min:0,step:.1}}:{...m,id:k,noTest:m.noTest||!1,onlyTest:m.onlyTest||!1}}),notOpen:V.testModule?.dialog?.notOpen||!1,title:V.testModule?.dialog?.title||"",content:V.testModule?.dialog?.content||""}},children:V.children?.map(m=>({...m,enabled:!m.disabled,disabled:!1,testModule:{...m.testModule,document:{...m.testModule?.document,params:dataStructureUtils.genTreeArrNodeId(m.testModule?.document?.params||[]),returnValue:{...m.testModule?.document?.returnValue,instructions:m.testModule?.document?.returnValue?.instructions||""},example:{...m.testModule?.document?.example,title:m.testModule?.document?.example?.title||"",code:m.testModule?.document?.example?.code||""},searchKeys:m.testModule?.document?.searchKeys||[],codeSnippet:m.testModule?.document?.codeSnippet||""},dialog:{...m.testModule?.dialog,args:m.testModule?.dialog?.args?.map(k=>{const A=nanoid();return k.componentType==="DirInput"?{...k,id:A,noTest:k.noTest||!1,onlyTest:k.onlyTest||!1,suffix:k.suffix||"",verifyPath:k.verifyPath||!1}:k.componentType==="FileInput"?{...k,id:A,noTest:k.noTest||!1,onlyTest:k.onlyTest||!1,suffix:k.suffix||"",verifyPath:k.verifyPath||!1,multiple:k.multiple||!1,value:k.value||(k.multiple?[]:"")}:k.componentType==="RectInput"?{...k,id:A,noTest:k.noTest||!1,onlyTest:k.onlyTest||!1,targetSrc:k.targetSrc||""}:k.componentType==="select"?{...k,id:A,noTest:k.noTest||!1,onlyTest:k.onlyTest||!1,options:k.options||[],multiple:k.multiple||!1,value:k.value||(k.multiple?[]:""),selectOptionSeparator:k.selectOptionSeparator||"",notAllowCreate:k.notAllowCreate||!1}:k.componentType==="numberRangeInput"?{...k,id:A,noTest:k.noTest||!1,onlyTest:k.onlyTest||!1,limit:k.limit||[0,0]}:k.componentType==="switch"?{...k,id:A,noTest:k.noTest||!1,onlyTest:k.onlyTest||!1,activeText:k.activeText||"是",inactiveText:k.inactiveText||"否"}:k.componentType==="slider"?{...k,id:A,noTest:k.noTest||!1,onlyTest:k.onlyTest||!1,range:k.range||{max:1,min:0,step:.1}}:{...k,id:A,noTest:k.noTest||!1,onlyTest:k.onlyTest||!1}}),notOpen:m.testModule?.dialog?.notOpen||!1,title:m.testModule?.dialog?.title||"",content:m.testModule?.dialog?.content||""}}}))})),S.value[0]&&(S.value[0].children&&S.value[0].children[0]?N.value=S.value[0].children[0].id:N.value=S.value[0].id)},j=async()=>{const E=JSON.parse(JSON.stringify(await I(!1,!0,!0))),{groupRecordToOptions:V,dataGrouping:m}=dataStructureUtils,k=V(m(E,"scope"),"name","id",["disabled","id","fullPath","scope","testModule"]);M(k)},K=ref("horizontal"),D=async()=>{await o.isMaximized()?K.value="vertical":K.value="horizontal"},i=reactive([{value:"api-name",label:"名称"},{value:"api-state",label:"状态"},{value:"ns",label:"命名空间"},{value:"weight",label:"权重"},{value:"api-doc",label:"文档"},{value:"api-test",label:"弹窗"},{value:"auxiliary",label:"辅助代码"},{value:"fn",label:"API本体"},{value:"cb",label:"回调代码"}]),g=E=>{const V=document.getElementById((c.value==="管理API"?"manager":"create")+"-"+E);if(V){const k=i.slice(-5).map(A=>A.value).indexOf(E);if(k!==-1){let A;c.value==="创建API"?A=r.value.changeFormShow:A=a.value.changeFormShow,A&&A(k)}nextTick(()=>{V.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})})}};let F={manager:i[0].value,create:i[0].value};watch(n,E=>{c.value==="管理API"?F.manager=E:F.create=E});const P=()=>{c.value==="创建API"?(n.value=F.create,setTimeout(()=>{g(F.create)},100)):(n.value=F.manager,setTimeout(()=>{g(F.manager)},100))};let R,q=!1,U=0;const H=E=>{R&&clearTimeout(R),R=setTimeout(()=>{const V=E.target.scrollTop||0,m=i.find(k=>{const A=document.getElementById((c.value==="管理API"?"manager":"create")+"-"+k.value);if(A){const v=A.getBoundingClientRect();return v.top>=70&&v.bottom<=window.innerHeight}return!1});if(m)n.value=m.value,q=!1;else if(V<U){const k=i.findIndex(A=>A.value===n.value);k>0&&!q&&(n.value=i[k-1].value,q=!0)}U=V})};onMounted(async()=>{await j(),D(),window.addEventListener("resize",D),C.value?.addEventListener("scroll",H),n.value=i[0].value,invokeBaseApi.closeSplashscreen()}),onUnmounted(()=>{window.removeEventListener("resize",D),C.value?.removeEventListener("scroll",H)});const z=(E,V)=>{const m=V.testModule?.dialog,k=V.testModule?.document;return V.label.toLocaleLowerCase().includes(E.toLocaleLowerCase())||m?.title?.toLocaleLowerCase().includes(E.toLocaleLowerCase())||m?.content?.toLocaleLowerCase().includes(E.toLocaleLowerCase())||k?.howToUse?.toLocaleLowerCase().includes(E.toLocaleLowerCase())||k?.searchKeys?.some(A=>A.toLocaleLowerCase().includes(E.toLocaleLowerCase()))},T=async()=>{try{await ElMessageBox.confirm("是否清空当前内容？","提示",{confirmButtonText:"清空",cancelButtonText:"取消",type:"warning"})}catch{return}y.value.create=defaultInvokeTemplateOptions(),ElMessage.success("清空完成")},_=()=>{const{codeSnippetPlaceholder:E}=r.value;y.value.create.document.codeSnippet?.trim().length||(y.value.create.document.codeSnippet=E),new InvokeTemplate(y.value.create).create(),ElMessage.success("创建成功")};return(E,V)=>{const m=ElSegmented,k=ElText,A=ElTag,v=ElTreeSelect,B=ElButton,W=ElButtonGroup,Y=__unplugin_components_6,G=ElEmpty;return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createVNode(m,{modelValue:unref(c),"onUpdate:modelValue":V[0]||(V[0]=L=>isRef(c)?c.value=L:null),options:l,"ml-1":"",onChange:P},null,8,["modelValue"]),createBaseVNode("div",_hoisted_3,[withDirectives(createVNode(k,{tag:"b"},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(x)?"*":""),1)]),_:1},512),[[vShow,unref(c)==="管理API"]]),withDirectives(createVNode(v,{size:"small",onClick:O,"w-300px":"","mr-10px":"",modelValue:unref(N),"onUpdate:modelValue":V[1]||(V[1]=L=>isRef(N)?N.value=L:null),data:unref(S),"filter-node-method":z,clearable:"",placeholder:"请选择API",filterable:"","default-expand-all":""},{default:withCtx(({data:{label:L,children:J,enabled:Q}})=>[createBaseVNode("div",_hoisted_4,[createTextVNode(toDisplayString(L),1),J?(openBlock(),createBlock(A,{key:0,"ml-1":"",size:"small"},{default:withCtx(()=>V[6]||(V[6]=[createTextVNode("namespace")])),_:1})):createCommentVNode("",!0),Q?createCommentVNode("",!0):(openBlock(),createBlock(A,{key:1,size:"small",type:"danger","ml-1":""},{default:withCtx(()=>V[7]||(V[7]=[createTextVNode("已禁用")])),_:1}))])]),_:1},8,["modelValue","data"]),[[vShow,unref(c)==="管理API"]]),withDirectives(createVNode(W,{"ml-1":"",size:"small"},{default:withCtx(()=>[createVNode(B,{type:"danger",onClick:$},{default:withCtx(()=>V[8]||(V[8]=[createTextVNode("删除API")])),_:1}),createVNode(B,{onClick:V[2]||(V[2]=L=>b(!0)),disabled:!unref(x)},{default:withCtx(()=>V[9]||(V[9]=[createTextVNode("恢复修改前")])),_:1},8,["disabled"]),createVNode(B,{type:"primary",onClick:s,disabled:!unref(x)},{default:withCtx(()=>V[10]||(V[10]=[createTextVNode("保存修改")])),_:1},8,["disabled"])]),_:1},512),[[vShow,unref(c)==="管理API"]]),withDirectives(createVNode(W,{"ml-1":"",size:"small"},{default:withCtx(()=>[createVNode(B,{onClick:T},{default:withCtx(()=>V[11]||(V[11]=[createTextVNode("清空内容")])),_:1}),createVNode(B,{type:"primary",onClick:_},{default:withCtx(()=>V[12]||(V[12]=[createTextVNode("保存新建")])),_:1})]),_:1},512),[[vShow,unref(c)==="创建API"]])])]),createBaseVNode("div",{flex:"","w-full":"",class:"content-container",style:normalizeStyle({flexDirection:unref(K)==="horizontal"?"column":"row"})},[unref(K)==="horizontal"?(openBlock(),createBlock(m,{key:0,modelValue:unref(n),"onUpdate:modelValue":V[3]||(V[3]=L=>isRef(n)?n.value=L:null),options:unref(i),size:"small",block:!0},{default:withCtx(({item:L})=>[typeof L=="object"?(openBlock(),createElementBlock("div",{key:0,onClick:J=>g(L.value)},toDisplayString(L.label),9,_hoisted_5)):createCommentVNode("",!0)]),_:1},8,["modelValue","options"])):createCommentVNode("",!0),createBaseVNode("div",{"overflow-y-scroll":"","overflow-x-hidden":"",ref_key:"scrollRef",ref:C,"flex-1":""},[withDirectives(createVNode(Y,{ref_key:"IMFRef_manager",ref:a,modelValue:unref(y).manager,"onUpdate:modelValue":V[4]||(V[4]=L=>unref(y).manager=L),"scope-list":unref(f),"anchor-model":unref(K),"anchor-id-prefix":"manager"},null,8,["modelValue","scope-list","anchor-model"]),[[vShow,unref(c)==="管理API"&&unref(N)]]),withDirectives(createVNode(G,{description:"请选择一个API进行管理"},null,512),[[vShow,unref(c)==="管理API"&&!unref(N)]]),withDirectives(createVNode(Y,{ref_key:"IMFRef",ref:r,modelValue:unref(y).create,"onUpdate:modelValue":V[5]||(V[5]=L=>unref(y).create=L),"scope-list":unref(f),"anchor-model":unref(K),"anchor-id-prefix":"create"},null,8,["modelValue","scope-list","anchor-model"]),[[vShow,unref(c)==="创建API"]])],512),unref(K)==="vertical"?(openBlock(),createElementBlock("div",_hoisted_6,[createVNode(k,{tag:"b"},{default:withCtx(()=>V[13]||(V[13]=[createTextVNode("表单项")])),_:1}),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(i),L=>(openBlock(),createElementBlock("div",{class:normalizeClass(["link-item",{active:unref(n)===L.value}]),onClick:J=>g(L.value),link:"",key:L.value},toDisplayString(L.label),11,_hoisted_7))),128))])):createCommentVNode("",!0)],4)])}}}),InvokesManager=_export_sfc$1(_sfc_main,[["__scopeId","data-v-42f93c6e"]]);export{InvokesManager as default};
